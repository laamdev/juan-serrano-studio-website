import{c as Jl,i as Zl,g as po,P as $s}from"../chunks/constants.bf7ff794.js";import{s as eu,h as Js,n as Zs}from"../chunks/scheduler.dd28e2fa.js";import{S as tu,i as ru,s as Vi,g as xr,m as eo,A as iu,f as Or,c as Wi,h as Mr,j as Yi,n as to,B as ro,k as ur,l as nu,a as io,x as Kt}from"../chunks/index.43f321c1.js";const au=async()=>{const{infos:b}=await Jl.request(Zl);return{info:b[0]}},fd=Object.freeze(Object.defineProperty({__proto__:null,load:au},Symbol.toStringTag,{value:"Module"}));var yo={exports:{}};/*!
 * mux-embed
 * @version 4.26.0
 * @copyright 2023 Mux, Inc
 */(function(b,k){(function(){var I;I=function(){return function(){var F={80:function(j,V,Y){j.exports=Y(728).default},728:function(j,V,Y){Y.d(V,{default:function(){return sr}});var oe=Y(48),z=Y.n(oe),te=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(p){var h=16*Math.random()|0;return(p==="x"?h:3&h|8).toString(16)})},Re=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},ce=function(p){return p&&p.nodeName!==void 0?(p.muxId||(p.muxId=p.id||Re()),p.muxId):p},de=function(p){var h;p&&p.nodeName!==void 0?p=ce(h=p):h=document.querySelector(p);var m=h&&h.nodeName?h.nodeName.toLowerCase():"";return[h,p,m]},xe=Y(640),Ae=Y.n(xe),Qe=Ae().methodFactory;Ae().methodFactory=function(p,h,m){var g=Qe(p,h,m);return function(){for(var w=["[mux]"],C=0;C<arguments.length;C++)w.push(arguments[C]);g.apply(void 0,w)}},Ae().setLevel(Ae().getLevel());var ee=Ae();function fe(){return(z().doNotTrack||z().navigator&&z().navigator.doNotTrack)==="1"}var Te={now:function(){var p=z().performance,h=p&&p.timing,m=h&&h.navigationStart,g=typeof m=="number"&&typeof p.now=="function"?m+p.now():Date.now();return Math.round(g)}},De=function(p){return we(p)[0]},we=function(p){if(typeof p!="string"||p==="")return["localhost"];var h,m=(p.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return m&&(h=(m.match(/[^\.]+\.[^\.]+$/)||[])[0]),[m,h]},$={exists:function(){var p=z().performance;return(p&&p.timing)!==void 0},domContentLoadedEventEnd:function(){var p=z().performance,h=p&&p.timing;return h&&h.domContentLoadedEventEnd},navigationStart:function(){var p=z().performance,h=p&&p.timing;return h&&h.navigationStart}};function T(p,h,m){m=m===void 0?1:m,p[h]=p[h]||0,p[h]+=m}var Z=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],N=["x-cdn","content-type"].concat(Z);function ye(p){var h={};return(p=p||"").trim().split(/[\r\n]+/).forEach(function(m){if(m){var g=m.split(": "),w=g.shift();w&&(N.indexOf(w.toLowerCase())>=0||w.toLowerCase().indexOf("x-litix-")===0)&&(h[w]=g.join(": "))}}),h}function Ye(p){if(p){var h=Z.find(function(m){return p[m]!==void 0});return h?p[h]:void 0}}var Je=function(p){var h={};for(var m in p){var g=p[m];g["DATA-ID"].search("io.litix.data.")!==-1&&(h[g["DATA-ID"].replace("io.litix.data.","")]=g.VALUE)}return h};function Ct(p,h){var m=Object.keys(p);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(p);h&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(p,w).enumerable})),m.push.apply(m,g)}return m}function Ve(p){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?Ct(Object(m),!0).forEach(function(g){x(p,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(m)):Ct(Object(m)).forEach(function(g){Object.defineProperty(p,g,Object.getOwnPropertyDescriptor(m,g))})}return p}function x(p,h,m){return h in p?Object.defineProperty(p,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):p[h]=m,p}var jt=function(p){if(!p)return{};var h=$.navigationStart(),m=p.loading,g=m?m.start:p.trequest,w=m?m.first:p.tfirst,C=m?m.end:p.tload;return{bytesLoaded:p.total,requestStart:Math.round(h+g),responseStart:Math.round(h+w),responseEnd:Math.round(h+C)}},Pt=function(p){if(p&&typeof p.getAllResponseHeaders=="function")return ye(p.getAllResponseHeaders())};function Xe(p,h){var m=Object.keys(p);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(p);h&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(p,w).enumerable})),m.push.apply(m,g)}return m}function Vt(p){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?Xe(Object(m),!0).forEach(function(g){Be(p,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(m)):Xe(Object(m)).forEach(function(g){Object.defineProperty(p,g,Object.getOwnPropertyDescriptor(m,g))})}return p}function Be(p,h,m){return h in p?Object.defineProperty(p,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):p[h]=m,p}var Et=function(p,h){if(!p||typeof p.getRequests!="function")return{};var m=p.getRequests({state:"executed"});if(m.length===0)return{};var g,w=m[m.length-1],C=De(w.url),L=w.url,M=w.bytesLoaded,P=new Date(w.requestStartDate).getTime(),W=new Date(w.firstByteDate).getTime(),ue=new Date(w.requestEndDate).getTime(),pe=isNaN(w.duration)?0:w.duration,Ce=typeof h.getMetricsFor=="function"?h.getMetricsFor(w.mediaType).HttpList:h.getDashMetrics().getHttpRequests(w.mediaType);return Ce.length>0&&(g=ye(Ce[Ce.length-1]._responseHeaders||"")),{requestStart:P,requestResponseStart:W,requestResponseEnd:ue,requestBytesLoaded:M,requestResponseHeaders:g,requestMediaDuration:pe,requestHostname:C,requestUrl:L,requestId:g?Ye(g):void 0}},Ze=function(p,h){var m=h.getQualityFor(p),g=h.getCurrentTrackFor(p).bitrateList;return g?{currentLevel:m,renditionWidth:g[m].width||null,renditionHeight:g[m].height||null,renditionBitrate:g[m].bandwidth}:{}},gt=function(p){var h;return(h=p.match(/.*codecs\*?="(.*)"/))===null||h===void 0?void 0:h[1]};function X(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var ve=0,je=function(){function p(){(function(g,w){if(!(g instanceof w))throw new TypeError("Cannot call a class as a function")})(this,p)}var h,m;return h=p,m=[{key:"on",value:function(g,w,C){return w._eventEmitterGuid=w._eventEmitterGuid||++ve,this._listeners=this._listeners||{},this._listeners[g]=this._listeners[g]||[],C&&(w=w.bind(C)),this._listeners[g].push(w),w}},{key:"off",value:function(g,w){var C=this._listeners&&this._listeners[g];C&&C.forEach(function(L,M){L._eventEmitterGuid===w._eventEmitterGuid&&C.splice(M,1)})}},{key:"one",value:function(g,w,C){var L=this;w._eventEmitterGuid=w._eventEmitterGuid||++ve;var M=function P(){L.off(g,P),w.apply(C||this,arguments)};M._eventEmitterGuid=w._eventEmitterGuid,this.on(g,M)}},{key:"emit",value:function(g,w){var C=this;if(this._listeners){w=w||{};var L=this._listeners["before*"]||[],M=this._listeners[g]||[],P=this._listeners["after"+g]||[],W=function(ue,pe){(ue=ue.slice()).forEach(function(Ce){Ce.call(C,{type:g},pe)})};W(L,w),W(M,w),W(P,w)}}}],m&&X(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}(),at=je;function mt(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var wt=function(){function p(g){var w=this;(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,g.on("playing",function(){w._playheadShouldBeProgressing=!0}),g.on("play",this._startPlaybackHeartbeatInterval.bind(this)),g.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),g.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),g.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),g.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),g.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),g.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),g.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),g.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),g.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),g.on("seeked",function(){g.data.player_is_paused?w._stopPlaybackHeartbeatInterval():w._startPlaybackHeartbeatInterval()}),g.on("timeupdate",function(){w._playbackHeartbeatInterval!==null&&g.emit("playbackheartbeat")}),g.on("devicesleep",function(C,L){w._playbackHeartbeatInterval!==null&&(z().clearInterval(w._playbackHeartbeatInterval),g.emit("playbackheartbeatend",{viewer_time:L.viewer_time}),w._playbackHeartbeatInterval=null)})}var h,m;return h=p,(m=[{key:"_startPlaybackHeartbeatInterval",value:function(){var g=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=z().setInterval(function(){g.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(z().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&mt(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function er(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function Dt(p,h,m){return h&&er(p.prototype,h),m&&er(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var We=Dt(function p(h){var m=this;(function(g,w){if(!(g instanceof w))throw new TypeError("Cannot call a class as a function")})(this,p),h.on("viewinit",function(){m.viewErrored=!1}),h.on("error",function(g,w){try{var C=h.errorTranslator({player_error_code:w.player_error_code,player_error_message:w.player_error_message,player_error_context:w.player_error_context});C?(h.data.player_error_code=C.player_error_code||w.player_error_code,h.data.player_error_message=C.player_error_message||w.player_error_message,h.data.player_error_context=C.player_error_context||w.player_error_context,m.viewErrored=!0):(delete h.data.player_error_code,delete h.data.player_error_message,delete h.data.player_error_context)}catch(L){h.mux.log.warn("Exception in error translator callback.",L),m.viewErrored=!0}})});function xt(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var cr=function(){function p(g){(function(w,C){if(!(w instanceof C))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g,this._watchTimeTrackerLastCheckedTime=null,g.on("playbackheartbeat",this._updateWatchTime.bind(this)),g.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var h,m;return h=p,(m=[{key:"_updateWatchTime",value:function(g,w){var C=w.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=C),T(this.pm.data,"view_watch_time",C-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=C}},{key:"_clearWatchTimeState",value:function(g,w){this._updateWatchTime(g,w),this._watchTimeTrackerLastCheckedTime=null}}])&&xt(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function nr(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var It=function(){function p(g){var w=this;(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=Te.now(),this._isAdPlaying=!1,g.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),g.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),g.on("seeking",this._clearPlaybackTimeState.bind(this)),g.on("adplaying",function(){w._isAdPlaying=!0}),g.on("adended",function(){w._isAdPlaying=!1}),g.on("adpause",function(){w._isAdPlaying=!1}),g.on("adbreakstart",function(){w._isAdPlaying=!1}),g.on("adbreakend",function(){w._isAdPlaying=!1}),g.on("adplay",function(){w._isAdPlaying=!1})}var h,m;return h=p,(m=[{key:"_updatePlaybackTime",value:function(){var g=this.pm.data.player_playhead_time,w=Te.now(),C=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&g>this._playbackTimeTrackerLastPlayheadPosition?C=g-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(C=w-this._lastTime),C>0&&C<=1e3&&T(this.pm.data,"view_content_playback_time",C),this._playbackTimeTrackerLastPlayheadPosition=g,this._lastTime=w}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&nr(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function et(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var hr=function(){function p(g){(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g;var w=this._updatePlayheadTime.bind(this);g.on("playbackheartbeat",w),g.on("playbackheartbeatend",w),g.on("timeupdate",w),g.on("destroy",function(){g.off("timeupdate",w)})}var h,m;return h=p,(m=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(g,w){var C=this,L=function(){C.pm.currentFragmentPDT&&C.pm.currentFragmentStart&&(C.pm.data.player_program_time=C.pm.currentFragmentPDT+C.pm.data.player_playhead_time-C.pm.currentFragmentStart)};if(w&&w.player_playhead_time)this.pm.data.player_playhead_time=w.player_playhead_time,L(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var M=this.pm.getPlayheadTime();M!==void 0&&(this.pm.data.player_playhead_time=M,L(),this._updateMaxPlayheadPosition())}}}])&&et(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function fr(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function Ar(p,h,m){return h&&fr(p.prototype,h),m&&fr(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var wr=3e5,Wt=Ar(function p(h){if(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")}(this,p),!h.disableRebufferTracking){var m,g=function(C,L){w(L),m=void 0},w=function(C){if(m){var L=C.viewer_time-m;T(h.data,"view_rebuffer_duration",L),m=C.viewer_time,h.data.view_rebuffer_duration>wr&&(h.emit("viewend"),h.send("viewend"),h.mux.log.warn("Ending view after rebuffering for longer than ".concat(wr,"ms, future events will be ignored unless a programchange or videochange occurs.")))}h.data.view_watch_time>=0&&h.data.view_rebuffer_count>0&&(h.data.view_rebuffer_frequency=h.data.view_rebuffer_count/h.data.view_watch_time,h.data.view_rebuffer_percentage=h.data.view_rebuffer_duration/h.data.view_watch_time)};h.on("playbackheartbeat",function(C,L){return w(L)}),h.on("rebufferstart",function(C,L){m||(T(h.data,"view_rebuffer_count",1),m=L.viewer_time,h.one("rebufferend",g))}),h.on("viewinit",function(){m=void 0,h.off("rebufferend",g)})}});function bi(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var Si=function(){function p(g){var w=this;(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g,g.disableRebufferTracking||g.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,g.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),g.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),g.on("seeking",function(){w._cleanupRebufferTracker(null,{viewer_time:Te.now()})}))}var h,m;return h=p,m=[{key:"_checkIfRebuffering",value:function(g,w){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(g,w);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var C=w.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&C>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=w.viewer_time}else this._cleanupRebufferTracker(g,w,!0);else this._prepareRebufferTrackerState(w.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(g){this._lastCheckedTime=g,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=g}},{key:"_cleanupRebufferTracker",value:function(g,w){var C=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:w.viewer_time});else{if(this._lastCheckedTime===null)return;var L=this.pm.data.player_playhead_time-this._lastPlayheadTime,M=w.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&L>0&&M-L>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+M-L}))}C?this._prepareRebufferTrackerState(w.viewer_time):this._clearRebufferTrackerState()}}],m&&bi(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}(),Ji=Si;function ti(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var ri=function(){function p(g){var w=this;(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g,g.on("viewinit",function(){var C=g.data,L=C.view_id;if(!C.view_program_changed){var M=function(P,W){var ue=W.viewer_time;P.type==="playing"&&g.data.view_time_to_first_frame===void 0?w.calculateTimeToFirstFrame(ue||Te.now(),L):P.type!=="adplaying"||g.data.view_time_to_first_frame!==void 0&&!w._inPrerollPosition()||w.calculateTimeToFirstFrame(ue||Te.now(),L)};g.one("playing",M),g.one("adplaying",M),g.one("viewend",function(){g.off("playing",M),g.off("adplaying",M)})}})}var h,m;return h=p,(m=[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(g,w){w===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:g}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&ti(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function Zi(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function en(p,h,m){return h&&Zi(p.prototype,h),m&&Zi(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var Qn=en(function p(h){var m=this;(function(g,w){if(!(g instanceof w))throw new TypeError("Cannot call a class as a function")})(this,p),h.on("viewinit",function(){m._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(g){h.on(g,function(){if(m._lastPlayheadPosition>=0&&h.data.player_playhead_time>=0&&m._lastPlayerWidth>=0&&m._lastSourceWidth>0&&m._lastPlayerHeight>=0&&m._lastSourceHeight>0){var w=h.data.player_playhead_time-m._lastPlayheadPosition;if(w<0)return void(m._lastPlayheadPosition=-1);var C=Math.min(m._lastPlayerWidth/m._lastSourceWidth,m._lastPlayerHeight/m._lastSourceHeight),L=Math.max(0,C-1),M=Math.max(0,1-C);h.data.view_max_upscale_percentage=Math.max(h.data.view_max_upscale_percentage||0,L),h.data.view_max_downscale_percentage=Math.max(h.data.view_max_downscale_percentage||0,M),T(h.data,"view_total_content_playback_time",w),T(h.data,"view_total_upscaling",L*w),T(h.data,"view_total_downscaling",M*w)}m._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(g){h.on(g,function(){m._lastPlayheadPosition=h.data.player_playhead_time,m._lastPlayerWidth=h.data.player_width,m._lastPlayerHeight=h.data.player_height,m._lastSourceWidth=h.data.video_source_width,m._lastSourceHeight=h.data.video_source_height})})});function Ai(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function $n(p,h,m){return h&&Ai(p.prototype,h),m&&Ai(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var Jn=$n(function p(h){var m=this;(function(g,w){if(!(g instanceof w))throw new TypeError("Cannot call a class as a function")})(this,p),this.isSeeking=!1,h.on("seeking",function(g,w){Object.assign(h.data,w),m._lastSeekingTime=Te.now(),m.isSeeking===!1&&(m.isSeeking=!0,h.send("seeking"))}),h.on("seeked",function(){m.isSeeking=!1;var g=m._lastSeekingTime||Te.now(),w=Te.now()-g;T(h.data,"view_seek_count",1),T(h.data,"view_seek_duration",w);var C=h.data.view_max_seek_time||0;h.data.view_max_seek_time=Math.max(C,w)}),h.on("viewend",function(){m.isSeeking=!1})});function tn(p,h){return function(m){if(Array.isArray(m))return m}(p)||function(m,g){var w=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(w!=null){var C,L,M=[],P=!0,W=!1;try{for(w=w.call(m);!(P=(C=w.next()).done)&&(M.push(C.value),!g||M.length!==g);P=!0);}catch(ue){W=!0,L=ue}finally{try{P||w.return==null||w.return()}finally{if(W)throw L}}return M}}(p,h)||function(m,g){if(m){if(typeof m=="string")return rn(m,g);var w=Object.prototype.toString.call(m).slice(8,-1);return w==="Object"&&m.constructor&&(w=m.constructor.name),w==="Map"||w==="Set"?Array.from(m):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?rn(m,g):void 0}}(p,h)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function rn(p,h){(h==null||h>p.length)&&(h=p.length);for(var m=0,g=new Array(h);m<h;m++)g[m]=p[m];return g}function Zn(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}var Nt=function(p,h){p.push(h),p.sort(function(m,g){return m.viewer_time-g.viewer_time})},ea=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],Yt=function(){function p(g){var w=this;(function(L,M){if(!(L instanceof M))throw new TypeError("Cannot call a class as a function")})(this,p),this.pm=g,g.on("viewinit",function(){w.isAdBreak=!1,w._currentAdRequestNumber=0,w._currentAdResponseNumber=0,w._adRequests=[],w._adResponses=[],w._adHasPlayed=!1,w._wouldBeNewAdPlay=!0,w._prerollPlayTime=void 0}),ea.forEach(function(L){return g.on(L,w._updateAdData.bind(w))});var C=function(){w.isAdBreak=!1};g.on("adbreakstart",function(){w.isAdBreak=!0}),g.on("play",C),g.on("playing",C),g.on("viewend",C),g.on("adrequest",function(L,M){M=Object.assign({ad_request_id:"generatedAdRequestId"+w._currentAdRequestNumber++},M),Nt(w._adRequests,M),T(g.data,"view_ad_request_count"),w.inPrerollPosition()&&(g.data.view_preroll_requested=!0,w._adHasPlayed||T(g.data,"view_preroll_request_count"))}),g.on("adresponse",function(L,M){M=Object.assign({ad_request_id:"generatedAdRequestId"+w._currentAdResponseNumber++},M),Nt(w._adResponses,M);var P=w.findAdRequest(M.ad_request_id);P&&T(g.data,"view_ad_request_time",Math.max(0,M.viewer_time-P.viewer_time))}),g.on("adplay",function(L,M){w._adHasPlayed=!0,w._wouldBeNewAdPlay&&(w._wouldBeNewAdPlay=!1,T(g.data,"view_ad_played_count")),w.inPrerollPosition()&&!g.data.view_preroll_played&&(g.data.view_preroll_played=!0,w._adRequests.length>0&&(g.data.view_preroll_request_time=Math.max(0,M.viewer_time-w._adRequests[0].viewer_time)),g.data.view_start&&(g.data.view_startup_preroll_request_time=Math.max(0,M.viewer_time-g.data.view_start)),w._prerollPlayTime=M.viewer_time)}),g.on("adplaying",function(L,M){w.inPrerollPosition()&&g.data.view_preroll_load_time===void 0&&w._prerollPlayTime!==void 0&&(g.data.view_preroll_load_time=M.viewer_time-w._prerollPlayTime,g.data.view_startup_preroll_load_time=M.viewer_time-w._prerollPlayTime)}),g.on("adended",function(){w._wouldBeNewAdPlay=!0}),g.on("aderror",function(){w._wouldBeNewAdPlay=!0})}var h,m;return h=p,(m=[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(g){for(var w=0;w<this._adRequests.length;w++)if(this._adRequests[w].ad_request_id===g)return this._adRequests[w]}},{key:"_updateAdData",value:function(g,w){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&w.ad_tag_url){var C=tn(we(w.ad_tag_url),2),L=C[0],M=C[1];this.pm.data.view_preroll_ad_tag_domain=M,this.pm.data.view_preroll_ad_tag_hostname=L}if(!this.pm.data.view_preroll_ad_asset_hostname&&w.ad_asset_url){var P=tn(we(w.ad_asset_url),2),W=P[0],ue=P[1];this.pm.data.view_preroll_ad_asset_domain=ue,this.pm.data.view_preroll_ad_asset_hostname=W}}this.pm.data.ad_asset_url=w==null?void 0:w.ad_asset_url,this.pm.data.ad_tag_url=w==null?void 0:w.ad_tag_url,this.pm.data.ad_creative_id=w==null?void 0:w.ad_creative_id,this.pm.data.ad_id=w==null?void 0:w.ad_id,this.pm.data.ad_universal_id=w==null?void 0:w.ad_universal_id}}])&&Zn(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function Ur(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function ta(p,h,m){return h&&Ur(p.prototype,h),m&&Ur(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var nn=ta(function p(h){var m,g;(function(M,P){if(!(M instanceof P))throw new TypeError("Cannot call a class as a function")})(this,p);var w=function(){h.disableRebufferTracking||m&&(T(h.data,"view_waiting_rebuffer_duration",Te.now()-m),m=!1,z().clearInterval(g))},C=!1,L=function(){C=!1,w()};h.on("waiting",function(){C&&(h.disableRebufferTracking||(T(h.data,"view_waiting_rebuffer_count",1),m=Te.now(),g=z().setInterval(function(){if(m){var M=Te.now();T(h.data,"view_waiting_rebuffer_duration",M-m),m=M}},250)))}),h.on("playing",function(){w(),C=!0}),h.on("pause",L),h.on("seeking",L)});function lt(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function an(p,h,m){return h&&lt(p.prototype,h),m&&lt(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var Oe=an(function p(h){var m=this;(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,p);var g=function(){m.lastWallClockTime=Te.now(),h.on("before*",w)},w=function(C){var L=Te.now(),M=m.lastWallClockTime;m.lastWallClockTime=L,L-M>3e4&&(h.emit("devicesleep",{viewer_time:M}),Object.assign(h.data,{viewer_time:M}),h.send("devicesleep"),h.emit("devicewake",{viewer_time:L}),Object.assign(h.data,{viewer_time:L}),h.send("devicewake"))};h.one("playbackheartbeat",g),h.on("playbackheartbeatend",function(){h.off("before*",w),h.one("playbackheartbeat",g)})}),wi=Y(375),ki=Y(655),He=Y.n(ki),sn="muxData",Li=function(){var p;try{p=wi.parse(He().get(sn)||"")}catch{p={}}return p},Ri=function(p){try{He().set(sn,wi.stringify(p),{expires:365})}catch{}},ra=function(){var p=Li();return p.mux_viewer_id=p.mux_viewer_id||te(),p.msn=p.msn||Math.random(),Ri(p),{mux_viewer_id:p.mux_viewer_id,mux_sample_number:p.msn}};function vr(p,h){var m=h.beaconCollectionDomain,g=h.beaconDomain;if(m)return"https://"+m;var w=g||"litix.io";return(p=p||"inferred").match(/^[a-z0-9]+$/)?"https://"+p+"."+w:"https://img.litix.io/a.gif"}var Di=function(){var p;switch(on()){case"cellular":p="cellular";break;case"ethernet":p="wired";break;case"wifi":p="wifi";break;case void 0:break;default:p="other"}return p},on=function(){var p=z().navigator,h=p&&(p.connection||p.mozConnection||p.webkitConnection);return h&&h.type};Di.getConnectionFromAPI=on;var ln=Di,un=Br({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),dn=Br({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function Br(p){var h={};for(var m in p)p.hasOwnProperty(m)&&(h[p[m]]=m);return h}function Gr(p){var h={},m={};return Object.keys(p).forEach(function(g){var w=!1;if(p.hasOwnProperty(g)&&p[g]!==void 0){var C=g.split("_"),L=C[0],M=un[L];M||(ee.info("Data key word `"+C[0]+"` not expected in "+g),M=L+"_"),C.splice(1).forEach(function(P){P==="url"&&(w=!0),dn[P]?M+=dn[P]:Number(P)&&Math.floor(Number(P))===Number(P)?M+=P:(ee.info("Data key word `"+P+"` not expected in "+g),M+="_"+P+"_")}),w?m[M]=p[g]:h[M]=p[g]}}),Object.assign(h,m)}var cn={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},hn=["hb","requestcompleted","requestfailed","requestcanceled"],kt="https://img.litix.io",Ut=function(p){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._beaconUrl=p||kt,this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},cn,h)};Ut.prototype.queueEvent=function(p,h){var m=Object.assign({},h);return(this._eventQueue.length<=this._options.maxQueueLength||p==="eventrateexceeded")&&(this._eventQueue.push(m),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},Ut.prototype.flushEvents=function(){var p=arguments.length>0&&arguments[0]!==void 0&&arguments[0];p&&this._eventQueue.length===1?this._eventQueue.pop():(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},Ut.prototype.destroy=function(){var p=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,p?this._clearBeaconQueue():this.flushEvents(),z().clearTimeout(this._sendTimeout)},Ut.prototype._clearBeaconQueue=function(){var p=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,h=this._eventQueue.slice(p);p>0&&Object.assign(h[h.length-1],Gr({mux_view_message:"event queue truncated"}));var m=this._createPayload(h);vn(this._beaconUrl,m,!0,function(){})},Ut.prototype._sendBeaconQueue=function(){var p=this;if(!this._postInFlight){var h=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var m=this._createPayload(h),g=Te.now();vn(this._beaconUrl,m,!1,function(w,C){C?(p._eventQueue=h.concat(p._eventQueue),p._failureCount+=1,ee.info("Error sending beacon: "+C)):p._failureCount=0,p._roundTripTime=Te.now()-g,p._postInFlight=!1})}},Ut.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var p=Math.pow(2,this._failureCount-1);return(1+(p*=Math.random()))*this._options.baseTimeBetweenBeacons},Ut.prototype._startBeaconSending=function(){var p=this;z().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=z().setTimeout(function(){p._eventQueue.length&&p._sendBeaconQueue(),p._startBeaconSending()},this._getNextBeaconTime()))},Ut.prototype._createPayload=function(p){var h,m,g,w=this,C={transmission_timestamp:Math.round(Te.now())};this._roundTripTime&&(C.rtt_ms=Math.round(this._roundTripTime));var L=function(){h=JSON.stringify({metadata:C,events:m||p}),g=h.length/1024},M=function(){return g<=w._options.maxPayloadKBSize};return L(),M()||(ee.info("Payload size is too big ("+g+" kb). Removing unnecessary events."),m=p.filter(function(P){return hn.indexOf(P.e)===-1}),L()),M()||(ee.info("Payload size still too big ("+g+" kb). Cropping fields.."),m.forEach(function(P){for(var W in P){var ue=P[W];typeof ue=="string"&&ue.length>51200&&(P[W]=ue.substring(0,51200))}}),L()),h};var fn=function(p){return p.length<=57344},vn=function(p,h,m,g){if(m&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(p,h))g();else if(z().fetch)z().fetch(p,{method:"POST",body:h,headers:{"Content-Type":"text/plain"},keepalive:fn(h)}).then(function(C){return g(null,C.ok?null:"Error")}).catch(function(C){return g(null,C)});else{if(z().XMLHttpRequest){var w=new(z()).XMLHttpRequest;return w.onreadystatechange=function(){if(w.readyState===4)return g(null,w.status!==200?"error":void 0)},w.open("POST",p),w.setRequestHeader("Content-Type","text/plain"),void w.send(h)}g()}},ii=Ut;function ia(p,h){return function(m){if(Array.isArray(m))return m}(p)||function(m,g){var w=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(w!=null){var C,L,M=[],P=!0,W=!1;try{for(w=w.call(m);!(P=(C=w.next()).done)&&(M.push(C.value),!g||M.length!==g);P=!0);}catch(ue){W=!0,L=ue}finally{try{P||w.return==null||w.return()}finally{if(W)throw L}}return M}}(p,h)||function(m,g){if(m){if(typeof m=="string")return Ii(m,g);var w=Object.prototype.toString.call(m).slice(8,-1);return w==="Object"&&m.constructor&&(w=m.constructor.name),w==="Map"||w==="Set"?Array.from(m):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?Ii(m,g):void 0}}(p,h)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ii(p,h){(h==null||h>p.length)&&(h=p.length);for(var m=0,g=new Array(h);m<h;m++)g[m]=p[m];return g}function ni(p,h){var m=Object.keys(p);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(p);h&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(p,w).enumerable})),m.push.apply(m,g)}return m}function gr(p){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?ni(Object(m),!0).forEach(function(g){ai(p,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(m)):ni(Object(m)).forEach(function(g){Object.defineProperty(p,g,Object.getOwnPropertyDescriptor(m,g))})}return p}function kr(p){return kr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},kr(p)}function na(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function gn(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function ai(p,h,m){return h in p?Object.defineProperty(p,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):p[h]=m,p}var Hr=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],mn=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],pn=["ad_id","ad_creative_id","ad_universal_id"],aa=["viewstart","error","ended","viewend"],yn=function(){function p(g,w){var C,L,M,P,W,ue,pe,Ce,ae,_e,Ie,ot,ut,dt,Tt,Me=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};na(this,p),ai(this,"previousBeaconData",null),ai(this,"lastEventTime",0),ai(this,"rateLimited",!1),this.mux=g,this.envKey=w,this.options=Me,this.eventQueue=new ii(vr(this.envKey,this.options)),this.sampleRate=(C=this.options.sampleRate)!==null&&C!==void 0?C:1,this.disableCookies=(L=this.options.disableCookies)!==null&&L!==void 0&&L,this.respectDoNotTrack=(M=this.options.respectDoNotTrack)!==null&&M!==void 0&&M,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:(P=this.options.platform)===null||P===void 0?void 0:P.name,viewer_application_version:(W=this.options.platform)===null||W===void 0?void 0:W.version,viewer_application_engine:(ue=this.options.platform)===null||ue===void 0?void 0:ue.layout,viewer_device_name:(pe=this.options.platform)===null||pe===void 0?void 0:pe.product,viewer_device_category:"",viewer_device_manufacturer:(Ce=this.options.platform)===null||Ce===void 0?void 0:Ce.manufacturer,viewer_os_family:(ae=this.options.platform)===null||ae===void 0||(_e=ae.os)===null||_e===void 0?void 0:_e.family,viewer_os_architecture:(Ie=this.options.platform)===null||Ie===void 0||(ot=Ie.os)===null||ot===void 0?void 0:ot.architecture,viewer_os_version:(ut=this.options.platform)===null||ut===void 0||(dt=ut.os)===null||dt===void 0?void 0:dt.version,viewer_connection_type:ln(),page_url:z()===null||z()===void 0||(Tt=z().location)===null||Tt===void 0?void 0:Tt.href},this.viewerData=this.disableCookies?{}:ra()}var h,m;return h=p,(m=[{key:"send",value:function(g,w){var C;if(g&&w!=null&&w.view_id){if(this.respectDoNotTrack&&fe())return ee.info("Not sending `"+g+"` because Do Not Track is enabled");if(!w||kr(w)!=="object")return ee.error("A data object was expected in send() but was not provided");var L,M,P=this.disableCookies?{}:(L=Li(),M=Te.now(),L.session_start&&(L.sst=L.session_start,delete L.session_start),L.session_id&&(L.sid=L.session_id,delete L.session_id),L.session_expires&&(L.sex=L.session_expires,delete L.session_expires),(!L.sex||L.sex<M)&&(L.sid=te(),L.sst=M),L.sex=M+15e5,Ri(L),{session_id:L.sid,session_start:L.sst,session_expires:L.sex}),W=gr(gr(gr(gr(gr({},this.pageLevelData),w),P),this.viewerData),{},{event:g,env_key:this.envKey});W.user_id&&(W.viewer_user_id=W.user_id,delete W.user_id);var ue=((C=W.mux_sample_number)!==null&&C!==void 0?C:0)>=this.sampleRate,pe=Gr(this._deduplicateBeaconData(g,W));if(this.lastEventTime=this.mux.utils.now(),ue)return ee.info("Not sending event due to sample rate restriction",g,W,pe);if(this.envKey||ee.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",g,W,pe),!this.rateLimited){if(ee.info("Sending event",g,W,pe),this.rateLimited=!this.eventQueue.queueEvent(g,pe),this.mux.WINDOW_UNLOADING&&g==="viewend")this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&g==="hb"?this.eventQueue.flushEvents(!0):aa.indexOf(g)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return W.event="eventrateexceeded",pe=Gr(W),this.eventQueue.queueEvent(W.event,pe),ee.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(g,w){var C=this,L={},M=w.view_id;if(M==="-1"||g==="viewstart"||g==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)L=gr({},w),M&&(this.previousBeaconData=L),M&&g==="viewend"&&(this.previousBeaconData=null);else{var P=g.indexOf("request")===0;Object.entries(w).forEach(function(W){var ue=ia(W,2),pe=ue[0],Ce=ue[1];C.previousBeaconData&&(Ce!==C.previousBeaconData[pe]||Hr.indexOf(pe)>-1||C.objectHasChanged(P,pe,Ce,C.previousBeaconData[pe])||C.eventRequiresKey(g,pe))&&(L[pe]=Ce,C.previousBeaconData[pe]=Ce)})}return L}},{key:"objectHasChanged",value:function(g,w,C,L){return!(!g||w.indexOf("request_")!==0||w!=="request_response_headers"&&kr(C)==="object"&&kr(L)==="object"&&Object.keys(C||{}).length===Object.keys(L||{}).length)}},{key:"eventRequiresKey",value:function(g,w){return g==="renditionchange"&&w.indexOf("video_source_")===0||!(!pn.includes(w)||!mn.includes(g))}}])&&gn(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),p}();function Ci(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function En(p,h,m){return h&&Ci(p.prototype,h),m&&Ci(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var Tn=En(function p(h){(function(W,ue){if(!(W instanceof ue))throw new TypeError("Cannot call a class as a function")})(this,p);var m=0,g=0,w=0,C=0,L=0,M=0,P=0;h.on("requestcompleted",function(W,ue){var pe,Ce,ae=ue.request_start,_e=ue.request_response_start,Ie=ue.request_response_end,ot=ue.request_bytes_loaded;if(C++,_e?(pe=_e-(ae??0),Ce=(Ie??0)-_e):Ce=(Ie??0)-(ae??0),Ce>0&&ot&&ot>0){var ut=ot/Ce*8e3;L++,g+=ot,w+=Ce,h.data.view_min_request_throughput=Math.min(h.data.view_min_request_throughput||1/0,ut),h.data.view_average_request_throughput=g/w*8e3,h.data.view_request_count=C,pe>0&&(m+=pe,h.data.view_max_request_latency=Math.max(h.data.view_max_request_latency||0,pe),h.data.view_average_request_latency=m/L)}}),h.on("requestfailed",function(W,ue){C++,M++,h.data.view_request_count=C,h.data.view_request_failed_count=M}),h.on("requestcanceled",function(W,ue){C++,P++,h.data.view_request_count=C,h.data.view_request_canceled_count=P})});function mr(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function pr(p,h,m){return h&&mr(p.prototype,h),m&&mr(p,m),Object.defineProperty(p,"prototype",{writable:!1}),p}var zt=pr(function p(h){var m=this;(function(g,w){if(!(g instanceof w))throw new TypeError("Cannot call a class as a function")})(this,p),h.on("before*",function(g,w){var C=w.viewer_time,L=Te.now(),M=m._lastEventTime;if(m._lastEventTime=L,M&&L-M>36e5){var P=Object.keys(h.data).reduce(function(W,ue){return ue.indexOf("video_")===0?Object.assign(W,function(pe,Ce,ae){return Ce in pe?Object.defineProperty(pe,Ce,{value:ae,enumerable:!0,configurable:!0,writable:!0}):pe[Ce]=ae,pe}({},ue,h.data[ue])):W},{});h.mux.log.info("Received event after at least an hour inactivity, creating a new view"),h.emit("viewinit",Object.assign({viewer_time:C},P)),h.playbackHeartbeat._playheadShouldBeProgressing&&g.type!=="play"&&g.type!=="adbreakstart"&&(h.emit("play",{viewer_time:C}),g.type!=="playing"&&h.emit("playing",{viewer_time:C}))}})});function Bt(p){return Bt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},Bt(p)}function ze(p,h){return function(m){if(Array.isArray(m))return m}(p)||function(m,g){var w=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(w!=null){var C,L,M=[],P=!0,W=!1;try{for(w=w.call(m);!(P=(C=w.next()).done)&&(M.push(C.value),!g||M.length!==g);P=!0);}catch(ue){W=!0,L=ue}finally{try{P||w.return==null||w.return()}finally{if(W)throw L}}return M}}(p,h)||function(m,g){if(m){if(typeof m=="string")return Gt(m,g);var w=Object.prototype.toString.call(m).slice(8,-1);return w==="Object"&&m.constructor&&(w=m.constructor.name),w==="Map"||w==="Set"?Array.from(m):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?Gt(m,g):void 0}}(p,h)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Gt(p,h){(h==null||h>p.length)&&(h=p.length);for(var m=0,g=new Array(h);m<h;m++)g[m]=p[m];return g}function ar(p,h){for(var m=0;m<h.length;m++){var g=h[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(p,g.key,g)}}function si(p,h){return si=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,g){return m.__proto__=g,m},si(p,h)}function Pi(p){var h=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var m,g=Kr(p);if(h){var w=Kr(this).constructor;m=Reflect.construct(g,arguments,w)}else m=g.apply(this,arguments);return sa(this,m)}}function sa(p,h){if(h&&(Bt(h)==="object"||typeof h=="function"))return h;if(h!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return st(p)}function st(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function Kr(p){return Kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(h){return h.__proto__||Object.getPrototypeOf(h)},Kr(p)}var Lr=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],xi=function(p){(function(C,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(L&&L.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),L&&si(C,L)})(w,p);var h,m,g=Pi(w);function w(C,L,M){var P;(function(ae,_e){if(!(ae instanceof _e))throw new TypeError("Cannot call a class as a function")})(this,w),(P=g.call(this)).DOM_CONTENT_LOADED_EVENT_END=$.domContentLoadedEventEnd(),P.NAVIGATION_START=$.navigationStart(),P.mux=C,P.id=L,(M=Object.assign({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(ae){return ae}},M)).data=M.data||{},M.data.property_key&&(M.data.env_key=M.data.property_key,delete M.data.property_key),ee.setLevel(M.debug?"debug":"warn"),P.getPlayheadTime=M.getPlayheadTime,P.getStateData=M.getStateData||function(){return{}},P.getAdData=M.getAdData||function(){},P.minimumRebufferDuration=M.minimumRebufferDuration,P.sustainedRebufferThreshold=M.sustainedRebufferThreshold,P.playbackHeartbeatTime=M.playbackHeartbeatTime,P.disableRebufferTracking=M.disableRebufferTracking,P.disableRebufferTracking&&P.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),P.disablePlayheadRebufferTracking=M.disablePlayheadRebufferTracking,P.errorTranslator=M.errorTranslator,P.playbackEventDispatcher=new yn(C,M.data.env_key,M),P.data={player_instance_id:te(),mux_sample_rate:M.sampleRate,beacon_domain:M.beaconCollectionDomain?M.beaconCollectionDomain:M.beaconDomain},P.data.view_sequence_number=1,P.data.player_sequence_number=1,P.oldEmit=P.emit,P.emit=function(ae,_e){_e=Object.assign({viewer_time:this.mux.utils.now()},_e),this.oldEmit(ae,_e)};var W=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(st(P));P.on("viewinit",function(ae,_e){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,_e),this._initializeViewData(),this.one("play",W),this.one("adbreakstart",W)});var ue=function(ae){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",ae)}.bind(st(P));if(P.on("videochange",function(ae,_e){ue(_e)}),P.on("programchange",function(ae,_e){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),ue(Object.assign(_e,{view_program_changed:!0})),W(),this.emit("play"),this.emit("playing")}),P.on("fragmentchange",function(ae,_e){this.currentFragmentPDT=_e.currentFragmentPDT,this.currentFragmentStart=_e.currentFragmentStart}),P.on("destroy",P.destroy),typeof window<"u"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var pe=function(){var ae=P.data.view_start!==void 0;P.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",ae&&P.mux.WINDOW_HIDDEN&&(P.data.player_is_paused||P.emit("hb"))};window.addEventListener("visibilitychange",pe,!1);var Ce=function(ae){ae.persisted||P.destroy()};window.addEventListener("pagehide",Ce,!1),P.on("destroy",function(){window.removeEventListener("visibilitychange",pe),window.removeEventListener("pagehide",Ce)})}return P.on("playerready",function(ae,_e){Object.assign(this.data,_e)}),Lr.forEach(function(ae){P.on(ae,function(_e,Ie){ae.indexOf("ad")!==0&&this._updateStateData(),Object.assign(this.data,Ie),this._sanitizeData()}),P.on("after"+ae,function(){(ae!=="error"||this.errorTracker.viewErrored)&&this.send(ae)})}),P.on("viewend",function(ae,_e){Object.assign(P.data,_e)}),P.one("playerready",function(ae){var _e=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=_e-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),P.longResumeTracker=new zt(st(P)),P.errorTracker=new We(st(P)),new Oe(st(P)),P.seekingTracker=new Jn(st(P)),P.playheadTime=new hr(st(P)),P.playbackHeartbeat=new wt(st(P)),new Qn(st(P)),P.watchTimeTracker=new cr(st(P)),new It(st(P)),P.adTracker=new Yt(st(P)),new Ji(st(P)),new Wt(st(P)),new ri(st(P)),new nn(st(P)),new Tn(st(P)),M.hlsjs&&P.addHLSJS(M),M.dashjs&&P.addDashJS(M),P.emit("viewinit",M.data),P}return h=w,m=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(C){if(this.data.view_id){var L=Object.assign({},this.data);if(L.video_source_is_live===void 0&&(L.player_source_duration===1/0||L.video_source_duration===1/0?L.video_source_is_live=!0:(L.player_source_duration>0||L.video_source_duration>0)&&(L.video_source_is_live=!1)),L.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(ue){L[ue]=void 0}),L.video_source_url=L.video_source_url||L.player_source_url,L.video_source_url){var M=ze(we(L.video_source_url),2),P=M[0],W=M[1];L.video_source_domain=W,L.video_source_hostname=P}delete L.ad_request_id,this.playbackEventDispatcher.send(C,L),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat(),C==="viewend"&&delete this.data.view_id}}},{key:"_updateStateData",value:function(){Object.assign(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var C=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(L){var M=parseInt(C.data[L],10);C.data[L]=isNaN(M)?void 0:M}),["player_source_url","video_source_url"].forEach(function(L){if(C.data[L]){var M=C.data[L].toLowerCase();M.indexOf("data:")!==0&&M.indexOf("blob:")!==0||(C.data[L]="MSE style URL")}})}},{key:"_resetVideoData",value:function(C,L){var M=this;Object.keys(this.data).forEach(function(P){P.indexOf("video_")===0&&delete M.data[P]})}},{key:"_resetViewData",value:function(){var C=this;Object.keys(this.data).forEach(function(L){L.indexOf("view_")===0&&delete C.data[L]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(C,L){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var C=this,L=this.data.view_id=te(),M=function(){L===C.data.view_id&&T(C.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",M):M()}},{key:"_restartHeartBeat",value:function(){var C=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){C.data.player_is_paused||C.emit("hb")},1e4))}},{key:"addHLSJS",value:function(C){C.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=C.hlsjs,function(L,M,P){var W=arguments.length>4?arguments[4]:void 0,ue=L.log,pe=L.utils.secondsToMs,Ce=function(qe){var re,ne=parseInt(W.version);return ne===1&&qe.programDateTime!==null&&(re=qe.programDateTime),ne===0&&qe.pdt!==null&&(re=qe.pdt),re};if($.exists()){var ae=function(qe,re){return L.emit(M,qe,re)},_e=function(qe,re){var ne=re.levels,se=re.audioTracks,Pe=re.url,Ne=re.stats,it=re.networkDetails,Rt=re.sessionData,ct={},_t={};ne.forEach(function(me,yr){ct[yr]={width:me.width,height:me.height,bitrate:me.bitrate,attrs:me.attrs}}),se.forEach(function(me,yr){_t[yr]={name:me.name,language:me.lang,bitrate:me.bitrate}});var ht=jt(Ne),ft=ht.bytesLoaded,Xt=ht.requestStart,Xr=ht.responseStart,vt=ht.responseEnd;ae("requestcompleted",Ve(Ve({},Je(Rt)),{},{request_event_type:qe,request_bytes_loaded:ft,request_start:Xt,request_response_start:Xr,request_response_end:vt,request_type:"manifest",request_hostname:De(Pe),request_response_headers:Pt(it),request_rendition_lists:{media:ct,audio:_t,video:{}}}))};P.on(W.Events.MANIFEST_LOADED,_e);var Ie=function(qe,re){var ne=re.details,se=re.level,Pe=re.networkDetails,Ne=re.stats,it=jt(Ne),Rt=it.bytesLoaded,ct=it.requestStart,_t=it.responseStart,ht=it.responseEnd,ft=ne.fragments[ne.fragments.length-1],Xt=Ce(ft)+pe(ft.duration);ae("requestcompleted",{request_event_type:qe,request_bytes_loaded:Rt,request_start:ct,request_response_start:_t,request_response_end:ht,request_current_level:se,request_type:"manifest",request_hostname:De(ne.url),request_response_headers:Pt(Pe),video_holdback:ne.holdBack&&pe(ne.holdBack),video_part_holdback:ne.partHoldBack&&pe(ne.partHoldBack),video_part_target_duration:ne.partTarget&&pe(ne.partTarget),video_target_duration:ne.targetduration&&pe(ne.targetduration),video_source_is_live:ne.live,player_manifest_newest_program_time:isNaN(Xt)?void 0:Xt})};P.on(W.Events.LEVEL_LOADED,Ie);var ot=function(qe,re){var ne=re.details,se=re.networkDetails,Pe=re.stats,Ne=jt(Pe),it=Ne.bytesLoaded,Rt=Ne.requestStart,ct=Ne.responseStart,_t=Ne.responseEnd;ae("requestcompleted",{request_event_type:qe,request_bytes_loaded:it,request_start:Rt,request_response_start:ct,request_response_end:_t,request_type:"manifest",request_hostname:De(ne.url),request_response_headers:Pt(se)})};P.on(W.Events.AUDIO_TRACK_LOADED,ot);var ut=function(qe,re){var ne=re.stats,se=re.networkDetails,Pe=re.frag;ne=ne||Pe.stats;var Ne=jt(ne),it=Ne.bytesLoaded,Rt=Ne.requestStart,ct=Ne.responseStart,_t=Ne.responseEnd,ht=se?Pt(se):void 0,ft={request_event_type:qe,request_bytes_loaded:it,request_start:Rt,request_response_start:ct,request_response_end:_t,request_hostname:se?De(se.responseURL):void 0,request_id:ht?Ye(ht):void 0,request_response_headers:ht,request_media_duration:Pe.duration,request_url:se==null?void 0:se.responseURL};Pe.type==="main"?(ft.request_type="media",ft.request_current_level=Pe.level,ft.request_video_width=(P.levels[Pe.level]||{}).width,ft.request_video_height=(P.levels[Pe.level]||{}).height,ft.request_labeled_bitrate=(P.levels[Pe.level]||{}).bitrate):ft.request_type=Pe.type,ae("requestcompleted",ft)};P.on(W.Events.FRAG_LOADED,ut);var dt=function(qe,re){var ne=re.frag,se=ne.start,Pe={currentFragmentPDT:Ce(ne),currentFragmentStart:pe(se)};ae("fragmentchange",Pe)};P.on(W.Events.FRAG_CHANGED,dt);var Tt=function(qe,re){var ne=re.type,se=re.details,Pe=re.response,Ne=re.fatal,it=re.frag,Rt=re.networkDetails,ct=(it==null?void 0:it.url)||re.url||"",_t=Rt?Pt(Rt):void 0;if(se!==W.ErrorDetails.MANIFEST_LOAD_ERROR&&se!==W.ErrorDetails.MANIFEST_LOAD_TIMEOUT&&se!==W.ErrorDetails.FRAG_LOAD_ERROR&&se!==W.ErrorDetails.FRAG_LOAD_TIMEOUT&&se!==W.ErrorDetails.LEVEL_LOAD_ERROR&&se!==W.ErrorDetails.LEVEL_LOAD_TIMEOUT&&se!==W.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&se!==W.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT&&se!==W.ErrorDetails.SUBTITLE_LOAD_ERROR&&se!==W.ErrorDetails.SUBTITLE_LOAD_TIMEOUT&&se!==W.ErrorDetails.KEY_LOAD_ERROR&&se!==W.ErrorDetails.KEY_LOAD_TIMEOUT||ae("requestfailed",{request_error:se,request_url:ct,request_hostname:De(ct),request_id:_t?Ye(_t):void 0,request_type:se===W.ErrorDetails.FRAG_LOAD_ERROR||se===W.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":se===W.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||se===W.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":se===W.ErrorDetails.SUBTITLE_LOAD_ERROR||se===W.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":se===W.ErrorDetails.KEY_LOAD_ERROR||se===W.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:Pe==null?void 0:Pe.code,request_error_text:Pe==null?void 0:Pe.text}),Ne){var ht,ft="".concat(ct?"url: ".concat(ct,`
`):"")+"".concat(Pe&&(Pe.code||Pe.text)?"response: ".concat(Pe.code,", ").concat(Pe.text,`
`):"")+"".concat(re.reason?"failure reason: ".concat(re.reason,`
`):"")+"".concat(re.level?"level: ".concat(re.level,`
`):"")+"".concat(re.parent?"parent stream controller: ".concat(re.parent,`
`):"")+"".concat(re.buffer?"buffer length: ".concat(re.buffer,`
`):"")+"".concat(re.error?"error: ".concat(re.error,`
`):"")+"".concat(re.event?"event: ".concat(re.event,`
`):"")+"".concat(re.err?"error message: ".concat((ht=re.err)===null||ht===void 0?void 0:ht.message,`
`):"");ae("error",{player_error_code:ne,player_error_message:se,player_error_context:ft})}};P.on(W.Events.ERROR,Tt);var Me=function(qe,re){var ne=re.frag,se=ne&&ne._url||"";ae("requestcanceled",{request_event_type:qe,request_url:se,request_type:"media",request_hostname:De(se)})};P.on(W.Events.FRAG_LOAD_EMERGENCY_ABORTED,Me);var rt=function(qe,re){var ne=re.level,se=P.levels[ne];if(se&&se.attrs&&se.attrs.BANDWIDTH){var Pe,Ne=se.attrs.BANDWIDTH,it=parseFloat(se.attrs["FRAME-RATE"]);isNaN(it)||(Pe=it),Ne?ae("renditionchange",{video_source_fps:Pe,video_source_bitrate:Ne,video_source_width:se.width,video_source_height:se.height,video_source_rendition_name:se.name,video_source_codec:se==null?void 0:se.videoCodec}):ue.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};P.on(W.Events.LEVEL_SWITCHED,rt),P._stopMuxMonitor=function(){P.off(W.Events.MANIFEST_LOADED,_e),P.off(W.Events.LEVEL_LOADED,Ie),P.off(W.Events.AUDIO_TRACK_LOADED,ot),P.off(W.Events.FRAG_LOADED,ut),P.off(W.Events.FRAG_CHANGED,dt),P.off(W.Events.ERROR,Tt),P.off(W.Events.FRAG_LOAD_EMERGENCY_ABORTED,Me),P.off(W.Events.LEVEL_SWITCHED,rt),P.off(W.Events.DESTROYING,P._stopMuxMonitor),delete P._stopMuxMonitor},P.on(W.Events.DESTROYING,P._stopMuxMonitor)}else ue.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,C.hlsjs,{},C.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var C;this.hlsjs&&((C=this.hlsjs)&&typeof C._stopMuxMonitor=="function"&&C._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(C){C.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=C.dashjs,function(L,M,P){var W=L.log;if(P&&P.on){var ue=function(Me,rt){return L.emit(M,Me,rt)},pe=function(Me){var rt=Me.type,qe=(Me.data||{}).url;ue("requestcompleted",{request_event_type:rt,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:De(qe),request_url:qe})};P.on("manifestLoaded",pe);var Ce={},ae=function(Me){var rt=Me.type,qe=Me.fragmentModel,re=(Me.chunk||{}).mediaInfo||{},ne=re.type,se=re.bitrateList,Pe={};(se=se||[]).forEach(function(vt,me){Pe[me]={},Pe[me].width=vt.width,Pe[me].height=vt.height,Pe[me].bitrate=vt.bandwidth,Pe[me].attrs={}}),ne==="video"?Ce.video=Pe:ne==="audio"?Ce.audio=Pe:Ce.media=Pe;var Ne=Et(qe,P),it=Ne.requestStart,Rt=Ne.requestResponseStart,ct=Ne.requestResponseEnd,_t=Ne.requestResponseHeaders,ht=Ne.requestMediaDuration,ft=Ne.requestHostname,Xt=Ne.requestUrl,Xr=Ne.requestId;ue("requestcompleted",{request_event_type:rt,request_start:it,request_response_start:Rt,request_response_end:ct,request_bytes_loaded:-1,request_type:ne+"_init",request_response_headers:_t,request_hostname:ft,request_id:Xr,request_url:Xt,request_media_duration:ht,request_rendition_lists:Ce})};P.on("initFragmentLoaded",ae);var _e=function(Me){var rt=Me.type,qe=Me.fragmentModel,re=Me.chunk||{},ne=re.mediaInfo,se=re.start,Pe=(ne||{}).type,Ne=Et(qe,P),it=Ne.requestStart,Rt=Ne.requestResponseStart,ct=Ne.requestResponseEnd,_t=Ne.requestBytesLoaded,ht=Ne.requestResponseHeaders,ft=Ne.requestMediaDuration,Xt=Ne.requestHostname,Xr=Ne.requestUrl,vt=Ne.requestId,me=Ze(Pe,P),yr=me.currentLevel,Dr=me.renditionWidth,Ir=me.renditionHeight,Qr=me.renditionBitrate;ue("requestcompleted",{request_event_type:rt,request_start:it,request_response_start:Rt,request_response_end:ct,request_bytes_loaded:_t,request_type:Pe,request_response_headers:ht,request_hostname:Xt,request_id:vt,request_url:Xr,request_media_start_time:se,request_media_duration:ft,request_current_level:yr,request_labeled_bitrate:Qr,request_video_width:Dr,request_video_height:Ir})};P.on("mediaFragmentLoaded",_e);var Ie={video:void 0,audio:void 0,totalBitrate:void 0},ot=function(){if(Ie.video&&typeof Ie.video.bitrate=="number"){if(Ie.video.width&&Ie.video.height){var Me=Ie.video.bitrate;return Ie.audio&&typeof Ie.audio.bitrate=="number"&&(Me+=Ie.audio.bitrate),Me!==Ie.totalBitrate?(Ie.totalBitrate=Me,{video_source_bitrate:Me,video_source_height:Ie.video.height,video_source_width:Ie.video.width,video_source_codec:gt(Ie.video.codec)}):void 0}W.warn("have bitrate info for video but missing width/height")}},ut=function(Me,rt,qe){if(typeof Me.newQuality=="number"){var re=Me.mediaType;if(re==="audio"||re==="video"){var ne=P.getBitrateInfoListFor(re).find(function(Pe){return Pe.qualityIndex===Me.newQuality});if(ne&&typeof ne.bitrate=="number"){Ie[re]=Vt(Vt({},ne),{},{codec:P.getCurrentTrackFor(re).codec});var se=ot();se&&ue("renditionchange",se)}else W.warn("missing bitrate info for ".concat(re))}}else W.warn("missing evt.newQuality in qualityChangeRendered event",Me)};P.on("qualityChangeRendered",ut);var dt=function(Me){var rt=Me.request,qe=Me.mediaType;ue("requestcanceled",{request_event_type:(rt=rt||{}).type+"_"+rt.action,request_url:rt.url,request_type:qe,request_hostname:De(rt.url)})};P.on("fragmentLoadingAbandoned",dt);var Tt=function(Me){var rt,qe,re=Me.error,ne=(re==null||(rt=re.data)===null||rt===void 0?void 0:rt.request)||{},se=(re==null||(qe=re.data)===null||qe===void 0?void 0:qe.response)||{};(re==null?void 0:re.code)===27&&ue("requestfailed",{request_error:ne.type+"_"+ne.action,request_url:ne.url,request_hostname:De(ne.url),request_type:ne.mediaType,request_error_code:se.status,request_error_text:se.statusText});var Pe="".concat(ne!=null&&ne.url?"url: ".concat(ne.url,`
`):"")+"".concat(se!=null&&se.status||se!=null&&se.statusText?"response: ".concat(se==null?void 0:se.status,", ").concat(se==null?void 0:se.statusText,`
`):"");ue("error",{player_error_code:re==null?void 0:re.code,player_error_message:re==null?void 0:re.message,player_error_context:Pe})};P.on("error",Tt),P._stopMuxMonitor=function(){P.off("manifestLoaded",pe),P.off("initFragmentLoaded",ae),P.off("mediaFragmentLoaded",_e),P.off("qualityChangeRendered",ut),P.off("error",Tt),P.off("fragmentLoadingAbandoned",dt),delete P._stopMuxMonitor}}else W.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,C.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var C;this.dashjs&&((C=this.dashjs)&&typeof C._stopMuxMonitor=="function"&&C._stopMuxMonitor(),this.dashjs=void 0)}}],m&&ar(h.prototype,m),Object.defineProperty(h,"prototype",{writable:!1}),w}(at),qr=xi,oa=Y(153),tr=Y.n(oa);function jr(p){return jr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},jr(p)}function Vr(p,h){return function(m){if(Array.isArray(m))return m}(p)||function(m,g){var w=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(w!=null){var C,L,M=[],P=!0,W=!1;try{for(w=w.call(m);!(P=(C=w.next()).done)&&(M.push(C.value),!g||M.length!==g);P=!0);}catch(ue){W=!0,L=ue}finally{try{P||w.return==null||w.return()}finally{if(W)throw L}}return M}}(p,h)||function(m,g){if(m){if(typeof m=="string")return oi(m,g);var w=Object.prototype.toString.call(m).slice(8,-1);return w==="Object"&&m.constructor&&(w=m.constructor.name),w==="Map"||w==="Set"?Array.from(m):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?oi(m,g):void 0}}(p,h)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function oi(p,h){(h==null||h>p.length)&&(h=p.length);for(var m=0,g=new Array(h);m<h;m++)g[m]=p[m];return g}var Rr,la=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],Oi={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};z()&&z().WeakMap&&(Rr=new WeakMap);var Mi="#EXT-X-TARGETDURATION",ua="#EXT-X-PART-INF",da="#EXT-X-SERVER-CONTROL",_n="#EXTINF",Wr="#EXT-X-PROGRAM-DATE-TIME",Fi="#EXT-X-VERSION",bn="#EXT-X-SESSION-DATA",li=function(p){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(p),this.manifest};li.prototype.process=function(p){var h;for(this.buffer+=p,h=this.buffer.indexOf(`
`);h>-1;h=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,h)),this.buffer=this.buffer.substring(h+1)},li.prototype.processLine=function(p){var h=p.indexOf(":"),m=Ni(p,h),g=m[0],w=m.length===2?ci(m[1]):void 0;if(g[0]!=="#")this.currentUri.uri=g,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(g){case Mi:if(!isFinite(w)||w<0)return;this.manifest.targetDuration=w,this.setHoldBack();break;case ua:ui(this.manifest,m),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case da:ui(this.manifest,m),this.setHoldBack();break;case _n:w===0?this.currentUri.duration=.01:w>0&&(this.currentUri.duration=w);break;case Wr:var C=w,L=new Date(C);this.manifest.dateTimeString||(this.manifest.dateTimeString=C,this.manifest.dateTimeObject=L),this.currentUri.dateTimeString=C,this.currentUri.dateTimeObject=L;break;case Fi:ui(this.manifest,m);break;case bn:var M=wn(m[1]),P=Je(M);Object.assign(this.manifest.sessionData,P)}},li.prototype.setHoldBack=function(){var p=this.manifest,h=p.serverControl,m=p.targetDuration,g=p.partTargetDuration;if(h){var w="holdBack",C="partHoldBack",L=m&&3*m,M=g&&2*g;m&&!h.hasOwnProperty(w)&&(h[w]=L),L&&h[w]<L&&(h[w]=L),g&&!h.hasOwnProperty(C)&&(h[C]=3*g),g&&h[C]<M&&(h[C]=M)}};var ui=function(p,h){var m,g=di(h[0].replace("#EXT-X-",""));An(h[1])?(m={},m=Object.assign(hi(h[1]),m)):m=ci(h[1]),p[g]=m},di=function(p){return p.toLowerCase().replace(/-(\w)/g,function(h){return h[1].toUpperCase()})},ci=function(p){if(p.toLowerCase()==="yes"||p.toLowerCase()==="no")return p.toLowerCase()==="yes";var h=p.indexOf(":")!==-1?p:parseFloat(p);return isNaN(h)?p:h},Sn=function(p){var h={},m=p.split("=");return m.length>1&&(h[di(m[0])]=ci(m[1])),h},hi=function(p){for(var h=p.split(","),m={},g=0;h.length>g;g++){var w=h[g],C=Sn(w);m=Object.assign(C,m)}return m},An=function(p){return p.indexOf("=")>-1},Ni=function(p,h){return h===-1?[p]:[p.substring(0,h),p.substring(h+1)]},wn=function(p){var h={};if(p){var m=p.search(",");return[p.slice(0,m),p.slice(m+1)].forEach(function(g,w){for(var C=g.replace(/['"]+/g,"").split("="),L=0;L<C.length;L++)C[L]==="DATA-ID"&&(h["DATA-ID"]=C[1-L]),C[L]==="VALUE"&&(h.VALUE=C[1-L])}),{data:h}}},fi=li,kn={safeCall:function(p,h,m,g){var w=g;if(p&&typeof p[h]=="function")try{w=p[h].apply(p,m)}catch(C){ee.info("safeCall error",C)}return w},safeIncrement:T,getComputedStyle:function(p,h){var m;if(p&&h&&z()&&typeof z().getComputedStyle=="function")return Rr&&Rr.has(p)&&(m=Rr.get(p)),m||(m=z().getComputedStyle(p,null),Rr&&Rr.set(p,m)),m.getPropertyValue(h)},secondsToMs:function(p){return Math.floor(1e3*p)},assign:Object.assign,headersStringToObject:ye,cdnHeadersToRequestId:Ye,extractHostnameAndDomain:we,extractHostname:De,manifestParser:fi,generateShortID:Re,generateUUID:te,now:Te.now},Yr={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"};function Ui(p,h){return function(m){if(Array.isArray(m))return m}(p)||function(m,g){var w=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(w!=null){var C,L,M=[],P=!0,W=!1;try{for(w=w.call(m);!(P=(C=w.next()).done)&&(M.push(C.value),!g||M.length!==g);P=!0);}catch(ue){W=!0,L=ue}finally{try{P||w.return==null||w.return()}finally{if(W)throw L}}return M}}(p,h)||function(m,g){if(m){if(typeof m=="string")return Ln(m,g);var w=Object.prototype.toString.call(m).slice(8,-1);return w==="Object"&&m.constructor&&(w=m.constructor.name),w==="Map"||w==="Set"?Array.from(m):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?Ln(m,g):void 0}}(p,h)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ln(p,h){(h==null||h>p.length)&&(h=p.length);for(var m=0,g=new Array(h);m<h;m++)g[m]=p[m];return g}var Lt={},zr=function p(h){var m=arguments;typeof h=="string"?p.hasOwnProperty(h)?z().setTimeout(function(){m=Array.prototype.splice.call(m,1),p[h].apply(null,m)},0):ee.warn("`"+h+"` is an unknown task"):typeof h=="function"?z().setTimeout(function(){h(p)},0):ee.warn("`"+h+"` is invalid.")},Rn={loaded:Te.now(),NAME:"mux-embed",VERSION:"4.26.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(p,h){return function(m,g,w){var C=Vr(de(g),3),L=C[0],M=C[1],P=C[2],W=m.log,ue=m.utils.getComputedStyle,pe=m.utils.secondsToMs;if(!L)return W.error("No element was found with the `"+M+"` query selector.");if(P!=="video"&&P!=="audio")return W.error("The element of `"+M+"` was not a media element.");L.mux&&(L.mux.destroy(),delete L.mux,W.warn("Already monitoring this video element, replacing existing event listeners")),(w=Object.assign({automaticErrorTracking:!0},w)).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:m.VERSION},w.data),w.getPlayheadTime=function(){return pe(L.currentTime)},w.getStateData=function(){var ae,_e,Ie=this.hlsjs&&this.hlsjs.url,ot=this.dashjs&&jr(this.dashjs.getSource==="function")&&this.dashjs.getSource(),ut={player_is_paused:L.paused,player_playhead_time:pe(L.currentTime),player_width:parseInt(ue(L,"width")),player_height:parseInt(ue(L,"height")),player_autoplay_on:L.autoplay,player_preload_on:L.preload,player_language_code:L.lang,player_is_fullscreen:tr()&&!!(tr().fullscreenElement||tr().webkitFullscreenElement||tr().mozFullScreenElement||tr().msFullscreenElement),video_poster_url:L.poster,video_source_url:Ie||ot||L.currentSrc,video_source_duration:pe(L.duration),video_source_height:L.videoHeight,video_source_width:L.videoWidth,view_dropped_frame_count:(ae=L)===null||ae===void 0||(_e=ae.getVideoPlaybackQuality)===null||_e===void 0?void 0:_e.call(ae).droppedVideoFrames},dt=w.getPlayheadTime();if(L.getStartDate&&dt>0){var Tt=L.getStartDate();if(Tt&&typeof Tt.getTime=="function"&&Tt.getTime()){var Me=Tt.getTime();if(ut.player_program_time=Me+dt,L.seekable.length>0){var rt=Me+L.seekable.end(L.seekable.length-1);ut.player_live_edge_program_time=rt}}}return ut},L.mux=L.mux||{},L.mux.deleted=!1,L.mux.emit=function(ae,_e){m.emit(M,ae,_e)};var Ce=function(){W.error("The monitor for this video element has already been destroyed.")};L.mux.destroy=function(){Object.keys(L.mux.listeners).forEach(function(ae){L.removeEventListener(ae,L.mux.listeners[ae],!1)}),delete L.mux.listeners,L.mux.destroy=Ce,L.mux.swapElement=Ce,L.mux.emit=Ce,L.mux.addHLSJS=Ce,L.mux.addDashJS=Ce,L.mux.removeHLSJS=Ce,L.mux.removeDashJS=Ce,L.mux.deleted=!0,m.emit(M,"destroy")},L.mux.swapElement=function(ae){var _e=Vr(de(ae),3),Ie=_e[0],ot=_e[1],ut=_e[2];return Ie?ut!=="video"&&ut!=="audio"?m.log.error("The element of `"+ot+"` was not a media element."):(Ie.muxId=L.muxId,delete L.muxId,Ie.mux=Ie.mux||{},Ie.mux.listeners=Object.assign({},L.mux.listeners),delete L.mux.listeners,Object.keys(Ie.mux.listeners).forEach(function(dt){L.removeEventListener(dt,Ie.mux.listeners[dt],!1),Ie.addEventListener(dt,Ie.mux.listeners[dt],!1)}),Ie.mux.swapElement=L.mux.swapElement,Ie.mux.destroy=L.mux.destroy,delete L.mux,void(L=Ie)):m.log.error("No element was found with the `"+ot+"` query selector.")},L.mux.addHLSJS=function(ae){m.addHLSJS(M,ae)},L.mux.addDashJS=function(ae){m.addDashJS(M,ae)},L.mux.removeHLSJS=function(){m.removeHLSJS(M)},L.mux.removeDashJS=function(){m.removeDashJS(M)},m.init(M,w),m.emit(M,"playerready"),L.paused||(m.emit(M,"play"),L.readyState>2&&m.emit(M,"playing")),L.mux.listeners={},la.forEach(function(ae){(ae!=="error"||w.automaticErrorTracking)&&(L.mux.listeners[ae]=function(){var _e={};if(ae==="error"){if(!L.error||L.error.code===1)return;_e.player_error_code=L.error.code,_e.player_error_message=Oi[L.error.code]||L.error.message}m.emit(M,ae,_e)},L.addEventListener(ae,L.mux.listeners[ae],!1))})}(zr,p,h)},destroyMonitor:function(p){var h=Ui(de(p),1)[0];h&&h.mux&&typeof h.mux.destroy=="function"?h.mux.destroy():ee.error("A video element monitor for `"+p+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(p,h){var m=ce(p);Lt[m]?Lt[m].addHLSJS(h):ee.error("A monitor for `"+m+"` has not been initialized.")},addDashJS:function(p,h){var m=ce(p);Lt[m]?Lt[m].addDashJS(h):ee.error("A monitor for `"+m+"` has not been initialized.")},removeHLSJS:function(p){var h=ce(p);Lt[h]?Lt[h].removeHLSJS():ee.error("A monitor for `"+h+"` has not been initialized.")},removeDashJS:function(p){var h=ce(p);Lt[h]?Lt[h].removeDashJS():ee.error("A monitor for `"+h+"` has not been initialized.")},init:function(p,h){fe()&&h&&h.respectDoNotTrack&&ee.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var m=ce(p);Lt[m]=new qr(zr,m,h)},emit:function(p,h,m){var g=ce(p);Lt[g]?(Lt[g].emit(h,m),h==="destroy"&&delete Lt[g]):ee.error("A monitor for `"+g+"` has not been initialized.")},checkDoNotTrack:fe,log:ee,utils:kn,events:Yr,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(zr,Rn),z()!==void 0&&typeof z().addEventListener=="function"&&z().addEventListener("pagehide",function(p){p.persisted||(zr.WINDOW_UNLOADING=!0)},!1);var sr=zr},655:function(j,V,Y){var oe,z;function te(Re){return te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ce){return typeof ce}:function(ce){return ce&&typeof Symbol=="function"&&ce.constructor===Symbol&&ce!==Symbol.prototype?"symbol":typeof ce},te(Re);/*!
 * JavaScript Cookie v2.1.3
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */}(function(Re){var ce=!1;if((z=typeof(oe=Re)=="function"?oe.call(V,Y,V,j):oe)===void 0||(j.exports=z),ce=!0,te(V)==="object"&&(j.exports=Re(),ce=!0),!ce){var de=window.Cookies,xe=window.Cookies=Re();xe.noConflict=function(){return window.Cookies=de,xe}}})(function(){var Re=function(){for(var ce=0,de={};ce<arguments.length;ce++){var xe=arguments[ce];for(var Ae in xe)de[Ae]=xe[Ae]}return de};return function ce(de){function xe(Ae,Qe,ee){var fe;if(typeof document<"u"){if(arguments.length>1){if(typeof(ee=Re({path:"/"},xe.defaults,ee)).expires=="number"){var Te=new Date;Te.setMilliseconds(Te.getMilliseconds()+864e5*ee.expires),ee.expires=Te}try{fe=JSON.stringify(Qe),/^[\{\[]/.test(fe)&&(Qe=fe)}catch{}return Qe=de.write?de.write(Qe,Ae):encodeURIComponent(String(Qe)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),Ae=(Ae=(Ae=encodeURIComponent(String(Ae))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[Ae,"=",Qe,ee.expires?"; expires="+ee.expires.toUTCString():"",ee.path?"; path="+ee.path:"",ee.domain?"; domain="+ee.domain:"",ee.secure?"; secure":""].join("")}Ae||(fe={});for(var De=document.cookie?document.cookie.split("; "):[],we=/(%[0-9A-Z]{2})+/g,$=0;$<De.length;$++){var T=De[$].split("="),Z=T.slice(1).join("=");Z.charAt(0)==='"'&&(Z=Z.slice(1,-1));try{var N=T[0].replace(we,decodeURIComponent);if(Z=de.read?de.read(Z,N):de(Z,N)||Z.replace(we,decodeURIComponent),this.json)try{Z=JSON.parse(Z)}catch{}if(Ae===N){fe=Z;break}Ae||(fe[N]=Z)}catch{}}return fe}}return xe.set=xe,xe.get=function(Ae){return xe.call(xe,Ae)},xe.getJSON=function(){return xe.apply({json:!0},[].slice.call(arguments))},xe.defaults={},xe.remove=function(Ae,Qe){xe(Ae,"",Re(Qe,{expires:-1}))},xe.withConverter=ce,xe}(function(){})})},153:function(j,V,Y){var oe,z=Y.g!==void 0?Y.g:typeof window<"u"?window:{},te=Y(558);typeof document<"u"?oe=document:(oe=z["__GLOBAL_DOCUMENT_CACHE@4"])||(oe=z["__GLOBAL_DOCUMENT_CACHE@4"]=te),j.exports=oe},48:function(j,V,Y){var oe;oe=typeof window<"u"?window:Y.g!==void 0?Y.g:typeof self<"u"?self:{},j.exports=oe},640:function(j,V,Y){var oe,z;(function(te,Re){oe=function(){var ce=function(){},de="undefined",xe=typeof window!==de&&typeof window.navigator!==de&&/Trident\/|MSIE /.test(window.navigator.userAgent),Ae=["trace","debug","info","warn","error"];function Qe(ye,Ye){var Je=ye[Ye];if(typeof Je.bind=="function")return Je.bind(ye);try{return Function.prototype.bind.call(Je,ye)}catch{return function(){return Function.prototype.apply.apply(Je,[ye,arguments])}}}function ee(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function fe(ye){return ye==="debug"&&(ye="log"),typeof console!==de&&(ye==="trace"&&xe?ee:console[ye]!==void 0?Qe(console,ye):console.log!==void 0?Qe(console,"log"):ce)}function Te(ye,Ye){for(var Je=0;Je<Ae.length;Je++){var Ct=Ae[Je];this[Ct]=Je<ye?ce:this.methodFactory(Ct,ye,Ye)}this.log=this.debug}function De(ye,Ye,Je){return function(){typeof console!==de&&(Te.call(this,Ye,Je),this[ye].apply(this,arguments))}}function we(ye,Ye,Je){return fe(ye)||De.apply(this,arguments)}function $(ye,Ye,Je){var Ct,Ve=this;Ye=Ye??"WARN";var x="loglevel";function jt(Be){var Et=(Ae[Be]||"silent").toUpperCase();if(typeof window!==de&&x){try{return void(window.localStorage[x]=Et)}catch{}try{window.document.cookie=encodeURIComponent(x)+"="+Et+";"}catch{}}}function Pt(){var Be;if(typeof window!==de&&x){try{Be=window.localStorage[x]}catch{}if(typeof Be===de)try{var Et=window.document.cookie,Ze=Et.indexOf(encodeURIComponent(x)+"=");Ze!==-1&&(Be=/^([^;]+)/.exec(Et.slice(Ze))[1])}catch{}return Ve.levels[Be]===void 0&&(Be=void 0),Be}}function Xe(){if(typeof window!==de&&x){try{return void window.localStorage.removeItem(x)}catch{}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}typeof ye=="string"?x+=":"+ye:typeof ye=="symbol"&&(x=void 0),Ve.name=ye,Ve.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},Ve.methodFactory=Je||we,Ve.getLevel=function(){return Ct},Ve.setLevel=function(Be,Et){if(typeof Be=="string"&&Ve.levels[Be.toUpperCase()]!==void 0&&(Be=Ve.levels[Be.toUpperCase()]),!(typeof Be=="number"&&Be>=0&&Be<=Ve.levels.SILENT))throw"log.setLevel() called with invalid level: "+Be;if(Ct=Be,Et!==!1&&jt(Be),Te.call(Ve,Be,ye),typeof console===de&&Be<Ve.levels.SILENT)return"No console available for logging"},Ve.setDefaultLevel=function(Be){Ye=Be,Pt()||Ve.setLevel(Be,!1)},Ve.resetLevel=function(){Ve.setLevel(Ye,!1),Xe()},Ve.enableAll=function(Be){Ve.setLevel(Ve.levels.TRACE,Be)},Ve.disableAll=function(Be){Ve.setLevel(Ve.levels.SILENT,Be)};var Vt=Pt();Vt==null&&(Vt=Ye),Ve.setLevel(Vt,!1)}var T=new $,Z={};T.getLogger=function(ye){if(typeof ye!="symbol"&&typeof ye!="string"||ye==="")throw new TypeError("You must supply a name when creating a logger.");var Ye=Z[ye];return Ye||(Ye=Z[ye]=new $(ye,T.getLevel(),T.methodFactory)),Ye};var N=typeof window!==de?window.log:void 0;return T.noConflict=function(){return typeof window!==de&&window.log===T&&(window.log=N),T},T.getLoggers=function(){return Z},T.default=T,T},(z=typeof oe=="function"?oe.call(V,Y,V,j):oe)===void 0||(j.exports=z)})()},375:function(j,V){var Y=Object.prototype.hasOwnProperty;function oe(te){try{return decodeURIComponent(te.replace(/\+/g," "))}catch{return null}}function z(te){try{return encodeURIComponent(te)}catch{return null}}V.stringify=function(te,Re){Re=Re||"";var ce,de,xe=[];for(de in typeof Re!="string"&&(Re="?"),te)if(Y.call(te,de)){if((ce=te[de])||ce!=null&&!isNaN(ce)||(ce=""),de=z(de),ce=z(ce),de===null||ce===null)continue;xe.push(de+"="+ce)}return xe.length?Re+xe.join("&"):""},V.parse=function(te){for(var Re,ce=/([^=?#&]+)=?([^&]*)/g,de={};Re=ce.exec(te);){var xe=oe(Re[1]),Ae=oe(Re[2]);xe===null||Ae===null||xe in de||(de[xe]=Ae)}return de}},558:function(){}},H={};function G(j){var V=H[j];if(V!==void 0)return V.exports;var Y=H[j]={exports:{}};return F[j].call(Y.exports,Y,Y.exports,G),Y.exports}return G.n=function(j){var V=j&&j.__esModule?function(){return j.default}:function(){return j};return G.d(V,{a:V}),V},G.d=function(j,V){for(var Y in V)G.o(V,Y)&&!G.o(j,Y)&&Object.defineProperty(j,Y,{enumerable:!0,get:V[Y]})},G.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),G.o=function(j,V){return Object.prototype.hasOwnProperty.call(j,V)},G(80)}()},b.exports=I()})()})(yo);var su=yo.exports;const Xa=po(su);var Eo={exports:{}};(function(b,k){(function I(F){var H;H=function(){function G(s,n){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);n&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),e.push.apply(e,t)}return e}function j(s){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?G(Object(e),!0).forEach(function(t){oe(s,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):G(Object(e)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))})}return s}function V(s,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,fe(t.key),t)}}function Y(s,n,e){return n&&V(s.prototype,n),e&&V(s,e),Object.defineProperty(s,"prototype",{writable:!1}),s}function oe(s,n,e){return(n=fe(n))in s?Object.defineProperty(s,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[n]=e,s}function z(){return z=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s},z.apply(this,arguments)}function te(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,ce(s,n)}function Re(s){return Re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Re(s)}function ce(s,n){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(s,n)}function de(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xe(s,n,e){return xe=de()?Reflect.construct.bind():function(t,r,i){var a=[null];a.push.apply(a,r);var o=new(Function.bind.apply(t,a));return i&&ce(o,i.prototype),o},xe.apply(null,arguments)}function Ae(s){var n=typeof Map=="function"?new Map:void 0;return Ae=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(n!==void 0){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return xe(e,arguments,Re(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ce(r,e)},Ae(s)}function Qe(s,n){(n==null||n>s.length)&&(n=s.length);for(var e=0,t=new Array(n);e<n;e++)t[e]=s[e];return t}function ee(s,n){var e=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(e)return(e=e.call(s)).next.bind(e);if(Array.isArray(s)||(e=function(r,i){if(r){if(typeof r=="string")return Qe(r,i);var a=Object.prototype.toString.call(r).slice(8,-1);return a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set"?Array.from(r):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Qe(r,i):void 0}}(s))||n&&s&&typeof s.length=="number"){e&&(s=e);var t=0;return function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fe(s){var n=function(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}(s,"string");return typeof n=="symbol"?n:String(n)}function Te(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var De={exports:{}};(function(s,n){var e,t,r,i,a;e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(o,l,u){if(u=u||{},o=o.trim(),!(l=l.trim())){if(!u.alwaysNormalize)return o;var d=a.parseURL(o);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var c=a.parseURL(l);if(!c)throw new Error("Error trying to parse relative URL.");if(c.scheme)return u.alwaysNormalize?(c.path=a.normalizePath(c.path),a.buildURLFromParts(c)):l;var f=a.parseURL(o);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var v=t.exec(f.path);f.netLoc=v[1],f.path=v[2]}f.netLoc&&!f.path&&(f.path="/");var y={scheme:f.scheme,netLoc:c.netLoc,path:null,params:c.params,query:c.query,fragment:c.fragment};if(!c.netLoc&&(y.netLoc=f.netLoc,c.path[0]!=="/"))if(c.path){var _=f.path,A=_.substring(0,_.lastIndexOf("/")+1)+c.path;y.path=a.normalizePath(A)}else y.path=f.path,c.params||(y.params=f.params,c.query||(y.query=f.query));return y.path===null&&(y.path=u.alwaysNormalize?a.normalizePath(c.path):c.path),a.buildURLFromParts(y)},parseURL:function(o){var l=e.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(r,"");o.length!==(o=o.replace(i,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}},s.exports=a})(De);var we=De.exports,$=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},T=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s}({}),Z=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),N=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.UNKNOWN="unknown",s}({}),ye=function(){},Ye={trace:ye,debug:ye,log:ye,warn:ye,info:ye,error:ye},Je=Ye;function Ct(s){var n=self.console[s];return n?n.bind(self.console,"["+s+"] >"):ye}function Ve(s,n){if(self.console&&s===!0||typeof s=="object"){(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(a){Je[a]=e[a]?e[a].bind(e):Ct(a)})})(s,"debug","log","info","warn","error");try{Je.log('Debug logs enabled for "'+n+'" in hls.js version 1.4.5')}catch{Je=Ye}}else Je=Ye}var x=Je,jt=/^(\d+)x(\d+)$/,Pt=/(.+?)=(".*?"|.*?)(?:,|$)/g,Xe=function(){function s(e){for(var t in typeof e=="string"&&(e=s.parseAttrList(e)),e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}var n=s.prototype;return n.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},n.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},n.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},n.decimalFloatingPoint=function(e){return parseFloat(this[e])},n.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},n.enumeratedString=function(e){return this[e]},n.bool=function(e){return this[e]==="YES"},n.decimalResolution=function(e){var t=jt.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},s.parseAttrList=function(e){var t,r={};for(Pt.lastIndex=0;(t=Pt.exec(e))!==null;){var i=t[2];i.indexOf('"')===0&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1].trim()]=i}return r},s}();function Vt(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"}var Be=function(){function s(n,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var t=e.attr;for(var r in t)if(Object.prototype.hasOwnProperty.call(n,r)&&n[r]!==t[r]){x.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+n.ID+'"'),this._badValueForSameId=r;break}n=z(new Xe({}),t,n)}if(this.attr=n,this._startDate=new Date(n["START-DATE"]),"END-DATE"in this.attr){var i=new Date(this.attr["END-DATE"]);$(i.getTime())&&(this._endDate=i)}}return Y(s,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var n=this.duration;return n!==null?new Date(this._startDate.getTime()+1e3*n):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if($(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&$(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),s}(),Et=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},Ze="audio",gt="video",X="audiovideo",ve=function(){function s(n){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[Ze]=null,e[gt]=null,e[X]=null,e),this.baseurl=n}return s.prototype.setByteRange=function(n,e){var t=n.split("@",2),r=[];t.length===1?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(t[1]),r[1]=parseInt(t[0])+r[0],this._byteRange=r},Y(s,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=we.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(n){this._url=n}}]),s}(),je=function(s){function n(t,r){var i;return(i=s.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new Et,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.type=t,i}te(n,s);var e=n.prototype;return e.setKeyFormat=function(t){if(this.levelkeys){var r=this.levelkeys[t];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},e.abortRequests=function(){var t,r;(t=this.loader)==null||t.abort(),(r=this.keyLoader)==null||r.abort()},e.setElementaryStreamInfo=function(t,r,i,a,o,l){l===void 0&&(l=!1);var u=this.elementaryStreams,d=u[t];d?(d.startPTS=Math.min(d.startPTS,r),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,a),d.endDTS=Math.max(d.endDTS,o)):u[t]={startPTS:r,endPTS:i,startDTS:a,endDTS:o,partial:l}},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[Ze]=null,t[gt]=null,t[X]=null},Y(n,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!$(this.programDateTime))return null;var t=$(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}}]),n}(ve),at=function(s){function n(e,t,r,i,a){var o;(o=s.call(this,r)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new Et,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=t,o.index=i;var l=e.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,a),a&&(o.fragOffset=a.fragOffset+a.duration),o}return te(n,s),Y(n,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),n}(ve),mt=function(){function s(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}return s.prototype.reloaded=function(n){if(!n)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-n.lastPartSn,t=this.lastPartIndex-n.lastPartIndex;this.updated=this.endSN!==n.endSN||!!t||!!e,this.advanced=this.endSN>n.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(.6*n.misses):this.misses=n.misses+1,this.availabilityDelay=n.availabilityDelay},Y(s,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&$(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var n=this.driftEndTime-this.driftStartTime;return n>0?1e3*(this.driftEnd-this.driftStart)/n:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var n;return(n=this.fragments)!=null&&n.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),s}();function wt(s){return Uint8Array.from(atob(s),function(n){return n.charCodeAt(0)})}function er(s){var n,e,t=s.split(":"),r=null;if(t[0]==="data"&&t.length===2){var i=t[1].split(";"),a=i[i.length-1].split(",");if(a.length===2){var o=a[0]==="base64",l=a[1];o?(i.splice(-1,1),r=wt(l)):(n=Dt(l).subarray(0,16),(e=new Uint8Array(16)).set(n,16-n.length),r=e)}}return r}function Dt(s){return Uint8Array.from(unescape(encodeURIComponent(s)),function(n){return n.charCodeAt(0)})}var We={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},xt="org.w3.clearkey",cr="com.apple.streamingkeydelivery",nr="com.microsoft.playready",It="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function et(s){switch(s){case cr:return We.FAIRPLAY;case nr:return We.PLAYREADY;case It:return We.WIDEVINE;case xt:return We.CLEARKEY}}var hr="edef8ba979d64acea3c827dcd51d21ed";function fr(s){switch(s){case We.FAIRPLAY:return cr;case We.PLAYREADY:return nr;case We.WIDEVINE:return It;case We.CLEARKEY:return xt}}function Ar(s){var n=s.drmSystems,e=s.widevineLicenseUrl,t=n?[We.FAIRPLAY,We.WIDEVINE,We.PLAYREADY,We.CLEARKEY].filter(function(r){return!!n[r]}):[];return!t[We.WIDEVINE]&&e&&t.push(We.WIDEVINE),t}var wr=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function Wt(s,n,e){return Uint8Array.prototype.slice?s.slice(n,e):new Uint8Array(Array.prototype.slice.call(s,n,e))}var bi,Si=function(s,n){return n+10<=s.length&&s[n]===73&&s[n+1]===68&&s[n+2]===51&&s[n+3]<255&&s[n+4]<255&&s[n+6]<128&&s[n+7]<128&&s[n+8]<128&&s[n+9]<128},Ji=function(s,n){return n+10<=s.length&&s[n]===51&&s[n+1]===68&&s[n+2]===73&&s[n+3]<255&&s[n+4]<255&&s[n+6]<128&&s[n+7]<128&&s[n+8]<128&&s[n+9]<128},ti=function(s,n){for(var e=n,t=0;Si(s,n);)t+=10,t+=ri(s,n+6),Ji(s,n+10)&&(t+=10),n+=t;if(t>0)return s.subarray(e,e+t)},ri=function(s,n){var e=0;return e=(127&s[n])<<21,e|=(127&s[n+1])<<14,e|=(127&s[n+2])<<7,e|=127&s[n+3]},Zi=function(s,n){return Si(s,n)&&ri(s,n+6)+10<=s.length-n},en=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},Qn=function(s){var n=String.fromCharCode(s[0],s[1],s[2],s[3]),e=ri(s,4);return{type:n,size:e,data:s.subarray(10,10+e)}},Ai=function(s){for(var n=0,e=[];Si(s,n);){for(var t=ri(s,n+6),r=(n+=10)+t;n+8<r;){var i=Qn(s.subarray(n)),a=$n(i);a&&e.push(a),n+=i.size+10}Ji(s,n)&&(n+=10)}return e},$n=function(s){return s.type==="PRIV"?Jn(s):s.type[0]==="W"?rn(s):tn(s)},Jn=function(s){if(!(s.size<2)){var n=Nt(s.data,!0),e=new Uint8Array(s.data.subarray(n.length+1));return{key:s.type,info:n,data:e.buffer}}},tn=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var n=1,e=Nt(s.data.subarray(n),!0);n+=e.length+1;var t=Nt(s.data.subarray(n));return{key:s.type,info:e,data:t}}var r=Nt(s.data.subarray(1));return{key:s.type,data:r}}},rn=function(s){if(s.type==="WXXX"){if(s.size<2)return;var n=1,e=Nt(s.data.subarray(n),!0);n+=e.length+1;var t=Nt(s.data.subarray(n));return{key:s.type,info:e,data:t}}var r=Nt(s.data);return{key:s.type,data:r}},Zn=function(s){if(s.data.byteLength===8){var n=new Uint8Array(s.data),e=1&n[3],t=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return t/=45,e&&(t+=4772185884e-2),Math.round(t)}},Nt=function(s,n){n===void 0&&(n=!1);var e=ea();if(e){var t=e.decode(s);if(n){var r=t.indexOf("\0");return r!==-1?t.substring(0,r):t}return t.replace(/\0/g,"")}for(var i,a,o,l=s.length,u="",d=0;d<l;){if((i=s[d++])===0&&n)return u;if(i!==0&&i!==3)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(i);break;case 12:case 13:a=s[d++],u+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=s[d++],o=s[d++],u+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&o)<<0)}}return u};function ea(){return bi||self.TextDecoder===void 0||(bi=new self.TextDecoder("utf-8")),bi}var Yt=function(s){for(var n="",e=0;e<s.length;e++){var t=s[e].toString(16);t.length<2&&(t="0"+t),n+=t}return n},Ur=Math.pow(2,32)-1,ta=[].push,nn={video:1,audio:2,id3:3,text:4};function lt(s){return String.fromCharCode.apply(null,s)}function an(s,n){var e=s[n]<<8|s[n+1];return e<0?65536+e:e}function Oe(s,n){var e=wi(s,n);return e<0?4294967296+e:e}function wi(s,n){return s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3]}function ki(s,n,e){s[n]=e>>24,s[n+1]=e>>16&255,s[n+2]=e>>8&255,s[n+3]=255&e}function He(s,n){var e=[];if(!n.length)return e;for(var t=s.byteLength,r=0;r<t;){var i=Oe(s,r),a=i>1?r+i:t;if(lt(s.subarray(r+4,r+8))===n[0])if(n.length===1)e.push(s.subarray(r+8,a));else{var o=He(s.subarray(r+8,a),n.slice(1));o.length&&ta.apply(e,o)}r=a}return e}function sn(s){var n=[],e=s[0],t=8,r=Oe(s,t);t+=4,t+=e===0?8:16,t+=2;var i=s.length+0,a=an(s,t);t+=2;for(var o=0;o<a;o++){var l=t,u=Oe(s,l);l+=4;var d=2147483647&u;if((2147483648&u)>>>31==1)return x.warn("SIDX has hierarchical references (not supported)"),null;var c=Oe(s,l);l+=4,n.push({referenceSize:d,subsegmentDuration:c,info:{duration:c/r,start:i,end:i+d-1}}),i+=d,t=l+=4}return{earliestPresentationTime:0,timescale:r,version:e,referencesCount:a,references:n}}function Li(s){for(var n=[],e=He(s,["moov","trak"]),t=0;t<e.length;t++){var r=e[t],i=He(r,["tkhd"])[0];if(i){var a=i[0],o=a===0?12:20,l=Oe(i,o),u=He(r,["mdia","mdhd"])[0];if(u){var d=Oe(u,o=(a=u[0])===0?12:20),c=He(r,["mdia","hdlr"])[0];if(c){var f=lt(c.subarray(8,12)),v={soun:Ze,vide:gt}[f];if(v){var y=He(r,["mdia","minf","stbl","stsd"])[0],_=void 0;y&&(_=lt(y.subarray(12,16))),n[l]={timescale:d,type:v},n[v]={timescale:d,id:l,codec:_}}}}}}return He(s,["moov","mvex","trex"]).forEach(function(A){var E=Oe(A,4),S=n[E];S&&(S.default={duration:Oe(A,12),flags:Oe(A,20)})}),n}function Ri(s){var n=He(s,["schm"])[0];if(n){var e=lt(n.subarray(4,8));if(e==="cbcs"||e==="cenc")return He(s,["schi","tenc"])[0]}return x.error("[eme] missing 'schm' box"),null}function ra(s){var n=Oe(s,0),e=8;1&n&&(e+=4),4&n&&(e+=4);for(var t=0,r=Oe(s,4),i=0;i<r;i++)256&n&&(t+=Oe(s,e),e+=4),512&n&&(e+=4),1024&n&&(e+=4),2048&n&&(e+=4);return t}function vr(s,n){var e=new Uint8Array(s.length+n.length);return e.set(s),e.set(n,s.length),e}function Di(s,n){var e=[],t=n.samples,r=n.timescale,i=n.id,a=!1;return He(t,["moof"]).map(function(o){var l=o.byteOffset-8;He(o,["traf"]).map(function(u){var d=He(u,["tfdt"]).map(function(c){var f=c[0],v=Oe(c,4);return f===1&&(v*=Math.pow(2,32),v+=Oe(c,8)),v/r})[0];return d!==void 0&&(s=d),He(u,["tfhd"]).map(function(c){var f=Oe(c,4),v=16777215&Oe(c,0),y=0,_=(16&v)!=0,A=0,E=(32&v)!=0,S=8;f===i&&(1&v&&(S+=8),2&v&&(S+=4),8&v&&(y=Oe(c,S),S+=4),_&&(A=Oe(c,S),S+=4),E&&(S+=4),n.type==="video"&&(a=function(D){if(!D)return!1;var R=D.indexOf("."),O=R<0?D:D.substring(0,R);return O==="hvc1"||O==="hev1"||O==="dvh1"||O==="dvhe"}(n.codec)),He(u,["trun"]).map(function(D){var R=D[0],O=16777215&Oe(D,0),U=(1&O)!=0,B=0,Q=(4&O)!=0,K=(256&O)!=0,q=0,ie=(512&O)!=0,J=0,he=(1024&O)!=0,be=(2048&O)!=0,ge=0,Ee=Oe(D,4),Le=8;U&&(B=Oe(D,Le),Le+=4),Q&&(Le+=4);for(var ke=B+l,Fe=0;Fe<Ee;Fe++){if(K?(q=Oe(D,Le),Le+=4):q=y,ie?(J=Oe(D,Le),Le+=4):J=A,he&&(Le+=4),be&&(ge=R===0?Oe(D,Le):wi(D,Le),Le+=4),n.type===gt)for(var Ge=0;Ge<J;){var Ke=Oe(t,ke);on(a,t[ke+=4])&&ln(t.subarray(ke,ke+Ke),a?2:1,s+ge/r,e),ke+=Ke,Ge+=Ke+4}s+=q/r}}))})})}),e}function on(s,n){if(s){var e=n>>1&63;return e===39||e===40}return(31&n)==6}function ln(s,n,e,t){var r=un(s),i=0;i+=n;for(var a=0,o=0,l=!1,u=0;i<r.length;){a=0;do{if(i>=r.length)break;a+=u=r[i++]}while(u===255);o=0;do{if(i>=r.length)break;o+=u=r[i++]}while(u===255);var d=r.length-i;if(!l&&a===4&&i<r.length){if(l=!0,r[i++]===181){var c=an(r,i);if(i+=2,c===49){var f=Oe(r,i);if(i+=4,f===1195456820){var v=r[i++];if(v===3){var y=r[i++],_=64&y,A=_?2+3*(31&y):0,E=new Uint8Array(A);if(_){E[0]=y;for(var S=1;S<A;S++)E[S]=r[i++]}t.push({type:v,payloadType:a,pts:e,bytes:E})}}}}}else if(a===5&&o<d){if(l=!0,o>16){for(var D=[],R=0;R<16;R++){var O=r[i++].toString(16);D.push(O.length==1?"0"+O:O),R!==3&&R!==5&&R!==7&&R!==9||D.push("-")}for(var U=o-16,B=new Uint8Array(U),Q=0;Q<U;Q++)B[Q]=r[i++];t.push({payloadType:a,pts:e,uuid:D.join(""),userData:Nt(B),userDataBytes:B})}}else if(o<d)i+=o;else if(o>d)break}}function un(s){for(var n=s.byteLength,e=[],t=1;t<n-2;)s[t]===0&&s[t+1]===0&&s[t+2]===3?(e.push(t+2),t+=2):t++;if(e.length===0)return s;var r=n-e.length,i=new Uint8Array(r),a=0;for(t=0;t<r;a++,t++)a===e[0]&&(a++,e.shift()),i[t]=s[a];return i}function dn(s,n,e){if(s.byteLength!==16)throw new RangeError("Invalid system id");var t,r,i;if(n){t=1,r=new Uint8Array(16*n.length);for(var a=0;a<n.length;a++){var o=n[a];if(o.byteLength!==16)throw new RangeError("Invalid key");r.set(o,16*a)}}else t=0,r=new Uint8Array;t>0?(i=new Uint8Array(4),n.length>0&&new DataView(i.buffer).setUint32(0,n.length,!1)):i=new Uint8Array;var l=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(l.buffer).setUint32(0,e.byteLength,!1),function(u){for(var d=arguments.length,c=new Array(d>1?d-1:0),f=1;f<d;f++)c[f-1]=arguments[f];for(var v=c.length,y=8,_=v;_--;)y+=c[_].byteLength;var A=new Uint8Array(y);for(A[0]=y>>24&255,A[1]=y>>16&255,A[2]=y>>8&255,A[3]=255&y,A.set(u,4),_=0,y=8;_<v;_++)A.set(c[_],y),y+=c[_].byteLength;return A}([112,115,115,104],new Uint8Array([t,0,0,0]),s,i,r,l,e||new Uint8Array)}var Br={},Gr=function(){function s(e,t,r,i,a){i===void 0&&(i=[1]),a===void 0&&(a=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=a,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&e!=="AES-128"}s.clearKeyUriToKeyIdMap=function(){Br={}};var n=s.prototype;return n.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case cr:case It:case nr:case xt:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},n.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method!=="AES-128"||this.iv||x.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(A){for(var E=new Uint8Array(16),S=12;S<16;S++)E[S]=A>>8*(15-S)&255;return E}(e);return new s(this.method,this.uri,"identity",this.keyFormatVersions,t)}var r=er(this.uri);if(r)switch(this.keyFormat){case It:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case nr:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=dn(i,null,r);var a=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),o=String.fromCharCode.apply(null,Array.from(a)),l=o.substring(o.indexOf("<"),o.length),u=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("KID")[0];if(u){var d=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(d){var c=wt(d).subarray(0,16);(function(A){var E=function(S,D,R){var O=S[D];S[D]=S[R],S[R]=O};E(A,0,3),E(A,1,2),E(A,4,5),E(A,6,7)})(c),this.keyId=c}}break;default:var f=r.subarray(0,16);if(f.length!==16){var v=new Uint8Array(16);v.set(f,16-f.length),f=v}this.keyId=f}if(!this.keyId||this.keyId.byteLength!==16){var y=Br[this.uri];if(!y){var _=Object.keys(Br).length%Number.MAX_SAFE_INTEGER;y=new Uint8Array(16),new DataView(y.buffer,12,4).setUint32(0,_),Br[this.uri]=y}this.keyId=y}return this},s}(),cn=/\{\$([a-zA-Z0-9-_]+)\}/g;function hn(s){return cn.test(s)}function kt(s,n,e){if(s.variableList!==null||s.hasVariableRefs)for(var t=e.length;t--;){var r=e[t],i=n[r];i&&(n[r]=Ut(s,i))}}function Ut(s,n){if(s.variableList!==null||s.hasVariableRefs){var e=s.variableList;return n.replace(cn,function(t){var r=t.substring(2,t.length-1),i=e==null?void 0:e[r];return i===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+r+'"')),t):i})}return n}function fn(s,n,e){var t,r,i=s.variableList;if(i||(s.variableList=i={}),"QUERYPARAM"in n){t=n.QUERYPARAM;try{var a=new self.URL(e).searchParams;if(!a.has(t))throw new Error('"'+t+'" does not match any query parameter in URI: "'+e+'"');r=a.get(t)}catch(o){s.playlistParsingError||(s.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+o.message))}}else t=n.NAME,r=n.VALUE;t in i?s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+t+'"')):i[t]=r||""}function vn(s,n,e){var t=n.IMPORT;if(e&&t in e){var r=s.variableList;r||(s.variableList=r={}),r[t]=e[t]}else s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+t+'"'))}function ii(){if(typeof self<"u")return self.MediaSource||self.WebKitMediaSource}var ia={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Ii=ii();function ni(s,n){var e;return(e=Ii==null?void 0:Ii.isTypeSupported((n||"video")+'/mp4;codecs="'+s+'"'))!=null&&e}var gr=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,kr=/#EXT-X-MEDIA:(.*)/g,na=/^#EXT(?:INF|-X-TARGETDURATION):/m,gn=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ai=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Hr=function(){function s(){}return s.findGroup=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.id===e)return r}},s.convertAVC1ToAVCOTI=function(n){var e=n.split(".");if(e.length>2){var t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4)}return n},s.resolve=function(n,e){return we.buildAbsoluteURL(e,n,{alwaysNormalize:!0})},s.isMediaPlaylist=function(n){return na.test(n)},s.parseMasterPlaylist=function(n,e){var t,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:hn(n)},i=[];for(gr.lastIndex=0;(t=gr.exec(n))!=null;)if(t[1]){var a,o=new Xe(t[1]);kt(r,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var l=Ut(r,t[2]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:s.resolve(l,e)},d=o.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),aa((o.CODECS||"").split(/[ ,]+/).filter(function(D){return D}),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=s.convertAVC1ToAVCOTI(u.videoCodec)),(a=u.unknownCodecs)!=null&&a.length||i.push(u),r.levels.push(u)}else if(t[3]){var c=t[3],f=t[4];switch(c){case"SESSION-DATA":var v=new Xe(f);kt(r,v,["DATA-ID","LANGUAGE","VALUE","URI"]);var y=v["DATA-ID"];y&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[y]=v);break;case"SESSION-KEY":var _=mn(f,e,r);_.encrypted&&_.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(_)):x.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+f+'"');break;case"DEFINE":var A=new Xe(f);kt(r,A,["NAME","VALUE","QUERYPARAM"]),fn(r,A,e);break;case"CONTENT-STEERING":var E=new Xe(f);kt(r,E,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:s.resolve(E["SERVER-URI"],e),pathwayId:E["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=pn(f)}}var S=i.length>0&&i.length<r.levels.length;return r.levels=S?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},s.parseMasterPlaylistMedia=function(n,e,t){var r,i={},a=t.levels,o={AUDIO:a.map(function(_){return{id:_.attrs.AUDIO,audioCodec:_.audioCodec}}),SUBTITLES:a.map(function(_){return{id:_.attrs.SUBTITLES,textCodec:_.textCodec}}),"CLOSED-CAPTIONS":[]},l=0;for(kr.lastIndex=0;(r=kr.exec(n))!==null;){var u=new Xe(r[1]),d=u.TYPE;if(d){var c=o[d],f=i[d]||[];i[d]=f,kt(t,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:d,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?s.resolve(u.URI,e):""};if(c!=null&&c.length){var y=s.findGroup(c,v.groupId)||c[0];yn(v,y,"audioCodec"),yn(v,y,"textCodec")}f.push(v)}}return i},s.parseLevelPlaylist=function(n,e,t,r,i,a){var o,l,u,d=new mt(e),c=d.fragments,f=null,v=0,y=0,_=0,A=0,E=null,S=new je(r,e),D=-1,R=!1;for(gn.lastIndex=0,d.m3u8=n,d.hasVariableRefs=hn(n);(o=gn.exec(n))!==null;){R&&(R=!1,(S=new je(r,e)).start=_,S.sn=v,S.cc=A,S.level=t,f&&(S.initSegment=f,S.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null));var O=o[1];if(O){S.duration=parseFloat(O);var U=(" "+o[2]).slice(1);S.title=U||null,S.tagList.push(U?["INF",O,U]:["INF",O])}else if(o[3]){if($(S.duration)){S.start=_,u&&Tn(S,u,d),S.sn=v,S.level=t,S.cc=A,S.urlId=i,c.push(S);var B=(" "+o[3]).slice(1);S.relurl=Ut(d,B),Ci(S,E),E=S,_+=S.duration,v++,y=0,R=!0}}else if(o[4]){var Q=(" "+o[4]).slice(1);E?S.setByteRange(Q,E):S.setByteRange(Q)}else if(o[5])S.rawProgramDateTime=(" "+o[5]).slice(1),S.tagList.push(["PROGRAM-DATE-TIME",S.rawProgramDateTime]),D===-1&&(D=c.length);else{if(!(o=o[0].match(ai))){x.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&o[l]===void 0;l++);var K=(" "+o[l]).slice(1),q=(" "+o[l+1]).slice(1),ie=o[l+2]?(" "+o[l+2]).slice(1):"";switch(K){case"PLAYLIST-TYPE":d.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":v=d.startSN=parseInt(q);break;case"SKIP":var J=new Xe(q);kt(d,J,["RECENTLY-REMOVED-DATERANGES"]);var he=J.decimalInteger("SKIPPED-SEGMENTS");if($(he)){d.skippedSegments=he;for(var be=he;be--;)c.unshift(null);v+=he}var ge=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");ge&&(d.recentlyRemovedDateranges=ge.split("	"));break;case"TARGETDURATION":d.targetduration=Math.max(parseInt(q),1);break;case"VERSION":d.version=parseInt(q);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(q||ie)&&S.tagList.push(ie?[q,ie]:[q]);break;case"DISCONTINUITY":A++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([K]);break;case"BITRATE":S.tagList.push([K,q]);break;case"DATERANGE":var Ee=new Xe(q);kt(d,Ee,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),kt(d,Ee,Ee.clientAttrs);var Le=new Be(Ee,d.dateRanges[Ee.ID]);Le.isValid||d.skippedSegments?d.dateRanges[Le.id]=Le:x.warn('Ignoring invalid DATERANGE tag: "'+q+'"'),S.tagList.push(["EXT-X-DATERANGE",q]);break;case"DEFINE":var ke=new Xe(q);kt(d,ke,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ke?vn(d,ke,a):fn(d,ke,e);break;case"DISCONTINUITY-SEQUENCE":A=parseInt(q);break;case"KEY":var Fe=mn(q,e,d);if(Fe.isSupported()){if(Fe.method==="NONE"){u=void 0;break}u||(u={}),u[Fe.keyFormat]&&(u=z({},u)),u[Fe.keyFormat]=Fe}else x.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+q+'"');break;case"START":d.startTimeOffset=pn(q);break;case"MAP":var Ge=new Xe(q);if(kt(d,Ge,["BYTERANGE","URI"]),S.duration){var Ke=new je(r,e);En(Ke,Ge,t,u),f=Ke,S.initSegment=f,f.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=f.rawProgramDateTime)}else En(S,Ge,t,u),f=S,R=!0;break;case"SERVER-CONTROL":var $e=new Xe(q);d.canBlockReload=$e.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=$e.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&$e.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=$e.optionalFloat("PART-HOLD-BACK",0),d.holdBack=$e.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Mt=new Xe(q);d.partTarget=Mt.decimalFloatingPoint("PART-TARGET");break;case"PART":var pt=d.partList;pt||(pt=d.partList=[]);var rr=y>0?pt[pt.length-1]:void 0,Jt=y++,Zt=new Xe(q);kt(d,Zt,["BYTERANGE","URI"]);var yt=new at(Zt,S,e,Jt,rr);pt.push(yt),S.duration+=yt.duration;break;case"PRELOAD-HINT":var St=new Xe(q);kt(d,St,["URI"]),d.preloadHint=St;break;case"RENDITION-REPORT":var lr=new Xe(q);kt(d,lr,["URI"]),d.renditionReports=d.renditionReports||[],d.renditionReports.push(lr);break;default:x.warn("line parsed but not handled: "+o)}}}E&&!E.relurl?(c.pop(),_-=E.duration,d.partList&&(d.fragmentHint=E)):d.partList&&(Ci(S,E),S.cc=A,d.fragmentHint=S,u&&Tn(S,u,d));var Pr=c.length,Ht=c[0],Ki=c[Pr-1];if((_+=d.skippedSegments*d.targetduration)>0&&Pr&&Ki){d.averagetargetduration=_/Pr;var qi=Ki.sn;d.endSN=qi!=="initSegment"?qi:0,d.live||(Ki.endList=!0),Ht&&(d.startCC=Ht.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(_+=d.fragmentHint.duration),d.totalduration=_,d.endCC=A,D>0&&function(Bn,Ei){for(var ei=Bn[Ei],ji=Ei;ji--;){var br=Bn[ji];if(!br)return;br.programDateTime=ei.programDateTime-1e3*br.duration,ei=br}}(c,D),d},s}();function mn(s,n,e){var t,r,i=new Xe(s);kt(e,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var a=(t=i.METHOD)!=null?t:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,d=(r=i.KEYFORMAT)!=null?r:"identity";o&&i.IV&&!l&&x.error("Invalid IV: "+i.IV);var c=o?Hr.resolve(o,n):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Gr(a,c,d,f,l)}function pn(s){var n=new Xe(s).decimalFloatingPoint("TIME-OFFSET");return $(n)?n:null}function aa(s,n){["video","audio","text"].forEach(function(e){var t=s.filter(function(i){return function(a,o){var l=ia[o];return!!l&&l[a.slice(0,4)]===!0}(i,e)});if(t.length){var r=t.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});n[e+"Codec"]=r.length>0?r[0]:t[0],s=s.filter(function(i){return t.indexOf(i)===-1})}}),n.unknownCodecs=s}function yn(s,n,e){var t=n[e];t&&(s[e]=t)}function Ci(s,n){s.rawProgramDateTime?s.programDateTime=Date.parse(s.rawProgramDateTime):n!=null&&n.programDateTime&&(s.programDateTime=n.endProgramDateTime),$(s.programDateTime)||(s.programDateTime=null,s.rawProgramDateTime=null)}function En(s,n,e,t){s.relurl=n.URI,n.BYTERANGE&&s.setByteRange(n.BYTERANGE),s.level=e,s.sn="initSegment",t&&(s.levelkeys=t),s.initSegment=null}function Tn(s,n,e){s.levelkeys=n;var t=e.encryptedFragments;t.length&&t[t.length-1].levelkeys===n||!Object.keys(n).some(function(r){return n[r].isCommonEncryption})||t.push(s)}var mr="manifest",pr="level",zt="audioTrack",Bt="subtitleTrack",ze="main",Gt="audio",ar="subtitle";function si(s){switch(s.type){case zt:return Gt;case Bt:return ar;default:return ze}}function Pi(s,n){var e=s.url;return e!==void 0&&e.indexOf("data:")!==0||(e=n.url),e}var sa=function(){function s(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var n=s.prototype;return n.startLoad=function(e){},n.stopLoad=function(){this.destroyInternalLoaders()},n.registerListeners=function(){var e=this.hls;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.unregisterListeners=function(){var e=this.hls;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,a=new(r||i)(t);return this.loaders[e.type]=a,a},n.getInternalLoader=function(e){return this.loaders[e.type]},n.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},n.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},n.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},n.onManifestLoading=function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:mr,url:r,deliveryDirectives:null})},n.onLevelLoading=function(e,t){var r=t.id,i=t.level,a=t.url,o=t.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:pr,url:a,deliveryDirectives:o})},n.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,a=t.url,o=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:zt,url:a,deliveryDirectives:o})},n.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,a=t.url,o=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:Bt,url:a,deliveryDirectives:o})},n.load=function(e){var t,r,i,a=this,o=this.hls.config,l=this.getInternalLoader(e);if(l){var u=l.context;if(u&&u.url===e.url)return void x.trace("[playlist-loader]: playlist request ongoing");x.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}if(r=e.type===mr?o.manifestLoadPolicy.default:z({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part&&(e.type===pr&&e.level!==null?i=this.hls.levels[e.level].details:e.type===zt&&e.id!==null?i=this.hls.audioTracks[e.id].details:e.type===Bt&&e.id!==null&&(i=this.hls.subtitleTracks[e.id].details),i)){var d=i.partTarget,c=i.targetduration;if(d&&c){var f=1e3*Math.max(3*d,.8*c);r=z({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}var v=r.errorRetry||r.timeoutRetry||{},y={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:v.maxNumRetry||0,retryDelay:v.retryDelayMs||0,maxRetryDelay:v.maxRetryDelayMs||0},_={onSuccess:function(A,E,S,D){var R=a.getInternalLoader(S);a.resetInternalLoader(S.type);var O=A.data;O.indexOf("#EXTM3U")===0?(E.parsing.start=performance.now(),Hr.isMediaPlaylist(O)?a.handleTrackOrLevelPlaylist(A,E,S,D||null,R):a.handleMasterPlaylist(A,E,S,D)):a.handleManifestParsingError(A,S,new Error("no EXTM3U delimiter"),D||null,E)},onError:function(A,E,S,D){a.handleNetworkError(E,S,!1,A,D)},onTimeout:function(A,E,S){a.handleNetworkError(E,S,!0,void 0,A)}};l.load(e,y,_)},n.handleMasterPlaylist=function(e,t,r,i){var a=this.hls,o=e.data,l=Pi(e,r),u=Hr.parseMasterPlaylist(o,l);if(u.playlistParsingError)this.handleManifestParsingError(e,r,u.playlistParsingError,i,t);else{var d=u.contentSteering,c=u.levels,f=u.sessionData,v=u.sessionKeys,y=u.startTimeOffset,_=u.variableList;this.variableList=_;var A=Hr.parseMasterPlaylistMedia(o,l,u),E=A.AUDIO,S=E===void 0?[]:E,D=A.SUBTITLES,R=A["CLOSED-CAPTIONS"];S.length&&(S.some(function(O){return!O.url})||!c[0].audioCodec||c[0].attrs.AUDIO||(x.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Xe({}),bitrate:0,url:""}))),a.trigger(T.MANIFEST_LOADED,{levels:c,audioTracks:S,subtitles:D,captions:R,contentSteering:d,url:l,stats:t,networkDetails:i,sessionData:f,sessionKeys:v,startTimeOffset:y,variableList:_})}},n.handleTrackOrLevelPlaylist=function(e,t,r,i,a){var o=this.hls,l=r.id,u=r.level,d=r.type,c=Pi(e,r),f=$(l)?l:0,v=$(u)?u:f,y=si(r),_=Hr.parseLevelPlaylist(e.data,c,v,y,f,this.variableList);if(d===mr){var A={attrs:new Xe({}),bitrate:0,details:_,name:"",url:c};o.trigger(T.MANIFEST_LOADED,{levels:[A],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=_,this.handlePlaylistLoaded(_,e,t,r,i,a)},n.handleManifestParsingError=function(e,t,r,i,a){this.hls.trigger(T.ERROR,{type:Z.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===mr,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:a})},n.handleNetworkError=function(e,t,r,i,a){r===void 0&&(r=!1);var o="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+e.type;e.type===pr?o+=": "+e.level+" id: "+e.id:e.type!==zt&&e.type!==Bt||(o+=" id: "+e.id+' group-id: "'+e.groupId+'"');var l=new Error(o);x.warn("[playlist-loader]: "+o);var u=N.UNKNOWN,d=!1,c=this.getInternalLoader(e);switch(e.type){case mr:u=r?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,d=!0;break;case pr:u=r?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,d=!1;break;case zt:u=r?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Bt:u=r?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,d=!1}c&&this.resetInternalLoader(e.type);var f={type:Z.NETWORK_ERROR,details:u,fatal:d,url:e.url,loader:c,context:e,error:l,networkDetails:t,stats:a};if(i){var v=(t==null?void 0:t.url)||e.url;f.response=j({url:v,data:void 0},i)}this.hls.trigger(T.ERROR,f)},n.handlePlaylistLoaded=function(e,t,r,i,a,o){var l=this.hls,u=i.type,d=i.level,c=i.id,f=i.groupId,v=i.deliveryDirectives,y=Pi(t,i),_=si(i),A=typeof i.level=="number"&&_===ze?d:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var E=e.playlistParsingError;if(E)l.trigger(T.ERROR,{type:Z.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:E,reason:E.message,response:t,context:i,level:A,parent:_,networkDetails:a,stats:r});else switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),u){case mr:case pr:l.trigger(T.LEVEL_LOADED,{details:e,level:A||0,id:c||0,stats:r,networkDetails:a,deliveryDirectives:v});break;case zt:l.trigger(T.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:f||"",stats:r,networkDetails:a,deliveryDirectives:v});break;case Bt:l.trigger(T.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:f||"",stats:r,networkDetails:a,deliveryDirectives:v})}}else{var S=new Error("No Segments found in Playlist");l.trigger(T.ERROR,{type:Z.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:S,reason:S.message,response:t,context:i,level:A,parent:_,networkDetails:a,stats:r})}},s}();function st(s,n){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=s,n.dispatchEvent(e)}function Kr(s,n){var e=s.mode;if(e==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(n.id))try{if(s.addCue(n),!s.cues.getCueById(n.id))throw new Error("addCue is failed for: "+n)}catch(r){x.debug("[texttrack-utils]: "+r);var t=new self.TextTrackCue(n.startTime,n.endTime,n.text);t.id=n.id,s.addCue(t)}e==="disabled"&&(s.mode=e)}function Lr(s){var n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues)for(var e=s.cues.length;e--;)s.removeCue(s.cues[e]);n==="disabled"&&(s.mode=n)}function xi(s,n,e,t){var r=s.mode;if(r==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var i=function(o,l,u){var d=[],c=function(_,A){if(A<_[0].startTime)return 0;var E=_.length-1;if(A>_[E].endTime)return-1;for(var S=0,D=E;S<=D;){var R=Math.floor((D+S)/2);if(A<_[R].startTime)D=R-1;else{if(!(A>_[R].startTime&&S<E))return R;S=R+1}}return _[S].startTime-A<A-_[D].startTime?S:D}(o,l);if(c>-1)for(var f=c,v=o.length;f<v;f++){var y=o[f];if(y.startTime>=l&&y.endTime<=u)d.push(y);else if(y.startTime>u)return d}return d}(s.cues,n,e),a=0;a<i.length;a++)t&&!t(i[a])||s.removeCue(i[a]);r==="disabled"&&(s.mode=r)}var qr="org.id3",oa="com.apple.quicktime.HLS",tr="https://aomedia.org/emsg/ID3";function jr(){if(typeof self<"u")return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Vr=function(){var s=jr();try{new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function oi(s,n){return s.getTime()/1e3-n}var Rr=function(){function s(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var n=s.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var e=this.hls;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var e=this.hls;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(e,t){this.media=t.media},n.onMediaDetaching=function(){this.id3Track&&(Lr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},n.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3")return st(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,a=r.enableID3MetadataCues;if(i||a){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var l=jr(),u=0;u<o.length;u++){var d=o[u].type;if((d!==tr||i)&&a){var c=Ai(o[u].data);if(c){var f=o[u].pts,v=f+o[u].duration;v>Vr&&(v=Vr),v-f<=0&&(v=f+.25);for(var y=0;y<c.length;y++){var _=c[y];if(!en(_)){this.updateId3CueEnds(f,d);var A=new l(f,v,"");A.value=_,d&&(A.type=d),this.id3Track.addCue(A)}}}}}}}},n.updateId3CueEnds=function(e,t){var r,i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(var a=i.length;a--;){var o=i[a];o.type===t&&o.startTime<e&&o.endTime===Vr&&(o.endTime=e)}},n.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,a=t.type,o=this.id3Track,l=this.hls;if(l){var u=l.config,d=u.enableEmsgMetadataCues,c=u.enableID3MetadataCues;o&&(d||c)&&xi(o,r,i,a==="audio"?function(f){return f.type===qr&&c}:a==="video"?function(f){return f.type===tr&&d}:function(f){return f.type===qr&&c||f.type===tr&&d})}},n.onLevelUpdated=function(e,t){var r=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,o=this.id3Track,l=i.dateRanges,u=Object.keys(l);if(o)for(var d=Object.keys(a).filter(function(S){return!u.includes(S)}),c=function(){var S=d[f];Object.keys(a[S].cues).forEach(function(D){o.removeCue(a[S].cues[D])}),delete a[S]},f=d.length;f--;)c();var v=i.fragments[i.fragments.length-1];if(u.length!==0&&$(v==null?void 0:v.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=v.programDateTime/1e3-v.start,_=jr(),A=function(){var S=u[E],D=l[S],R=a[S],O=(R==null?void 0:R.cues)||{},U=(R==null?void 0:R.durationKnown)||!1,B=oi(D.startDate,y),Q=Vr,K=D.endDate;if(K)Q=oi(K,y),U=!0;else if(D.endOnNext&&!U){var q=u.reduce(function(ke,Fe){var Ge=l[Fe];return Ge.class===D.class&&Ge.id!==Fe&&Ge.startDate>D.startDate&&ke.push(Ge),ke},[]).sort(function(ke,Fe){return ke.startDate.getTime()-Fe.startDate.getTime()})[0];q&&(Q=oi(q.startDate,y),U=!0)}for(var ie,J,he=Object.keys(D.attr),be=0;be<he.length;be++){var ge=he[be];if((J=ge)!=="ID"&&J!=="CLASS"&&J!=="START-DATE"&&J!=="DURATION"&&J!=="END-DATE"&&J!=="END-ON-NEXT"){var Ee=O[ge];if(Ee)U&&!R.durationKnown&&(Ee.endTime=Q);else{var Le=D.attr[ge];Ee=new _(B,Q,""),Vt(ge)&&(ie=Le,Le=Uint8Array.from(ie.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),Ee.value={key:ge,data:Le},Ee.type=oa,Ee.id=S,r.id3Track.addCue(Ee),O[ge]=Ee}}}a[S]={cues:O,dateRange:D,durationKnown:U}},E=0;E<u.length;E++)A()}}},s}(),la=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var n=s.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},n.registerListeners=function(){this.hls.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(T.ERROR,this.onError,this)},n.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(e,t){var r;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&x.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(r!==null){this._latency=r;var i=this.config,a=i.lowLatencyMode,o=i.maxLiveSyncPlaybackRate;if(a&&o!==1){var l=this.targetLatency;if(l!==null){var u=r-l,d=u<Math.min(this.maxLatency,l+t.targetduration);if(t.live&&d&&u>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,f))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}}}}},n.estimateLiveEdge=function(){var e=this.levelDetails;return e===null?null:e.edge+e.age},n.computeLatency=function(){var e=this.estimateLiveEdge();return e===null?null:e-this.currentTime},Y(s,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(e===null)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,a=this.config,o=a.liveSyncDuration,l=a.liveSyncDurationCount,u=a.lowLatencyMode,d=this.hls.userConfig,c=u&&r||t;(d.liveSyncDuration||d.liveSyncDurationCount||c===0)&&(c=o!==void 0?o:l*i);var f=i;return c+Math.min(1*this.stallCount,f)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;var i=r.edge,a=e-t-this.edgeStalled,o=i-r.totalduration,l=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,a),l)}},{key:"drift",get:function(){var e=this.levelDetails;return e===null?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(e===null)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}]),s}(),Oi=["NONE","TYPE-0","TYPE-1",null],Mi="",ua="YES",da="v2",_n=function(){function s(n,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=e,this.skip=t}return s.prototype.addDirectives=function(n){var e=new self.URL(n);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},s}(),Wr=function(){function s(n){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[n.url],this._attrs=[n.attrs],this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.unknownCodecs=n.unknownCodecs,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}return s.prototype.addFallback=function(n){this.url.push(n.url),this._attrs.push(n.attrs)},Y(s,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(n){var e=n%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}},{key:"audioGroupId",get:function(){var n;return(n=this.audioGroupIds)==null?void 0:n[this.urlId]}},{key:"textGroupId",get:function(){var n;return(n=this.textGroupIds)==null?void 0:n[this.urlId]}}]),s}();function Fi(s,n){var e=n.startPTS;if($(e)){var t,r=0;n.sn>s.sn?(r=e-s.start,t=s):(r=s.start-e,t=n),t.duration!==r&&(t.duration=r)}else n.sn>s.sn?s.cc===n.cc&&s.minEndPTS?n.start=s.start+(s.minEndPTS-s.start):n.start=s.start+s.duration:n.start=Math.max(s.start-n.duration,0)}function bn(s,n,e,t,r,i){t-e<=0&&(x.warn("Fragment should have a positive duration",n),t=e+n.duration,i=r+n.duration);var a=e,o=t,l=n.startPTS,u=n.endPTS;if($(l)){var d=Math.abs(l-e);$(n.deltaPTS)?n.deltaPTS=Math.max(d,n.deltaPTS):n.deltaPTS=d,a=Math.max(e,l),e=Math.min(e,l),r=Math.min(r,n.startDTS),o=Math.min(t,u),t=Math.max(t,u),i=Math.max(i,n.endDTS)}var c=e-n.start;n.start!==0&&(n.start=e),n.duration=t-n.start,n.startPTS=e,n.maxStartPTS=a,n.startDTS=r,n.endPTS=t,n.minEndPTS=o,n.endDTS=i;var f,v=n.sn;if(!s||v<s.startSN||v>s.endSN)return 0;var y=v-s.startSN,_=s.fragments;for(_[y]=n,f=y;f>0;f--)Fi(_[f],_[f-1]);for(f=y;f<_.length-1;f++)Fi(_[f],_[f+1]);return s.fragmentHint&&Fi(_[_.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,c}function li(s,n){for(var e=null,t=s.fragments,r=t.length-1;r>=0;r--){var i=t[r].initSegment;if(i){e=i;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var a,o,l,u,d,c=0;if(function(E,S,D){for(var R=S.skippedSegments,O=Math.max(E.startSN,S.startSN)-S.startSN,U=(E.fragmentHint?1:0)+(R?S.endSN:Math.min(E.endSN,S.endSN))-S.startSN,B=S.startSN-E.startSN,Q=S.fragmentHint?S.fragments.concat(S.fragmentHint):S.fragments,K=E.fragmentHint?E.fragments.concat(E.fragmentHint):E.fragments,q=O;q<=U;q++){var ie=K[B+q],J=Q[q];R&&!J&&q<R&&(J=S.fragments[q]=ie),ie&&J&&D(ie,J)}}(s,n,function(E,S){E.relurl&&(c=E.cc-S.cc),$(E.startPTS)&&$(E.endPTS)&&(S.start=S.startPTS=E.startPTS,S.startDTS=E.startDTS,S.maxStartPTS=E.maxStartPTS,S.endPTS=E.endPTS,S.endDTS=E.endDTS,S.minEndPTS=E.minEndPTS,S.duration=E.endPTS-E.startPTS,S.duration&&(a=S),n.PTSKnown=n.alignedSliding=!0),S.elementaryStreams=E.elementaryStreams,S.loader=E.loader,S.stats=E.stats,S.urlId=E.urlId,E.initSegment&&(S.initSegment=E.initSegment,e=E.initSegment)}),e&&(n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments).forEach(function(E){var S;E.initSegment&&E.initSegment.relurl!==((S=e)==null?void 0:S.relurl)||(E.initSegment=e)}),n.skippedSegments)if(n.deltaUpdateFailed=n.fragments.some(function(E){return!E}),n.deltaUpdateFailed){x.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var f=n.skippedSegments;f--;)n.fragments.shift();n.startSN=n.fragments[0].sn,n.startCC=n.fragments[0].cc}else n.canSkipDateRanges&&(n.dateRanges=(o=s.dateRanges,l=n.dateRanges,u=n.recentlyRemovedDateranges,d=z({},o),u&&u.forEach(function(E){delete d[E]}),Object.keys(l).forEach(function(E){var S=new Be(l[E].attr,d[E]);S.isValid?d[E]=S:x.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(l[E].attr)+'"')}),d));var v=n.fragments;if(c){x.warn("discontinuity sliding from playlist, take drift into account");for(var y=0;y<v.length;y++)v[y].cc+=c}n.skippedSegments&&(n.startCC=n.fragments[0].cc),function(E,S,D){if(E&&S)for(var R=0,O=0,U=E.length;O<=U;O++){var B=E[O],Q=S[O+R];B&&Q&&B.index===Q.index&&B.fragment.sn===Q.fragment.sn?D(B,Q):R--}}(s.partList,n.partList,function(E,S){S.elementaryStreams=E.elementaryStreams,S.stats=E.stats}),a?bn(n,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):ui(s,n),v.length&&(n.totalduration=n.edge-v[0].start),n.driftStartTime=s.driftStartTime,n.driftStart=s.driftStart;var _=n.advancedDateTime;if(n.advanced&&_){var A=n.edge;n.driftStart||(n.driftStartTime=_,n.driftStart=A),n.driftEndTime=_,n.driftEnd=A}else n.driftEndTime=s.driftEndTime,n.driftEnd=s.driftEnd,n.advancedDateTime=s.advancedDateTime}function ui(s,n){var e=n.startSN+n.skippedSegments-s.startSN,t=s.fragments;e<0||e>=t.length||di(n,t[e].start)}function di(s,n){if(n){for(var e=s.fragments,t=s.skippedSegments;t<e.length;t++)e[t].start+=n;s.fragmentHint&&(s.fragmentHint.start+=n)}}function ci(s,n,e){var t;return s!=null&&s.details?Sn((t=s.details)==null?void 0:t.partList,n,e):null}function Sn(s,n,e){if(s)for(var t=s.length;t--;){var r=s[t];if(r.index===e&&r.fragment.sn===n)return r}return null}function hi(s){switch(s.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function An(s,n){var e=hi(n);return s.default[(e?"timeout":"error")+"Retry"]}function Ni(s,n){var e=s.backoff==="linear"?1:Math.pow(2,n);return Math.min(e*s.retryDelayMs,s.maxRetryDelayMs)}function wn(s){return j(j({},s),{errorRetry:null,timeoutRetry:null})}function fi(s,n,e,t){return!!s&&n<s.maxNumRetry&&(function(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}(t)||!!e)}var kn=function(s,n){for(var e=0,t=s.length-1,r=null,i=null;e<=t;){var a=n(i=s[r=(e+t)/2|0]);if(a>0)e=r+1;else{if(!(a<0))return i;t=r-1}}return null};function Yr(s,n,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var r=null;if(s?r=n[s.sn-n[0].sn+1]||null:e===0&&n[0].start===0&&(r=n[0]),r&&Ui(e,t,r)===0)return r;var i=kn(n,Ui.bind(null,e,t));return!i||i===s&&r?r:i}function Ui(s,n,e){if(s===void 0&&(s=0),n===void 0&&(n=0),e.start<=s&&e.start+e.duration>s)return 0;var t=Math.min(n,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=s?1:e.start-t>s&&e.start?-1:0}function Ln(s,n,e){var t=1e3*Math.min(n,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>s}var Lt,zr=3e5,Rn=0,sr=2,p=5,h=0,m=1,g=2,w=function(){function s(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=x.log.bind(x,"[info]:"),this.warn=x.warn.bind(x,"[warning]:"),this.error=x.error.bind(x,"[error]:"),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(T.ERROR,this.onError,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(T.ERROR,this.onError,this),e.off(T.ERROR,this.onErrorOut,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this))},n.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},n.startLoad=function(e){this.playlistError=0},n.stopLoad=function(){},n.getVariantLevelIndex=function(e){return(e==null?void 0:e.type)===ze?e.level:this.hls.loadLevel},n.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},n.onLevelUpdated=function(){this.playlistError=0},n.onError=function(e,t){var r;if(!t.fatal){var i=this.hls,a=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=sr);case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:var o,l,u=t.parent===ze?t.level:i.loadLevel;return void(t.details===N.LEVEL_EMPTY_ERROR&&(o=t.context)!=null&&(l=o.levelDetails)!=null&&l.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u)));case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:return void(typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){var d=i.levels[i.loadLevel];if(d&&(a.type===zt&&a.groupId===d.audioGroupId||a.type===Bt&&a.groupId===d.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=sr,void(t.errorAction.flags=m)}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var c=i.levels[i.loadLevel],f=c==null?void 0:c.attrs["HDCP-LEVEL"];return void(f&&(t.errorAction={action:sr,flags:g,hdcpLevel:f}));case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,(r=t.level)!=null?r:i.loadLevel));case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_APPEND_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Rn,flags:h})}if(t.type===Z.KEY_SYSTEM_ERROR){var v=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,v))}}},n.getPlaylistRetryOrSwitchAction=function(e,t){var r,i=An(this.hls.config.playlistLoadPolicy,e),a=this.playlistError++,o=(r=e.response)==null?void 0:r.code;if(fi(i,a,hi(e),o))return{action:p,flags:h,retryConfig:i,retryCount:a};var l=this.getLevelSwitchAction(e,t);return i&&(l.retryConfig=i,l.retryCount=a),l},n.getFragRetryOrSwitchAction=function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],a=t.config,o=a.fragLoadPolicy,l=a.keyLoadPolicy,u=An(e.details.startsWith("key")?l:o,e),d=t.levels.reduce(function(y,_){return y+_.fragmentError},0);if(i){var c;e.details!==N.FRAG_GAP&&i.fragmentError++;var f=(c=e.response)==null?void 0:c.code;if(fi(u,d,hi(e),f))return{action:p,flags:h,retryConfig:u,retryCount:d}}var v=this.getLevelSwitchAction(e,r);return u&&(v.retryConfig=u,v.retryCount=d),v},n.getLevelSwitchAction=function(e,t){var r=this.hls;t==null&&(t=r.loadLevel);var i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){for(var a,o,l=-1,u=r.levels,d=(a=e.frag)==null?void 0:a.type,c=(o=e.context)!=null?o:{},f=c.type,v=c.groupId,y=u.length;y--;){var _=(y+r.loadLevel)%u.length;if(_!==r.loadLevel&&u[_].loadError===0){var A=u[_];if(e.details===N.FRAG_GAP&&e.frag){var E=u[_].details;if(E){var S=Yr(e.frag,E.fragments,e.frag.start);if(S!=null&&S.gap)continue}}else if(f===zt&&v===A.audioGroupId||f===Bt&&v===A.textGroupId||d===Gt&&i.audioGroupId===A.audioGroupId||d===ar&&i.textGroupId===A.textGroupId)continue;l=_;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:sr,flags:h,nextAutoLevel:l}}return{action:sr,flags:m}},n.onErrorOut=function(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Rn:break;case sr:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===N.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()},n.sendAlternateToPenaltyBox=function(e){var t=this.hls,r=e.errorAction;if(r){var i=r.flags,a=r.hdcpLevel,o=r.nextAutoLevel;switch(i){case h:this.switchLevel(e,o);break;case m:r.resolved||(r.resolved=this.redundantFailover(e));break;case g:a&&(t.maxHdcpLevel=Oi[Oi.indexOf(a)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(e,o)}},n.switchLevel=function(e,t){t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},n.redundantFailover=function(e){var t=this,r=this.hls,i=this.penalizedRenditions,a=e.parent===ze?e.level:r.loadLevel,o=r.levels[a],l=o.url.length,u=e.frag?e.frag.urlId:o.urlId;o.urlId!==u||e.frag&&!o.details||this.penalizeRendition(o,e);for(var d=function(){var v=(u+c)%l,y=i[v];if(!y||function(_,A,E){if(performance.now()-_.lastErrorPerfMs>zr)return!0;var S=_.details;if(A.details===N.FRAG_GAP&&S&&A.frag){var D=A.frag.start,R=Yr(null,S.fragments,D);if(R&&!R.gap)return!0}if(E&&_.errors.length<E.errors.length){var O=_.errors[_.errors.length-1];if(S&&O.frag&&A.frag&&Math.abs(O.frag.start-A.frag.start)>3*S.targetduration)return!0}return!1}(y,e,i[u]))return t.warn("Switching to Redundant Stream "+(v+1)+"/"+l+': "'+o.url[v]+'" after '+e.details),t.playlistError=0,r.levels.forEach(function(_){_.urlId=v}),r.nextLoadLevel=a,{v:!0}},c=1;c<l;c++){var f=d();if(typeof f=="object")return f.v}return!1},n.penalizeRendition=function(e,t){var r=this.penalizedRenditions,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i},s}(),C=function(){function s(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=x.log.bind(x,t+":"),this.warn=x.warn.bind(x,t+":"),this.hls=e}var n=s.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},n.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(e,t){var r=t==null?void 0:t.renditionReports;if(r){for(var i=-1,a=0;a<r.length;a++){var o=r[a],l=void 0;try{l=new self.URL(o.URI,t.url).href}catch(v){x.warn("Could not construct new URL for Rendition Report: "+v),l=o.URI||""}if(l===e){i=a;break}l===e.substring(0,l.length)&&(i=a)}if(i!==-1){var u=r[i],d=parseInt(u["LAST-MSN"])||(t==null?void 0:t.lastPartSn),c=parseInt(u["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var f=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&f>t.partTarget&&(c+=1)}return new _n(d,c>=0?c:void 0,Mi)}}},n.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},n.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},n.shouldReloadPlaylist=function(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)},n.playlistLoaded=function(e,t,r){var i=this,a=t.details,o=t.stats,l=self.performance.now(),u=o.loading.first?Math.max(0,l-o.loading.first):0;if(a.advancedDateTime=Date.now()-u,a.live||r!=null&&r.live){if(a.reloaded(r),r&&this.log("live playlist "+e+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),r&&a.fragments.length>0&&li(r,a),!this.canLoad||!a.live)return;var d,c=void 0,f=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var v=this.hls.config.lowLatencyMode,y=a.lastPartSn,_=a.endSN,A=a.lastPartIndex,E=y===_;A!==-1?(c=E?_+1:y,f=E?v?0:A:A+1):c=_+1;var S=a.age,D=S+a.ageHeader,R=Math.min(D-a.partTarget,1.5*a.targetduration);if(R>0){if(r&&R>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+R+" with playlist age: "+a.age),R=0;else{var O=Math.floor(R/a.targetduration);c+=O,f!==void 0&&(f+=Math.round(R%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+S.toFixed(2)+"s goal: "+R+" skip sn "+O+" to part "+f)}a.tuneInGoal=R}if(d=this.getDeliveryDirectives(a,t.deliveryDirectives,c,f),v||!E)return void this.loadPlaylist(d)}else a.canBlockReload&&(d=this.getDeliveryDirectives(a,t.deliveryDirectives,c,f));var U=this.hls.mainForwardBufferInfo,B=U?U.end-U.len:0,Q=function(q,ie){ie===void 0&&(ie=1/0);var J=1e3*q.targetduration;if(q.updated){var he=q.fragments;if(he.length&&4*J>ie){var be=1e3*he[he.length-1].duration;be<J&&(J=be)}}else J/=2;return Math.round(J)}(a,1e3*(a.edge-B));a.updated&&l>this.requestScheduled+Q&&(this.requestScheduled=o.loading.start),c!==void 0&&a.canBlockReload?this.requestScheduled=o.loading.first+Q-(1e3*a.partTarget||1e3):this.requestScheduled===-1||this.requestScheduled+Q<l?this.requestScheduled=l:this.requestScheduled-l<=0&&(this.requestScheduled+=Q);var K=this.requestScheduled-l;K=Math.max(0,K),this.log("reload live playlist "+e+" in "+Math.round(K)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(d)},K)}else this.clearTimer()},n.getDeliveryDirectives=function(e,t,r,i){var a=function(o,l){var u=o.canSkipUntil,d=o.canSkipDateRanges,c=o.endSN;return u&&(l!==void 0?l-c:0)<u?d?da:ua:Mi}(e,r);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,a=Mi),new _n(r,i,a)},n.checkRetry=function(e){var t=this,r=e.details,i=hi(e),a=e.errorAction,o=a||{},l=o.action,u=o.retryCount,d=u===void 0?0:u,c=o.retryConfig,f=!!a&&!!c&&(l===p||!a.resolved&&l===sr);if(f){var v;if(this.requestScheduled=-1,d>=c.maxNumRetry)return!1;if(i&&(v=e.context)!=null&&v.deliveryDirectives)this.warn("Retrying playlist loading "+(d+1)+"/"+c.maxNumRetry+' after "'+r+'" without delivery-directives'),this.loadPlaylist();else{var y=Ni(c,d);this.timer=self.setTimeout(function(){return t.loadPlaylist()},y),this.warn("Retrying playlist loading "+(d+1)+"/"+c.maxNumRetry+' after "'+r+'" in '+y+"ms")}e.levelRetry=!0,a.resolved=!0}return f},s}(),L=function(s){function n(t,r){var i;return(i=s.call(this,t,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}te(n,s);var e=n.prototype;return e._registerListeners=function(){var t=this.hls;t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(T.LEVEL_LOADED,this.onLevelLoaded,this),t.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(T.FRAG_LOADED,this.onFragLoaded,this),t.on(T.ERROR,this.onError,this)},e._unregisterListeners=function(){var t=this.hls;t.off(T.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(T.LEVEL_LOADED,this.onLevelLoaded,this),t.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(T.FRAG_LOADED,this.onFragLoaded,this),t.off(T.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},e.startLoad=function(){this._levels.forEach(function(t){t.loadError=0,t.fragmentError=0}),s.prototype.startLoad.call(this)},e.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},e.onManifestLoading=function(t,r){this.resetLevels()},e.onManifestLoaded=function(t,r){var i,a=[],o={};r.levels.forEach(function(l){var u,d=l.attrs;((u=l.audioCodec)==null?void 0:u.indexOf("mp4a.40.34"))!==-1&&(Lt||(Lt=/chrome|firefox/i.test(navigator.userAgent)),Lt&&(l.audioCodec=void 0));var c=d.AUDIO,f=d.CODECS,v=d["FRAME-RATE"],y=d["PATHWAY-ID"],_=d.RESOLUTION,A=d.SUBTITLES,E=(y||".")+"-"+l.bitrate+"-"+_+"-"+v+"-"+f;(i=o[E])?i.addFallback(l):(i=new Wr(l),o[E]=i,a.push(i)),M(i,"audio",c),M(i,"text",A)}),this.filterAndSortMediaOptions(a,r)},e.filterAndSortMediaOptions=function(t,r){var i=this,a=[],o=[],l=!1,u=!1,d=!1,c=t.filter(function(S){var D=S.audioCodec,R=S.videoCodec,O=S.width,U=S.height,B=S.unknownCodecs;return l||(l=!(!O||!U)),u||(u=!!R),d||(d=!!D),!(B!=null&&B.length)&&(!D||ni(D,"audio"))&&(!R||ni(R,"video"))});if((l||u)&&d&&(c=c.filter(function(S){var D=S.videoCodec,R=S.width,O=S.height;return!!D||!(!R||!O)})),c.length!==0){r.audioTracks&&P(a=r.audioTracks.filter(function(S){return!S.audioCodec||ni(S.audioCodec,"audio")})),r.subtitles&&P(o=r.subtitles);var f=c.slice(0);c.sort(function(S,D){return S.attrs["HDCP-LEVEL"]!==D.attrs["HDCP-LEVEL"]?(S.attrs["HDCP-LEVEL"]||"")>(D.attrs["HDCP-LEVEL"]||"")?1:-1:S.bitrate!==D.bitrate?S.bitrate-D.bitrate:S.attrs["FRAME-RATE"]!==D.attrs["FRAME-RATE"]?S.attrs.decimalFloatingPoint("FRAME-RATE")-D.attrs.decimalFloatingPoint("FRAME-RATE"):S.attrs.SCORE!==D.attrs.SCORE?S.attrs.decimalFloatingPoint("SCORE")-D.attrs.decimalFloatingPoint("SCORE"):l&&S.height!==D.height?S.height-D.height:0});var v=f[0];if(this.steering&&(c=this.steering.filterParsedLevels(c)).length!==f.length){for(var y=0;y<f.length;y++)if(f[y].pathwayId===c[0].pathwayId){v=f[y];break}}this._levels=c;for(var _=0;_<c.length;_++)if(c[_]===v){this._firstLevel=_,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+v.bitrate);break}var A=d&&!u,E={levels:c,audioTracks:a,subtitleTracks:o,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:d,video:u,altAudio:!A&&a.some(function(S){return!!S.url})};this.hls.trigger(T.MANIFEST_PARSED,E),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){if(i.hls){var S=new Error("no level with compatible codecs found in manifest");i.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:S,reason:S.message})}})},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===pr&&r.context.level===this.level&&this.checkRetry(r)},e.onFragLoaded=function(t,r){var i=r.frag;if(i!==void 0&&i.type===ze){var a=this._levels[i.level];a!==void 0&&(a.loadError=0)}},e.onLevelLoaded=function(t,r){var i,a,o=r.level,l=r.details,u=this._levels[o];if(!u)return this.warn("Invalid level index "+o),void((a=r.deliveryDirectives)!=null&&a.skip&&(l.deltaUpdateFailed=!0));o===this.currentLevelIndex?(u.fragmentError===0&&(u.loadError=0),this.playlistLoaded(o,r,u.details)):(i=r.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(t,r){var i=this.currentLevel;if(i){var a=this.hls.audioTracks[r.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==a){for(var o=-1,l=0;l<i.audioGroupIds.length;l++)if(i.audioGroupIds[l]===a){o=l;break}o!==-1&&o!==i.urlId&&(i.urlId=o,this.canLoad&&this.startLoad())}}},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var a=i.urlId,o=i.uri;if(t)try{o=t.addDirectives(o)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}var l=i.attrs["PATHWAY-ID"];this.log("Loading level index "+r+((t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"")+" with"+(l?" Pathway "+l:"")+" URI "+(a+1)+"/"+i.url.length+" "+o),this.clearTimer(),this.hls.trigger(T.LEVEL_LOADING,{url:o,level:r,id:a,deliveryDirectives:t||null})}},e.removeLevel=function(t,r){var i=this,a=function(l,u){return u!==r},o=this._levels.filter(function(l,u){return u!==t||(l.url.length>1&&r!==void 0?(l.url=l.url.filter(a),l.audioGroupIds&&(l.audioGroupIds=l.audioGroupIds.filter(a)),l.textGroupIds&&(l.textGroupIds=l.textGroupIds.filter(a)),l.urlId=0,!0):(i.steering&&i.steering.removeLevel(l),!1))});this.hls.trigger(T.LEVELS_UPDATED,{levels:o})},e.onLevelsUpdated=function(t,r){var i=r.levels;i.forEach(function(a,o){var l=a.details;l!=null&&l.fragments&&l.fragments.forEach(function(u){u.level=o})}),this._levels=i},Y(n,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var r=this._levels;if(r.length!==0){if(t<0||t>=r.length){var i=new Error("invalid level idx"),a=t<0;if(this.hls.trigger(T.ERROR,{type:Z.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:t,fatal:a,error:i,reason:i.message}),a)return;t=Math.min(t,r.length-1)}var o=this.currentLevelIndex,l=this.currentLevel,u=l?l.attrs["PATHWAY-ID"]:void 0,d=r[t],c=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=d,o!==t||!d.details||!l||u!==c){this.log("Switching to level "+t+(c?" with Pathway "+c:"")+" from level "+o+(u?" with Pathway "+u:""));var f=z({},d,{level:t,maxBitrate:d.maxBitrate,attrs:d.attrs,uri:d.uri,urlId:d.urlId});delete f._attrs,delete f._urlId,this.hls.trigger(T.LEVEL_SWITCHING,f);var v=d.details;if(!v||v.live){var y=this.switchParams(d.uri,l==null?void 0:l.details);this.loadPlaylist(y)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}]),n}(C);function M(s,n,e){e&&(n==="audio"?(s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds[s.url.length-1]=e):n==="text"&&(s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds[s.url.length-1]=e))}function P(s){var n={};s.forEach(function(e){var t=e.groupId||"";e.id=n[t]=n[t]||0,n[t]++})}var W="NOT_LOADED",ue="APPENDING",pe="PARTIAL",Ce="OK",ae=function(){function s(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var n=s.prototype;return n._registerListeners=function(){var e=this.hls;e.on(T.BUFFER_APPENDED,this.onBufferAppended,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this)},n._unregisterListeners=function(){var e=this.hls;e.off(T.BUFFER_APPENDED,this.onBufferAppended,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this)},n.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},n.getAppendedFrag=function(e,t){var r=this.activePartLists[t];if(r)for(var i=r.length;i--;){var a=r[i];if(!a)break;var o=a.end;if(a.start<=e&&o!==null&&e<=o)return a}return this.getBufferedFrag(e,t)},n.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),a=i.length;a--;){var o=r[i[a]];if((o==null?void 0:o.body.type)===t&&o.buffered){var l=o.body;if(l.start<=e&&e<=l.end)return l}}return null},n.detectEvictedFragments=function(e,t,r,i){var a=this;this.timeRanges&&(this.timeRanges[e]=t);var o=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(l){var u=a.fragments[l];if(u&&!(o>=u.body.sn))if(u.buffered||u.loaded){var d=u.range[e];d&&d.time.some(function(c){var f=!a.isTimeBuffered(c.startPTS,c.endPTS,t);return f&&a.removeFragment(u.body),f})}else u.body.type===r&&a.removeFragment(u.body)})},n.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,a=e.part;if(r&&i.sn!=="initSegment"){var o=Ie(i),l=this.fragments[o];if(l){var u=!i.relurl;Object.keys(r).forEach(function(d){var c=i.elementaryStreams[d];if(c){var f=r[d],v=u||c.partial===!0;l.range[d]=t.getBufferedTimes(i,a,v,f)}}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,l.body.endList&&(this.endListFragments[l.body.type]=l),_e(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}}},n.removeParts=function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(function(i){return i.fragment.sn>=e}))},n.fragBuffered=function(e,t){var r=Ie(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},n.getBufferedTimes=function(e,t,r,i){for(var a={time:[],partial:r},o=e.start,l=e.end,u=e.minEndPTS||l,d=e.maxStartPTS||o,c=0;c<i.length;c++){var f=i.start(c)-this.bufferPadding,v=i.end(c)+this.bufferPadding;if(d>=f&&u<=v){a.time.push({startPTS:Math.max(o,i.start(c)),endPTS:Math.min(l,i.end(c))});break}if(o<v&&l>f)a.partial=!0,a.time.push({startPTS:Math.max(o,i.start(c)),endPTS:Math.min(l,i.end(c))});else if(l<=f)break}return a},n.getPartialFragment=function(e){var t,r,i,a=null,o=0,l=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(d){var c=u[d];c&&_e(c)&&(r=c.body.start-l,i=c.body.end+l,e>=r&&e<=i&&(t=Math.min(e-r,i-e),o<=t&&(a=c.body,o=t)))}),a},n.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||_e(t))},n.getState=function(e){var t=Ie(e),r=this.fragments[t];return r?r.buffered?_e(r)?pe:Ce:ue:W},n.isTimeBuffered=function(e,t,r){for(var i,a,o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,a=r.end(o)+this.bufferPadding,e>=i&&t<=a)return!0;if(t<=i)return!1}return!1},n.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if(r.sn!=="initSegment"&&!r.bitrateTest){var a=i?null:t,o=Ie(r);this.fragments[o]={body:r,appendedPTS:null,loaded:a,buffered:!1,range:Object.create(null)}}},n.onBufferAppended=function(e,t){var r=this,i=t.frag,a=t.part,o=t.timeRanges;if(i.sn!=="initSegment"){var l=i.type;if(a){var u=this.activePartLists[l];u||(this.activePartLists[l]=u=[]),u.push(a)}this.timeRanges=o,Object.keys(o).forEach(function(d){var c=o[d];r.detectEvictedFragments(d,c,l,a)})}},n.onFragBuffered=function(e,t){this.detectPartialFragments(t)},n.hasFragment=function(e){var t=Ie(e);return!!this.fragments[t]},n.hasParts=function(e){var t;return!((t=this.activePartLists[e])==null||!t.length)},n.removeFragmentsInRange=function(e,t,r,i,a){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(l){var u=o.fragments[l];if(u){var d=u.body;d.type!==r||i&&!d.gap||d.start<t&&d.end>e&&(u.buffered||a)&&o.removeFragment(d)}})},n.removeFragment=function(e){var t=Ie(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var i=e.sn;this.activePartLists[e.type]=r.filter(function(a){return a.fragment.sn!==i})}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},n.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},s}();function _e(s){var n,e,t;return s.buffered&&(s.body.gap||((n=s.range.video)==null?void 0:n.partial)||((e=s.range.audio)==null?void 0:e.partial)||((t=s.range.audiovideo)==null?void 0:t.partial))}function Ie(s){return s.type+"_"+s.level+"_"+s.urlId+"_"+s.sn}var ot=Math.pow(2,17),ut=function(){function s(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var n=s.prototype;return n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.abort=function(){this.loader&&this.loader.abort()},n.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new Me({type:Z.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var a=this.config,o=a.fLoader,l=a.loader;return new Promise(function(u,d){if(r.loader&&r.loader.destroy(),e.gap)d(Tt(e));else{var c=r.loader=e.loader=o?new o(a):new l(a),f=dt(e),v=wn(a.fragLoadPolicy.default),y={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:ot};e.stats=c.stats,c.load(f,y,{onSuccess:function(_,A,E,S){r.resetLoader(e,c);var D=_.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),u({frag:e,part:null,payload:D,networkDetails:S})},onError:function(_,A,E,S){r.resetLoader(e,c),d(new Me({type:Z.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:j({url:i,data:void 0},_),error:new Error("HTTP Error "+_.code+" "+_.text),networkDetails:E,stats:S}))},onAbort:function(_,A,E){r.resetLoader(e,c),d(new Me({type:Z.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:_}))},onTimeout:function(_,A,E){r.resetLoader(e,c),d(new Me({type:Z.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+y.timeout+"ms"),networkDetails:E,stats:_}))},onProgress:function(_,A,E,S){t&&t({frag:e,part:null,payload:E,networkDetails:S})}})}})},n.loadPart=function(e,t,r){var i=this;this.abort();var a=this.config,o=a.fLoader,l=a.loader;return new Promise(function(u,d){if(i.loader&&i.loader.destroy(),e.gap||t.gap)d(Tt(e,t));else{var c=i.loader=e.loader=o?new o(a):new l(a),f=dt(e,t),v=wn(a.fragLoadPolicy.default),y={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ot};t.stats=c.stats,c.load(f,y,{onSuccess:function(_,A,E,S){i.resetLoader(e,c),i.updateStatsFromPart(e,t);var D={frag:e,part:t,payload:_.data,networkDetails:S};r(D),u(D)},onError:function(_,A,E,S){i.resetLoader(e,c),d(new Me({type:Z.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:j({url:f.url,data:void 0},_),error:new Error("HTTP Error "+_.code+" "+_.text),networkDetails:E,stats:S}))},onAbort:function(_,A,E){e.stats.aborted=t.stats.aborted,i.resetLoader(e,c),d(new Me({type:Z.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:_}))},onTimeout:function(_,A,E){i.resetLoader(e,c),d(new Me({type:Z.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+y.timeout+"ms"),networkDetails:E,stats:_}))}})}})},n.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,a=i.total;if(r.loaded+=i.loaded,a){var o=Math.round(e.duration/t.duration),l=Math.min(Math.round(r.loaded/a),o),u=(o-l)*Math.round(r.loaded/l);r.total=r.loaded+u}else r.total=Math.max(r.loaded,r.total);var d=r.loading,c=i.loading;d.start?d.first+=c.first-c.start:(d.start=c.start,d.first=c.first),d.end=c.end},n.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},s}();function dt(s,n){n===void 0&&(n=null);var e=n||s,t={frag:s,part:n,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,i=e.byteRangeEndOffset;if($(r)&&$(i)){var a,o=r,l=i;if(s.sn==="initSegment"&&((a=s.decryptdata)==null?void 0:a.method)==="AES-128"){var u=i-r;u%16&&(l=i+(16-u%16)),r!==0&&(t.resetIV=!0,o=r-16)}t.rangeStart=o,t.rangeEnd=l}return t}function Tt(s,n){var e=new Error("GAP "+(s.gap?"tag":"attribute")+" found"),t={type:Z.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:s,error:e,networkDetails:null};return n&&(t.part=n),(n||s).stats.aborted=!0,new Me(t)}var Me=function(s){function n(e){var t;return(t=s.call(this,e.error.message)||this).data=void 0,t.data=e,t}return te(n,s),n}(Ae(Error)),rt=function(){function s(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var n=s.prototype;return n.abort=function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}},n.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},n.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},n.createKeyLoadError=function(e,t,r,i,a){return t===void 0&&(t=N.KEY_LOAD_ERROR),new Me({type:Z.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:r,networkDetails:i})},n.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,a=e.cc,o=function(){var u=t[l];if(a<=u.cc&&(i==="initSegment"||u.sn==="initSegment"||i<u.sn))return r.emeController.selectKeySystemFormat(u).then(function(d){u.setKeyFormat(d)}),"break"},l=0;l<t.length&&o()!=="break";l++);},n.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(r){return t.loadInternal(e,r)}):this.loadInternal(e)},n.loadInternal=function(e,t){var r,i;t&&e.setKeyFormat(t);var a=e.decryptdata;if(!a){var o=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,o))}var l=a.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+l+'"')));var u,d=this.keyUriToKeyInfo[l];if((r=d)!=null&&r.decryptdata.key)return a.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if((i=d)!=null&&i.keyLoadPromise)switch((u=d.mediaKeySessionContext)==null?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise.then(function(c){return a.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:d}})}switch(d=this.keyUriToKeyInfo[l]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+a.method+'"')))}},n.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(function(a){return e.mediaKeySessionContext=a,r})).catch(function(a){throw e.keyLoadPromise=null,a})}return Promise.resolve(r)},n.loadKeyHTTP=function(e,t){var r=this,i=this.config,a=new i.loader(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise(function(o,l){var u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=i.keyLoadPolicy.default,c={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:function(v,y,_,A){var E=_.frag,S=_.keyInfo,D=_.url;if(!E.decryptdata||S!==r.keyUriToKeyInfo[D])return l(r.createKeyLoadError(E,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));S.decryptdata.key=E.decryptdata.key=new Uint8Array(v.data),E.keyLoader=null,S.loader=null,o({frag:E,keyInfo:S})},onError:function(v,y,_,A){r.resetLoader(y),l(r.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error("HTTP Error "+v.code+" loading key "+v.text),_,j({url:u.url,data:void 0},v)))},onTimeout:function(v,y,_){r.resetLoader(y),l(r.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),_))},onAbort:function(v,y,_){r.resetLoader(y),l(r.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),_))}};a.load(u,c,f)})},n.resetLoader=function(e){var t=e.frag,r=e.keyInfo,i=e.url,a=r.loader;t.keyLoader===a&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],a&&a.destroy()},s}(),qe=function(){function s(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var n=s.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.onHandlerDestroyed=function(){},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},n.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},n.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},n.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},n.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},n.doTick=function(){},s}(),re={length:0,start:function(){return 0},end:function(){return 0}},ne=function(){function s(){}return s.isBuffered=function(n,e){try{if(n){for(var t=s.getBuffered(n),r=0;r<t.length;r++)if(e>=t.start(r)&&e<=t.end(r))return!0}}catch{}return!1},s.bufferInfo=function(n,e,t){try{if(n){var r,i=s.getBuffered(n),a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,e,t)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},s.bufferedInfo=function(n,e,t){e=Math.max(0,e),n.sort(function(_,A){var E=_.start-A.start;return E||A.end-_.end});var r=[];if(t)for(var i=0;i<n.length;i++){var a=r.length;if(a){var o=r[a-1].end;n[i].start-o<t?n[i].end>o&&(r[a-1].end=n[i].end):r.push(n[i])}else r.push(n[i])}else r=n;for(var l,u=0,d=e,c=e,f=0;f<r.length;f++){var v=r[f].start,y=r[f].end;if(e+t>=v&&e<y)d=v,u=(c=y)-e;else if(e+t<v){l=v;break}}return{len:u,start:d||0,end:c||0,nextStart:l}},s.getBuffered=function(n){try{return n.buffered}catch(e){return x.log("failed to get media.buffered",e),re}},s}(),se=function(s,n,e,t,r,i){t===void 0&&(t=0),r===void 0&&(r=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=s,this.sn=n,this.id=e,this.size=t,this.part=r,this.partial=i};function Pe(s,n){for(var e=null,t=0,r=s.length;t<r;t++){var i=s[t];if(i&&i.cc===n){e=i;break}}return e}function Ne(s,n){if(s){var e=s.start+n;s.start=s.startPTS=e,s.endPTS=e+s.duration}}function it(s,n){for(var e=n.fragments,t=0,r=e.length;t<r;t++)Ne(e[t],s);n.fragmentHint&&Ne(n.fragmentHint,s),n.alignedSliding=!0}function Rt(s,n,e){n&&(function(t,r,i){if(function(o,l,u){return!(!l.details||!(u.endCC>u.startCC||o&&o.cc<u.startCC))}(t,i,r)){var a=function(o,l,u){var d=o.fragments,c=l.fragments;if(c.length&&d.length){var f=Pe(d,c[0].cc);if(f&&(!f||f.startPTS))return f;x.log("No frag in previous level to align on")}else x.log("No fragments to align")}(i.details,r);a&&$(a.start)&&(x.log("Adjusting PTS using last level due to CC increase within current level "+r.url),it(a.start,r))}}(s,e,n),!e.alignedSliding&&n.details&&function(t,r){if(r.fragments.length&&t.hasProgramDateTime&&r.hasProgramDateTime){var i=r.fragments[0].programDateTime,a=t.fragments[0].programDateTime,o=(a-i)/1e3+r.fragments[0].start;o&&$(o)&&(x.log("Adjusting PTS using programDateTime delta "+(a-i)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),it(o,t))}}(e,n.details),e.alignedSliding||!n.details||e.skippedSegments||ui(n.details,e))}function ct(s,n){if(s.hasProgramDateTime&&n.hasProgramDateTime){var e=s.fragments,t=n.fragments;if(e.length&&t.length){var r=t[Math.round(t.length/2)-1],i=Pe(e,r.cc)||e[Math.round(e.length/2)-1],a=r.programDateTime,o=i.programDateTime;a!==null&&o!==null&&it((o-a)/1e3-(i.start-r.start),s)}}}var _t=function(){function s(n,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=n,this.aesIV=e}return s.prototype.decrypt=function(n,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,n)},s}(),ht=function(){function s(n,e){this.subtle=void 0,this.key=void 0,this.subtle=n,this.key=e}return s.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},s}(),ft=function(){function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var n=s.prototype;return n.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},n.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],a=r[1],o=r[2],l=r[3],u=this.invSubMix,d=u[0],c=u[1],f=u[2],v=u[3],y=new Uint32Array(256),_=0,A=0,E=0;for(E=0;E<256;E++)y[E]=E<128?E<<1:E<<1^283;for(E=0;E<256;E++){var S=A^A<<1^A<<2^A<<3^A<<4;S=S>>>8^255&S^99,e[_]=S,t[S]=_;var D=y[_],R=y[D],O=y[R],U=257*y[S]^16843008*S;i[_]=U<<24|U>>>8,a[_]=U<<16|U>>>16,o[_]=U<<8|U>>>24,l[_]=U,U=16843009*O^65537*R^257*D^16843008*_,d[S]=U<<24|U>>>8,c[S]=U<<16|U>>>16,f[S]=U<<8|U>>>24,v[S]=U,_?(_=D^y[y[y[O^D]]],A^=y[y[A]]):_=A=1}},n.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);var o,l,u,d,c=this.ksRows=4*(a+6+1),f=this.keySchedule=new Uint32Array(c),v=this.invKeySchedule=new Uint32Array(c),y=this.sBox,_=this.rcon,A=this.invSubMix,E=A[0],S=A[1],D=A[2],R=A[3];for(o=0;o<c;o++)o<a?u=f[o]=t[o]:(d=u,o%a==0?(d=y[(d=d<<8|d>>>24)>>>24]<<24|y[d>>>16&255]<<16|y[d>>>8&255]<<8|y[255&d],d^=_[o/a|0]<<24):a>6&&o%a==4&&(d=y[d>>>24]<<24|y[d>>>16&255]<<16|y[d>>>8&255]<<8|y[255&d]),f[o]=u=(f[o-a]^d)>>>0);for(l=0;l<c;l++)o=c-l,d=3&l?f[o]:f[o-4],v[l]=l<4||o<=4?d:E[y[d>>>24]]^S[y[d>>>16&255]]^D[y[d>>>8&255]]^R[y[255&d]],v[l]=v[l]>>>0}},n.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},n.decrypt=function(e,t,r){for(var i,a,o,l,u,d,c,f,v,y,_,A,E,S,D=this.keySize+6,R=this.invKeySchedule,O=this.invSBox,U=this.invSubMix,B=U[0],Q=U[1],K=U[2],q=U[3],ie=this.uint8ArrayToUint32Array_(r),J=ie[0],he=ie[1],be=ie[2],ge=ie[3],Ee=new Int32Array(e),Le=new Int32Array(Ee.length),ke=this.networkToHostOrderSwap;t<Ee.length;){for(v=ke(Ee[t]),y=ke(Ee[t+1]),_=ke(Ee[t+2]),A=ke(Ee[t+3]),u=v^R[0],d=A^R[1],c=_^R[2],f=y^R[3],E=4,S=1;S<D;S++)i=B[u>>>24]^Q[d>>16&255]^K[c>>8&255]^q[255&f]^R[E],a=B[d>>>24]^Q[c>>16&255]^K[f>>8&255]^q[255&u]^R[E+1],o=B[c>>>24]^Q[f>>16&255]^K[u>>8&255]^q[255&d]^R[E+2],l=B[f>>>24]^Q[u>>16&255]^K[d>>8&255]^q[255&c]^R[E+3],u=i,d=a,c=o,f=l,E+=4;i=O[u>>>24]<<24^O[d>>16&255]<<16^O[c>>8&255]<<8^O[255&f]^R[E],a=O[d>>>24]<<24^O[c>>16&255]<<16^O[f>>8&255]<<8^O[255&u]^R[E+1],o=O[c>>>24]<<24^O[f>>16&255]<<16^O[u>>8&255]<<8^O[255&d]^R[E+2],l=O[f>>>24]<<24^O[u>>16&255]<<16^O[d>>8&255]<<8^O[255&c]^R[E+3],Le[t]=ke(i^J),Le[t+1]=ke(l^he),Le[t+2]=ke(o^be),Le[t+3]=ke(a^ge),J=v,he=y,be=_,ge=A,t+=4}return Le.buffer},s}(),Xt=function(){function s(e,t){var r=(t===void 0?{}:t).removePKCS7Padding,i=r===void 0||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var n=s.prototype;return n.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},n.isSync=function(){return this.useSoftware},n.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,i,a,o=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(r=o).byteLength,(a=i&&new DataView(r.buffer).getUint8(i-1))?Wt(r,0,i-a):r):o},n.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},n.decrypt=function(e,t,r){var i=this;return this.useSoftware?new Promise(function(a,o){i.softwareDecrypt(new Uint8Array(e),t,r);var l=i.flush();l?a(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)},n.softwareDecrypt=function(e,t,r){var i=this.currentIV,a=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(e=vr(o,e),this.remainderData=null);var l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);var u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new ft),u.expandKey(t);var d=a;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=Wt(l,-16).buffer,d||null},n.webCryptoDecrypt=function(e,t,r){var i=this,a=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new ht(a,t)),this.fastAesKey.expandKey().then(function(o){return a?(i.logOnce("WebCrypto AES decrypt"),new _t(a,new Uint8Array(r)).decrypt(e.buffer,o)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(o){return x.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+o.name+": "+o.message),i.onWebCryptoError(e,t,r)})},n.onWebCryptoError=function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},n.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=Wt(e,0,r),this.remainderData=Wt(e,r)),t},n.logOnce=function(e){this.logEnabled&&(x.log("[decrypter]: "+e),this.logEnabled=!1)},s}(),Xr=function(s){for(var n="",e=s.length,t=0;t<e;t++)n+="["+s.start(t).toFixed(3)+"-"+s.end(t).toFixed(3)+"]";return n},vt="STOPPED",me="IDLE",yr="KEY_LOADING",Dr="FRAG_LOADING",Ir="FRAG_LOADING_WAITING_RETRY",Qr="WAITING_TRACK",Er="PARSING",Dn="PARSED",Bi="ENDED",vi="ERROR",Gi="WAITING_INIT_PTS",gi="WAITING_LEVEL",ca=function(s){function n(t,r,i,a,o){var l;return(l=s.call(this)||this).hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=vt,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.loadedmetadata=!1,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.onvseeking=null,l.onvended=null,l.logPrefix="",l.log=void 0,l.warn=void 0,l.playlistType=o,l.logPrefix=a,l.log=x.log.bind(x,a+":"),l.warn=x.warn.bind(x,a+":"),l.hls=t,l.fragmentLoader=new ut(t.config),l.keyLoader=i,l.fragmentTracker=r,l.config=t.config,l.decrypter=new Xt(t.config),t.on(T.MANIFEST_LOADED,l.onManifestLoaded,function(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}(l)),l}te(n,s);var e=n.prototype;return e.doTick=function(){this.onTickEnd()},e.onTickEnd=function(){},e.startLoad=function(t){},e.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=vt},e._streamEnded=function(t,r){if(r.live||t.nextStart||!t.end||!this.media)return!1;var i=r.partList;if(i!=null&&i.length){var a=i[i.length-1];return ne.isBuffered(this.media,a.start+a.duration/2)}var o=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)},e.getLevelDetails=function(){var t;if(this.levels&&this.levelLastLoaded!==null)return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details},e.onMediaAttached=function(t,r){var i=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.state===vt&&this.startLoad(a.startPosition)},e.onMediaDetaching=function(){var t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},e.onMediaSeeking=function(){var t=this.config,r=this.fragCurrent,i=this.media,a=this.mediaBuffer,o=this.state,l=i?i.currentTime:0,u=ne.bufferInfo(a||i,l,t.maxBufferHole);if(this.log("media seeking to "+($(l)?l.toFixed(3):l)+", state: "+o),this.state===Bi)this.resetLoadingState();else if(r){var d=t.maxFragLookUpTolerance,c=r.start-d,f=r.start+r.duration+d;if(!u.len||f<u.start||c>u.end){var v=l>f;(l<c||v)&&(v&&r.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),this.loadedmetadata||u.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()},e.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.onManifestLoaded=function(t,r){this.startTimeOffset=r.startTimeOffset,this.initPTS=[]},e.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},e.onHandlerDestroyed=function(){this.state=vt,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},e.loadFragment=function(t,r,i){this._loadFragForPlayback(t,r,i)},e._loadFragForPlayback=function(t,r,i){var a=this;this._doFragLoad(t,r,i,function(o){if(a.fragContextChanged(t))return a.warn("Fragment "+t.sn+(o.part?" p: "+o.part.index:"")+" of level "+t.level+" was dropped during download."),void a.fragmentTracker.removeFragment(t);t.stats.chunkCount++,a._handleFragmentLoadProgress(o)}).then(function(o){if(o){var l=a.state;a.fragContextChanged(t)?(l===Dr||!a.fragCurrent&&l===Er)&&(a.fragmentTracker.removeFragment(t),a.state=me):("payload"in o&&(a.log("Loaded fragment "+t.sn+" of level "+t.level),a.hls.trigger(T.FRAG_LOADED,o)),a._handleFragmentLoadComplete(o))}}).catch(function(o){a.state!==vt&&a.state!==vi&&(a.warn(o),a.resetFragmentLoading(t))})},e.clearTrackerIfNeeded=function(t){var r,i=this.fragmentTracker;if(i.getState(t)===ue){var a=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,a),l=Math.max(t.duration,o?o.len:this.config.maxBufferLength);this.reduceMaxBufferLength(l)&&i.removeFragment(t)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===pe&&i.removeFragment(t))},e.flushMainBuffer=function(t,r,i){if(i===void 0&&(i=null),t-r){var a={startOffset:t,endOffset:r,type:i};this.hls.trigger(T.BUFFER_FLUSHING,a)}},e._loadInitSegment=function(t,r){var i=this;this._doFragLoad(t,r).then(function(a){if(!a||i.fragContextChanged(t)||!i.levels)throw new Error("init load aborted");return a}).then(function(a){var o=i.hls,l=a.payload,u=t.decryptdata;if(l&&l.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var d=self.performance.now();return i.decrypter.decrypt(new Uint8Array(l),u.key.buffer,u.iv.buffer).catch(function(c){throw o.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(function(c){var f=self.performance.now();return o.trigger(T.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:d,tdecrypt:f}}),a.payload=c,a})}return a}).then(function(a){var o=i.fragCurrent,l=i.hls;if(!i.levels)throw new Error("init load aborted, missing levels");var u=t.stats;i.state=me,r.fragmentError=0,t.data=new Uint8Array(a.payload),u.parsing.start=u.buffering.start=self.performance.now(),u.parsing.end=u.buffering.end=self.performance.now(),a.frag===o&&l.trigger(T.FRAG_BUFFERED,{stats:u,frag:o,part:null,id:t.type}),i.tick()}).catch(function(a){i.state!==vt&&i.state!==vi&&(i.warn(a),i.resetFragmentLoading(t))})},e.fragContextChanged=function(t){var r=this.fragCurrent;return!t||!r||t.level!==r.level||t.sn!==r.sn||t.urlId!==r.urlId},e.fragBufferedComplete=function(t,r){var i,a,o,l,u=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+(this.playlistType===ze?"level":"track")+" "+t.level+" (frag:["+((i=t.startPTS)!=null?i:NaN).toFixed(3)+"-"+((a=t.endPTS)!=null?a:NaN).toFixed(3)+"] > buffer:"+(u?Xr(ne.getBuffered(u)):"(detached)")+")"),this.state=me,u&&(!this.loadedmetadata&&t.type==ze&&u.buffered.length&&((o=this.fragCurrent)==null?void 0:o.sn)===((l=this.fragPrevious)==null?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},e.seekToStartPos=function(){},e._handleFragmentLoadComplete=function(t){var r=this.transmuxer;if(r){var i=t.frag,a=t.part,o=t.partsLoaded,l=!o||o.length===0||o.some(function(d){return!d}),u=new se(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!l);r.flush(u)}},e._handleFragmentLoadProgress=function(t){},e._doFragLoad=function(t,r,i,a){var o,l=this;i===void 0&&(i=null);var u=r==null?void 0:r.details;if(!this.levels||!u)throw new Error("frag load aborted, missing level"+(u?"":" detail")+"s");var d=null;if(!t.encrypted||(o=t.decryptdata)!=null&&o.key?!t.encrypted&&u.encryptedFragments.length&&this.keyLoader.loadClear(t,u.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+u.startSN+"-"+u.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level),this.state=yr,this.fragCurrent=t,d=this.keyLoader.load(t).then(function(E){if(!l.fragContextChanged(E.frag))return l.hls.trigger(T.KEY_LOADED,E),l.state===yr&&(l.state=me),E}),this.hls.trigger(T.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(t.start,i||0),this.config.lowLatencyMode&&t.sn!=="initSegment"){var c=u.partList;if(c&&a){i>t.end&&u.fragmentHint&&(t=u.fragmentHint);var f=this.getNextPart(c,t,i);if(f>-1){var v,y=c[f];return this.log("Loading part sn: "+t.sn+" p: "+y.index+" cc: "+t.cc+" of playlist ["+u.startSN+"-"+u.endSN+"] parts [0-"+f+"-"+(c.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=y.start+y.duration,this.state=Dr,v=d?d.then(function(E){return!E||l.fragContextChanged(E.frag)?null:l.doFragPartsLoad(t,y,r,a)}).catch(function(E){return l.handleFragLoadError(E)}):this.doFragPartsLoad(t,y,r,a).catch(function(E){return l.handleFragLoadError(E)}),this.hls.trigger(T.FRAG_LOADING,{frag:t,part:y,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):v}if(!t.url||this.loadedEndOfParts(c,i))return Promise.resolve(null)}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(u?"of ["+u.startSN+"-"+u.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),$(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=Dr;var _,A=this.config.progressive;return _=A&&d?d.then(function(E){return!E||l.fragContextChanged(E==null?void 0:E.frag)?null:l.fragmentLoader.load(t,a)}).catch(function(E){return l.handleFragLoadError(E)}):Promise.all([this.fragmentLoader.load(t,A?a:void 0),d]).then(function(E){var S=E[0];return!A&&S&&a&&a(S),S}).catch(function(E){return l.handleFragLoadError(E)}),this.hls.trigger(T.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):_},e.doFragPartsLoad=function(t,r,i,a){var o=this;return new Promise(function(l,u){var d,c=[],f=(d=i.details)==null?void 0:d.partList;(function v(y){o.fragmentLoader.loadPart(t,y,a).then(function(_){c[y.index]=_;var A=_.part;o.hls.trigger(T.FRAG_LOADED,_);var E=ci(i,t.sn,y.index+1)||Sn(f,t.sn,y.index+1);if(!E)return l({frag:t,part:A,partsLoaded:c});v(E)}).catch(u)})(r)})},e.handleFragLoadError=function(t){if("data"in t){var r=t.data;t.data&&r.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(T.ERROR,r)}else this.hls.trigger(T.ERROR,{type:Z.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},e._handleTransmuxerFlush=function(t){var r=this.getCurrentContext(t);if(r&&this.state===Er){var i=r.frag,a=r.part,o=r.level,l=self.performance.now();i.stats.parsing.end=l,a&&(a.stats.parsing.end=l),this.updateLevelTiming(i,a,o,t.partial)}else this.fragCurrent||this.state===vt||this.state===vi||(this.state=me)},e.getCurrentContext=function(t){var r=this.levels,i=this.fragCurrent,a=t.level,o=t.sn,l=t.part;if(r==null||!r[a])return this.warn("Levels object was unset while buffering fragment "+o+" of level "+a+". The current chunk will not be buffered."),null;var u=r[a],d=l>-1?ci(u,o,l):null,c=d?d.fragment:function(f,v,y){if(f==null||!f.details)return null;var _=f.details,A=_.fragments[v-_.startSN];return A||((A=_.fragmentHint)&&A.sn===v?A:v<_.startSN&&y&&y.sn===v?y:null)}(u,o,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:d,level:u}):null},e.bufferFragmentData=function(t,r,i,a){var o;if(t&&this.state===Er){var l=t.data1,u=t.data2,d=l;if(l&&u&&(d=vr(l,u)),(o=d)!=null&&o.length){var c={type:t.type,frag:r,part:i,chunkMeta:a,parent:r.type,data:d};this.hls.trigger(T.BUFFER_APPENDING,c),t.dropped&&t.independent&&!i&&this.flushBufferGap(r)}}},e.flushBufferGap=function(t){var r=this.media;if(r)if(ne.isBuffered(r,r.currentTime)){var i=r.currentTime,a=ne.bufferInfo(r,i,0),o=t.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),u=Math.max(Math.min(t.start-l,a.end-l),i+l);t.start-u>l&&this.flushMainBuffer(u,t.start)}else this.flushMainBuffer(0,t.start)},e.getFwdBufferInfo=function(t,r){var i=this.getLoadPosition();return $(i)?this.getFwdBufferInfoAtPos(t,i,r):null},e.getFwdBufferInfoAtPos=function(t,r,i){var a=this.config.maxBufferHole,o=ne.bufferInfo(t,r,a);if(o.len===0&&o.nextStart!==void 0){var l=this.fragmentTracker.getBufferedFrag(r,i);if(l&&o.nextStart<l.end)return ne.bufferInfo(t,r,Math.max(o.nextStart,a))}return o},e.getMaxBufferLength=function(t){var r,i=this.config;return r=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)},e.reduceMaxBufferLength=function(t){var r=this.config,i=t||r.maxBufferLength;return r.maxMaxBufferLength>=i&&(r.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+r.maxMaxBufferLength+"s"),!0)},e.getAppendedFrag=function(t,r){var i=this.fragmentTracker.getAppendedFrag(t,ze);return i&&"fragment"in i?i.fragment:i},e.getNextFragment=function(t,r){var i=r.fragments,a=i.length;if(!a)return null;var o,l=this.config,u=i[0].start;if(r.live){var d=l.initialLiveManifestSize;if(a<d)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+d+")"),null;r.PTSKnown||this.startFragRequested||this.startPosition!==-1||(o=this.getInitialLiveFragment(r,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=u&&(o=i[0]);if(!o){var c=l.lowLatencyMode?r.partEnd:r.fragmentEnd;o=this.getFragmentAtPosition(t,c,r)}return this.mapToInitFragWhenRequired(o)},e.isLoopLoading=function(t,r){var i=this.fragmentTracker.getState(t);return(i===Ce||i===pe&&!!t.gap)&&this.nextLoadPosition>r},e.getNextFragmentLoopLoading=function(t,r,i,a,o){var l=t.gap,u=this.getNextFragment(this.nextLoadPosition,r);if(u===null)return u;if(t=u,l&&t&&!t.gap&&i.nextStart){var d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,a);if(d!==null&&i.len+d.len>=o)return this.log('buffer full after gaps in "'+a+'" playlist starting at sn: '+t.sn),null}return t},e.mapToInitFragWhenRequired=function(t){return t==null||!t.initSegment||t!=null&&t.initSegment.data||this.bitrateTest?t:t.initSegment},e.getNextPart=function(t,r,i){for(var a=-1,o=!1,l=!0,u=0,d=t.length;u<d;u++){var c=t[u];if(l=l&&!c.independent,a>-1&&i<c.start)break;var f=c.loaded;f?a=-1:(o||c.independent||l)&&c.fragment===r&&(a=u),o=f}return a},e.loadedEndOfParts=function(t,r){var i=t[t.length-1];return i&&r>i.start&&i.loaded},e.getInitialLiveFragment=function(t,r){var i=this.fragPrevious,a=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=function(d,c,f){if(c===null||!Array.isArray(d)||!d.length||!$(c)||c<(d[0].programDateTime||0)||c>=(d[d.length-1].endProgramDateTime||0))return null;f=f||0;for(var v=0;v<d.length;++v){var y=d[v];if(Ln(c,f,y))return y}return null}(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){var o=i.sn+1;if(o>=t.startSN&&o<=t.endSN){var l=r[o-t.startSN];i.cc===l.cc&&(a=l,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=function(d,c){return kn(d,function(f){return f.cc<c?1:f.cc>c?-1:0})}(r,i.cc),a&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn))}}else{var u=this.hls.liveSyncPosition;u!==null&&(a=this.getFragmentAtPosition(u,this.bitrateTest?t.fragmentEnd:t.edge,t))}return a},e.getFragmentAtPosition=function(t,r,i){var a,o=this.config,l=this.fragPrevious,u=i.fragments,d=i.endSN,c=i.fragmentHint,f=o.maxFragLookUpTolerance,v=i.partList,y=!!(o.lowLatencyMode&&v!=null&&v.length&&c);if(y&&c&&!this.bitrateTest&&(u=u.concat(c),d=c.sn),a=t<r?Yr(l,u,t,t>r-f?0:f):u[u.length-1]){var _=a.sn-i.startSN,A=this.fragmentTracker.getState(a);if((A===Ce||A===pe&&a.gap)&&(l=a),l&&a.sn===l.sn&&(!y||v[0].fragment.sn>a.sn)&&l&&a.level===l.level){var E=u[_+1];a=a.sn<d&&this.fragmentTracker.getState(E)!==Ce?E:null}}return a},e.synchronizeToLiveEdge=function(t){var r=this.config,i=this.media;if(i){var a=this.hls.liveSyncPosition,o=i.currentTime,l=t.fragments[0].start,u=t.edge,d=o>=l-r.maxFragLookUpTolerance&&o<=u;if(a!==null&&i.duration>a&&(o<a||!d)){var c=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration;(!d&&i.readyState<4||o<u-c)&&(this.loadedmetadata||(this.nextLoadPosition=a),i.readyState&&(this.warn("Playback: "+o.toFixed(3)+" is located too far from the end of live sliding playlist: "+u+", reset currentTime to : "+a.toFixed(3)),i.currentTime=a))}}},e.alignPlaylists=function(t,r){var i=this.levels,a=this.levelLastLoaded,o=this.fragPrevious,l=a!==null?i[a]:null,u=t.fragments.length;if(!u)return this.warn("No fragments in live playlist"),0;var d=t.fragments[0].start,c=!r,f=t.alignedSliding&&$(d);if(c||!f&&!d){Rt(o,l,t);var v=t.fragments[0].start;return this.log("Live playlist sliding: "+v.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+t.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+u),v}return d},e.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},e.setStartPosition=function(t,r){var i=this.startPosition;if(i<r&&(i=-1),i===-1||this.lastCurrentTime===-1){var a=this.startTimeOffset!==null,o=a?this.startTimeOffset:t.startTimeOffset;o!==null&&$(o)?(i=r+o,o<0&&(i+=t.totalduration),i=Math.min(Math.max(r,i),r+t.totalduration),this.log("Start time offset "+o+" found in "+(a?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||r:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},e.getLoadPosition=function(){var t=this.media,r=0;return this.loadedmetadata&&t?r=t.currentTime:this.nextLoadPosition&&(r=this.nextLoadPosition),r},e.handleFragLoadAborted=function(t,r){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(r?" part "+r.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},e.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===Ir)||(this.state=me)},e.onFragmentOrKeyLoadError=function(t,r){if(r.chunkMeta&&!r.frag){var i=this.getCurrentContext(r.chunkMeta);i&&(r.frag=i.frag)}var a=r.frag;if(a&&a.type===t&&this.levels)if(this.fragContextChanged(a)){var o;this.warn("Frag load error must match current frag to retry "+a.url+" > "+((o=this.fragCurrent)==null?void 0:o.url))}else{var l=r.details===N.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(a,!0);var u=r.errorAction,d=u||{},c=d.action,f=d.retryCount,v=f===void 0?0:f,y=d.retryConfig;if(u&&c===p&&y){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var _=Ni(y,v);this.warn("Fragment "+a.sn+" of "+t+" "+a.level+" errored with "+r.details+", retrying loading "+(v+1)+"/"+y.maxNumRetry+" in "+_+"ms"),u.resolved=!0,this.retryDate=self.performance.now()+_,this.state=Ir}else y&&u?(this.resetFragmentErrors(t),v<y.maxNumRetry?l||(u.resolved=!0):x.warn(r.details+" reached or exceeded max retry ("+v+")")):this.state=vi;this.tickImmediate()}},e.reduceLengthAndFlushBuffer=function(t){if(this.state===Er||this.state===Dn){var r=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),a=i&&i.len>.5;a&&this.reduceMaxBufferLength(i.len);var o=!a;return o&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+r+" buffer"),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),o}return!1},e.resetFragmentErrors=function(t){t===Gt&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==vt&&(this.state=me)},e.afterBufferFlushed=function(t,r,i){if(t){var a=ne.getBuffered(t);this.fragmentTracker.detectEvictedFragments(r,a,i),this.state===Bi&&this.resetLoadingState()}},e.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=me},e.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var r=this.levels?this.levels[t].details:null;r!=null&&r.live?(this.startPosition=-1,this.setStartPosition(r,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},e.resetWhenMissingContext=function(t){this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(t.level),this.resetLoadingState()},e.removeUnbufferedFrags=function(t){t===void 0&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},e.updateLevelTiming=function(t,r,i,a){var o,l=this,u=i.details;if(u){if(Object.keys(t.elementaryStreams).reduce(function(c,f){var v=t.elementaryStreams[f];if(v){var y=v.endPTS-v.startPTS;if(y<=0)return l.warn("Could not parse fragment "+t.sn+" "+f+" duration reliably ("+y+")"),c||!1;var _=a?0:bn(u,t,v.startPTS,v.endPTS,v.startDTS,v.endDTS);return l.hls.trigger(T.LEVEL_PTS_UPDATED,{details:u,level:i,drift:_,type:f,frag:t,start:v.startPTS,end:v.endPTS}),!0}return c},!1))i.fragmentError=0;else if(((o=this.transmuxer)==null?void 0:o.error)===null){var d=new Error("Found no media in fragment "+t.sn+" of level "+i.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(d.message),this.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:t,reason:"Found no media in msn "+t.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Dn,this.hls.trigger(T.FRAG_PARSED,{frag:t,part:r})}else this.warn("level.details undefined")},e.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e.recoverWorkerError=function(t){t.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())},Y(n,[{key:"state",get:function(){return this._state},set:function(t){var r=this._state;r!==t&&(this._state=t,this.log(r+"->"+t))}}]),n}(qe);function ts(){return self.SourceBuffer||self.WebKitSourceBuffer}function or(s,n){return s===void 0&&(s=""),n===void 0&&(n=9e4),{type:s,id:-1,pid:-1,inputTimeScale:n,sequenceNumber:-1,samples:[],dropped:0}}var rs=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var n=s.prototype;return n.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},n.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},n.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},n.canParse=function(e,t){return!1},n.appendFrame=function(e,t,r){},n.demux=function(e,t){this.cachedData&&(e=vr(this.cachedData,e),this.cachedData=null);var r,i=ti(e,0),a=i?i.length:0,o=this._audioTrack,l=this._id3Track,u=i?function(v){for(var y=Ai(v),_=0;_<y.length;_++){var A=y[_];if(en(A))return Zn(A)}}(i):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&$(u))&&(this.basePTS=Uo(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:qr,duration:Number.POSITIVE_INFINITY});a<d;){if(this.canParse(e,a)){var c=this.appendFrame(o,e,a);c?(this.frameIndex++,this.lastPTS=c.sample.pts,r=a+=c.length):a=d}else Zi(e,a)?(i=ti(e,a),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:qr,duration:Number.POSITIVE_INFINITY}),r=a+=i.length):a++;if(a===d&&r!==d){var f=Wt(e,r);this.cachedData?this.cachedData=vr(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:or(),id3Track:l,textTrack:or()}},n.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},n.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:or(),id3Track:this._id3Track,textTrack:or()}},n.destroy=function(){},s}(),Uo=function(s,n,e){return $(s)?90*s:9e4*n+(e?9e4*e.baseTime/e.timescale:0)};function is(s,n){return s[n]===255&&(246&s[n+1])==240}function ns(s,n){return 1&s[n+1]?7:9}function ha(s,n){return(3&s[n+3])<<11|s[n+4]<<3|(224&s[n+5])>>>5}function In(s,n){return n+1<s.length&&is(s,n)}function Bo(s,n){if(In(s,n)){var e=ns(s,n);if(n+e>=s.length)return!1;var t=ha(s,n);if(t<=e)return!1;var r=n+t;return r===s.length||In(s,r)}return!1}function as(s,n,e,t,r){if(!s.samplerate){var i=function(a,o,l,u){var d,c,f,v,y=navigator.userAgent.toLowerCase(),_=u,A=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];d=1+((192&o[l+2])>>>6);var E=(60&o[l+2])>>>2;if(!(E>A.length-1))return f=(1&o[l+2])<<2,f|=(192&o[l+3])>>>6,x.log("manifest codec:"+u+", ADTS type:"+d+", samplingIndex:"+E),/firefox/i.test(y)?E>=6?(d=5,v=new Array(4),c=E-3):(d=2,v=new Array(2),c=E):y.indexOf("android")!==-1?(d=2,v=new Array(2),c=E):(d=5,v=new Array(4),u&&(u.indexOf("mp4a.40.29")!==-1||u.indexOf("mp4a.40.5")!==-1)||!u&&E>=6?c=E-3:((u&&u.indexOf("mp4a.40.2")!==-1&&(E>=6&&f===1||/vivaldi/i.test(y))||!u&&f===1)&&(d=2,v=new Array(2)),c=E)),v[0]=d<<3,v[0]|=(14&E)>>1,v[1]|=(1&E)<<7,v[1]|=f<<3,d===5&&(v[1]|=(14&c)>>1,v[2]=(1&c)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:A[E],channelCount:f,codec:"mp4a.40."+d,manifestCodec:_};a.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+E})}(n,e,t,r);if(!i)return;s.config=i.config,s.samplerate=i.samplerate,s.channelCount=i.channelCount,s.codec=i.codec,s.manifestCodec=i.manifestCodec,x.log("parsed codec:"+s.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function ss(s){return 9216e4/s}function os(s,n,e,t,r){var i,a=t+r*ss(s.samplerate),o=function(y,_){var A=ns(y,_);if(_+A<=y.length){var E=ha(y,_)-A;if(E>0)return{headerLength:A,frameLength:E}}}(n,e);if(o){var l=o.frameLength,u=o.headerLength,d=u+l,c=Math.max(0,e+d-n.length);c?(i=new Uint8Array(d-u)).set(n.subarray(e+u,n.length),0):i=n.subarray(e+u,e+d);var f={unit:i,pts:a};return c||s.samples.push(f),{sample:f,length:d,missing:c}}var v=n.length-e;return(i=new Uint8Array(v)).set(n.subarray(e,n.length),0),{sample:{unit:i,pts:a},length:v,missing:-1}}var Go=function(s){function n(t,r){var i;return(i=s.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}te(n,s);var e=n.prototype;return e.resetInitSegment=function(t,r,i,a){s.prototype.resetInitSegment.call(this,t,r,i,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},n.probe=function(t){if(!t)return!1;for(var r=(ti(t,0)||[]).length,i=t.length;r<i;r++)if(Bo(t,r))return x.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,a){return function(o,l){return l+5<o.length}(i,a)&&is(i,a)&&ha(i,a)<=i.length-a}(t,r)},e.appendFrame=function(t,r,i){as(t,this.observer,r,i,t.manifestCodec);var a=os(t,r,i,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},n}(rs),Ho=/\/emsg[-/]ID3/i,Ko=function(){function s(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var n=s.prototype;return n.resetTimeStamp=function(){},n.resetInitSegment=function(e,t,r,i){var a=this.videoTrack=or("video",1),o=this.audioTrack=or("audio",1),l=this.txtTrack=or("text",1);if(this.id3Track=or("id3",1),this.timeOffset=0,e!=null&&e.byteLength){var u=Li(e);if(u.video){var d=u.video,c=d.id,f=d.timescale,v=d.codec;a.id=c,a.timescale=l.timescale=f,a.codec=v}if(u.audio){var y=u.audio,_=y.id,A=y.timescale,E=y.codec;o.id=_,o.timescale=A,o.codec=E}l.id=nn.text,a.sampleDuration=0,a.duration=o.duration=i}},n.resetContiguity=function(){this.remainderData=null},s.probe=function(e){return He(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0},n.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=vr(this.remainderData,e));var o=function(u){var d={valid:null,remainder:null},c=He(u,["moof"]);if(!c)return d;if(c.length<2)return d.remainder=u,d;var f=c[c.length-1];return d.valid=Wt(u,0,f.byteOffset-8),d.remainder=Wt(u,f.byteOffset-8),d}(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;var l=this.extractID3Track(i,t);return a.samples=Di(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},n.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=Di(e,t),{videoTrack:t,audioTrack:or(),id3Track:i,textTrack:or()}},n.extractID3Track=function(e,t){var r=this.id3Track;if(e.samples.length){var i=He(e.samples,["emsg"]);i&&i.forEach(function(a){var o=function(c){var f=c[0],v="",y="",_=0,A=0,E=0,S=0,D=0,R=0;if(f===0){for(;lt(c.subarray(R,R+1))!=="\0";)v+=lt(c.subarray(R,R+1)),R+=1;for(v+=lt(c.subarray(R,R+1)),R+=1;lt(c.subarray(R,R+1))!=="\0";)y+=lt(c.subarray(R,R+1)),R+=1;y+=lt(c.subarray(R,R+1)),R+=1,_=Oe(c,12),A=Oe(c,16),S=Oe(c,20),D=Oe(c,24),R=28}else if(f===1){_=Oe(c,R+=4);var O=Oe(c,R+=4),U=Oe(c,R+=4);for(R+=4,E=Math.pow(2,32)*O+U,Number.isSafeInteger(E)||(E=Number.MAX_SAFE_INTEGER,x.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),S=Oe(c,R),D=Oe(c,R+=4),R+=4;lt(c.subarray(R,R+1))!=="\0";)v+=lt(c.subarray(R,R+1)),R+=1;for(v+=lt(c.subarray(R,R+1)),R+=1;lt(c.subarray(R,R+1))!=="\0";)y+=lt(c.subarray(R,R+1)),R+=1;y+=lt(c.subarray(R,R+1)),R+=1}return{schemeIdUri:v,value:y,timeScale:_,presentationTime:E,presentationTimeDelta:A,eventDuration:S,id:D,payload:c.subarray(R,c.byteLength)}}(a);if(Ho.test(o.schemeIdUri)){var l=$(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale,u=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);var d=o.payload;r.samples.push({data:d,len:d.byteLength,dts:l,pts:l,type:tr,duration:u})}})}return r},n.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},n.destroy=function(){},s}(),Cn=null,qo=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],jo=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Vo=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Wo=[0,1,1,4];function ls(s,n,e,t,r){if(!(e+24>n.length)){var i=us(n,e);if(i&&e+i.frameLength<=n.length){var a=t+r*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:n.subarray(e,e+i.frameLength),pts:a,dts:a};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}}function us(s,n){var e=s[n+1]>>3&3,t=s[n+1]>>1&3,r=s[n+2]>>4&15,i=s[n+2]>>2&3;if(e!==1&&r!==0&&r!==15&&i!==3){var a=s[n+2]>>1&1,o=s[n+3]>>6,l=1e3*qo[14*(e===3?3-t:t===3?3:4)+r-1],u=jo[3*(e===3?0:e===2?1:2)+i],d=o===3?1:2,c=Vo[e][t],f=Wo[t],v=8*c*f,y=Math.floor(c*l/u+a)*f;if(Cn===null){var _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Cn=_?parseInt(_[1]):0}return Cn&&Cn<=87&&t===2&&l>=224e3&&o===0&&(s[n+3]=128|s[n+3]),{sampleRate:u,channelCount:d,frameLength:y,samplesPerFrame:v}}}function fa(s,n){return s[n]===255&&(224&s[n+1])==224&&(6&s[n+1])!=0}function ds(s,n){return n+1<s.length&&fa(s,n)}function Yo(s,n){if(n+1<s.length&&fa(s,n)){var e=us(s,n),t=4;e!=null&&e.frameLength&&(t=e.frameLength);var r=n+t;return r===s.length||ds(s,r)}return!1}var cs=function(){function s(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var n=s.prototype;return n.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},n.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},n.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&x.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},n.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},n.skipUEG=function(){this.skipBits(1+this.skipLZ())},n.skipEG=function(){this.skipBits(1+this.skipLZ())},n.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},n.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},n.readBoolean=function(){return this.readBits(1)===1},n.readUByte=function(){return this.readBits(8)},n.readUShort=function(){return this.readBits(16)},n.readUInt=function(){return this.readBits(32)},n.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)r!==0&&(r=(t+this.readEG()+256)%256),t=r===0?t:r},n.readSPS=function(){var e,t,r,i=0,a=0,o=0,l=0,u=this.readUByte.bind(this),d=this.readBits.bind(this),c=this.readUEG.bind(this),f=this.readBoolean.bind(this),v=this.skipBits.bind(this),y=this.skipEG.bind(this),_=this.skipUEG.bind(this),A=this.skipScalingList.bind(this);u();var E=u();if(d(5),v(3),u(),_(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){var S=c();if(S===3&&v(1),_(),_(),v(1),f())for(t=S!==3?8:12,r=0;r<t;r++)f()&&A(r<6?16:64)}_();var D=c();if(D===0)c();else if(D===1)for(v(1),y(),y(),e=c(),r=0;r<e;r++)y();_(),v(1);var R=c(),O=c(),U=d(1);U===0&&v(1),v(1),f()&&(i=c(),a=c(),o=c(),l=c());var B=[1,1];if(f()&&f())switch(u()){case 1:B=[1,1];break;case 2:B=[12,11];break;case 3:B=[10,11];break;case 4:B=[16,11];break;case 5:B=[40,33];break;case 6:B=[24,11];break;case 7:B=[20,11];break;case 8:B=[32,11];break;case 9:B=[80,33];break;case 10:B=[18,11];break;case 11:B=[15,11];break;case 12:B=[64,33];break;case 13:B=[160,99];break;case 14:B=[4,3];break;case 15:B=[3,2];break;case 16:B=[2,1];break;case 255:B=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil(16*(R+1)-2*i-2*a),height:(2-U)*(O+1)*16-(U?2:4)*(o+l),pixelRatio:B}},n.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},s}(),zo=function(){function s(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Xt(t,{removePKCS7Padding:!1})}var n=s.prototype;return n.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},n.decryptAacSample=function(e,t,r){var i=this,a=e[t].unit;if(!(a.length<=16)){var o=a.subarray(16,a.length-a.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then(function(u){var d=new Uint8Array(u);a.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)})}},n.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}},n.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,a=32;a<e.length-16;a+=160,i+=16)r.set(e.subarray(a,a+16),i);return r},n.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,a=32;a<e.length-16;a+=160,i+=16)e.set(r.subarray(i,i+16),a);return e},n.decryptAvcSample=function(e,t,r,i,a){var o=this,l=un(a.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(function(d){a.data=o.getAvcDecryptedUnit(l,d),o.decrypter.isSync()||o.decryptAvcSamples(e,t,r+1,i)})},n.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var a=e[t].units;!(r>=a.length);r++){var o=a[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5||(this.decryptAvcSample(e,t,r,i,o),this.decrypter.isSync())))return}}},s}(),Ot=188,Xo=function(){function s(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}s.probe=function(e){var t=s.syncOffset(e);return t>0&&x.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},s.syncOffset=function(e){for(var t=e.length,r=Math.min(940,e.length-Ot)+1,i=0;i<r;){for(var a=!1,o=-1,l=0,u=i;u<t;u+=Ot){if(e[u]!==71){if(l)return-1;break}if(l++,o===-1&&(o=u)!==0&&(r=Math.min(o+18612,e.length-Ot)+1),a||(a=va(e,u)===0),a&&l>1&&(o===0&&l>2||u+Ot>r))return o}i++}return-1},s.createTrack=function(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:nn[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}};var n=s.prototype;return n.resetInitSegment=function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video"),this._audioTrack=s.createTrack("audio",i),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i},n.resetTimeStamp=function(){},n.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},n.demux=function(e,t,r,i){var a;r===void 0&&(r=!1),i===void 0&&(i=!1),r||(this.sampleAes=null);var o=this._avcTrack,l=this._audioTrack,u=this._id3Track,d=this._txtTrack,c=o.pid,f=o.pesData,v=l.pid,y=u.pid,_=l.pesData,A=u.pesData,E=null,S=this.pmtParsed,D=this._pmtId,R=e.length;if(this.remainderData&&(R=(e=vr(this.remainderData,e)).length,this.remainderData=null),R<Ot&&!i)return this.remainderData=e,{audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};var O=Math.max(0,s.syncOffset(e));(R-=(R-O)%Ot)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));for(var U=0,B=O;B<R;B+=Ot)if(e[B]===71){var Q=!!(64&e[B+1]),K=va(e,B),q=void 0;if((48&e[B+3])>>4>1){if((q=B+5+e[B+4])===B+Ot)continue}else q=B+4;switch(K){case c:Q&&(f&&(a=mi(f))&&this.parseAVCPES(o,d,a,!1),f={data:[],size:0}),f&&(f.data.push(e.subarray(q,B+Ot)),f.size+=B+Ot-q);break;case v:if(Q){if(_&&(a=mi(_)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,a);break;case"mp3":this.parseMPEGPES(l,a)}_={data:[],size:0}}_&&(_.data.push(e.subarray(q,B+Ot)),_.size+=B+Ot-q);break;case y:Q&&(A&&(a=mi(A))&&this.parseID3PES(u,a),A={data:[],size:0}),A&&(A.data.push(e.subarray(q,B+Ot)),A.size+=B+Ot-q);break;case 0:Q&&(q+=e[q]+1),D=this._pmtId=Qo(e,q);break;case D:Q&&(q+=e[q]+1);var ie=$o(e,q,this.typeSupported,r);(c=ie.avc)>0&&(o.pid=c),(v=ie.audio)>0&&(l.pid=v,l.segmentCodec=ie.segmentCodec),(y=ie.id3)>0&&(u.pid=y),E===null||S||(x.warn("MPEG-TS PMT found at "+B+" after unknown PID '"+E+"'. Backtracking to sync byte @"+O+" to parse all TS packets."),E=null,B=O-188),S=this.pmtParsed=!0;break;case 17:case 8191:break;default:E=K}}else U++;if(U>0){var J=new Error("Found "+U+" TS packet/s that do not start with 0x47");this.observer.emit(T.ERROR,T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:J,reason:J.message})}o.pesData=f,l.pesData=_,u.pesData=A;var he={audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};return i&&this.extractRemainingSamples(he),he},n.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},n.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,a=e.id3Track,o=e.textTrack,l=i.pesData,u=r.pesData,d=a.pesData;if(l&&(t=mi(l))?(this.parseAVCPES(i,o,t,!0),i.pesData=null):i.pesData=l,u&&(t=mi(u))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t)}r.pesData=null}else u!=null&&u.size&&x.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=u;d&&(t=mi(d))?(this.parseID3PES(a,t),a.pesData=null):a.pesData=d},n.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),a=this.sampleAes=new zo(this.observer,this.config,t);return this.decrypt(i,a)},n.decrypt=function(e,t){return new Promise(function(r){var i=e.audioTrack,a=e.videoTrack;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,function(){a.samples?t.decryptAvcSamples(a.samples,0,0,function(){r(e)}):r(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,function(){r(e)})})},n.destroy=function(){this._duration=0},n.parseAVCPES=function(e,t,r,i){var a,o=this,l=this.parseAVCNALu(e,r.data),u=this.avcSample,d=!1;r.data=null,u&&l.length&&!e.audFound&&(ga(u,e),u=this.avcSample=Pn(!1,r.pts,r.dts,"")),l.forEach(function(c){switch(c.type){case 1:a=!0,u||(u=o.avcSample=Pn(!0,r.pts,r.dts,"")),u.frame=!0;var f=c.data;if(d&&f.length>4){var v=new cs(f).readSliceType();v!==2&&v!==4&&v!==7&&v!==9||(u.key=!0)}break;case 5:a=!0,u||(u=o.avcSample=Pn(!0,r.pts,r.dts,"")),u.key=!0,u.frame=!0;break;case 6:a=!0,ln(c.data,1,r.pts,t.samples);break;case 7:if(a=!0,d=!0,!e.sps){var y=c.data,_=new cs(y).readSPS();e.width=_.width,e.height=_.height,e.pixelRatio=_.pixelRatio,e.sps=[y],e.duration=o._duration;for(var A=y.subarray(1,4),E="avc1.",S=0;S<3;S++){var D=A[S].toString(16);D.length<2&&(D="0"+D),E+=D}e.codec=E}break;case 8:a=!0,e.pps||(e.pps=[c.data]);break;case 9:a=!1,e.audFound=!0,u&&ga(u,e),u=o.avcSample=Pn(!1,r.pts,r.dts,"");break;case 12:a=!0;break;default:a=!1,u&&(u.debug+="unknown NAL "+c.type+" ")}u&&a&&u.units.push(c)}),i&&u&&(ga(u,e),this.avcSample=null)},n.getLastNalUnit=function(e){var t,r,i=this.avcSample;if(i&&i.units.length!==0||(i=e[e.length-1]),(t=i)!=null&&t.units){var a=i.units;r=a[a.length-1]}return r},n.parseAVCNALu=function(e,t){var r,i,a=t.byteLength,o=e.naluState||0,l=o,u=[],d=0,c=-1,f=0;for(o===-1&&(c=0,f=31&t[0],o=0,d=1);d<a;)if(r=t[d++],o)if(o!==1)if(r)if(r===1){if(c>=0){var v={data:t.subarray(c,d-o-1),type:f};u.push(v)}else{var y=this.getLastNalUnit(e.samples);if(y&&(l&&d<=4-l&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-l)),(i=d-o-1)>0)){var _=new Uint8Array(y.data.byteLength+i);_.set(y.data,0),_.set(t.subarray(0,i),y.data.byteLength),y.data=_,y.state=0}}d<a?(c=d,f=31&t[d],o=0):o=-1}else o=0;else o=3;else o=r?0:2;else o=r?0:1;if(c>=0&&o>=0){var A={data:t.subarray(c,a),type:f,state:o};u.push(A)}if(u.length===0){var E=this.getLastNalUnit(e.samples);if(E){var S=new Uint8Array(E.data.byteLength+t.byteLength);S.set(E.data,0),S.set(t,E.data.byteLength),E.data=S}}return e.naluState=o,u},n.parseAACPES=function(e,t){var r,i,a,o=0,l=this.aacOverFlow,u=t.data;if(l){this.aacOverFlow=null;var d=l.missing,c=l.sample.unit.byteLength;if(d===-1){var f=new Uint8Array(c+u.byteLength);f.set(l.sample.unit,0),f.set(u,c),u=f}else{var v=c-d;l.sample.unit.set(u.subarray(0,d),v),e.samples.push(l.sample),o=l.missing}}for(r=o,i=u.length;r<i-1&&!In(u,r);r++);if(r!==o){var y,_=r<i-1;y=_?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES";var A=new Error(y);if(x.warn("parsing error: "+y),this.observer.emit(T.ERROR,T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:_,error:A,reason:y}),!_)return}if(as(e,this.observer,u,r,this.audioCodec),t.pts!==void 0)a=t.pts;else{if(!l)return void x.warn("[tsdemuxer]: AAC PES unknown PTS");var E=ss(e.samplerate);a=l.sample.pts+E}for(var S,D=0;r<i;){if(r+=(S=os(e,u,r,a,D)).length,S.missing){this.aacOverFlow=S;break}for(D++;r<i-1&&!In(u,r);r++);}},n.parseMPEGPES=function(e,t){var r=t.data,i=r.length,a=0,o=0,l=t.pts;if(l!==void 0)for(;o<i;)if(ds(r,o)){var u=ls(e,r,o,l,a);if(!u)break;o+=u.length,a++}else o++;else x.warn("[tsdemuxer]: MPEG PES unknown PTS")},n.parseID3PES=function(e,t){if(t.pts!==void 0){var r=z({},t,{type:this._avcTrack?tr:qr,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else x.warn("[tsdemuxer]: ID3 PES unknown PTS")},s}();function Pn(s,n,e,t){return{key:s,frame:!1,pts:n,dts:e,units:[],debug:t,length:0}}function va(s,n){return((31&s[n+1])<<8)+s[n+2]}function Qo(s,n){return(31&s[n+10])<<8|s[n+11]}function $o(s,n,e,t){var r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},i=n+3+((15&s[n+1])<<8|s[n+2])-4;for(n+=12+((15&s[n+10])<<8|s[n+11]);n<i;){var a=va(s,n);switch(s[n]){case 207:if(!t){x.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:r.audio===-1&&(r.audio=a);break;case 21:r.id3===-1&&(r.id3=a);break;case 219:if(!t){x.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:r.avc===-1&&(r.avc=a);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?x.log("MPEG audio found, not supported in this browser"):r.audio===-1&&(r.audio=a,r.segmentCodec="mp3");break;case 36:x.warn("Unsupported HEVC stream type found")}n+=5+((15&s[n+3])<<8|s[n+4])}return r}function mi(s){var n,e,t,r,i,a=0,o=s.data;if(!s||s.size===0)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(((n=o[0])[0]<<16)+(n[1]<<8)+n[2]===1){if((e=(n[4]<<8)+n[5])&&e>s.size-6)return null;var u=n[7];192&u&&(r=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&u?r-(i=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2)>54e5&&(x.warn(Math.round((r-i)/9e4)+"s delta between PTS and DTS, align them"),r=i):i=r);var d=(t=n[8])+9;if(s.size<=d)return null;s.size-=d;for(var c=new Uint8Array(s.size),f=0,v=o.length;f<v;f++){var y=(n=o[f]).byteLength;if(d){if(d>y){d-=y;continue}n=n.subarray(d),y-=d,d=0}c.set(n,a),a+=y}return e&&(e-=t+3),{data:c,pts:r,dts:i,len:e}}return null}function ga(s,n){if(s.units.length&&s.frame){if(s.pts===void 0){var e=n.samples,t=e.length;if(!t)return void n.dropped++;var r=e[t-1];s.pts=r.pts,s.dts=r.dts}n.samples.push(s)}s.debug.length&&x.log(s.pts+"/"+s.dts+":"+s.debug)}var Jo=function(s){function n(){return s.apply(this,arguments)||this}te(n,s);var e=n.prototype;return e.resetInitSegment=function(t,r,i,a){s.prototype.resetInitSegment.call(this,t,r,i,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},n.probe=function(t){if(!t)return!1;for(var r=(ti(t,0)||[]).length,i=t.length;r<i;r++)if(Yo(t,r))return x.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,a){return fa(i,a)&&4<=i.length-a}(t,r)},e.appendFrame=function(t,r,i){if(this.basePTS!==null)return ls(t,r,i,this.basePTS,this.frameIndex)},n}(rs),hs=function(){function s(){}return s.getSilentFrame=function(n,e){if(n==="mp4a.40.2"){if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},s}(),Cr=Math.pow(2,32)-1,bt=function(){function s(){}return s.init=function(){var n;for(n in s.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},s.types)s.types.hasOwnProperty(n)&&(s.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);s.HDLR_TYPES={video:e,audio:t};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);s.STTS=s.STSC=s.STCO=i,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);s.FTYP=s.box(s.types.ftyp,a,l,a,o),s.DINF=s.box(s.types.dinf,s.box(s.types.dref,r))},s.box=function(n){for(var e=8,t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var a=r.length,o=a;a--;)e+=r[a].byteLength;var l=new Uint8Array(e);for(l[0]=e>>24&255,l[1]=e>>16&255,l[2]=e>>8&255,l[3]=255&e,l.set(n,4),a=0,e=8;a<o;a++)l.set(r[a],e),e+=r[a].byteLength;return l},s.hdlr=function(n){return s.box(s.types.hdlr,s.HDLR_TYPES[n])},s.mdat=function(n){return s.box(s.types.mdat,n)},s.mdhd=function(n,e){e*=n;var t=Math.floor(e/(Cr+1)),r=Math.floor(e%(Cr+1));return s.box(s.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},s.mdia=function(n){return s.box(s.types.mdia,s.mdhd(n.timescale,n.duration),s.hdlr(n.type),s.minf(n))},s.mfhd=function(n){return s.box(s.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]))},s.minf=function(n){return n.type==="audio"?s.box(s.types.minf,s.box(s.types.smhd,s.SMHD),s.DINF,s.stbl(n)):s.box(s.types.minf,s.box(s.types.vmhd,s.VMHD),s.DINF,s.stbl(n))},s.moof=function(n,e,t){return s.box(s.types.moof,s.mfhd(n),s.traf(t,e))},s.moov=function(n){for(var e=n.length,t=[];e--;)t[e]=s.trak(n[e]);return s.box.apply(null,[s.types.moov,s.mvhd(n[0].timescale,n[0].duration)].concat(t).concat(s.mvex(n)))},s.mvex=function(n){for(var e=n.length,t=[];e--;)t[e]=s.trex(n[e]);return s.box.apply(null,[s.types.mvex].concat(t))},s.mvhd=function(n,e){e*=n;var t=Math.floor(e/(Cr+1)),r=Math.floor(e%(Cr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.box(s.types.mvhd,i)},s.sdtp=function(n){var e,t,r=n.samples||[],i=new Uint8Array(4+r.length);for(e=0;e<r.length;e++)t=r[e].flags,i[e+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return s.box(s.types.sdtp,i)},s.stbl=function(n){return s.box(s.types.stbl,s.stsd(n),s.box(s.types.stts,s.STTS),s.box(s.types.stsc,s.STSC),s.box(s.types.stsz,s.STSZ),s.box(s.types.stco,s.STCO))},s.avc1=function(n){var e,t,r,i=[],a=[];for(e=0;e<n.sps.length;e++)r=(t=n.sps[e]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(t));for(e=0;e<n.pps.length;e++)r=(t=n.pps[e]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(t));var o=s.box(s.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|n.sps.length].concat(i).concat([n.pps.length]).concat(a))),l=n.width,u=n.height,d=n.pixelRatio[0],c=n.pixelRatio[1];return s.box(s.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,c>>24,c>>16&255,c>>8&255,255&c])))},s.esds=function(n){var e=n.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(n.config).concat([6,1,2]))},s.mp4a=function(n){var e=n.samplerate;return s.box(s.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),s.box(s.types.esds,s.esds(n)))},s.mp3=function(n){var e=n.samplerate;return s.box(s.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},s.stsd=function(n){return n.type==="audio"?n.segmentCodec==="mp3"&&n.codec==="mp3"?s.box(s.types.stsd,s.STSD,s.mp3(n)):s.box(s.types.stsd,s.STSD,s.mp4a(n)):s.box(s.types.stsd,s.STSD,s.avc1(n))},s.tkhd=function(n){var e=n.id,t=n.duration*n.timescale,r=n.width,i=n.height,a=Math.floor(t/(Cr+1)),o=Math.floor(t%(Cr+1));return s.box(s.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))},s.traf=function(n,e){var t=s.sdtp(n),r=n.id,i=Math.floor(e/(Cr+1)),a=Math.floor(e%(Cr+1));return s.box(s.types.traf,s.box(s.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),s.box(s.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a])),s.trun(n,t.length+16+20+8+16+8+8),t)},s.trak=function(n){return n.duration=n.duration||4294967295,s.box(s.types.trak,s.tkhd(n),s.mdia(n))},s.trex=function(n){var e=n.id;return s.box(s.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},s.trun=function(n,e){var t,r,i,a,o,l,u=n.samples||[],d=u.length,c=12+16*d,f=new Uint8Array(c);for(e+=8+c,f.set([n.type==="video"?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),t=0;t<d;t++)i=(r=u[t]).duration,a=r.size,o=r.flags,l=r.cts,f.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*t);return s.box(s.types.trun,f)},s.initSegment=function(n){s.types||s.init();var e=s.moov(n),t=new Uint8Array(s.FTYP.byteLength+e.byteLength);return t.set(s.FTYP),t.set(e,s.FTYP.byteLength),t},s}();function ma(s,n,e,t){e===void 0&&(e=1),t===void 0&&(t=!1);var r=s*n*e;return t?Math.round(r):r}function Hi(s,n){return n===void 0&&(n=!1),ma(s,1e3,1/9e4,n)}bt.types=void 0,bt.HDLR_TYPES=void 0,bt.STTS=void 0,bt.STSC=void 0,bt.STCO=void 0,bt.STSZ=void 0,bt.VMHD=void 0,bt.SMHD=void 0,bt.STSD=void 0,bt.FTYP=void 0,bt.DINF=void 0;var xn=null,pa=null,ya=function(){function s(e,t,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,xn===null){var a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);xn=a?parseInt(a[1]):0}if(pa===null){var o=navigator.userAgent.match(/Safari\/(\d+)/i);pa=o?parseInt(o[1]):0}}var n=s.prototype;return n.destroy=function(){},n.resetTimeStamp=function(e){x.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},n.resetNextTimestamp=function(){x.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},n.resetInitSegment=function(){x.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},n.getVideoStartPts=function(e){var t=!1,r=e.reduce(function(i,a){var o=a.pts-i;return o<-4294967296?(t=!0,Qt(i,a.pts)):o>0?i:a.pts},e[0].pts);return t&&x.debug("PTS rollover detected"),r},n.remux=function(e,t,r,i,a,o,l,u){var d,c,f,v,y,_,A=a,E=a,S=e.pid>-1,D=t.pid>-1,R=t.samples.length,O=e.samples.length>0,U=l&&R>0||R>1;if((!S||O)&&(!D||U)||this.ISGenerated||l){this.ISGenerated||(f=this.generateIS(e,t,a,o));var B,Q=this.isVideoContiguous,K=-1;if(U&&(K=function(be){for(var ge=0;ge<be.length;ge++)if(be[ge].key)return ge;return-1}(t.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(_=!0,K>0){x.warn("[mp4-remuxer]: Dropped "+K+" out of "+R+" video samples due to a missing keyframe");var q=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(K),t.dropped+=K,B=E+=(t.samples[0].pts-q)/t.inputTimeScale}else K===-1&&(x.warn("[mp4-remuxer]: No keyframe found out of "+R+" video samples"),_=!1);if(this.ISGenerated){if(O&&U){var ie=this.getVideoStartPts(t.samples),J=(Qt(e.samples[0].pts,ie)-ie)/t.inputTimeScale;A+=Math.max(0,J),E+=Math.max(0,-J)}if(O){if(e.samplerate||(x.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(e,t,a,o)),c=this.remuxAudio(e,A,this.isAudioContiguous,o,D||U||u===Gt?E:void 0),U){var he=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(x.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(e,t,a,o)),d=this.remuxVideo(t,E,Q,he)}}else U&&(d=this.remuxVideo(t,E,Q,0));d&&(d.firstKeyFrame=K,d.independent=K!==-1,d.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(y=fs(r,a,this._initPTS,this._initDTS)),i.samples.length&&(v=vs(i,a,this._initPTS))),{audio:c,video:d,initSegment:f,independent:_,text:v,id3:y}},n.generateIS=function(e,t,r,i){var a,o,l,u=e.samples,d=t.samples,c=this.typeSupported,f={},v=this._initPTS,y=!v||i,_="audio/mp4";if(y&&(a=o=1/0),e.config&&u.length&&(e.timescale=e.samplerate,e.segmentCodec==="mp3"&&(c.mpeg?(_="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),f.audio={id:"audio",container:_,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):bt.initSegment([e]),metadata:{channelCount:e.channelCount}},y&&(l=e.inputTimeScale,v&&l===v.timescale?y=!1:a=o=u[0].pts-Math.round(l*r))),t.sps&&t.pps&&d.length&&(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:bt.initSegment([t]),metadata:{width:t.width,height:t.height}},y))if(l=t.inputTimeScale,v&&l===v.timescale)y=!1;else{var A=this.getVideoStartPts(d),E=Math.round(l*r);o=Math.min(o,Qt(d[0].dts,A)-E),a=Math.min(a,A-E)}if(Object.keys(f).length)return this.ISGenerated=!0,y?(this._initPTS={baseTime:a,timescale:l},this._initDTS={baseTime:o,timescale:l}):a=l=void 0,{tracks:f,initPTS:a,timescale:l}},n.remuxVideo=function(e,t,r,i){var a,o,l=e.inputTimeScale,u=e.samples,d=[],c=u.length,f=this._initPTS,v=this.nextAvcDts,y=8,_=this.videoSampleDuration,A=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,S=!1;r&&v!==null||(v=t*l-(u[0].pts-Qt(u[0].dts,u[0].pts)));for(var D=f.baseTime*l/f.timescale,R=0;R<c;R++){var O=u[R];O.pts=Qt(O.pts-D,v),O.dts=Qt(O.dts-D,v),O.dts<u[R>0?R-1:R].dts&&(S=!0)}S&&u.sort(function(Gn,Qs){var Ql=Gn.dts-Qs.dts,$l=Gn.pts-Qs.pts;return Ql||$l}),a=u[0].dts;var U=(o=u[u.length-1].dts)-a,B=U?Math.round(U/(c-1)):_||e.inputTimeScale/30;if(r){var Q=a-v,K=Q>B,q=Q<-1;if((K||q)&&(K?x.warn("AVC: "+Hi(Q,!0)+" ms ("+Q+"dts) hole between fragments detected, filling it"):x.warn("AVC: "+Hi(-Q,!0)+" ms ("+Q+"dts) overlapping between fragments detected"),!q||v>=u[0].pts)){a=v;var ie=u[0].pts-Q;u[0].dts=a,u[0].pts=ie,x.log("Video: First PTS/DTS adjusted: "+Hi(ie,!0)+"/"+Hi(a,!0)+", delta: "+Hi(Q,!0)+" ms")}}a=Math.max(0,a);for(var J=0,he=0,be=0;be<c;be++){for(var ge=u[be],Ee=ge.units,Le=Ee.length,ke=0,Fe=0;Fe<Le;Fe++)ke+=Ee[Fe].data.length;he+=ke,J+=Le,ge.length=ke,ge.dts=Math.max(ge.dts,a),A=Math.min(ge.pts,A),E=Math.max(ge.pts,E)}o=u[c-1].dts;var Ge,Ke=he+4*J+8;try{Ge=new Uint8Array(Ke)}catch(Gn){return void this.observer.emit(T.ERROR,T.ERROR,{type:Z.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:Gn,bytes:Ke,reason:"fail allocating video mdat "+Ke})}var $e=new DataView(Ge.buffer);$e.setUint32(0,Ke),Ge.set(bt.types.mdat,4);for(var Mt=!1,pt=Number.POSITIVE_INFINITY,rr=Number.POSITIVE_INFINITY,Jt=Number.NEGATIVE_INFINITY,Zt=Number.NEGATIVE_INFINITY,yt=0;yt<c;yt++){for(var St=u[yt],lr=St.units,Pr=0,Ht=0,Ki=lr.length;Ht<Ki;Ht++){var qi=lr[Ht],Bn=qi.data,Ei=qi.data.byteLength;$e.setUint32(y,Ei),y+=4,Ge.set(Bn,y),y+=Ei,Pr+=4+Ei}var ei=void 0;if(yt<c-1)_=u[yt+1].dts-St.dts,ei=u[yt+1].pts-St.pts;else{var ji=this.config,br=yt>0?St.dts-u[yt-1].dts:B;if(ei=yt>0?St.pts-u[yt-1].pts:B,ji.stretchShortVideoTrack&&this.nextAudioPts!==null){var Vl=Math.floor(ji.maxBufferHole*l),Ua=(i?A+i*l:this.nextAudioPts)-St.pts;Ua>Vl?((_=Ua-br)<0?_=br:Mt=!0,x.log("[mp4-remuxer]: It is approximately "+Ua/90+" ms to the next segment; using duration "+_/90+" ms for the last video frame.")):_=br}else _=br}var Wl=Math.round(St.pts-St.dts);pt=Math.min(pt,_),Jt=Math.max(Jt,_),rr=Math.min(rr,ei),Zt=Math.max(Zt,ei),d.push(new gs(St.key,_,Pr,Wl))}if(d.length){if(xn){if(xn<70){var Ys=d[0].flags;Ys.dependsOn=2,Ys.isNonSync=0}}else if(pa&&Zt-rr<Jt-pt&&B/Jt<.025&&d[0].cts===0){x.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ba=a,ir=0,zs=d.length;ir<zs;ir++){var Xs=Ba+d[ir].duration,Yl=Ba+d[ir].cts;if(ir<zs-1){var zl=Xs+d[ir+1].cts;d[ir].duration=zl-Yl}else d[ir].duration=ir?d[ir-1].duration:B;d[ir].cts=0,Ba=Xs}}}_=Mt||!_?B:_,this.nextAvcDts=v=o+_,this.videoSampleDuration=_,this.isVideoContiguous=!0;var Xl={data1:bt.moof(e.sequenceNumber++,a,z({},e,{samples:d})),data2:Ge,startPTS:A/l,endPTS:(E+_)/l,startDTS:a/l,endDTS:v/l,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Xl},n.remuxAudio=function(e,t,r,i,a){var o=e.inputTimeScale,l=o/(e.samplerate?e.samplerate:o),u=e.segmentCodec==="aac"?1024:1152,d=u*l,c=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],y=a!==void 0,_=e.samples,A=f?0:8,E=this.nextAudioPts||-1,S=t*o,D=c.baseTime*o/c.timescale;if(this.isAudioContiguous=r=r||_.length&&E>0&&(i&&Math.abs(S-E)<9e3||Math.abs(Qt(_[0].pts-D,S)-E)<20*d),_.forEach(function(Ht){Ht.pts=Qt(Ht.pts-D,S)}),!r||E<0){if(_=_.filter(function(Ht){return Ht.pts>=0}),!_.length)return;E=a===0?0:i&&!y?Math.max(0,S):_[0].pts}if(e.segmentCodec==="aac")for(var R=this.config.maxAudioFramesDrift,O=0,U=E;O<_.length;O++){var B=_[O],Q=B.pts,K=Q-U,q=Math.abs(1e3*K/o);if(K<=-R*d&&y)O===0&&(x.warn("Audio frame @ "+(Q/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*K/o)+" ms."),this.nextAudioPts=E=U=Q);else if(K>=R*d&&q<1e4&&y){var ie=Math.round(K/d);(U=Q-ie*d)<0&&(ie--,U+=d),O===0&&(this.nextAudioPts=E=U),x.warn("[mp4-remuxer]: Injecting "+ie+" audio frame @ "+(U/o).toFixed(3)+"s due to "+Math.round(1e3*K/o)+" ms gap.");for(var J=0;J<ie;J++){var he=Math.max(U,0),be=hs.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);be||(x.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),be=B.unit.subarray()),_.splice(O,0,{unit:be,pts:he}),U+=d,O++}}B.pts=U,U+=d}for(var ge,Ee=null,Le=null,ke=0,Fe=_.length;Fe--;)ke+=_[Fe].unit.byteLength;for(var Ge=0,Ke=_.length;Ge<Ke;Ge++){var $e=_[Ge],Mt=$e.unit,pt=$e.pts;if(Le!==null)v[Ge-1].duration=Math.round((pt-Le)/l);else{if(r&&e.segmentCodec==="aac"&&(pt=E),Ee=pt,!(ke>0))return;ke+=A;try{ge=new Uint8Array(ke)}catch(Ht){return void this.observer.emit(T.ERROR,T.ERROR,{type:Z.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:Ht,bytes:ke,reason:"fail allocating audio mdat "+ke})}f||(new DataView(ge.buffer).setUint32(0,ke),ge.set(bt.types.mdat,4))}ge.set(Mt,A);var rr=Mt.byteLength;A+=rr,v.push(new gs(!0,u,rr,0)),Le=pt}var Jt=v.length;if(Jt){var Zt=v[v.length-1];this.nextAudioPts=E=Le+l*Zt.duration;var yt=f?new Uint8Array(0):bt.moof(e.sequenceNumber++,Ee/l,z({},e,{samples:v}));e.samples=[];var St=Ee/o,lr=E/o,Pr={data1:yt,data2:ge,startPTS:St,endPTS:lr,startDTS:St,endDTS:lr,type:"audio",hasAudio:!0,hasVideo:!1,nb:Jt};return this.isAudioContiguous=!0,Pr}},n.remuxEmptyAudio=function(e,t,r,i){var a=e.inputTimeScale,o=a/(e.samplerate?e.samplerate:a),l=this.nextAudioPts,u=this._initDTS,d=9e4*u.baseTime/u.timescale,c=(l!==null?l:i.startDTS*a)+d,f=i.endDTS*a+d,v=1024*o,y=Math.ceil((f-c)/v),_=hs.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(x.warn("[mp4-remuxer]: remux empty Audio"),_){for(var A=[],E=0;E<y;E++){var S=c+E*v;A.push({unit:_,pts:S,dts:S})}return e.samples=A,this.remuxAudio(e,t,r,!1)}x.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},s}();function Qt(s,n){var e;if(n===null)return s;for(e=n<s?-8589934592:8589934592;Math.abs(s-n)>4294967296;)s+=e;return s}function fs(s,n,e,t){var r=s.samples.length;if(r){for(var i=s.inputTimeScale,a=0;a<r;a++){var o=s.samples[a];o.pts=Qt(o.pts-e.baseTime*i/e.timescale,n*i)/i,o.dts=Qt(o.dts-t.baseTime*i/t.timescale,n*i)/i}var l=s.samples;return s.samples=[],{samples:l}}}function vs(s,n,e){var t=s.samples.length;if(t){for(var r=s.inputTimeScale,i=0;i<t;i++){var a=s.samples[i];a.pts=Qt(a.pts-9e4*e.baseTime/e.timescale,n*r)/r}s.samples.sort(function(l,u){return l.pts-u.pts});var o=s.samples;return s.samples=[],{samples:o}}}var Tr,gs=function(s,n,e,t){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=n,this.size=e,this.cts=t,this.flags=new Zo(s)},Zo=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1},el=function(){function s(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var n=s.prototype;return n.destroy=function(){},n.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},n.resetNextTimestamp=function(){this.lastEndTime=null},n.resetInitSegment=function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(a,o){if(!a||!o)return a;var l=o.keyId;return l&&o.isCommonEncryption&&He(a,["moov","trak"]).forEach(function(u){var d=He(u,["mdia","minf","stbl","stsd"])[0].subarray(8),c=He(d,["enca"]),f=c.length>0;f||(c=He(d,["encv"])),c.forEach(function(v){He(f?v.subarray(28):v.subarray(78),["sinf"]).forEach(function(y){var _=Ri(y);if(_){var A=_.subarray(8,24);A.some(function(E){return E!==0})||(x.log("[eme] Patching keyId in 'enc"+(f?"a":"v")+">sinf>>tenc' box: "+Yt(A)+" -> "+Yt(l)),_.set(l,8))}})})}),a}(e,i)),this.emitInitSegment=!0},n.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(e==null||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Li(e);t||(t=ms(i.audio,Ze)),r||(r=ms(i.video,gt));var a={};i.audio&&i.video?a.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?a.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?a.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:x.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},n.remux=function(e,t,r,i,a,o){var l,u,d=this.initPTS,c=this.lastEndTime,f={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};$(c)||(c=this.lastEndTime=a||0);var v=t.samples;if(v==null||!v.length)return f;var y={initPTS:void 0,timescale:1},_=this.initData;if((l=_)!=null&&l.length||(this.generateInitSegment(v),_=this.initData),(u=_)==null||!u.length)return x.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);var A=function(K,q){for(var ie=0,J=0,he=0,be=He(K,["moof","traf"]),ge=0;ge<be.length;ge++){var Ee=be[ge],Le=He(Ee,["tfhd"])[0],ke=q[Oe(Le,4)];if(ke){var Fe=ke.default,Ge=Oe(Le,0)|(Fe==null?void 0:Fe.flags),Ke=Fe==null?void 0:Fe.duration;8&Ge&&(Ke=Oe(Le,2&Ge?12:8));for(var $e=ke.timescale||9e4,Mt=He(Ee,["trun"]),pt=0;pt<Mt.length;pt++)!(ie=ra(Mt[pt]))&&Ke&&(ie=Ke*Oe(Mt[pt],4)),ke.type===gt?J+=ie/$e:ke.type===Ze&&(he+=ie/$e)}}if(J===0&&he===0){for(var rr=0,Jt=He(K,["sidx"]),Zt=0;Zt<Jt.length;Zt++){var yt=sn(Jt[Zt]);yt!=null&&yt.references&&(rr+=yt.references.reduce(function(St,lr){return St+lr.info.duration||0},0))}return rr}return J||he}(v,_),E=function(K,q){return He(q,["moof","traf"]).reduce(function(ie,J){var he=He(J,["tfdt"])[0],be=he[0],ge=He(J,["tfhd"]).reduce(function(Ee,Le){var ke=Oe(Le,4),Fe=K[ke];if(Fe){var Ge=Oe(he,4);if(be===1){if(Ge===Ur)return x.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),Ee;Ge*=Ur+1,Ge+=Oe(he,8)}var Ke=Ge/(Fe.timescale||9e4);if(isFinite(Ke)&&(Ee===null||Ke<Ee))return Ke}return Ee},null);return ge!==null&&isFinite(ge)&&(ie===null||ge<ie)?ge:ie},null)}(_,v),S=E===null?a:E;(function(K,q,ie,J){if(K===null)return!0;var he=Math.max(J,1),be=q-K.baseTime/K.timescale;return Math.abs(be-ie)>he}(d,S,a,A)||y.timescale!==d.timescale&&o)&&(y.initPTS=S-a,d&&d.timescale===1&&x.warn("Adjusting initPTS by "+(y.initPTS-d.baseTime)),this.initPTS=d={baseTime:y.initPTS,timescale:1});var D=e?S-d.baseTime/d.timescale:c,R=D+A;(function(K,q,ie){He(q,["moof","traf"]).forEach(function(J){He(J,["tfhd"]).forEach(function(he){var be=Oe(he,4),ge=K[be];if(ge){var Ee=ge.timescale||9e4;He(J,["tfdt"]).forEach(function(Le){var ke=Le[0],Fe=Oe(Le,4);if(ke===0)Fe-=ie*Ee,ki(Le,4,Fe=Math.max(Fe,0));else{Fe*=Math.pow(2,32),Fe+=Oe(Le,8),Fe-=ie*Ee,Fe=Math.max(Fe,0);var Ge=Math.floor(Fe/(Ur+1)),Ke=Math.floor(Fe%(Ur+1));ki(Le,4,Ge),ki(Le,8,Ke)}})}})})})(_,v,d.baseTime/d.timescale),A>0?this.lastEndTime=R:(x.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var O=!!_.audio,U=!!_.video,B="";O&&(B+="audio"),U&&(B+="video");var Q={data1:v,startPTS:D,startDTS:D,endPTS:R,endDTS:R,type:B,hasAudio:O,hasVideo:U,nb:1,dropped:0};return f.audio=Q.type==="audio"?Q:void 0,f.video=Q.type!=="audio"?Q:void 0,f.initSegment=y,f.id3=fs(r,a,d,d),i.samples.length&&(f.text=vs(i,a,d)),f},s}();function ms(s,n){var e=s==null?void 0:s.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||n===gt?"avc1.42e01e":"mp4a.40.5"}try{Tr=self.performance.now.bind(self.performance)}catch{x.debug("Unable to use Performance API on this environment"),Tr=typeof self<"u"&&self.Date.now}var Ea=[{demux:Ko,remux:el},{demux:Xo,remux:ya},{demux:Go,remux:ya},{demux:Jo,remux:ya}],Ta=function(){function s(e,t,r,i,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=a}var n=s.prototype;return n.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},n.push=function(e,t,r,i){var a=this,o=r.transmuxing;o.executeStart=Tr();var l=new Uint8Array(e),u=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var c=i||u,f=c.contiguous,v=c.discontinuity,y=c.trackSwitch,_=c.accurateTimeOffset,A=c.timeOffset,E=c.initSegmentChange,S=d.audioCodec,D=d.videoCodec,R=d.defaultInitPts,O=d.duration,U=d.initSegmentData,B=function(be,ge){var Ee=null;return be.byteLength>0&&ge!=null&&ge.key!=null&&ge.iv!==null&&ge.method!=null&&(Ee=ge),Ee}(l,t);if(B&&B.method==="AES-128"){var Q=this.getDecrypter();if(!Q.isSync())return this.decryptionPromise=Q.webCryptoDecrypt(l,B.key.buffer,B.iv.buffer).then(function(be){var ge=a.push(be,null,r);return a.decryptionPromise=null,ge}),this.decryptionPromise;var K=Q.softwareDecrypt(l,B.key.buffer,B.iv.buffer);if(r.part>-1&&(K=Q.flush()),!K)return o.executeEnd=Tr(),_a(r);l=new Uint8Array(K)}var q=this.needsProbing(v,y);if(q){var ie=this.configureTransmuxer(l);if(ie)return x.warn("[transmuxer] "+ie.message),this.observer.emit(T.ERROR,T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:ie,reason:ie.message}),o.executeEnd=Tr(),_a(r)}(v||y||E||q)&&this.resetInitSegment(U,S,D,O,t),(v||E||q)&&this.resetInitialTimestamp(R),f||this.resetContiguity();var J=this.transmux(l,B,A,_,r),he=this.currentTransmuxState;return he.contiguous=!0,he.discontinuity=!1,he.trackSwitch=!1,o.executeEnd=Tr(),J},n.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=Tr();var i=this.decrypter,a=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then(function(){return t.flush(e)});var l=[],u=a.timeOffset;if(i){var d=i.flush();d&&l.push(this.push(d,null,e))}var c=this.demuxer,f=this.remuxer;if(!c||!f)return r.executeEnd=Tr(),[_a(e)];var v=c.flush(u);return $r(v)?v.then(function(y){return t.flushRemux(l,y,e),l}):(this.flushRemux(l,v,e),l)},n.flushRemux=function(e,t,r){var i=t.audioTrack,a=t.videoTrack,o=t.id3Track,l=t.textTrack,u=this.currentTransmuxState,d=u.accurateTimeOffset,c=u.timeOffset;x.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var f=this.remuxer.remux(i,a,o,l,c,d,!0,this.id);e.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=Tr()},n.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},n.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},n.resetInitSegment=function(e,t,r,i,a){var o=this.demuxer,l=this.remuxer;o&&l&&(o.resetInitSegment(e,t,r,i),l.resetInitSegment(e,t,r,a))},n.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},n.transmux=function(e,t,r,i,a){return t&&t.method==="SAMPLE-AES"?this.transmuxSampleAes(e,t,r,i,a):this.transmuxUnencrypted(e,r,i,a)},n.transmuxUnencrypted=function(e,t,r,i){var a=this.demuxer.demux(e,t,!1,!this.config.progressive),o=a.audioTrack,l=a.videoTrack,u=a.id3Track,d=a.textTrack;return{remuxResult:this.remuxer.remux(o,l,u,d,t,r,!1,this.id),chunkMeta:i}},n.transmuxSampleAes=function(e,t,r,i,a){var o=this;return this.demuxer.demuxSampleAes(e,t,r).then(function(l){return{remuxResult:o.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,r,i,!1,o.id),chunkMeta:a}})},n.configureTransmuxer=function(e){for(var t,r=this.config,i=this.observer,a=this.typeSupported,o=this.vendor,l=0,u=Ea.length;l<u;l++)if(Ea[l].demux.probe(e)){t=Ea[l];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,c=this.remuxer,f=t.remux,v=t.demux;c&&c instanceof f||(this.remuxer=new f(i,r,a,o)),d&&d instanceof v||(this.demuxer=new v(i,r,a),this.probe=v.probe)},n.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},n.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new Xt(this.config)),e},s}(),_a=function(s){return{remuxResult:{},chunkMeta:s}};function $r(s){return"then"in s&&s.then instanceof Function}var tl=function(s,n,e,t,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=n,this.initSegmentData=e,this.duration=t,this.defaultInitPts=r||null},rl=function(s,n,e,t,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=n,this.accurateTimeOffset=e,this.trackSwitch=t,this.timeOffset=r,this.initSegmentChange=i},ps={exports:{}};(function(s){var n=Object.prototype.hasOwnProperty,e="~";function t(){}function r(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function i(l,u,d,c,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new r(d,c||l,f),y=e?e+u:u;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],v]:l._events[y].push(v):(l._events[y]=v,l._eventsCount++),l}function a(l,u){--l._eventsCount==0?l._events=new t:delete l._events[u]}function o(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(e=!1)),o.prototype.eventNames=function(){var l,u,d=[];if(this._eventsCount===0)return d;for(u in l=this._events)n.call(l,u)&&d.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(l)):d},o.prototype.listeners=function(l){var u=e?e+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var c=0,f=d.length,v=new Array(f);c<f;c++)v[c]=d[c].fn;return v},o.prototype.listenerCount=function(l){var u=e?e+l:l,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,u,d,c,f,v){var y=e?e+l:l;if(!this._events[y])return!1;var _,A,E=this._events[y],S=arguments.length;if(E.fn){switch(E.once&&this.removeListener(l,E.fn,void 0,!0),S){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,u),!0;case 3:return E.fn.call(E.context,u,d),!0;case 4:return E.fn.call(E.context,u,d,c),!0;case 5:return E.fn.call(E.context,u,d,c,f),!0;case 6:return E.fn.call(E.context,u,d,c,f,v),!0}for(A=1,_=new Array(S-1);A<S;A++)_[A-1]=arguments[A];E.fn.apply(E.context,_)}else{var D,R=E.length;for(A=0;A<R;A++)switch(E[A].once&&this.removeListener(l,E[A].fn,void 0,!0),S){case 1:E[A].fn.call(E[A].context);break;case 2:E[A].fn.call(E[A].context,u);break;case 3:E[A].fn.call(E[A].context,u,d);break;case 4:E[A].fn.call(E[A].context,u,d,c);break;default:if(!_)for(D=1,_=new Array(S-1);D<S;D++)_[D-1]=arguments[D];E[A].fn.apply(E[A].context,_)}}return!0},o.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},o.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},o.prototype.removeListener=function(l,u,d,c){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return a(this,f),this;var v=this._events[f];if(v.fn)v.fn!==u||c&&!v.once||d&&v.context!==d||a(this,f);else{for(var y=0,_=[],A=v.length;y<A;y++)(v[y].fn!==u||c&&!v[y].once||d&&v[y].context!==d)&&_.push(v[y]);_.length?this._events[f]=_.length===1?_[0]:_:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&a(this,u)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})(ps);var On=Te(ps.exports);function ba(s,n){if(!((e=n.remuxResult).audio||e.video||e.text||e.id3||e.initSegment))return!1;var e,t=[],r=n.remuxResult,i=r.audio,a=r.video;return i&&ys(t,i),a&&ys(t,a),s.postMessage({event:"transmuxComplete",data:n},t),!0}function ys(s,n){n.data1&&s.push(n.data1.buffer),n.data2&&s.push(n.data2.buffer)}function Es(s,n,e){n.reduce(function(t,r){return ba(s,r)||t},!1)||s.postMessage({event:"transmuxComplete",data:n[0]}),s.postMessage({event:"flush",data:e})}F!==void 0&&F&&function(s){var n=new On,e=function(r,i){s.postMessage({event:r,data:i})};n.on(T.FRAG_DECRYPTED,e),n.on(T.ERROR,e);var t=function(){var r=function(a){var o=function(l){e("workerLog",{logType:a,message:l})};x[a]=o};for(var i in x)r(i)};s.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var a=JSON.parse(i.config);s.transmuxer=new Ta(n,i.typeSupported,a,i.vendor,i.id),Ve(a.debug,i.id),t(),e("init",null);break;case"configure":s.transmuxer.configure(i.config);break;case"demux":var o=s.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);$r(o)?(s.transmuxer.async=!0,o.then(function(d){ba(s,d)}).catch(function(d){e(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker push error"})})):(s.transmuxer.async=!1,ba(s,o));break;case"flush":var l=i.chunkMeta,u=s.transmuxer.flush(l);$r(u)||s.transmuxer.async?($r(u)||(u=Promise.resolve(u)),u.then(function(d){Es(s,d,l)}).catch(function(d){e(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker flush error"})})):Es(s,u,l)}})}(self);var Sa=ii()||{isTypeSupported:function(){return!1}},Ts=function(){function s(e,t,r,i){var a=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var l=function(A,E){(E=E||{}).frag=a.frag,E.id=a.id,A===T.ERROR&&(a.error=E.error),a.hls.trigger(A,E)};this.observer=new On,this.observer.on(T.FRAG_DECRYPTED,l),this.observer.on(T.ERROR,l);var u,d,c,f,v={mp4:Sa.isTypeSupported("video/mp4"),mpeg:Sa.isTypeSupported("audio/mpeg"),mp3:Sa.isTypeSupported('audio/mp4; codecs="mp3"')},y=navigator.vendor;if(!this.useWorker||typeof Worker>"u"||(o.workerPath,0))this.transmuxer=new Ta(this.observer,v,o,y,t);else try{o.workerPath?(x.log("loading Web Worker "+o.workerPath+' for "'+t+'"'),this.workerContext=(c=o.workerPath,f=new self.URL(c,self.location.href).href,{worker:new self.Worker(f),scriptURL:f})):(x.log('injecting Web Worker for "'+t+'"'),this.workerContext=(u=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+I.toString()+")(true);"],{type:"text/javascript"}),d=self.URL.createObjectURL(u),{worker:new self.Worker(d),objectURL:d})),this.onwmsg=function(A){return a.onWorkerMessage(A)};var _=this.workerContext.worker;_.addEventListener("message",this.onwmsg),_.onerror=function(A){var E=new Error(A.message+"  ("+A.filename+":"+A.lineno+")");o.enableWorker=!1,x.warn('Error in "'+t+'" Web Worker, fallback to inline'),a.hls.trigger(T.ERROR,{type:Z.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:E})},_.postMessage({cmd:"init",typeSupported:v,vendor:y,id:t,config:JSON.stringify(o)})}catch(A){x.warn('Error setting up "'+t+'" Web Worker, fallback to inline',A),this.resetWorker(),this.error=null,this.transmuxer=new Ta(this.observer,v,o,y,t)}}var n=s.prototype;return n.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},n.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},n.push=function(e,t,r,i,a,o,l,u,d,c){var f,v,y=this;d.transmuxing.start=self.performance.now();var _=this.transmuxer,A=o?o.start:a.start,E=a.decryptdata,S=this.frag,D=!(S&&a.cc===S.cc),R=!(S&&d.level===S.level),O=S?d.sn-S.sn:-1,U=this.part?d.part-this.part.index:-1,B=O===0&&d.id>1&&d.id===(S==null?void 0:S.stats.chunkCount),Q=!R&&(O===1||O===0&&(U===1||B&&U<=0)),K=self.performance.now();(R||O||a.stats.parsing.start===0)&&(a.stats.parsing.start=K),!o||!U&&Q||(o.stats.parsing.start=K);var q=!(S&&((f=a.initSegment)==null?void 0:f.url)===((v=S.initSegment)==null?void 0:v.url)),ie=new rl(D,Q,u,R,A,q);if(!Q||D||q){x.log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+d.sn+" p: "+d.part+" level: "+d.level+" id: "+d.id+`
        discontinuity: `+D+`
        trackSwitch: `+R+`
        contiguous: `+Q+`
        accurateTimeOffset: `+u+`
        timeOffset: `+A+`
        initSegmentChange: `+q);var J=new tl(r,i,t,l,c);this.configureTransmuxer(J)}if(this.frag=a,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:E,chunkMeta:d,state:ie},e instanceof ArrayBuffer?[e]:[]);else if(_){var he=_.push(e,E,d,ie);$r(he)?(_.async=!0,he.then(function(be){y.handleTransmuxComplete(be)}).catch(function(be){y.transmuxerError(be,d,"transmuxer-interface push error")})):(_.async=!1,this.handleTransmuxComplete(he))}},n.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e);$r(i)||r.async?($r(i)||(i=Promise.resolve(i)),i.then(function(a){t.handleFlushResult(a,e)}).catch(function(a){t.transmuxerError(a,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}},n.transmuxerError=function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))},n.handleFlushResult=function(e,t){var r=this;e.forEach(function(i){r.handleTransmuxComplete(i)}),this.onFlush(t)},n.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var i,a=(i=this.workerContext)==null?void 0:i.objectURL;a&&self.URL.revokeObjectURL(a);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":x[t.data.logType]&&x[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},n.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},n.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},s}(),il=function(){function s(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var n=s.prototype;return n.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},n.poll=function(e,t){var r=this.config,i=this.media,a=this.stalled;if(i!==null){var o=i.currentTime,l=i.seeking,u=this.seeking&&!l,d=!this.seeking&&l;if(this.seeking=l,o===e){if(d||u)this.stalled=null;else if(!(i.paused&&!l||i.ended||i.playbackRate===0)&&ne.getBuffered(i).length){var c=ne.bufferInfo(i,o,0),f=c.len>0,v=c.nextStart||0;if(f||v){if(l){var y=c.len>2,_=!v||t&&t.start<=o||v-o>2&&!this.fragmentTracker.getPartialFragment(o);if(y||_)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var A,E=Math.max(v,c.start||0)-o,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,D=!(S==null||(A=S.details)==null)&&A.live?2*S.details.targetduration:2,R=this.fragmentTracker.getPartialFragment(o);if(E>0&&(E<=D||R))return void this._trySkipBufferHole(R)}var O=self.performance.now();if(a!==null){var U=O-a;if(l||!(U>=250)||(this._reportStall(c),this.media)){var B=ne.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(B,U)}}else this.stalled=O}}}else if(this.moved=!0,a!==null){if(this.stallReported){var Q=self.performance.now()-a;x.warn("playback not stuck anymore @"+o+", after "+Math.round(Q)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},n._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,a=this.media;if(a!==null){var o=a.currentTime,l=i.getPartialFragment(o);if(l&&(this._trySkipBufferHole(l)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(x.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},n._reportStall=function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var i=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")");x.warn(i.message),t.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}},n._trySkipBufferHole=function(e){var t=this.config,r=this.hls,i=this.media;if(i===null)return 0;var a=i.currentTime,o=ne.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l){var u=o.len<=t.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,c=l-a;if(c>0&&(u||d)){if(c>t.maxBufferHole){var f=this.fragmentTracker,v=!1;if(a===0){var y=f.getAppendedFrag(0,ze);y&&l<y.end&&(v=!0)}if(!v){var _=e||f.getAppendedFrag(a,ze);if(_){for(var A=!1,E=_.end;E<l;){var S=f.getPartialFragment(E);if(!S){A=!0;break}E+=S.duration}if(A)return 0}}}var D=Math.max(l+.05,a+.1);if(x.warn("skipping hole, adjusting currentTime from "+a+" to "+D),this.moved=!0,this.stalled=null,i.currentTime=D,e&&!e.gap){var R=new Error("fragment loaded with buffer holes, seeking from "+a+" to "+D);r.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:R,reason:R.message,frag:e})}return D}}return 0},n._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry;if(r!==null){var a=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var o=a+(i+1)*e.nudgeOffset,l=new Error("Nudging 'currentTime' from "+a+" to "+o);x.warn(l.message),r.currentTime=o,t.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1})}else{var u=new Error("Playhead still not moving while enough data buffered @"+a+" after "+e.nudgeMaxRetry+" nudges");x.error(u.message),t.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:u,fatal:!0})}}},s}(),nl=function(s){function n(t,r,i){var a;return(a=s.call(this,t,r,i,"[stream-controller]",ze)||this).audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.couldBacktrack=!1,a.backtrackFragment=null,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}te(n,s);var e=n.prototype;return e._registerListeners=function(){var t=this.hls;t.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.MANIFEST_PARSED,this.onManifestParsed,this),t.on(T.LEVEL_LOADING,this.onLevelLoading,this),t.on(T.LEVEL_LOADED,this.onLevelLoaded,this),t.on(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(T.ERROR,this.onError,this),t.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(T.BUFFER_CREATED,this.onBufferCreated,this),t.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(T.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(T.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.MANIFEST_PARSED,this.onManifestParsed,this),t.off(T.LEVEL_LOADED,this.onLevelLoaded,this),t.off(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(T.ERROR,this.onError,this),t.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(T.BUFFER_CREATED,this.onBufferCreated,this),t.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(T.FRAG_BUFFERED,this.onFragBuffered,this)},e.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},e.startLoad=function(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var a=i.startLevel;a===-1&&(i.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=i.nextAutoLevel),this.level=i.nextLoadLevel=a,this.loadedmetadata=!1}r>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=me,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=vt},e.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},e.doTick=function(){switch(this.state){case gi:var t,r=this.levels,i=this.level,a=r==null||(t=r[i])==null?void 0:t.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=me;break}if(this.hls.nextLoadLevel!==this.level){this.state=me;break}break;case Ir:var o,l=self.performance.now(),u=this.retryDate;(!u||l>=u||(o=this.media)!=null&&o.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=me)}this.state===me&&this.doTickIdle(),this.onTickEnd()},e.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},e.doTickIdle=function(){var t=this.hls,r=this.levelLastLoaded,i=this.levels,a=this.media,o=t.config,l=t.nextLoadLevel;if(r!==null&&(a||!this.startFragRequested&&o.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&i!=null&&i[l]){var u=i[l],d=this.getMainFwdBufferInfo();if(d!==null){var c=this.getLevelDetails();if(c&&this._streamEnded(d,c)){var f={};return this.altAudio&&(f.type="video"),this.hls.trigger(T.BUFFER_EOS,f),void(this.state=Bi)}t.loadLevel!==l&&t.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=t.nextLoadLevel=l;var v=u.details;if(!v||this.state===gi||v.live&&this.levelLastLoaded!==l)return this.level=l,void(this.state=gi);var y=d.len,_=this.getMaxBufferLength(u.maxBitrate);if(!(y>=_)){this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);var A=this.backtrackFragment?this.backtrackFragment.start:d.end,E=this.getNextFragment(A,v);if(this.couldBacktrack&&!this.fragPrevious&&E&&E.sn!=="initSegment"&&this.fragmentTracker.getState(E)!==Ce){var S,D=((S=this.backtrackFragment)!=null?S:E).sn-v.startSN,R=v.fragments[D-1];R&&E.cc===R.cc&&(E=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,A)){if(!E.gap){var O=this.audioOnly&&!this.altAudio?Ze:gt,U=(O===gt?this.videoBuffer:this.mediaBuffer)||this.media;U&&this.afterBufferFlushed(U,O,ze)}E=this.getNextFragmentLoopLoading(E,v,d,ze,_)}E&&(!E.initSegment||E.initSegment.data||this.bitrateTest||(E=E.initSegment),this.loadFragment(E,u,A))}}}},e.loadFragment=function(t,r,i){var a=this.fragmentTracker.getState(t);this.fragCurrent=t,a===W||a===pe?t.sn==="initSegment"?this._loadInitSegment(t,r):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,ze)},e.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},e.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.nextLevelSwitch=function(){var t=this.levels,r=this.media;if(r!=null&&r.readyState){var i,a=this.getAppendedFrag(r.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);var o=this.getLevelDetails();if(o!=null&&o.live){var l=this.getMainFwdBufferInfo();if(!l||l.len<2*o.targetduration)return}if(!r.paused&&t){var u=t[this.hls.nextLoadLevel],d=this.fragLastKbps;i=d&&this.fragCurrent?this.fragCurrent.duration*u.maxBitrate/(1e3*d)+1:0}else i=0;var c=this.getBufferedFrag(r.currentTime+i);if(c){var f=this.followingBufferedFrag(c);if(f){this.abortCurrentFrag();var v=f.maxStartPTS?f.maxStartPTS:f.start,y=f.duration,_=Math.max(c.end,v+Math.min(Math.max(y-this.config.maxFragLookUpTolerance,.5*y),.75*y));this.flushMainBuffer(_,Number.POSITIVE_INFINITY)}}}},e.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case yr:case Dr:case Ir:case Er:case Dn:this.state=me}this.nextLoadPosition=this.getLoadPosition()},e.flushMainBuffer=function(t,r){s.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},e.onMediaAttached=function(t,r){s.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new il(this.config,i,this.fragmentTracker,this.hls)},e.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},e.onMediaPlaying=function(){this.tick()},e.onMediaSeeked=function(){var t=this.media,r=t?t.currentTime:null;$(r)&&this.log("Media seeked to "+r.toFixed(3));var i=this.getMainFwdBufferInfo();i!==null&&i.len!==0?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},e.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(T.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},e.onManifestParsed=function(t,r){var i,a,o,l=!1,u=!1;r.levels.forEach(function(d){(i=d.audioCodec)&&(i.indexOf("mp4a.40.2")!==-1&&(l=!0),i.indexOf("mp4a.40.5")!==-1&&(u=!0))}),this.audioCodecSwitch=l&&u&&typeof((o=ts())==null||(a=o.prototype)==null?void 0:a.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},e.onLevelLoading=function(t,r){var i=this.levels;if(i&&this.state===me){var a=i[r.level];(!a.details||a.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(a.details))&&(this.state=gi)}},e.onLevelLoaded=function(t,r){var i,a=this.levels,o=r.level,l=r.details,u=l.totalduration;if(a){this.log("Level "+o+" loaded ["+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+", cc ["+l.startCC+", "+l.endCC+"] duration:"+u);var d=a[o],c=this.fragCurrent;!c||this.state!==Dr&&this.state!==Ir||c.level===r.level&&c.urlId===d.urlId||!c.loader||this.abortCurrentFrag();var f=0;if(l.live||(i=d.details)!=null&&i.live){if(l.fragments[0]||(l.deltaUpdateFailed=!0),l.deltaUpdateFailed)return;f=this.alignPlaylists(l,d.details)}if(d.details=l,this.levelLastLoaded=o,this.hls.trigger(T.LEVEL_UPDATED,{details:l,level:o}),this.state===gi){if(this.waitForCdnTuneIn(l))return;this.state=me}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,f),this.tick()}else this.warn("Levels were reset while loading level "+o)},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,a=t.part,o=t.payload,l=this.levels;if(l){var u=l[i.level],d=u.details;if(!d)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var c=u.videoCodec,f=d.PTSKnown||!d.live,v=(r=i.initSegment)==null?void 0:r.data,y=this._getAudioCodec(u),_=this.transmuxer=this.transmuxer||new Ts(this.hls,ze,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),A=a?a.index:-1,E=A!==-1,S=new se(i.level,i.sn,i.stats.chunkCount,o.byteLength,A,E),D=this.initPTS[i.cc];_.push(o,v,y,c,i,a,d.totalduration,f,S,D)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e.onAudioTrackSwitching=function(t,r){var i=this.altAudio;if(!r.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;i&&(o.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(T.AUDIO_TRACK_SWITCHED,r)}},e.onAudioTrackSwitched=function(t,r){var i=r.id,a=!!this.hls.audioTracks[i].url;if(a){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=a,this.tick()},e.onBufferCreated=function(t,r){var i,a,o=r.tracks,l=!1;for(var u in o){var d=o[u];if(d.id==="main"){if(a=u,i=d,u==="video"){var c=o[u];c&&(this.videoBuffer=c.buffer)}}else l=!0}l&&i?(this.log("Alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.onFragBuffered=function(t,r){var i=r.frag,a=r.part;if(!i||i.type===ze){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Dn&&(this.state=me));var o=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}},e.onError=function(t,r){var i;if(r.fatal)this.state=vi;else switch(r.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ze,r);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==gi||((i=r.context)==null?void 0:i.type)!==pr||(this.state=me);break;case N.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.checkBuffer=function(){var t=this.media,r=this.gapController;if(t&&r&&t.readyState){if(this.loadedmetadata||!ne.getBuffered(t).length){var i=this.state!==me?this.fragCurrent:null;r.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}},e.onFragLoadEmergencyAborted=function(){this.state=me,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},e.onBufferFlushed=function(t,r){var i=r.type;if(i!==Ze||this.audioOnly&&!this.altAudio){var a=(i===gt?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,i,ze)}},e.onLevelsUpdated=function(t,r){this.levels=r.levels},e.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.seekToStartPos=function(){var t=this.media;if(t){var r=t.currentTime,i=this.startPosition;if(i>=0&&r<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+r);var a=ne.getBuffered(t),o=(a.length?a.start(0):0)-i;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+o+" to match buffer start"),i+=o,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),t.currentTime=i}}},e._getAudioCodec=function(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=r.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),r},e._loadBitrateTestFrag=function(t,r){var i=this;t.bitrateTest=!0,this._doFragLoad(t,r).then(function(a){var o=i.hls;if(a&&!i.fragContextChanged(t)){r.fragmentError=0,i.state=me,i.startFragRequested=!1,i.bitrateTest=!1;var l=t.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),o.trigger(T.FRAG_LOADED,a),t.bitrateTest=!1}})},e._handleTransmuxComplete=function(t){var r,i="main",a=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(u){var d=u.frag,c=u.part,f=u.level,v=o.video,y=o.text,_=o.id3,A=o.initSegment,E=f.details,S=this.altAudio?void 0:o.audio;if(this.fragContextChanged(d))this.fragmentTracker.removeFragment(d);else{if(this.state=Er,A){if(A!=null&&A.tracks){var D=d.initSegment||d;this._bufferInitSegment(f,A.tracks,D,l),a.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:i,tracks:A.tracks})}var R=A.initPTS,O=A.timescale;$(R)&&(this.initPTS[d.cc]={baseTime:R,timescale:O},a.trigger(T.INIT_PTS_FOUND,{frag:d,id:i,initPTS:R,timescale:O}))}if(v&&o.independent!==!1){if(E){var U=v.startPTS,B=v.endPTS,Q=v.startDTS,K=v.endDTS;if(c)c.elementaryStreams[v.type]={startPTS:U,endPTS:B,startDTS:Q,endDTS:K};else if(v.firstKeyFrame&&v.independent&&l.id===1&&(this.couldBacktrack=!0),v.dropped&&v.independent){var q=this.getMainFwdBufferInfo();if((q?q.end:this.getLoadPosition())+this.config.maxBufferHole<(v.firstKeyFramePTS?v.firstKeyFramePTS:U)-this.config.maxBufferHole)return void this.backtrack(d);d.setElementaryStreamInfo(v.type,d.start,B,d.start,K,!0)}d.setElementaryStreamInfo(v.type,U,B,Q,K),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(v,d,c,l)}}else if(o.independent===!1)return void this.backtrack(d);if(S){var ie=S.startPTS,J=S.endPTS,he=S.startDTS,be=S.endDTS;c&&(c.elementaryStreams[Ze]={startPTS:ie,endPTS:J,startDTS:he,endDTS:be}),d.setElementaryStreamInfo(Ze,ie,J,he,be),this.bufferFragmentData(S,d,c,l)}if(E&&_!=null&&(r=_.samples)!=null&&r.length){var ge={id:i,frag:d,details:E,samples:_.samples};a.trigger(T.FRAG_PARSING_METADATA,ge)}if(E&&y){var Ee={id:i,frag:d,details:E,samples:y.samples};a.trigger(T.FRAG_PARSING_USERDATA,Ee)}}}else this.resetWhenMissingContext(l)},e._bufferInitSegment=function(t,r,i,a){var o=this;if(this.state===Er){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var l=r.audio,u=r.video,d=r.audiovideo;if(l){var c=t.audioCodec,f=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(c&&(c=c.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),l.metadata.channelCount!==1&&f.indexOf("firefox")===-1&&(c="mp4a.40.5")),f.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),t.audioCodec&&t.audioCodec!==c&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+c+'"'),l.levelCodec=c,l.id="main",this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(t.audioCodec||"")+"/"+l.codec+"]")}u&&(u.levelCodec=t.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+u.codec+"]")),d&&this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+d.codec+"]"),this.hls.trigger(T.BUFFER_CODECS,r),Object.keys(r).forEach(function(v){var y=r[v].initSegment;y!=null&&y.byteLength&&o.hls.trigger(T.BUFFER_APPENDING,{type:v,data:y,frag:i,part:null,chunkMeta:a,parent:i.type})}),this.tick()}},e.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,ze)},e.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=me},e.checkFragmentChanged=function(){var t=this.media,r=null;if(t&&t.readyState>1&&t.seeking===!1){var i=t.currentTime;if(ne.isBuffered(t,i)?r=this.getAppendedFrag(i):ne.isBuffered(t,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){this.backtrackFragment=null;var a=this.fragPlaying,o=r.level;a&&r.sn===a.sn&&a.level===o&&r.urlId===a.urlId||(this.fragPlaying=r,this.hls.trigger(T.FRAG_CHANGED,{frag:r}),a&&a.level===o||this.hls.trigger(T.LEVEL_SWITCHED,{level:o}))}}},Y(n,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var r=t.currentTime,i=this.currentFrag;if(i&&$(r)&&$(i.programDateTime)){var a=i.programDateTime+1e3*(r-i.start);return new Date(a)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),n}(ca),pi=function(){function s(e,t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var n=s.prototype;return n.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},n.getTotalWeight=function(){return this.totalWeight_},n.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},s}(),al=function(){function s(e,t,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new pi(e),this.fast_=new pi(t),this.defaultTTFB_=i,this.ttfb_=new pi(e)}var n=s.prototype;return n.update=function(e,t){var r=this.slow_,i=this.fast_,a=this.ttfb_;r.halfLife!==e&&(this.slow_=new pi(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new pi(t,i.getEstimate(),i.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new pi(e,a.getEstimate(),a.getTotalWeight()))},n.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},n.sampleTTFB=function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))},n.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},n.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},n.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},n.destroy=function(){},s}(),sl=function(){function s(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new al(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this)},n.unregisterListeners=function(){var e=this.hls;e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this)},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},n.onFragLoading=function(e,t){var r,i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},n.onLevelSwitching=function(e,t){this.clearTimer()},n.getTimeToLoadFrag=function(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)},n.onLevelLoaded=function(e,t){var r=this.hls.config,i=t.stats,a=i.total,o=i.bwEstimate;$(a)&&$(o)&&(this.lastLevelLoadSec=8*a/o),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},n._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,a=r.media;if(e&&a){var o=performance.now(),l=t?t.stats:e.stats,u=t?t.duration:e.duration,d=o-l.loading.start;if(l.aborted||l.loaded&&l.loaded===l.total||e.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!a.paused&&a.playbackRate&&a.readyState){var c=r.mainForwardBufferInfo;if(c!==null){var f=this.bwEstimator.getEstimateTTFB(),v=Math.abs(a.playbackRate);if(!(d<=Math.max(f,u/(2*v)*1e3))){var y=c.len/v;if(!(y>=2*u/v)){var _=l.loading.first?l.loading.first-l.loading.start:-1,A=l.loaded&&_>-1,E=this.bwEstimator.getEstimate(),S=r.levels,D=r.minAutoLevel,R=S[e.level],O=l.total||Math.max(l.loaded,Math.round(u*R.maxBitrate/8)),U=d-_;U<1&&A&&(U=Math.min(d,8*l.loaded/E));var B=A?1e3*l.loaded/U:0,Q=B?(O-l.loaded)/B:8*O/E+f/1e3;if(!(Q<=y)){var K,q=B?8*B:E,ie=Number.POSITIVE_INFINITY;for(K=e.level-1;K>D;K--){var J=S[K].maxBitrate;if((ie=this.getTimeToLoadFrag(f/1e3,q,u*J,!S[K].details))<y)break}ie>=Q||ie>10*u||(r.nextLoadLevel=K,A?this.bwEstimator.sample(d-Math.min(f,_),l.loaded):this.bwEstimator.sampleTTFB(d),this.clearTimer(),x.warn("[abr] Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+` is loading too slowly;
      Time to underbuffer: `+y.toFixed(3)+` s
      Estimated load time for current fragment: `+Q.toFixed(3)+` s
      Estimated load time for down switch fragment: `+ie.toFixed(3)+` s
      TTFB estimate: `+_+`
      Current BW estimate: `+($(E)?(E/1024).toFixed(3):"Unknown")+` Kb/s
      New BW estimate: `+(this.bwEstimator.getEstimate()/1024).toFixed(3)+` Kb/s
      Aborting and switching to level `+K),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(T.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:l}))}}}}}}},n.onFragLoaded=function(e,t){var r=t.frag,i=t.part,a=i?i.stats:r.stats;if(r.type===ze&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=i?i.duration:r.duration,l=this.hls.levels[r.level],u=(l.loaded?l.loaded.bytes:0)+a.loaded,d=(l.loaded?l.loaded.duration:0)+o;l.loaded={bytes:u,duration:d},l.realBitrate=Math.round(8*u/d)}if(r.bitrateTest){var c={stats:a,frag:r,part:i,id:r.type};this.onFragBuffered(T.FRAG_BUFFERED,c),r.bitrateTest=!1}}},n.onFragBuffered=function(e,t){var r=t.frag,i=t.part,a=i!=null&&i.stats.loaded?i.stats:r.stats;if(!a.aborted&&!this.ignoreFragment(r)){var o=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},n.ignoreFragment=function(e){return e.type!==ze||e.sn==="initSegment"},n.clearTimer=function(){self.clearInterval(this.timer)},n.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,a=r.config,o=r.minAutoLevel,l=r.media,u=t?t.duration:e?e.duration:0,d=l&&l.playbackRate!==0?Math.abs(l.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,f=r.mainForwardBufferInfo,v=(f?f.len:0)/d,y=this.findBestLevel(c,o,i,v,a.abrBandWidthFactor,a.abrBandWidthUpFactor);if(y>=0)return y;x.trace("[abr] "+(v?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var _=u?Math.min(u,a.maxStarvationDelay):a.maxStarvationDelay,A=a.abrBandWidthFactor,E=a.abrBandWidthUpFactor;if(!v){var S=this.bitrateTestDelay;S&&(_=(u?Math.min(u,a.maxLoadingDelay):a.maxLoadingDelay)-S,x.trace("[abr] bitrate test took "+Math.round(1e3*S)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*_)+" ms"),A=E=1)}return y=this.findBestLevel(c,o,i,v+_,A,E),Math.max(y,0)},n.findBestLevel=function(e,t,r,i,a,o){for(var l,u=this.fragCurrent,d=this.partCurrent,c=this.lastLoadedFragLevel,f=this.hls.levels,v=f[c],y=!(v==null||(l=v.details)==null||!l.live),_=v==null?void 0:v.codecSet,A=d?d.duration:u?u.duration:0,E=this.bwEstimator.getEstimateTTFB()/1e3,S=t,D=-1,R=r;R>=t;R--){var O=f[R];if(!O||_&&O.codecSet!==_)O&&(S=Math.min(R,S),D=Math.max(R,D));else{D!==-1&&x.trace("[abr] Skipped level(s) "+S+"-"+D+' with CODECS:"'+f[D].attrs.CODECS+'"; not compatible with "'+v.attrs.CODECS+'"');var U=O.details,B=(d?U==null?void 0:U.partTarget:U==null?void 0:U.averagetargetduration)||A,Q=void 0;Q=R<=c?a*e:o*e;var K=f[R].maxBitrate,q=this.getTimeToLoadFrag(E,Q,K*B,U===void 0);if(x.trace("[abr] level:"+R+" adjustedbw-bitrate:"+Math.round(Q-K)+" avgDuration:"+B.toFixed(1)+" maxFetchDuration:"+i.toFixed(1)+" fetchDuration:"+q.toFixed(1)),Q>K&&(q===0||!$(q)||y&&!this.bitrateTestDelay||q<i))return R}}return-1},Y(s,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();if(e!==-1){var i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return e!==-1&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}]),s}(),_s=function(){function s(){this.chunks=[],this.dataLength=0}var n=s.prototype;return n.push=function(e){this.chunks.push(e),this.dataLength+=e.length},n.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=t.length===1?t[0]:function(i,a){for(var o=new Uint8Array(a),l=0,u=0;u<i.length;u++){var d=i[u];o.set(d,l),l+=d.length}return o}(t,r),this.reset(),e):new Uint8Array(0)},n.reset=function(){this.chunks.length=0,this.dataLength=0},s}(),ol=function(s){function n(t,r,i){var a;return(a=s.call(this,t,r,i,"[audio-stream-controller]",Gt)||this).videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.bufferedTrack=null,a.switchingTrack=null,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}te(n,s);var e=n.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},e._registerListeners=function(){var t=this.hls;t.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.LEVEL_LOADED,this.onLevelLoaded,this),t.on(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(T.ERROR,this.onError,this),t.on(T.BUFFER_RESET,this.onBufferReset,this),t.on(T.BUFFER_CREATED,this.onBufferCreated,this),t.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(T.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(T.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.LEVEL_LOADED,this.onLevelLoaded,this),t.off(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(T.ERROR,this.onError,this),t.off(T.BUFFER_RESET,this.onBufferReset,this),t.off(T.BUFFER_CREATED,this.onBufferCreated,this),t.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(T.FRAG_BUFFERED,this.onFragBuffered,this)},e.onInitPtsFound=function(t,r){var i=r.frag,a=r.id,o=r.initPTS,l=r.timescale;if(a==="main"){var u=i.cc;this.initPTS[i.cc]={baseTime:o,timescale:l},this.log("InitPTS for cc: "+u+" found from main: "+o),this.videoTrackCC=u,this.state===Gi&&this.tick()}},e.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=vt);var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r,this.state=me):(this.loadedmetadata=!1,this.state=Qr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.doTick=function(){switch(this.state){case me:this.doTickIdle();break;case Qr:var t,r=this.levels,i=this.trackId,a=r==null||(t=r[i])==null?void 0:t.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=Gi}break;case Ir:var o,l=performance.now(),u=this.retryDate;(!u||l>=u||(o=this.media)!=null&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=me);break;case Gi:var d=this.waitingData;if(d){var c=d.frag,f=d.part,v=d.cache,y=d.complete;if(this.initPTS[c.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Dr;var _={frag:c,part:f,payload:v.flush(),networkDetails:null};this._handleFragmentLoadProgress(_),y&&s.prototype._handleFragmentLoadComplete.call(this,_)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+c.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var A=this.getLoadPosition(),E=ne.bufferInfo(this.mediaBuffer,A,this.config.maxBufferHole);Ui(E.end,this.config.maxFragLookUpTolerance,c)<0&&(this.log("Waiting fragment cc ("+c.cc+") @ "+c.start+" cancelled because another fragment at "+E.end+" is needed"),this.clearWaitingFragment())}}else this.state=me}this.onTickEnd()},e.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=me)},e.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},e.onTickEnd=function(){var t=this.media;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)},e.doTickIdle=function(){var t=this.hls,r=this.levels,i=this.media,a=this.trackId,o=t.config;if(r!=null&&r[a]&&(i||!this.startFragRequested&&o.startFragPrefetch)){var l=r[a],u=l.details;if(!u||u.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(u))this.state=Qr;else{var d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Ze,Gt));var c=this.getFwdBufferInfo(d,Gt);if(c!==null){var f=this.bufferedTrack,v=this.switchingTrack;if(!v&&this._streamEnded(c,u))return t.trigger(T.BUFFER_EOS,{type:"audio"}),void(this.state=Bi);var y=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,ze),_=c.len,A=this.getMaxBufferLength(y==null?void 0:y.len);if(!(_>=A)||v){var E=u.fragments[0].start,S=c.end;if(v&&i){var D=this.getLoadPosition();f&&v.attrs!==f.attrs&&(S=D),u.PTSKnown&&D<E&&(c.end>E||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=E+.05)}var R=this.getNextFragment(S,u),O=!1;if(R&&this.isLoopLoading(R,S)&&(O=!!R.gap,R=this.getNextFragmentLoopLoading(R,u,c,ze,A)),R){var U=y&&R.start>y.end+u.targetduration;if(U||(y==null||!y.len)&&c.len){var B=this.getAppendedFrag(R.start,ze);if(B===null||(O||(O=!!B.gap||!!U&&y.len===0),U&&!O||O&&c.nextStart&&c.nextStart<B.end))return}this.loadFragment(R,l,S)}else this.bufferFlushed=!0}}}}},e.getMaxBufferLength=function(t){var r=s.prototype.getMaxBufferLength.call(this);return t?Math.min(Math.max(r,t),this.config.maxMaxBufferLength):r},e.onMediaDetaching=function(){this.videoBuffer=null,s.prototype.onMediaDetaching.call(this)},e.onAudioTracksUpdated=function(t,r){var i=r.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(a){return new Wr(a)})},e.onAudioTrackSwitching=function(t,r){var i=!!r.url;this.trackId=r.id;var a=this.fragCurrent;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=r,this.state=me):(this.switchingTrack=null,this.bufferedTrack=r,this.state=vt),this.tick()},e.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},e.onLevelLoaded=function(t,r){this.mainDetails=r.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(T.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},e.onAudioTrackLoaded=function(t,r){var i;if(this.mainDetails!=null){var a=this.levels,o=r.details,l=r.id;if(a){this.log("Track "+l+" loaded ["+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+",duration:"+o.totalduration);var u=a[l],d=0;if(o.live||(i=u.details)!=null&&i.live){var c=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!c)return;!u.details&&o.hasProgramDateTime&&c.hasProgramDateTime?(ct(o,c),d=o.fragments[0].start):d=this.alignPlaylists(o,u.details)}u.details=o,this.levelLastLoaded=l,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(u.details,d),this.state!==Qr||this.waitForCdnTuneIn(o)||(this.state=me),this.tick()}else this.warn("Audio tracks were reset while loading level "+l)}else this.cachedTrackLoadedData=r},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,a=t.part,o=t.payload,l=this.config,u=this.trackId,d=this.levels;if(d){var c=d[u];if(c){var f=c.details;if(!f)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);var v=l.defaultAudioCodec||c.audioCodec||"mp4a.40.2",y=this.transmuxer;y||(y=this.transmuxer=new Ts(this.hls,Gt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var _=this.initPTS[i.cc],A=(r=i.initSegment)==null?void 0:r.data;if(_!==void 0){var E=a?a.index:-1,S=E!==-1,D=new se(i.level,i.sn,i.stats.chunkCount,o.byteLength,E,S);y.push(o,A,v,"",i,a,f.totalduration,!1,D,_)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+f.startSN+" ,"+f.endSN+"],track "+u),(this.waitingData=this.waitingData||{frag:i,part:a,cache:new _s,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=Gi}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:s.prototype._handleFragmentLoadComplete.call(this,t)},e.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.onBufferCreated=function(t,r){var i=r.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer||null)},e.onFragBuffered=function(t,r){var i=r.frag,a=r.part;if(i.type===Gt)if(this.fragContextChanged(i))this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if(i.sn!=="initSegment"){this.fragPrevious=i;var o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(T.AUDIO_TRACK_SWITCHED,j({},o)))}this.fragBufferedComplete(i,a)}else if(!this.loadedmetadata&&i.type===ze){var l=this.videoBuffer||this.media;l&&ne.getBuffered(l).length&&(this.loadedmetadata=!0)}},e.onError=function(t,r){var i;if(r.fatal)this.state=vi;else switch(r.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Gt,r);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==Qr||((i=r.context)==null?void 0:i.type)!==zt||(this.state=me);break;case N.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="audio")return;this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.onBufferFlushed=function(t,r){r.type===Ze&&(this.bufferFlushed=!0,this.state===Bi&&(this.state=me))},e._handleTransmuxComplete=function(t){var r,i="audio",a=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(u){var d=u.frag,c=u.part,f=u.level.details,v=o.audio,y=o.text,_=o.id3,A=o.initSegment;if(!this.fragContextChanged(d)&&f){if(this.state=Er,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){var E=d.initSegment||d;this._bufferInitSegment(A.tracks,E,l),a.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:A.tracks})}if(v){var S=v.startPTS,D=v.endPTS,R=v.startDTS,O=v.endDTS;c&&(c.elementaryStreams[Ze]={startPTS:S,endPTS:D,startDTS:R,endDTS:O}),d.setElementaryStreamInfo(Ze,S,D,R,O),this.bufferFragmentData(v,d,c,l)}if(_!=null&&(r=_.samples)!=null&&r.length){var U=z({id:i,frag:d,details:f},_);a.trigger(T.FRAG_PARSING_METADATA,U)}if(y){var B=z({id:i,frag:d,details:f},y);a.trigger(T.FRAG_PARSING_USERDATA,B)}}else this.fragmentTracker.removeFragment(d)}else this.resetWhenMissingContext(l)},e._bufferInitSegment=function(t,r,i){if(this.state===Er){t.video&&delete t.video;var a=t.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(T.BUFFER_CODECS,t);var o=a.initSegment;if(o!=null&&o.byteLength){var l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:o};this.hls.trigger(T.BUFFER_APPENDING,l)}this.tick()}}},e.loadFragment=function(t,r,i){var a,o=this.fragmentTracker.getState(t);this.fragCurrent=t,this.switchingTrack||o===W||o===pe?t.sn==="initSegment"?this._loadInitSegment(t,r):(a=r.details)!=null&&a.live&&!this.initPTS[t.cc]?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=Gi):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.completeAudioSwitch=function(t){var r=this.hls,i=this.media,a=this.bufferedTrack,o=a==null?void 0:a.attrs,l=t.attrs;i&&o&&(o.CHANNELS!==l.CHANNELS||o.NAME!==l.NAME||o.LANGUAGE!==l.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,r.trigger(T.AUDIO_TRACK_SWITCHED,j({},t))},n}(ca),ll=function(s){function n(t){var r;return(r=s.call(this,t,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}te(n,s);var e=n.prototype;return e.registerListeners=function(){var t=this.hls;t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.MANIFEST_PARSED,this.onManifestParsed,this),t.on(T.LEVEL_LOADING,this.onLevelLoading,this),t.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(T.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(T.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.MANIFEST_PARSED,this.onManifestParsed,this),t.off(T.LEVEL_LOADING,this.onLevelLoading,this),t.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(T.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,s.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.audioTracks||[]},e.onAudioTrackLoaded=function(t,r){var i=r.id,a=r.groupId,o=r.details,l=this.tracksInGroup[i];if(l&&l.groupId===a){var u=l.details;l.details=r.details,this.log("audio-track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+a+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,u)}else this.warn("Track with id:"+i+" and group:"+a+" not found in active group "+l.groupId)},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r!=null&&r.audioGroupIds){var i=r.audioGroupIds[r.urlId];if(this.groupId!==i){this.groupId=i||null;var a=this.tracks.filter(function(l){return!i||l.groupId===i});this.selectDefaultTrack&&!a.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=a;var o={audioTracks:a};this.log("Updating audio tracks, "+a.length+" track(s) found in group:"+i),this.hls.trigger(T.AUDIO_TRACKS_UPDATED,o),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===zt&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(r))},e.setAudioTrack=function(t){var r=this.tracksInGroup;if(t<0||t>=r.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var i=this.currentTrack;r[this.trackId];var a=r[t],o=a.groupId,l=a.name;if(this.log("Switching to audio-track "+t+' "'+l+'" lang:'+a.lang+" group:"+o),this.trackId=t,this.currentTrack=a,this.selectDefaultTrack=!1,this.hls.trigger(T.AUDIO_TRACK_SWITCHING,j({},a)),!a.details||a.details.live){var u=this.switchParams(a.url,i==null?void 0:i.details);this.loadPlaylist(u)}}},e.selectInitialTrack=function(){var t=this.tracksInGroup,r=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(r!==-1)this.setAudioTrack(r);else{var i=new Error("No track found for running audio group-ID: "+this.groupId+" track count: "+t.length);this.warn(i.message),this.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var a=r[i];if((!this.selectDefaultTrack||a.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]!==void 0&&t.attrs["STABLE-RENDITION-ID"]===a.attrs["STABLE-RENDITION-ID"]||t.name===a.name&&t.lang===a.lang))return a.id}return-1},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,a=r.groupId,o=r.url;if(t)try{o=t.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist "+i+' "'+r.name+'" lang:'+r.lang+" group:"+a),this.clearTimer(),this.hls.trigger(T.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:a,deliveryDirectives:t||null})}},Y(n,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),n}(C);function bs(s,n){if(s.length!==n.length)return!1;for(var e=0;e<s.length;e++)if(!ul(s[e].attrs,n[e].attrs))return!1;return!0}function ul(s,n){var e=s["STABLE-RENDITION-ID"];return e?e===n["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(function(t){return s[t]!==n[t]})}var dl=function(s){function n(t,r,i){var a;return(a=s.call(this,t,r,i,"[subtitle-stream-controller]",ar)||this).levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}te(n,s);var e=n.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var t=this.hls;t.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.LEVEL_LOADED,this.onLevelLoaded,this),t.on(T.ERROR,this.onError,this),t.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(T.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(T.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.LEVEL_LOADED,this.onLevelLoaded,this),t.off(T.ERROR,this.onError,this),t.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(T.FRAG_BUFFERED,this.onFragBuffered,this)},e.startLoad=function(t){this.stopLoad(),this.state=me,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},e.onMediaDetaching=function(){this.tracksBuffered=[],s.prototype.onMediaDetaching.call(this)},e.onLevelLoaded=function(t,r){this.mainDetails=r.details},e.onSubtitleFragProcessed=function(t,r){var i=r.frag,a=r.success;if(this.fragPrevious=i,this.state=me,a){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var l,u=i.start,d=0;d<o.length;d++)if(u>=o[d].start&&u<=o[d].end){l=o[d];break}var c=i.start+i.duration;l?l.end=c:(l={start:u,end:c},o.push(l)),this.fragmentTracker.fragBuffered(i)}}},e.onBufferFlushing=function(t,r){var i=r.startOffset,a=r.endOffset;if(i===0&&a!==Number.POSITIVE_INFINITY){var o=this.currentTrackId,l=this.levels;if(!l.length||!l[o]||!l[o].details)return;var u=a-l[o].details.targetduration;if(u<=0)return;r.endOffsetSubtitles=Math.max(0,u),this.tracksBuffered.forEach(function(d){for(var c=0;c<d.length;)if(d[c].end<=u)d.shift();else{if(!(d[c].start<u))break;d[c].start=u,c++}}),this.fragmentTracker.removeFragmentsInRange(i,u,ar)}},e.onFragBuffered=function(t,r){var i;this.loadedmetadata||r.frag.type!==ze||(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)},e.onError=function(t,r){var i=r.frag;(i==null?void 0:i.type)===ar&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==vt&&(this.state=me))},e.onSubtitleTracksUpdated=function(t,r){var i=this,a=r.subtitleTracks;bs(this.levels,a)?this.levels=a.map(function(o){return new Wr(o)}):(this.tracksBuffered=[],this.levels=a.map(function(o){var l=new Wr(o);return i.tracksBuffered[l.id]=[],l}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ar),this.fragPrevious=null,this.mediaBuffer=null)},e.onSubtitleTrackSwitch=function(t,r){if(this.currentTrackId=r.id,this.levels.length&&this.currentTrackId!==-1){var i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}else this.clearInterval()},e.onSubtitleTrackLoaded=function(t,r){var i,a=r.details,o=r.id,l=this.currentTrackId,u=this.levels;if(u.length){var d=u[l];if(!(o>=u.length||o!==l)&&d){this.mediaBuffer=this.mediaBufferTimeRanges;var c=0;if(a.live||(i=d.details)!=null&&i.live){var f=this.mainDetails;if(a.deltaUpdateFailed||!f)return;var v=f.fragments[0];d.details?(c=this.alignPlaylists(a,d.details))===0&&v&&di(a,c=v.start):a.hasProgramDateTime&&f.hasProgramDateTime?(ct(a,f),c=a.fragments[0].start):v&&di(a,c=v.start)}d.details=a,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(d.details,c),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===me&&(Yr(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0))}}},e._handleFragmentLoadComplete=function(t){var r=this,i=t.frag,a=t.payload,o=i.decryptdata,l=this.hls;if(!this.fragContextChanged(i)&&a&&a.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var u=performance.now();this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer).catch(function(d){throw l.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(function(d){var c=performance.now();l.trigger(T.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:u,tdecrypt:c}})}).catch(function(d){r.warn(d.name+": "+d.message),r.state=me})}},e.doTick=function(){if(this.media){if(this.state===me){var t=this.currentTrackId,r=this.levels,i=r[t];if(!r.length||!i||!i.details)return;var a=i.details,o=a.targetduration,l=this.config,u=this.getLoadPosition(),d=ne.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],u-o,l.maxBufferHole),c=d.end,f=d.len,v=this.getFwdBufferInfo(this.media,ze);if(f>this.getMaxBufferLength(v==null?void 0:v.len)+o)return;var y=a.fragments,_=y.length,A=a.edge,E=null,S=this.fragPrevious;if(c<A){var D=l.maxFragLookUpTolerance;!(E=Yr(S,y,Math.max(y[0].start,c),D))&&S&&S.start<y[0].start&&(E=y[0])}else E=y[_-1];if(!E)return;E=this.mapToInitFragWhenRequired(E),this.fragmentTracker.getState(E)===W&&this.loadFragment(E,i,c)}}else this.state=me},e.getMaxBufferLength=function(t){var r=s.prototype.getMaxBufferLength.call(this);return t?Math.max(r,t):r},e.loadFragment=function(t,r,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,r):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i))},Y(n,[{key:"mediaBufferTimeRanges",get:function(){return new cl(this.tracksBuffered[this.currentTrackId]||[])}}]),n}(ca),cl=function(s){this.buffered=void 0;var n=function(e,t,r){if((t>>>=0)>r-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+r+")");return s[t][e]};this.buffered={get length(){return s.length},end:function(e){return n("end",e,s.length)},start:function(e){return n("start",e,s.length)}}},hl=function(s){function n(t){var r;return(r=s.call(this,t,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}te(n,s);var e=n.prototype;return e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,s.prototype.destroy.call(this)},e.registerListeners=function(){var t=this.hls;t.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(T.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.MANIFEST_PARSED,this.onManifestParsed,this),t.on(T.LEVEL_LOADING,this.onLevelLoading,this),t.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(T.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(T.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.MANIFEST_PARSED,this.onManifestParsed,this),t.off(T.LEVEL_LOADING,this.onLevelLoading,this),t.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(T.ERROR,this.onError,this)},e.onMediaAttached=function(t,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},e.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},e.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Aa(this.media.textTracks).forEach(function(t){Lr(t)}),this.subtitleTrack=-1,this.media=null)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.subtitleTracks},e.onSubtitleTrackLoaded=function(t,r){var i=r.id,a=r.details,o=this.trackId,l=this.tracksInGroup[o];if(l){var u=l.details;l.details=r.details,this.log("subtitle track "+i+" loaded ["+a.startSN+"-"+a.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,u)}else this.warn("Invalid subtitle track id "+i)},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r!=null&&r.textGroupIds){var i=r.textGroupIds[r.urlId],a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){var o=this.tracks.filter(function(d){return!i||d.groupId===i});this.tracksInGroup=o;var l=this.findTrackId(a==null?void 0:a.name)||this.findTrackId();this.groupId=i||null;var u={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(T.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.setSubtitleTrack(l,a)}else this.shouldReloadPlaylist(a)&&this.setSubtitleTrack(this.trackId,a)}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var a=r[i];if((!this.selectDefaultTrack||a.default)&&(!t||t===a.name))return a.id}return-1},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===Bt&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.checkRetry(r)},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,a=r.groupId,o=r.url;if(t)try{o=t.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(T.SUBTITLE_TRACK_LOADING,{url:o,id:i,groupId:a,deliveryDirectives:t||null})}},e.toggleTrackModes=function(t){var r=this,i=this.media,a=this.trackId;if(i){var o=Aa(i.textTracks),l=o.filter(function(c){return c.groupId===r.groupId});if(t===-1)[].slice.call(o).forEach(function(c){c.mode="disabled"});else{var u=l[a];u&&(u.mode="disabled")}var d=l[t];d&&(d.mode=this.subtitleDisplay?"showing":"hidden")}},e.setSubtitleTrack=function(t,r){var i,a=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(i=a[t])!=null&&i.details)||t<-1||t>=a.length)){this.clearTimer();var o=a[t];if(this.log("Switching to subtitle-track "+t+(o?' "'+o.name+'" lang:'+o.lang+" group:"+o.groupId:"")),this.trackId=t,o){var l=o.id,u=o.groupId,d=u===void 0?"":u,c=o.name,f=o.type,v=o.url;this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:l,groupId:d,name:c,type:f,url:v});var y=this.switchParams(o.url,r==null?void 0:r.details);this.loadPlaylist(y)}else this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},e.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,r=Aa(this.media.textTracks),i=0;i<r.length;i++)if(r[i].mode==="hidden")t=i;else if(r[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},Y(n,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,r)}}]),n}(C);function Aa(s){for(var n=[],e=0;e<s.length;e++){var t=s[e];t.kind!=="subtitles"&&t.kind!=="captions"||!t.label||n.push(s[e])}return n}var fl=function(){function s(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var n=s.prototype;return n.append=function(e,t){var r=this.queues[t];r.push(e),r.length===1&&this.buffers[t]&&this.executeNext(t)},n.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},n.appendBlocker=function(e){var t,r=new Promise(function(a){t=a}),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},n.executeNext=function(e){var t=this.buffers,r=this.queues,i=t[e],a=r[e];if(a.length){var o=a[0];try{o.execute()}catch(l){x.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(l),i!=null&&i.updating||(a.shift(),this.executeNext(e))}}},n.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},n.current=function(e){return this.queues[e][0]},s}(),Ss=ii(),As=/([ha]vc.)(?:\.[^.,]+)+/,vl=function(){function s(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.media,i=t.mediaSource;x.log("[buffer-controller]: Media source opened"),r&&(r.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(T.MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){x.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){x.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var r=t.media,i=t._objectUrl;r&&r.src!==i&&x.error("Media element src was set while attaching MediaSource ("+i+" > "+r.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var n=s.prototype;return n.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},n.registerListeners=function(){var e=this.hls;e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.BUFFER_EOS,this.onBufferEos,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.FRAG_PARSED,this.onFragParsed,this),e.on(T.FRAG_CHANGED,this.onFragChanged,this)},n.unregisterListeners=function(){var e=this.hls;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.BUFFER_EOS,this.onBufferEos,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.FRAG_PARSED,this.onFragParsed,this),e.off(T.FRAG_CHANGED,this.onFragChanged,this)},n._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new fl(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},n.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},n.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,x.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},n.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&Ss){var i=this.mediaSource=new Ss;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},n.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(x.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){x.warn("[buffer-controller]: onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):x.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.MEDIA_DETACHED,void 0)},n.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(i){x.warn("[buffer-controller]: Failed to reset the "+t+" buffer",i)}}),this._initSourceBuffer()},n.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(a){if(i){var o=r.tracks[a];if(o&&typeof o.buffer.changeType=="function"){var l=t[a],u=l.id,d=l.codec,c=l.levelCodec,f=l.container,v=l.metadata,y=(o.levelCodec||o.codec).replace(As,"$1"),_=(c||d).replace(As,"$1");if(y!==_){var A=f+";codecs="+(c||d);r.appendChangeType(a,A),x.log("[buffer-controller]: switching codec "+y+" to "+_),r.tracks[a]={buffer:o.buffer,codec:d,container:f,levelCodec:c,metadata:v,id:u}}}}else r.pendingTracks[a]=t[a]}),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},n.appendChangeType=function(e,t){var r=this,i=this.operationQueue,a={execute:function(){var o=r.sourceBuffer[e];o&&(x.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),o.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(o){x.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",o)}};i.append(a,e)},n.onBufferAppending=function(e,t){var r=this,i=this.hls,a=this.operationQueue,o=this.tracks,l=t.data,u=t.type,d=t.frag,c=t.part,f=t.chunkMeta,v=f.buffering[u],y=self.performance.now();v.start=y;var _=d.stats.buffering,A=c?c.stats.buffering:null;_.start===0&&(_.start=y),A&&A.start===0&&(A.start=y);var E=o.audio,S=!1;u==="audio"&&(E==null?void 0:E.container)==="audio/mpeg"&&(S=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);var D=d.start,R={execute:function(){if(v.executeStart=self.performance.now(),S){var O=r.sourceBuffer[u];if(O){var U=D-O.timestampOffset;Math.abs(U)>=.1&&(x.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+D+" (delta: "+U+") sn: "+d.sn+")"),O.timestampOffset=D)}}r.appendExecutor(l,u)},onStart:function(){},onComplete:function(){var O=self.performance.now();v.executeEnd=v.end=O,_.first===0&&(_.first=O),A&&A.first===0&&(A.first=O);var U=r.sourceBuffer,B={};for(var Q in U)B[Q]=ne.getBuffered(U[Q]);r.appendError=0,r.hls.trigger(T.BUFFER_APPENDED,{type:u,frag:d,part:c,chunkMeta:f,parent:d.type,timeRanges:B})},onError:function(O){x.error("[buffer-controller]: Error encountered while trying to append to the "+u+" SourceBuffer",O);var U={type:Z.MEDIA_ERROR,parent:d.type,details:N.BUFFER_APPEND_ERROR,frag:d,part:c,chunkMeta:f,error:O,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=N.BUFFER_FULL_ERROR:(r.appendError++,U.details=N.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(x.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0)),i.trigger(T.ERROR,U)}};a.append(R,u)},n.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,a=function(o){return{execute:r.removeExecutor.bind(r,o,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(T.BUFFER_FLUSHED,{type:o})},onError:function(l){x.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",l)}}};t.type?i.append(a(t.type),t.type):this.getSourceBufferTypes().forEach(function(o){i.append(a(o),o)})},n.onFragParsed=function(e,t){var r=this,i=t.frag,a=t.part,o=[],l=a?a.elementaryStreams:i.elementaryStreams;l[X]?o.push("audiovideo"):(l[Ze]&&o.push("audio"),l[gt]&&o.push("video")),o.length===0&&x.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var u=self.performance.now();i.stats.buffering.end=u,a&&(a.stats.buffering.end=u);var d=a?a.stats:i.stats;r.hls.trigger(T.FRAG_BUFFERED,{frag:i,part:a,stats:d,id:i.type})},o)},n.onFragChanged=function(e,t){this.flushBackBuffer()},n.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce(function(i,a){var o=r.sourceBuffer[a];return!o||t.type&&t.type!==a||(o.ending=!0,o.ended||(o.ended=!0,x.log("[buffer-controller]: "+a+" sourceBuffer now EOS"))),i&&!(o&&!o.ended)},!0)&&(x.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(a){var o=r.sourceBuffer[a];o&&(o.ending=!1)});var i=r.mediaSource;i&&i.readyState==="open"?(x.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()):i&&x.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+i.readyState)}))},n.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},n.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,i=this.sourceBuffer;if(r&&t!==null){var a=this.getSourceBufferTypes();if(a.length){var o=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if($(o)&&!(o<0)){var l=r.currentTime,u=t.levelTargetDuration,d=Math.max(o,u),c=Math.floor(l/u)*u-d;a.forEach(function(f){var v=i[f];if(v){var y=ne.getBuffered(v);if(y.length>0&&c>y.start(0)){if(e.trigger(T.BACK_BUFFER_REACHED,{bufferEnd:c}),t.live)e.trigger(T.LIVE_BACK_BUFFER_REACHED,{bufferEnd:c});else if(v.ended&&y.end(y.length-1)-l<2*u)return void x.info("[buffer-controller]: Cannot flush "+f+" back buffer while SourceBuffer is in ended state");e.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:c,type:f})}}})}}}},n.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,a=e.fragments[0].start+e.totalduration,o=r.duration,l=$(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(x.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(a>l&&a>o||!$(o))&&(x.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),i.duration=a)}},n.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),a=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,a)}},n.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||i===2){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length)this.hls.trigger(T.BUFFER_CREATED,{tracks:this.tracks}),a.forEach(function(l){t.executeNext(l)});else{var o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}},n.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var a=e[i];if(!a)throw Error("source buffer exists for track "+i+", however track does not");var o=a.levelCodec||a.codec,l=a.container+";codecs="+o;x.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var u=t[i]=r.addSourceBuffer(l),d=i;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[i]={buffer:u,codec:o,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(c){x.error("[buffer-controller]: error while trying to add sourceBuffer: "+c.message),this.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,mimeType:l})}}},n._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},n._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},n._onSBUpdateError=function(e,t){var r=new Error(e+" SourceBuffer error");x.error("[buffer-controller]: "+r,t),this.hls.trigger(T.ERROR,{type:Z.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},n.removeExecutor=function(e,t,r){var i=this.media,a=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[e];if(!i||!a||!l)return x.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var u=$(i.duration)?i.duration:1/0,d=$(a.duration)?a.duration:1/0,c=Math.max(0,t),f=Math.min(r,u,d);f>c&&!l.ending?(l.ended=!1,x.log("[buffer-controller]: Removing ["+c+","+f+"] from the "+e+" SourceBuffer"),l.remove(c,f)):o.shiftAndExecuteNext(e)},n.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return x.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)},n.blockBuffers=function(e,t){var r=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return x.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var i=this.operationQueue,a=t.map(function(o){return i.appendBlocker(o)});Promise.all(a).then(function(){e(),t.forEach(function(o){var l=r.sourceBuffer[o];l!=null&&l.updating||i.shiftAndExecuteNext(o)})})},n.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},n.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var a=r.bind(this,e);this.listeners[e].push({event:t,listener:a}),i.addEventListener(t,a)}},n.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(r){t.removeEventListener(r.event,r.listener)})},s}(),ws={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ks=function(s){var n=s;return ws.hasOwnProperty(s)&&(n=ws[s]),String.fromCharCode(n)},Jr=15,_r=100,gl={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ml={17:2,18:4,21:6,22:8,23:10,19:13,20:15},pl={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},yl={25:2,26:4,29:6,30:8,31:10,27:13,28:15},El=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Tl=function(){function s(){this.time=null,this.verboseLevel=0}return s.prototype.log=function(n,e){if(this.verboseLevel>=n){var t=typeof e=="function"?e():e;x.log(this.time+" ["+n+"] "+t)}},s}(),Zr=function(s){for(var n=[],e=0;e<s.length;e++)n.push(s[e].toString(16));return n},Ls=function(){function s(e,t,r,i,a){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=a||!1}var n=s.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},n.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),_l=function(){function s(e,t,r,i,a,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Ls(t,r,i,a,o)}var n=s.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},n.setPenState=function(e){this.penState.copy(e)},n.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},n.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),bl=function(){function s(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<_r;t++)this.chars.push(new _l);this.logger=e,this.pos=0,this.currPenState=new Ls}var n=s.prototype;return n.equals=function(e){for(var t=!0,r=0;r<_r;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},n.copy=function(e){for(var t=0;t<_r;t++)this.chars[t].copy(e.chars[t])},n.isEmpty=function(){for(var e=!0,t=0;t<_r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},n.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>_r&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=_r)},n.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(e){var t=this;e>=144&&this.backSpace();var r=ks(e);this.pos>=_r?this.logger.log(0,function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},n.clearFromPos=function(e){var t;for(t=e;t<_r;t++)this.chars[t].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var e=[],t=!0,r=0;r<_r;r++){var i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")},n.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},s}(),wa=function(){function s(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Jr;t++)this.rows.push(new bl(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=s.prototype;return n.reset=function(){for(var e=0;e<Jr;e++)this.rows[e].clear();this.currRow=14},n.equals=function(e){for(var t=!0,r=0;r<Jr;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},n.copy=function(e){for(var t=0;t<Jr;t++)this.rows[t].copy(e.rows[t])},n.isEmpty=function(){for(var e=!0,t=0;t<Jr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},n.backSpace=function(){this.rows[this.currRow].backSpace()},n.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},n.insertChar=function(e){this.rows[this.currRow].insertChar(e)},n.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},n.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},n.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},n.setPAC=function(e){this.logger.log(2,function(){return"pacData = "+JSON.stringify(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<Jr;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var o=a.rows[i].cueStartTime,l=this.logger.time;if(o&&l!==null&&o<l)for(var u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[i+u])}}this.currRow=t;var d=this.rows[this.currRow];if(e.indent!==null){var c=e.indent,f=Math.max(c-1,0);d.setCursor(e.indent),e.color=d.chars[f].penState.foreground}var v={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(v)},n.setBkgData=function(e){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},n.setRollUpRows=function(e){this.nrRollUpRows=e},n.rollUp=function(){var e=this;if(this.nrRollUpRows!==null){this.logger.log(1,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},n.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<Jr;a++){var o=this.rows[a].getTextString();o&&(i=a+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join(`
`)),r},n.getTextAndFormat=function(){return this.rows},s}(),Rs=function(){function s(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new wa(r),this.nonDisplayedMemory=new wa(r),this.lastOutputScreen=new wa(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var n=s.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(e){this.outputFilter=e},n.setPAC=function(e){this.writeScreen.setPAC(e)},n.setBkgData=function(e){this.writeScreen.setBkgData(e)},n.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},n.insertChars=function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+t.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},n.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},n.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},n.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},n.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},s}(),Ds=function(){function s(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Tl;this.channels=[null,new Rs(e,t,i),new Rs(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}var n=s.prototype;return n.getHandler=function(e){return this.channels[e].getHandler()},n.setHandler=function(e,t){this.channels[e].setHandler(t)},n.addData=function(e,t){var r,i,a,o=!1;this.logger.time=e;for(var l=0;l<t.length;l+=2)if(i=127&t[l],a=127&t[l+1],i!==0||a!==0){if(this.logger.log(3,"["+Zr([t[l],t[l+1]])+"] -> ("+Zr([i,a])+")"),(r=this.parseCmd(i,a))||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(o=this.parseChars(i,a))){var u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||o||this.logger.log(2,"Couldn't parse cleaned data "+Zr([i,a])+" orig: "+Zr([t[l],t[l+1]]))}},n.parseCmd=function(e,t){var r=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Is(e,t,r))return yi(null,null,r),this.logger.log(3,"Repeated command ("+Zr([e,t])+") is dropped"),!0;var i=e===20||e===21||e===23?1:2,a=this.channels[i];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),yi(e,t,r),this.currentChannel=i,!0},n.parseMidrow=function(e,t){var r=0;if((e===17||e===25)&&t>=32&&t<=47){if((r=e===17?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Zr([e,t])+")"),!0)}return!1},n.parsePAC=function(e,t){var r,i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Is(e,t,i))return yi(null,null,i),!0;var a=e<=23?1:2;r=t>=64&&t<=95?a===1?gl[e]:pl[e]:a===1?ml[e]:yl[e];var o=this.channels[a];return!!o&&(o.setPAC(this.interpretPAC(r,t)),yi(e,t,i),this.currentChannel=a,!0)},n.interpretPAC=function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=(1&r)==1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},n.parseChars=function(e,t){var r,i,a=null,o=null;if(e>=25?(r=2,o=e-8):(r=1,o=e),o>=17&&o<=19?(i=o===17?t+80:o===18?t+112:t+144,this.logger.log(2,"Special char '"+ks(i)+"' in channel "+r),a=[i]):e>=32&&e<=127&&(a=t===0?[e]:[e,t]),a){var l=Zr(a);this.logger.log(3,"Char codes =  "+l.join(",")),yi(e,t,this.cmdHistory)}return a},n.parseBackgroundAttributes=function(e,t){var r;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var i={};e===16||e===24?(r=Math.floor((t-32)/2),i.background=El[r],t%2==1&&(i.background=i.background+"_semi")):t===45?i.background="transparent":(i.foreground="black",t===47&&(i.underline=!0));var a=e<=23?1:2;return this.channels[a].setBkgData(i),yi(e,t,this.cmdHistory),!0},n.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},n.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},s}();function yi(s,n,e){e.a=s,e.b=n}function Is(s,n,e){return e.a===s&&e.b===n}var Mn=function(){function s(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var n=s.prototype;return n.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},n.newCue=function(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},n.reset=function(){this.cueRanges=[],this.startTime=null},s}(),ka=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var s=["","lr","rl"],n=["start","middle","end","left","right"];function e(a,o){if(typeof o!="string"||!Array.isArray(a))return!1;var l=o.toLowerCase();return!!~a.indexOf(l)&&l}function t(a){return e(n,a)}function r(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];for(var d=1;d<arguments.length;d++){var c=arguments[d];for(var f in c)a[f]=c[f]}return a}function i(a,o,l){var u=this,d={enumerable:!0};u.hasBeenReset=!1;var c="",f=!1,v=a,y=o,_=l,A=null,E="",S=!0,D="auto",R="start",O=50,U="middle",B=50,Q="middle";Object.defineProperty(u,"id",r({},d,{get:function(){return c},set:function(K){c=""+K}})),Object.defineProperty(u,"pauseOnExit",r({},d,{get:function(){return f},set:function(K){f=!!K}})),Object.defineProperty(u,"startTime",r({},d,{get:function(){return v},set:function(K){if(typeof K!="number")throw new TypeError("Start time must be set to a number.");v=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",r({},d,{get:function(){return y},set:function(K){if(typeof K!="number")throw new TypeError("End time must be set to a number.");y=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",r({},d,{get:function(){return _},set:function(K){_=""+K,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",r({},d,{get:function(){return A},set:function(K){A=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",r({},d,{get:function(){return E},set:function(K){var q=function(ie){return e(s,ie)}(K);if(q===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",r({},d,{get:function(){return S},set:function(K){S=!!K,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",r({},d,{get:function(){return D},set:function(K){if(typeof K!="number"&&K!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",r({},d,{get:function(){return R},set:function(K){var q=t(K);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");R=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",r({},d,{get:function(){return O},set:function(K){if(K<0||K>100)throw new Error("Position must be between 0 and 100.");O=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",r({},d,{get:function(){return U},set:function(K){var q=t(K);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");U=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",r({},d,{get:function(){return B},set:function(K){if(K<0||K>100)throw new Error("Size must be between 0 and 100.");B=K,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",r({},d,{get:function(){return Q},set:function(K){var q=t(K);if(!q)throw new SyntaxError("An invalid or illegal string was specified.");Q=q,this.hasBeenReset=!0}})),u.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}(),Sl=function(){function s(){}return s.prototype.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},s}();function Cs(s){function n(t,r,i,a){return 3600*(0|t)+60*(0|r)+(0|i)+parseFloat(a||0)}var e=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?n(e[2],e[3],0,e[4]):n(e[1],e[2],e[3],e[4]):null}var Al=function(){function s(){this.values=Object.create(null)}var n=s.prototype;return n.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},n.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},n.has=function(e){return e in this.values},n.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},n.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},n.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},s}();function Ps(s,n,e,t){var r=t?s.split(t):[s];for(var i in r)if(typeof r[i]=="string"){var a=r[i].split(e);a.length===2&&n(a[0],a[1])}}var La=new ka(0,0,""),Fn=La.align==="middle"?"middle":"center";function wl(s,n,e){var t=s;function r(){var a=Cs(s);if(a===null)throw new Error("Malformed timestamp: "+t);return s=s.replace(/^[^\sa-zA-Z-]+/,""),a}function i(){s=s.replace(/^\s+/,"")}if(i(),n.startTime=r(),i(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);s=s.slice(3),i(),n.endTime=r(),i(),function(a,o){var l=new Al;Ps(a,function(c,f){var v;switch(c){case"region":for(var y=e.length-1;y>=0;y--)if(e[y].id===f){l.set(c,e[y].region);break}break;case"vertical":l.alt(c,f,["rl","lr"]);break;case"line":v=f.split(","),l.integer(c,v[0]),l.percent(c,v[0])&&l.set("snapToLines",!1),l.alt(c,v[0],["auto"]),v.length===2&&l.alt("lineAlign",v[1],["start",Fn,"end"]);break;case"position":v=f.split(","),l.percent(c,v[0]),v.length===2&&l.alt("positionAlign",v[1],["start",Fn,"end","line-left","line-right","auto"]);break;case"size":l.percent(c,f);break;case"align":l.alt(c,f,["start",Fn,"end","left","right"])}},/:/,/\s/),o.region=l.get("region",null),o.vertical=l.get("vertical","");var u=l.get("line","auto");u==="auto"&&La.line===-1&&(u=-1),o.line=u,o.lineAlign=l.get("lineAlign","start"),o.snapToLines=l.get("snapToLines",!0),o.size=l.get("size",100),o.align=l.get("align",Fn);var d=l.get("position","auto");d==="auto"&&La.position===50&&(d=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=d}(s,n)}function xs(s){return s.replace(/<br(?: \/)?>/gi,`
`)}var kl=function(){function s(){this.state="INITIAL",this.buffer="",this.decoder=new Sl,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var n=s.prototype;return n.parse=function(e){var t=this;function r(){var u=t.buffer,d=0;for(u=xs(u);d<u.length&&u[d]!=="\r"&&u[d]!==`
`;)++d;var c=u.slice(0,d);return u[d]==="\r"&&++d,u[d]===`
`&&++d,t.buffer=u.slice(d),c}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var a=(i=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(a==null||!a[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?Ps(i,function(u,d){},/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new ka(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{wl(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},n.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},s}(),Ll=/\r\n|\n\r|\n|\r/g,Ra=function(s,n,e){return e===void 0&&(e=0),s.slice(e,e+n.length)===n},Da=function(s){for(var n=5381,e=s.length;e;)n=33*n^s.charCodeAt(--e);return(n>>>0).toString()};function Ia(s,n,e){return Da(s.toString())+Da(n.toString())+Da(e)}function Rl(s,n,e,t,r,i,a){var o,l,u,d=new kl,c=Nt(new Uint8Array(s)).trim().replace(Ll,`
`).split(`
`),f=[],v=(o=n.baseTime,(l=n.timescale)===void 0&&(l=1),ma(o,9e4,1/l)),y="00:00.000",_=0,A=0,E=!0;d.oncue=function(S){var D=e[t],R=e.ccOffset,O=(_-v)/9e4;D!=null&&D.new&&(A!==void 0?R=e.ccOffset=D.start:function(K,q,ie){var J=K[q],he=K[J.prevCC];if(!he||!he.new&&J.new)return K.ccOffset=K.presentationOffset=J.start,void(J.new=!1);for(;(be=he)!=null&&be.new;){var be;K.ccOffset+=J.start-he.start,J.new=!1,he=K[(J=he).prevCC]}K.presentationOffset=ie}(e,t,O)),O&&(R=O-e.presentationOffset);var U=S.endTime-S.startTime,B=Qt(9e4*(S.startTime+R-A),9e4*r)/9e4;S.startTime=Math.max(B,0),S.endTime=Math.max(B+U,0);var Q=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(Q)),S.id||(S.id=Ia(S.startTime,S.endTime,Q)),S.endTime>0&&f.push(S)},d.onparsingerror=function(S){u=S},d.onflush=function(){u?a(u):i(f)},c.forEach(function(S){if(E){if(Ra(S,"X-TIMESTAMP-MAP=")){E=!1,S.slice(16).split(",").forEach(function(D){Ra(D,"LOCAL:")?y=D.slice(6):Ra(D,"MPEGTS:")&&(_=parseInt(D.slice(7)))});try{A=function(D){var R=parseInt(D.slice(-3)),O=parseInt(D.slice(-6,-4)),U=parseInt(D.slice(-9,-7)),B=D.length>9?parseInt(D.substring(0,D.indexOf(":"))):0;if(!($(R)&&$(O)&&$(U)&&$(B)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+D);return R+=1e3*O,(R+=6e4*U)+36e5*B}(y)/1e3}catch(D){u=D}return}S===""&&(E=!1)}d.parse(S+`
`)}),d.flush()}var Ca="stpp.ttml.im1t",Os=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ms=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Dl={left:"start",center:"center",right:"end",start:"start",end:"end"};function Fs(s,n,e,t){var r=He(new Uint8Array(s),["mdat"]);if(r.length!==0){var i,a,o,l,u=r.map(function(c){return Nt(c)}),d=(i=n.baseTime,a=1,(o=n.timescale)===void 0&&(o=1),l===void 0&&(l=!1),ma(i,a,1/o,l));try{u.forEach(function(c){return e(function(f,v){var y=new DOMParser().parseFromString(f,"text/xml").getElementsByTagName("tt")[0];if(!y)throw new Error("Invalid ttml");var _={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},A=Object.keys(_).reduce(function(O,U){return O[U]=y.getAttribute("ttp:"+U)||_[U],O},{}),E=y.getAttribute("xml:space")!=="preserve",S=Ns(Pa(y,"styling","style")),D=Ns(Pa(y,"layout","region")),R=Pa(y,"body","[begin]");return[].map.call(R,function(O){var U=Us(O,E);if(!U||!O.hasAttribute("begin"))return null;var B=Oa(O.getAttribute("begin"),A),Q=Oa(O.getAttribute("dur"),A),K=Oa(O.getAttribute("end"),A);if(B===null)throw Bs(O);if(K===null){if(Q===null)throw Bs(O);K=B+Q}var q=new ka(B-v,K-v,U);q.id=Ia(q.startTime,q.endTime,q.text);var ie=function(be,ge,Ee){var Le="http://www.w3.org/ns/ttml#styling",ke=null,Fe=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],Ge=be!=null&&be.hasAttribute("style")?be.getAttribute("style"):null;return Ge&&Ee.hasOwnProperty(Ge)&&(ke=Ee[Ge]),Fe.reduce(function(Ke,$e){var Mt=xa(ge,Le,$e)||xa(be,Le,$e)||xa(ke,Le,$e);return Mt&&(Ke[$e]=Mt),Ke},{})}(D[O.getAttribute("region")],S[O.getAttribute("style")],S),J=ie.textAlign;if(J){var he=Dl[J];he&&(q.lineAlign=he),q.align=J}return z(q,ie),q}).filter(function(O){return O!==null})}(c,d))})}catch(c){t(c)}}else t(new Error("Could not parse IMSC1 mdat"))}function Pa(s,n,e){var t=s.getElementsByTagName(n)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Ns(s){return s.reduce(function(n,e){var t=e.getAttribute("xml:id");return t&&(n[t]=e),n},{})}function Us(s,n){return[].slice.call(s.childNodes).reduce(function(e,t,r){var i;return t.nodeName==="br"&&r?e+`
`:(i=t.childNodes)!=null&&i.length?Us(t,n):n?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function xa(s,n,e){return s&&s.hasAttributeNS(n,e)?s.getAttributeNS(n,e):null}function Bs(s){return new Error("Could not parse ttml timestamp "+s)}function Oa(s,n){if(!s)return null;var e=Cs(s);return e===null&&(Os.test(s)?e=function(t,r){var i=Os.exec(t),a=(0|i[4])+(0|i[5])/r.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+a/r.frameRate}(s,n):Ms.test(s)&&(e=function(t,r){var i=Ms.exec(t),a=Number(i[1]);switch(i[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/r.frameRate;case"t":return a/r.tickRate}return a}(s,n))),e}var Il=function(){function s(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new Mn(this,"textTrack1"),r=new Mn(this,"textTrack2"),i=new Mn(this,"textTrack3"),a=new Mn(this,"textTrack4");this.cea608Parser1=new Ds(1,t,r),this.cea608Parser2=new Ds(3,i,a)}e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}var n=s.prototype;return n.destroy=function(){var e=this.hls;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},n.addCues=function(e,t,r,i,a){for(var o,l,u,d,c=!1,f=a.length;f--;){var v=a[f],y=(o=v[0],l=v[1],u=t,d=r,Math.min(l,d)-Math.max(o,u));if(y>=0&&(v[0]=Math.min(v[0],t),v[1]=Math.max(v[1],r),c=!0,y/(r-t)>.5))return}if(c||a.push([t,r]),this.config.renderTextTracksNatively){var _=this.captionsTracks[e];this.Cues.newCue(_,t,r,i)}else{var A=this.Cues.newCue(null,t,r,i);this.hls.trigger(T.CUES_PARSED,{type:"captions",cues:A,track:e})}},n.onInitPtsFound=function(e,t){var r=this,i=t.frag,a=t.id,o=t.initPTS,l=t.timescale,u=this.unparsedVttFrags;a==="main"&&(this.initPTS[i.cc]={baseTime:o,timescale:l}),u.length&&(this.unparsedVttFrags=[],u.forEach(function(d){r.onFragLoaded(T.FRAG_LOADED,d)}))},n.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},n.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},n.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,a=t[e],o=a.label,l=a.languageCode,u=this.getExistingTrack(e);if(u)r[e]=u,Lr(r[e]),st(r[e],i);else{var d=this.createTextTrack("captions",o,l);d&&(d[e]=!0,r[e]=d)}}},n.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},n.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},n.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},n.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){Lr(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},n.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},n._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Lr(t[r])}},n.onSubtitleTracksUpdated=function(e,t){var r=this,i=t.subtitleTracks||[],a=i.some(function(u){return u.textCodec===Ca});if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(bs(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:null;this.tracks.forEach(function(u,d){var c;if(o&&d<o.length){for(var f=null,v=0;v<o.length;v++)if(Cl(o[v],u)){f=o[v];break}f&&(c=f)}if(c)Lr(c);else{var y=r._captionsOrSubtitlesFromCharacteristics(u);(c=r.createTextTrack(y,u.name,u.lang))&&(c.mode="disabled")}c&&(c.groupId=u.groupId,r.textTracks.push(c))})}else if(this.tracks.length){var l=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},n._captionsOrSubtitlesFromCharacteristics=function(e){if(e.attrs.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"},n.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(i){var a=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(a){var o="textTrack"+a[1],l=r.captionsProperties[o];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)}})},n.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},n.onFragLoading=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2,a=this.lastSn,o=this.lastPartIndex;if(this.enabled&&r&&i&&t.frag.type===ze){var l,u,d=t.frag.sn,c=(l=t==null||(u=t.part)==null?void 0:u.index)!=null?l:-1;d===a+1||d===a&&c===o+1||(r.reset(),i.reset()),this.lastSn=d,this.lastPartIndex=c}},n.onFragLoaded=function(e,t){var r=t.frag,i=t.payload,a=this.initPTS,o=this.unparsedVttFrags;if(r.type===ar)if(i.byteLength){if(!a[r.cc])return o.push(t),void(a.length&&this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var l=r.decryptdata,u="stats"in t;if(l==null||!l.encrypted||u){var d=this.tracks[r.level],c=this.vttCCs;c[r.cc]||(c[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),d&&d.textCodec===Ca?this._parseIMSC1(r,i):this._parseVTTs(r,i,c)}}else this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},n._parseIMSC1=function(e,t){var r=this,i=this.hls;Fs(t,this.initPTS[e.cc],function(a){r._appendCues(a,e.level),i.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){x.log("Failed to parse IMSC1: "+a),i.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},n._parseVTTs=function(e,t,r){var i,a=this,o=this.hls;Rl((i=e.initSegment)!=null&&i.data?vr(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],r,e.cc,e.start,function(l){a._appendCues(l,e.level),o.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(l){a._fallbackToIMSC1(e,t),x.log("Failed to parse VTT cue: "+l),o.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:l})})},n._fallbackToIMSC1=function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||Fs(t,this.initPTS[e.cc],function(){i.textCodec=Ca,r._parseIMSC1(e,t)},function(){i.textCodec="wvtt"})},n._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(function(l){return Kr(i,l)})}else{var a=this.tracks[t];if(!a)return;var o=a.default?"default":"subtitles"+t;r.trigger(T.CUES_PARSED,{type:"subtitles",cues:e,track:o})}},n.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===ar){if(!this.initPTS[r.cc])return void this.unparsedVttFrags.push(t);this.onFragLoaded(T.FRAG_LOADED,t)}},n.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},n.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var a=t.frag,o=t.samples;if(a.type!==ze||this.closedCaptionsForLevel(a)!=="NONE")for(var l=0;l<o.length;l++){var u=o[l].bytes;if(u){var d=this.extractCea608Data(u);r.addData(o[l].pts,d[0]),i.addData(o[l].pts,d[1])}}}},n.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,a=t.endOffsetSubtitles,o=t.type,l=this.media;if(l&&!(l.currentTime<i)){if(!o||o==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(c){return xi(u[c],r,i)})}if(this.config.renderTextTracksNatively&&r===0&&a!==void 0){var d=this.textTracks;Object.keys(d).forEach(function(c){return xi(d[c],r,a)})}}},n.extractCea608Data=function(e){for(var t=[[],[]],r=31&e[0],i=2,a=0;a<r;a++){var o=e[i++],l=127&e[i++],u=127&e[i++];if((l!==0||u!==0)&&4&o){var d=3&o;d!==0&&d!==1||(t[d].push(l),t[d].push(u))}}return t},s}();function Cl(s,n){return!!s&&s.label===n.name&&!(s.textTrack1||s.textTrack2)}var Pl=function(){function s(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var n=s.prototype;return n.setStreamController=function(e){this.streamController=e},n.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},n.registerListeners=function(){var e=this.hls;e.on(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this)},n.unregisterListener=function(){var e=this.hls;e.off(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this)},n.onFpsDropLevelCapping=function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},n.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},n.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},n.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},n.onMediaDetaching=function(){this.stopCapping()},n.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},n.getMaxLevel=function(e){var t=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(a,o){return t.isLevelAllowed(a)&&o<=e});return this.clientRect=null,s.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},n.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},n.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},n.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},n.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},s.getMaxLevelByMediaSize=function(e,t,r){if(e==null||!e.length)return-1;for(var i,a,o=e.length-1,l=0;l<e.length;l+=1){var u=e[l];if((u.width>=t||u.height>=r)&&(i=u,!(a=e[l+1])||i.width!==a.width||i.height!==a.height)){o=l;break}}return o},Y(s,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}}]),s}(),xl=function(){function s(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var n=s.prototype;return n.setStreamController=function(e){this.streamController=e},n.registerListeners=function(){this.hls.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this)},n.unregisterListeners=function(){this.hls.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this)},n.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},n.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},n.checkFPS=function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var a=i-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*o/a,d=this.hls;if(d.trigger(T.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),u>0&&o>d.config.fpsDroppedMonitoringThreshold*l){var c=d.currentLevel;x.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=c)&&(c-=1,d.trigger(T.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:d.currentLevel}),d.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},n.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},s}(),Nn="[eme]",Gs=function(){function s(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=s.CDMCleanupPromise?[s.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=x.debug.bind(x,Nn),this.log=x.log.bind(x,Nn),this.warn=x.warn.bind(x,Nn),this.error=x.error.bind(x,Nn),this.hls=e,this.config=e.config,this.registerListeners()}var n=s.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},n.registerListeners=function(){this.hls.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.MANIFEST_LOADED,this.onManifestLoaded,this)},n.unregisterListeners=function(){this.hls.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(T.MANIFEST_LOADED,this.onManifestLoaded,this)},n.getLicenseServerUrl=function(e){var t=this.config,r=t.drmSystems,i=t.widevineLicenseUrl,a=r[e];if(a)return a.licenseUrl;if(e===We.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'+e+'"')},n.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},n.attemptKeySystemAccess=function(e){var t=this,r=this.hls.levels,i=function(l,u,d){return!!l&&d.indexOf(l)===u},a=r.map(function(l){return l.audioCodec}).filter(i),o=r.map(function(l){return l.videoCodec}).filter(i);return a.length+o.length===0&&o.push("avc1.42e01e"),new Promise(function(l,u){(function d(c){var f=c.shift();t.getMediaKeysPromise(f,a,o).then(function(v){return l({keySystem:f,mediaKeys:v})}).catch(function(v){c.length?d(c):u(v instanceof $t?v:new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:v,fatal:!0},v.message))})})(e)})},n.requestMediaKeySystemAccess=function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if(typeof r!="function"){var i="Configured requestMediaKeySystemAccess is not a function "+r;return wr===null&&self.location.protocol==="http:"&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return r(e,t)},n.getMediaKeysPromise=function(e,t,r){var i=this,a=function(d,c,f,v){var y;switch(d){case We.FAIRPLAY:y=["cenc","sinf"];break;case We.WIDEVINE:case We.PLAYREADY:y=["cenc"];break;case We.CLEARKEY:y=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+d)}return function(_,A,E,S){return[{initDataTypes:_,persistentState:S.persistentState||"not-allowed",distinctiveIdentifier:S.distinctiveIdentifier||"not-allowed",sessionTypes:S.sessionTypes||[S.sessionType||"temporary"],audioCapabilities:A.map(function(D){return{contentType:'audio/mp4; codecs="'+D+'"',robustness:S.audioRobustness||"",encryptionScheme:S.audioEncryptionScheme||null}}),videoCapabilities:E.map(function(D){return{contentType:'video/mp4; codecs="'+D+'"',robustness:S.videoRobustness||"",encryptionScheme:S.videoEncryptionScheme||null}})}]}(y,c,f,v)}(e,t,r,this.config.drmSystemOptions),o=this.keySystemAccessPromises[e],l=o==null?void 0:o.keySystemAccess;if(!l){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(a)),l=this.requestMediaKeySystemAccess(e,a);var u=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(function(d){i.log('Failed to obtain access to key-system "'+e+'": '+d)}),l.then(function(d){i.log('Access for key-system "'+d.keySystem+'" obtained');var c=i.fetchServerCertificate(e);return i.log('Create media-keys for "'+e+'"'),u.mediaKeys=d.createMediaKeys().then(function(f){return i.log('Media-keys created for "'+e+'"'),c.then(function(v){return v?i.setMediaKeysServerCertificate(f,e,v):f})}),u.mediaKeys.catch(function(f){i.error('Failed to create media-keys for "'+e+'"}: '+f)}),u.mediaKeys})}return l.then(function(){return o.mediaKeys})},n.createMediaKeySessionContext=function(e){var t=e.decryptdata,r=e.keySystem,i=e.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+Yt(t.keyId||[]));var a=i.createSession(),o={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o},n.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},n.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Yt(e.keyId)},n.updateKeySession=function(e,t){var r,i=e.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+Yt(((r=e.decryptdata)==null?void 0:r.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),i.update(t)},n.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},n.getKeyFormatPromise=function(e){var t=this;return new Promise(function(r,i){var a=Ar(t.config),o=e.map(et).filter(function(l){return!!l&&a.indexOf(l)!==-1});return t.getKeySystemSelectionPromise(o).then(function(l){var u=l.keySystem,d=fr(u);d?r(d):i(new Error('Unable to find format for key-system "'+u+'"'))}).catch(i)})},n.loadKey=function(e){var t=this,r=e.keyInfo.decryptdata,i=this.getKeyIdString(r),a="(keyId: "+i+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+a);var o=this.keyIdToKeySessionPromise[i];return o||(o=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then(function(l){var u=l.keySystem,d=l.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+a),t.attemptSetMediaKeys(u,d).then(function(){t.throwIfDestroyed();var c=t.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:r});return t.generateRequestWithPreferredKeySession(c,"cenc",r.pssh,"playlist-key")})})).catch(function(l){return t.handleError(l)}),o},n.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},n.handleError=function(e){this.hls&&(this.error(e.message),e instanceof $t?this.hls.trigger(T.ERROR,e.data):this.hls.trigger(T.ERROR,{type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},n.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var i=et(e.keyFormat),a=i?[i]:Ar(this.config);return this.attemptKeySystemAccess(a)}return r},n.getKeySystemSelectionPromise=function(e){if(e.length||(e=Ar(this.config)),e.length===0)throw new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},n._onMediaEncrypted=function(e){var t=this,r=e.initDataType,i=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+r+'"'),i!==null){var a,o;if(r==="sinf"&&this.config.drmSystems[We.FAIRPLAY]){var l=lt(new Uint8Array(i));try{var u=wt(JSON.parse(l).sinf),d=Ri(new Uint8Array(u));if(!d)return;a=d.subarray(8,24),o=We.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var c=function(D){if(!(D instanceof ArrayBuffer)||D.byteLength<32)return null;var R={version:0,systemId:"",kids:null,data:null},O=new DataView(D),U=O.getUint32(0);if(D.byteLength!==U&&U>44||O.getUint32(4)!==1886614376||(R.version=O.getUint32(8)>>>24,R.version>1))return null;R.systemId=Yt(new Uint8Array(D,12,16));var B=O.getUint32(28);if(R.version===0){if(U-32<B)return null;R.data=new Uint8Array(D,32,B)}else if(R.version===1){R.kids=[];for(var Q=0;Q<B;Q++)R.kids.push(new Uint8Array(D,32+16*Q,16))}return R}(i);if(c===null)return;c.version===0&&c.systemId===hr&&c.data&&(a=c.data.subarray(8,24)),o=function(D){if(D===hr)return We.WIDEVINE}(c.systemId)}if(o&&a){for(var f=Yt(a),v=this.keyIdToKeySessionPromise,y=this.mediaKeySessions,_=v[f],A=function(){var D=y[E],R=D.decryptdata;if(R.pssh||!R.keyId)return"continue";var O=Yt(R.keyId);return f===O||R.uri.replace(/-/g,"").indexOf(f)!==-1?(_=v[O],delete v[O],R.pssh=new Uint8Array(i),R.keyId=a,_=v[f]=_.then(function(){return t.generateRequestWithPreferredKeySession(D,r,i,"encrypted-event-key-match")}),"break"):void 0},E=0;E<y.length;E++){var S=A();if(S!=="continue"&&S==="break")break}_||(_=v[f]=this.getKeySystemSelectionPromise([o]).then(function(D){var R,O=D.keySystem,U=D.mediaKeys;t.throwIfDestroyed();var B=new Gr("ISO-23001-7",f,(R=fr(O))!=null?R:"");return B.pssh=new Uint8Array(i),B.keyId=a,t.attemptSetMediaKeys(O,U).then(function(){t.throwIfDestroyed();var Q=t.createMediaKeySessionContext({decryptdata:B,keySystem:O,mediaKeys:U});return t.generateRequestWithPreferredKeySession(Q,r,i,"encrypted-event-no-match")})})),_.catch(function(D){return t.handleError(D)})}}},n._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},n.attemptSetMediaKeys=function(e,t){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var a=Promise.all(i).then(function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(a),a.then(function(){r.log('Media-keys set for "'+e+'"'),i.push(a),r.setMediaKeysQueue=r.setMediaKeysQueue.filter(function(o){return i.indexOf(o)===-1})})},n.generateRequestWithPreferredKeySession=function(e,t,r,i){var a,o,l=this,u=(a=this.config.drmSystems)==null||(o=a[e.keySystem])==null?void 0:o.generateRequest;if(u)try{var d=u.call(this.hls,t,r,e);if(!d)throw new Error("Invalid response from configured generateRequest filter");t=d.initDataType,r=e.decryptdata.pssh=d.initData?new Uint8Array(d.initData):null}catch(_){var c;if(this.warn(_.message),(c=this.hls)!=null&&c.config.debug)throw _}if(r===null)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(e);var f=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+i+'": '+f+" (init data type: "+t+" length: "+(r?r.byteLength:null)+")");var v=new On;e.mediaKeysSession.onmessage=function(_){var A=e.mediaKeysSession;if(A){var E=_.messageType,S=_.message;l.log('"'+E+'" message event for session "'+A.sessionId+'" message size: '+S.byteLength),E==="license-request"||E==="license-renewal"?l.renewLicense(e,S).catch(function(D){l.handleError(D),v.emit("error",D)}):E==="license-release"?e.keySystem===We.FAIRPLAY&&(l.updateKeySession(e,Dt("acknowledged")),l.removeSession(e)):l.warn('unhandled media key message type "'+E+'"')}else v.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(_){if(e.mediaKeysSession){l.onKeyStatusChange(e);var A=e.keyStatus;v.emit("keyStatus",A),A==="expired"&&(l.warn(e.keySystem+" expired for key "+f),l.renewKeySession(e))}else v.emit("error",new Error("invalid state"))};var y=new Promise(function(_,A){v.on("error",A),v.on("keyStatus",function(E){E.startsWith("usable")?_():E==="output-restricted"?A(new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):E==="internal-error"?A(new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+E+'"')):E==="expired"?A(new Error("key expired while generating request")):l.warn('unhandled key status change "'+E+'"')})});return e.mediaKeysSession.generateRequest(t,r).then(function(){var _;l.log('Request generated for key-session "'+((_=e.mediaKeysSession)==null?void 0:_.sessionId)+'" keyId: '+f)}).catch(function(_){throw new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:_,fatal:!1},"Error generating key-session request: "+_)}).then(function(){return y}).catch(function(_){throw v.removeAllListeners(),l.removeSession(e),_}).then(function(){return v.removeAllListeners(),e})},n.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(r,i){t.log('key status change "'+r+'" for keyStatuses keyId: '+Yt("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+Yt(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=r})},n.fetchServerCertificate=function(e){var t=this.config,r=new t.loader(t),i=this.getServerCertificateUrl(e);return i?(this.log('Fetching serverCertificate for "'+e+'"'),new Promise(function(a,o){var l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(f,v,y,_){a(f.data)},onError:function(f,v,y,_){o(new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:j({url:l.url,data:void 0},f)},'"'+e+'" certificate request failed ('+i+"). Status: "+f.code+" ("+f.text+")"))},onTimeout:function(f,v,y){o(new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:l.url,data:void 0}},'"'+e+'" certificate request timed out ('+i+")"))},onAbort:function(f,v,y){o(new Error("aborted"))}};r.load(l,d,c)})):Promise.resolve()},n.setMediaKeysServerCertificate=function(e,t,r){var i=this;return new Promise(function(a,o){e.setServerCertificate(r).then(function(l){i.log("setServerCertificate "+(l?"success":"not supported by CDM")+" ("+(r==null?void 0:r.byteLength)+') on "'+t+'"'),a(e)}).catch(function(l){o(new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})},n.renewLicense=function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then(function(i){return r.updateKeySession(e,new Uint8Array(i)).catch(function(a){throw new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:a,fatal:!0},a.message)})})},n.setupLicenseXHR=function(e,t,r,i){var a=this,o=this.config.licenseXhrSetup;return o?Promise.resolve().then(function(){if(!r.decryptdata)throw new Error("Key removed");return o.call(a.hls,e,t,r,i)}).catch(function(l){if(!r.decryptdata)throw l;return e.open("POST",t,!0),o.call(a.hls,e,t,r,i)}).then(function(l){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||i}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))},n.requestLicense=function(e,t){var r=this,i=this.config.keyLoadPolicy.default;return new Promise(function(a,o){var l=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: "+l);var u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(u.readyState===4)if(u.status===200){r._requestLicenseFailureCount=0;var d=u.response;r.log("License received "+(d instanceof ArrayBuffer?d.byteLength:d));var c=r.config.licenseResponseCallback;if(c)try{d=c.call(r.hls,u,l,e)}catch(_){r.error(_)}a(d)}else{var f=i.errorRetry,v=f?f.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>v||u.status>=400&&u.status<500)o(new $t({type:Z.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:u,response:{url:l,data:void 0,code:u.status,text:u.statusText}},"License Request XHR failed ("+l+"). Status: "+u.status+" ("+u.statusText+")"));else{var y=v-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+y+" attempts left"),r.requestLicense(e,t).then(a,o)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,r.setupLicenseXHR(u,l,e,t).then(function(d){var c=d.xhr,f=d.licenseChallenge;c.send(f)})})},n.onMediaAttached=function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var e=this,t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Gr.clearKeyUriToKeyIdMap();var i=r.length;s.CDMCleanupPromise=Promise.all(r.map(function(a){return e.removeSession(a)}).concat(t==null?void 0:t.setMediaKeys(null).catch(function(a){e.log("Could not clear media keys: "+a+". media.src: "+(t==null?void 0:t.src))}))).then(function(){i&&(e.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(function(a){e.log("Could not close sessions and clear media keys: "+a+". media.src: "+(t==null?void 0:t.src))})},n.onManifestLoading=function(){this.keyFormatPromise=null},n.onManifestLoaded=function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce(function(a,o){return a.indexOf(o.keyFormat)===-1&&a.push(o.keyFormat),a},[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},n.removeSession=function(e){var t=this,r=e.mediaKeysSession,i=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var a=this.mediaKeySessions.indexOf(e);return a>-1&&this.mediaKeySessions.splice(a,1),r.remove().catch(function(o){t.log("Could not remove session: "+o)}).then(function(){return r.close()}).catch(function(o){t.log("Could not close session: "+o)})}},s}();Gs.CDMCleanupPromise=void 0;var $t=function(s){function n(e,t){var r;return(r=s.call(this,t)||this).data=void 0,e.error||(e.error=new Error(t)),r.data=e,e.err=e.error,r}return te(n,s),n}(Ae(Error)),Ol="m",Un="a",Ma="v",Fa="av",Hs="i",Ml="tt",Fl=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(a){try{t.apply(a,{ot:Ol,su:!t.initialized})}catch(o){x.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(a){try{var o=a.frag,l=t.hls.levels[o.level],u=t.getObjectType(o),d={d:1e3*o.duration,ot:u};u!==Ma&&u!==Un&&u!=Fa||(d.br=l.bitrate/1e3,d.tb=t.getTopBandwidth(u)/1e3,d.bl=t.getBufferLength(u)),t.apply(a,d)}catch(c){x.warn("Could not generate segment CMCD data.",c)}},this.hls=e;var r=this.config=e.config,i=r.cmcd;i!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||s.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHED,this.onMediaDetached,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this)},n.unregisterListeners=function(){var e=this.hls;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHED,this.onMediaDetached,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this)},n.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},n.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},n.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},n.onBufferCreated=function(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer},n.createData=function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},n.apply=function(e,t){t===void 0&&(t={}),z(t,this.createData());var r=t.ot===Hs||t.ot===Ma||t.ot===Fa;if(this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var i=s.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),z(e.headers,i)}else{var a=s.toQuery(t);if(!a)return;e.url=s.appendQueryToUri(e.url,a)}},n.getObjectType=function(e){var t=e.type;return t==="subtitle"?Ml:e.sn==="initSegment"?Hs:t==="audio"?Un:t==="main"?this.hls.audioTracks.length?Ma:Fa:void 0},n.getTopBandwidth=function(e){var t,r=0,i=this.hls;if(e===Un)t=i.audioTracks;else{var a=i.maxAutoLevel,o=a>-1?a+1:i.levels.length;t=i.levels.slice(0,o)}for(var l,u=ee(t);!(l=u()).done;){var d=l.value;d.bitrate>r&&(r=d.bitrate)}return r>0?r:NaN},n.getBufferLength=function(e){var t=this.hls.media,r=e===Un?this.audioBuffer:this.videoBuffer;return r&&t?1e3*ne.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},n.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(o,l,u){t(o),this.loader.load(o,l,u)},Y(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},n.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(o,l,u){t(o),this.loader.load(o,l,u)},Y(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},s.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},s.serialize=function(e){for(var t,r=[],i=function(_){return!Number.isNaN(_)&&_!=null&&_!==""&&_!==!1},a=function(_){return Math.round(_)},o=function(_){return 100*a(_/100)},l={br:a,d:a,bl:o,dl:o,mtp:o,nor:function(_){return encodeURIComponent(_)},rtp:o,tb:a},u=ee(Object.keys(e||{}).sort());!(t=u()).done;){var d=t.value,c=e[d];if(i(c)&&!(d==="v"&&c===1||d=="pr"&&c===1)){var f=l[d];f&&(c=f(c));var v=typeof c,y=void 0;y=d==="ot"||d==="sf"||d==="st"?d+"="+c:v==="boolean"?d:v==="number"?d+"="+c:d+"="+JSON.stringify(c),r.push(y)}}return r.join(",")},s.toHeaders=function(e){for(var t={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,l=Object.keys(e);o<l.length;o++){var u=l[o];i[a[u]!=null?a[u]:1][u]=e[u]}for(var d=0;d<i.length;d++){var c=s.serialize(i[d]);c&&(t["CMCD-"+r[d]]=c)}return t},s.toQuery=function(e){return"CMCD="+encodeURIComponent(s.serialize(e))},s.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},s}(),Nl=function(){function s(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=x.log.bind(x,"[content-steering]:"),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var e=this.hls;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.ERROR,this.onError,this))},n.startLoad=function(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){var e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)},n.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},n.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(r){return r!==e}))},n.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},n.onManifestLoaded=function(e,t){var r=t.contentSteering;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())},n.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},n.onError=function(e,t){var r=t.errorAction;if((r==null?void 0:r.action)===sr&&r.flags===m){var i=this.pathwayPriority,a=this.pathwayId;this.penalizedPathways[a]||(this.penalizedPathways[a]=performance.now()),!i&&this.levels&&(i=this.levels.reduce(function(o,l){return o.indexOf(l.pathwayId)===-1&&o.push(l.pathwayId),o},[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==a)}},n.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){var r=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+r+'"'),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t):e},n.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(t){return e===t.pathwayId})},n.updatePathwayPriority=function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(function(c){i-r[c]>3e5&&delete r[c]});for(var a=0;a<e.length;a++){var o=e[a];if(!r[o]){if(o===this.pathwayId)return;var l=this.hls.nextLoadLevel,u=this.hls.levels[l];if((t=this.getLevelsForPathway(o)).length>0){this.log('Setting Pathway to "'+o+'"'),this.pathwayId=o,this.hls.trigger(T.LEVELS_UPDATED,{levels:t});var d=this.hls.levels[l];u&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==u.bitrate&&this.log("Unstable Pathways change from bitrate "+u.bitrate+" to "+d.bitrate),this.hls.nextLoadLevel=l);break}}}},n.clonePathways=function(e){var t=this,r=this.levels;if(r){var i={},a={};e.forEach(function(o){var l=o.ID,u=o["BASE-ID"],d=o["URI-REPLACEMENT"];if(!r.some(function(f){return f.pathwayId===l})){var c=t.getLevelsForPathway(u).map(function(f){var v=z({},f);v.details=void 0,v.url=qs(f.uri,f.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d);var y=new Xe(f.attrs);y["PATHWAY-ID"]=l;var _=y.AUDIO&&y.AUDIO+"_clone_"+l,A=y.SUBTITLES&&y.SUBTITLES+"_clone_"+l;_&&(i[y.AUDIO]=_,y.AUDIO=_),A&&(a[y.SUBTITLES]=A,y.SUBTITLES=A),v.attrs=y;var E=new Wr(v);return M(E,"audio",_),M(E,"text",A),E});r.push.apply(r,c),Ks(t.audioTracks,i,d,l),Ks(t.subtitleTracks,a,d,l)}})}},n.loadSteeringManifest=function(e){var t,r=this,i=this.hls.config,a=i.loader;this.loader&&this.loader.destroy(),this.loader=new a(i);try{t=new self.URL(e)}catch{return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+e)}if(t.protocol!=="data:"){var o=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+o)}var l={responseType:"json",url:t.href},u=i.steeringManifestLoadPolicy.default,d=u.errorRetry||u.timeoutRetry||{},c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},f={onSuccess:function(v,y,_,A){r.log('Loaded steering manifest: "'+t+'"');var E=v.data;if(E.VERSION===1){r.updated=performance.now(),r.timeToLoad=E.TTL;var S=E["RELOAD-URI"],D=E["PATHWAY-CLONES"],R=E["PATHWAY-PRIORITY"];if(S)try{r.uri=new self.URL(S,t).href}catch{return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: "+S)}r.scheduleRefresh(r.uri||_.url),D&&r.clonePathways(D),R&&r.updatePathwayPriority(R)}else r.log("Steering VERSION "+E.VERSION+" not supported!")},onError:function(v,y,_,A){if(r.log("Error loading steering manifest: "+v.code+" "+v.text+" ("+y.url+")"),r.stopLoad(),v.code===410)return r.enabled=!1,void r.log("Steering manifest "+y.url+" no longer available");var E=1e3*r.timeToLoad;if(v.code!==429)r.scheduleRefresh(r.uri||y.url,E);else{var S=r.loader;if(typeof(S==null?void 0:S.getResponseHeader)=="function"){var D=S.getResponseHeader("Retry-After");D&&(E=1e3*parseFloat(D))}r.log("Steering manifest "+y.url+" rate limited")}},onTimeout:function(v,y,_){r.log("Timeout loading steering manifest ("+y.url+")"),r.scheduleRefresh(r.uri||y.url)}};this.log("Requesting steering manifest: "+t),this.loader.load(l,c,f)},n.scheduleRefresh=function(e,t){var r=this;t===void 0&&(t=1e3*this.timeToLoad),self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(function(){r.loadSteeringManifest(e)},t)},s}();function Ks(s,n,e,t){s&&Object.keys(n).forEach(function(r){var i=s.filter(function(a){return a.groupId===r}).map(function(a){var o=z({},a);return o.details=void 0,o.attrs=new Xe(o.attrs),o.url=o.attrs.URI=qs(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),o.groupId=o.attrs["GROUP-ID"]=n[r],o.attrs["PATHWAY-ID"]=t,o});s.push.apply(s,i)})}function qs(s,n,e,t){var r,i=t.HOST,a=t.PARAMS,o=t[e];n&&(r=o==null?void 0:o[n])&&(s=r);var l=new self.URL(s);return i&&!r&&(l.host=i),a&&Object.keys(a).sort().forEach(function(u){u&&l.searchParams.set(u,a[u])}),l.href}var Ul=/^age:\s*[\d.]+\s*$/im,js=function(){function s(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Et,this.retryDelay=0}var n=s.prototype;return n.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},n.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},n.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},n.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()},n.loadInternal=function(){var e=this,t=this.config,r=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0;var o=this.xhrSetup;o?Promise.resolve().then(function(){if(!e.stats.aborted)return o(i,r.url)}).catch(function(l){return i.open("GET",r.url,!0),o(i,r.url)}).then(function(){e.stats.aborted||e.openAndSendXhr(i,r,t)}).catch(function(l){e.callbacks.onError({code:i.status,text:l.message},r,i,a)}):this.openAndSendXhr(i,r,t)}},n.openAndSendXhr=function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=this.context.headers,a=r.loadPolicy,o=a.maxTimeToFirstByteMs,l=a.maxLoadTimeMs;if(i)for(var u in i)e.setRequestHeader(u,i[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&$(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()},n.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,a=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var o=t.status,l=t.responseType!=="text";if(o>=200&&o<300&&(l&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var u=l?t.response:t.responseText,d=t.responseType==="arraybuffer"?u.byteLength:u.length;if(r.loaded=r.total=d,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(r,e,u,t),!this.callbacks)return;var f={url:t.responseURL,data:u,code:o};this.callbacks.onSuccess(f,r,e,t)}else{var v=a.loadPolicy.errorRetry;fi(v,r.retry,!1,o)?this.retry(v):(x.error(o+" while loading "+e.url),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}},n.loadtimeout=function(){var e,t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry;if(fi(t,this.stats.retry,!0))this.retry(t);else{x.warn("timeout while loading "+this.context.url);var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}},n.retry=function(e){var t=this.context,r=this.stats;this.retryDelay=Ni(e,r.retry),r.retry++,x.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},n.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},n.getCacheAge=function(){var e=null;if(this.loader&&Ul.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},n.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},s}(),Bl=/(\d+)-(\d+)\/(\d+)/,Vs=function(){function s(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Gl,this.controller=new self.AbortController,this.stats=new Et}var n=s.prototype;return n.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},n.abortInternal=function(){var e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())},n.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},n.load=function(e,t,r){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var o=function(y,_){var A={method:"GET",mode:"cors",credentials:"same-origin",signal:_,headers:new self.Headers(z({},y.headers))};return y.rangeEnd&&A.headers.set("Range","bytes="+y.rangeStart+"-"+String(y.rangeEnd-1)),A}(e,this.controller.signal),l=r.onProgress,u=e.responseType==="arraybuffer",d=u?"byteLength":"length",c=t.loadPolicy,f=c.maxTimeToFirstByteMs,v=c.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=f&&$(f)?f:v,this.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(a,e,i.response)},t.timeout),self.fetch(this.request).then(function(y){i.response=i.loader=y;var _=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=v,i.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(a,e,i.response)},v-(_-a.loading.start)),!y.ok){var A=y.status,E=y.statusText;throw new Hl(E||"fetch, bad network response",A,y)}return a.loading.first=_,a.total=function(S){var D=S.get("Content-Range");if(D){var R=function(U){var B=Bl.exec(U);if(B)return parseInt(B[2])-parseInt(B[1])+1}(D);if($(R))return R}var O=S.get("Content-Length");if(O)return parseInt(O)}(y.headers)||a.total,l&&$(t.highWaterMark)?i.loadProgressively(y,a,e,t.highWaterMark,l):u?y.arrayBuffer():e.responseType==="json"?y.json():y.text()}).then(function(y){var _=i.response;self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var A=y[d];A&&(a.loaded=a.total=A);var E={url:_.url,data:y,code:_.status};l&&!$(t.highWaterMark)&&l(a,e,y,_),r.onSuccess(E,a,e,_)}).catch(function(y){if(self.clearTimeout(i.requestTimeout),!a.aborted){var _=y&&y.code||0,A=y?y.message:null;r.onError({code:_,text:A},e,y?y.details:null,a)}})},n.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},n.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},n.loadProgressively=function(e,t,r,i,a){i===void 0&&(i=0);var o=new _s,l=e.body.getReader();return function u(){return l.read().then(function(d){if(d.done)return o.dataLength&&a(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));var c=d.value,f=c.length;return t.loaded+=f,f<i||o.dataLength?(o.push(c),o.dataLength>=i&&a(t,r,o.flush(),e)):a(t,r,c,e),u()}).catch(function(){return Promise.reject()})}()},s}();function Gl(s,n){return new self.Request(s.url,n)}var Hl=function(s){function n(e,t,r){var i;return(i=s.call(this,e)||this).code=void 0,i.details=void 0,i.code=t,i.details=r,i}return te(n,s),n}(Ae(Error)),Kl=/\s/,ql=j(j({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:js,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:sl,bufferController:vl,capLevelController:Pl,errorController:w,fpsController:xl,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:wr,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(s,n,e,t){for(var r,i,a,o,l,u=[],d=self.VTTCue||self.TextTrackCue,c=0;c<t.rows.length;c++)if(a=!0,o=0,l="",!(r=t.rows[c]).isEmpty()){for(var f,v=0;v<r.chars.length;v++)Kl.test(r.chars[v].uchar)&&a?o++:(l+=r.chars[v].uchar,a=!1);r.cueStartTime=n,n===e&&(e+=1e-4),o>=16?o--:o++;var y=xs(l.trim()),_=Ia(n,e,y);s!=null&&(f=s.cues)!=null&&f.getCueById(_)||((i=new d(n,e,y)).id=_,i.line=c+1,i.align="left",i.position=10+Math.min(80,10*Math.floor(8*o/32)),u.push(i))}return s&&u.length&&(u.sort(function(A,E){return A.line==="auto"||E.line==="auto"?0:A.line>8&&E.line>8?E.line-A.line:A.line-E.line}),u.forEach(function(A){return Kr(s,A)})),u}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:dl,subtitleTrackController:hl,timelineController:Il,audioStreamController:ol,audioTrackController:ll,emeController:Gs,cmcdController:Fl,contentSteeringController:Nl});function Na(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(Na):Object.keys(s).reduce(function(n,e){return n[e]=Na(s[e]),n},{}):s}function jl(s){var n=s.loader;n!==Vs&&n!==js?(x.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(s.loader=Vs,s.progressive=!0,s.enableSoftwareAES=!0,x.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Ws=function(){function s(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new On,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Ve(e.debug||!1,"Hls instance");var t=this.config=function(ie,J){if((J.liveSyncDurationCount||J.liveMaxLatencyDurationCount)&&(J.liveSyncDuration||J.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(J.liveMaxLatencyDurationCount!==void 0&&(J.liveSyncDurationCount===void 0||J.liveMaxLatencyDurationCount<=J.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(J.liveMaxLatencyDuration!==void 0&&(J.liveSyncDuration===void 0||J.liveMaxLatencyDuration<=J.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var he=Na(ie),be=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(ge){var Ee=(ge==="level"?"playlist":ge)+"LoadPolicy",Le=J[Ee]===void 0,ke=[];be.forEach(function(Fe){var Ge=ge+"Loading"+Fe,Ke=J[Ge];if(Ke!==void 0&&Le){ke.push(Ge);var $e=he[Ee].default;switch(J[Ee]={default:$e},Fe){case"TimeOut":$e.maxLoadTimeMs=Ke,$e.maxTimeToFirstByteMs=Ke;break;case"MaxRetry":$e.errorRetry.maxNumRetry=Ke,$e.timeoutRetry.maxNumRetry=Ke;break;case"RetryDelay":$e.errorRetry.retryDelayMs=Ke,$e.timeoutRetry.retryDelayMs=Ke;break;case"MaxRetryTimeout":$e.errorRetry.maxRetryDelayMs=Ke,$e.timeoutRetry.maxRetryDelayMs=Ke}}}),ke.length&&x.warn('hls.js config: "'+ke.join('", "')+'" setting(s) are deprecated, use "'+Ee+'": '+JSON.stringify(J[Ee]))}),j(j({},he),J)}(s.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&jl(t);var r=t.abrController,i=t.bufferController,a=t.capLevelController,o=t.errorController,l=t.fpsController,u=new o(this),d=this.abrController=new r(this),c=this.bufferController=new i(this),f=this.capLevelController=new a(this),v=new l(this),y=new sa(this),_=new Rr(this),A=t.contentSteeringController,E=A?new A(this):null,S=this.levelController=new L(this,E),D=new ae(this),R=new rt(this.config),O=this.streamController=new nl(this,D,R);f.setStreamController(O),v.setStreamController(O);var U=[y,S,O];E&&U.splice(1,0,E),this.networkControllers=U;var B=[d,c,f,v,_,D];this.audioTrackController=this.createController(t.audioTrackController,U);var Q=t.audioStreamController;Q&&U.push(new Q(this,D,R)),this.subtitleTrackController=this.createController(t.subtitleTrackController,U);var K=t.subtitleStreamController;K&&U.push(new K(this,D,R)),this.createController(t.timelineController,B),R.emeController=this.emeController=this.createController(t.emeController,B),this.cmcdController=this.createController(t.cmcdController,B),this.latencyController=this.createController(la,B),this.coreComponents=B,U.push(u);var q=u.onErrorOut;typeof q=="function"&&this.on(T.ERROR,q,u)}s.isSupported=function(){return function(){var e=ii();if(!e)return!1;var t=ts(),r=e&&typeof e.isTypeSupported=="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!r&&!!i}()};var n=s.prototype;return n.createController=function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},n.on=function(e,t,r){r===void 0&&(r=this),this._emitter.on(e,t,r)},n.once=function(e,t,r){r===void 0&&(r=this),this._emitter.once(e,t,r)},n.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},n.off=function(e,t,r,i){r===void 0&&(r=this),this._emitter.off(e,t,r,i)},n.listeners=function(e){return this._emitter.listeners(e)},n.emit=function(e,t,r){return this._emitter.emit(e,t,r)},n.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){x.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(T.ERROR,{type:Z.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1},n.listenerCount=function(e){return this._emitter.listenerCount(e)},n.destroy=function(){x.log("destroy"),this.trigger(T.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},n.attachMedia=function(e){x.log("attachMedia"),this._media=e,this.trigger(T.MEDIA_ATTACHING,{media:e})},n.detachMedia=function(){x.log("detachMedia"),this.trigger(T.MEDIA_DETACHING,void 0),this._media=null},n.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=we.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});x.log("loadSource:"+i),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(T.MANIFEST_LOADING,{url:e})},n.startLoad=function(e){e===void 0&&(e=-1),x.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},n.stopLoad=function(){x.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},n.swapAudioCodec=function(){x.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){x.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},n.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},Y(s,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){x.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){x.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){x.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){x.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){x.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(x.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){Oi.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=r===-1&&t&&t.length?t.length-1:r,i)for(var a=e;a--;){var o=t[a].attrs["HDCP-LEVEL"];if(o&&o<=i)return a}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.5"}},{key:"Events",get:function(){return T}},{key:"ErrorTypes",get:function(){return Z}},{key:"ErrorDetails",get:function(){return N}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:ql},set:function(e){s.defaultConfig=e}}]),s}();return Ws.defaultConfig=void 0,Ws},b.exports=H()})(!1)})(Eo);var ou=Eo.exports;const lu=po(ou);var uu=lu,Ft=uu,zi=class extends Error{constructor(k,I=zi.MEDIA_ERR_CUSTOM,F,H){var G;super(k),this.name="MediaError",this.code=I,this.context=H,this.fatal=F??(I>=zi.MEDIA_ERR_NETWORK&&I<=zi.MEDIA_ERR_ENCRYPTED),this.message||(this.message=(G=zi.defaultMessages[this.code])!=null?G:"")}},qt=zi;qt.MEDIA_ERR_ABORTED=1,qt.MEDIA_ERR_NETWORK=2,qt.MEDIA_ERR_DECODE=3,qt.MEDIA_ERR_SRC_NOT_SUPPORTED=4,qt.MEDIA_ERR_ENCRYPTED=5,qt.MEDIA_ERR_CUSTOM=100,qt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var du=b=>b==null,To=(b,k)=>du(k)?!1:b in k,Ka={ANY:"any",MUTED:"muted"},Fr={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},Ti={MSE:"mse",NATIVE:"native"},qa={HEADER:"header",QUERY:"query",NONE:"none"},no=Object.values(qa),Nr={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},ao={HLS:Nr.M3U8};[...Object.values(Nr)];var dr=(b,k,I,F,H=b)=>{H.addEventListener(k,I,F),b.addEventListener("teardown",()=>{H.removeEventListener(k,I)},{once:!0})};function cu(b,k,I){k&&I>k&&(I=k);for(let F=0;F<b.length;F++)if(b.start(F)<=I&&b.end(F)>=I)return!0;return!1}var hu=b=>{let k=b.indexOf("?");if(k<0)return[b];let I=b.slice(0,k),F=b.slice(k);return[I,F]},zn=b=>{let k=b.type;if(k){let F=k.toUpperCase();return To(F,ao)?ao[F]:k}let{src:I}=b;return I?fu(I):""},_o=b=>b==="VOD"?Fr.ON_DEMAND:Fr.LIVE,bo=b=>b==="EVENT"?Number.POSITIVE_INFINITY:b==="VOD"?Number.NaN:0,fu=b=>{let k="";try{k=new URL(b).pathname}catch{console.error("invalid url")}let I=k.lastIndexOf(".");if(I<0)return"";let F=k.slice(I+1).toUpperCase();return To(F,Nr)?Nr[F]:""},vu=Object.values(Ka),so=b=>typeof b=="boolean"||typeof b=="string"&&vu.includes(b),gu=({autoplay:b},k,I)=>{let F=!1,H=!1,G=so(b)?b:!!b,j=()=>{F||dr(k,"playing",()=>{F=!0},{once:!0})};if(j(),dr(k,"loadstart",()=>{F=!1,j(),Ga(k,G)},{once:!0}),dr(k,"loadstart",()=>{I||(H=!Number.isFinite(k.duration)),Ga(k,G)},{once:!0}),I&&I.once(Ft.Events.LEVEL_LOADED,(V,Y)=>{var oe;H=(oe=Y.details.live)!=null?oe:!1}),!G){let V=()=>{!H||(I!=null&&I.liveSyncPosition?k.currentTime=I.liveSyncPosition:Number.isFinite(k.seekable.end(0))&&(k.currentTime=k.seekable.end(0)))};I&&dr(k,"play",()=>{k.preload==="metadata"?I.once(Ft.Events.LEVEL_UPDATED,V):V()},{once:!0})}return V=>{F||(G=so(V)?V:!!V,Ga(k,G))}},Ga=(b,k)=>{if(!k)return;let I=b.muted,F=()=>b.muted=I;switch(k){case Ka.ANY:b.play().catch(()=>{b.muted=!0,b.play().catch(F)});break;case Ka.MUTED:b.muted=!0,b.play().catch(F);break;default:b.play().catch(()=>{});break}},mu=({preload:b,src:k},I,F)=>{let H=te=>{te!=null&&["","none","metadata","auto"].includes(te)?I.setAttribute("preload",te):I.removeAttribute("preload")};if(!F)return H(b),H;let G=!1,j=!1,V=F.config.maxBufferLength,Y=F.config.maxBufferSize,oe=te=>{H(te);let Re=te??I.preload;j||Re==="none"||(Re==="metadata"?(F.config.maxBufferLength=1,F.config.maxBufferSize=1):(F.config.maxBufferLength=V,F.config.maxBufferSize=Y),z())},z=()=>{!G&&k&&(G=!0,F.loadSource(k))};return dr(I,"play",()=>{j=!0,F.config.maxBufferLength=V,F.config.maxBufferSize=Y,z()},{once:!0}),oe(b),oe};function pu(b,k){k.on(Ft.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(H,{tracks:G})=>{G.forEach(j=>{var V;let Y=(V=j.subtitleTrack)!=null?V:j.closedCaptions,oe=k.subtitleTracks.findIndex(({lang:z,name:te,type:Re})=>z==(Y==null?void 0:Y.lang)&&te===j.label&&Re.toLowerCase()===j.kind);So(b,j.kind,j.label,Y==null?void 0:Y.lang,`${j.kind}${oe}`)})});let I=()=>{var H;if(!k.subtitleTracks.length)return;let G=Array.from(b.textTracks).find(V=>V.id&&V.mode==="showing"&&["subtitles","captions"].includes(V.kind)),j=`${(H=k.subtitleTracks[k.subtitleTrack])==null?void 0:H.type.toLowerCase()}${k.subtitleTrack}`;if(G&&(k.subtitleTrack<0||(G==null?void 0:G.id)!==j)){let V=k.subtitleTracks.findIndex(({lang:Y,name:oe,type:z})=>Y==G.language&&oe===G.label&&z.toLowerCase()===G.kind);k.subtitleTrack=V}G&&(G==null?void 0:G.id)===j&&G.cues&&Array.from(G.cues).forEach(V=>{G.addCue(V)})};b.textTracks.addEventListener("change",I),k.on(Ft.Events.CUES_PARSED,(H,{track:G,cues:j})=>{let V=b.textTracks.getTrackById(G);if(!V)return;let Y=V.mode==="disabled";Y&&(V.mode="hidden"),j.forEach(oe=>{var z;(z=V.cues)!=null&&z.getCueById(oe.id)||V.addCue(oe)}),Y&&(V.mode="disabled")}),k.once(Ft.Events.DESTROYING,()=>{b.textTracks.removeEventListener("change",I),b.querySelectorAll("track[data-removeondestroy]").forEach(H=>{H.remove()})});let F=()=>{Array.from(b.textTracks).forEach(H=>{var G,j;if(!["subtitles","caption"].includes(H.kind)&&H.label==="thumbnails"){if(!((G=H.cues)!=null&&G.length)){let V=b.querySelector('track[label="thumbnails"]'),Y=(j=V==null?void 0:V.getAttribute("src"))!=null?j:"";V==null||V.removeAttribute("src"),setTimeout(()=>{V==null||V.setAttribute("src",Y)},0)}H.mode!=="hidden"&&(H.mode="hidden")}})};k.once(Ft.Events.MANIFEST_LOADED,F),k.once(Ft.Events.MEDIA_ATTACHED,F)}function So(b,k,I,F,H){let G=document.createElement("track");return G.kind=k,G.label=I,F&&(G.srclang=F),H&&(G.id=H),G.track.mode=["subtitles","captions"].includes(k)?"disabled":"hidden",G.setAttribute("data-removeondestroy",""),b.append(G),G.track}var $i="cuepoints",Qa=Object.freeze({label:$i}),$a=(b,{label:k=$i}=Qa)=>{var I;return(I=Array.from(b.querySelectorAll("track")).find(F=>F.track.label===k&&F.track.kind==="metadata"))==null?void 0:I.track};async function Ao(b,k,I=Qa){let F=$a(b,I);if(!F){let{label:H=$i}=I;F=So(b,"metadata",H),F.mode="hidden",await new Promise(G=>setTimeout(()=>G(void 0),0))}return F.mode!=="hidden"&&(F.mode="hidden"),[...k].sort(({time:H},{time:G})=>G-H).forEach(({time:H,value:G})=>{var j,V;let Y=Array.prototype.findIndex.call(F==null?void 0:F.cues,ce=>ce.startTime>=H),oe=(j=F==null?void 0:F.cues)==null?void 0:j[Y],z=oe?oe.startTime:Number.isFinite(b.duration)?b.duration:Number.MAX_SAFE_INTEGER,te=(V=F==null?void 0:F.cues)==null?void 0:V[Y-1];te&&(te.endTime=H);let Re=new VTTCue(H,z,JSON.stringify(G??null));F.addCue(Re)}),F}var wo=b=>({time:b.startTime,value:JSON.parse(b.text)});function yu(b,k={label:$i}){let I=$a(b,k);return I!=null&&I.cues?Array.from(I.cues,F=>wo(F)):[]}function ko(b,k={label:$i}){var I,F;let H=$a(b,k);if(!((I=H==null?void 0:H.activeCues)!=null&&I.length))return;let{currentTime:G}=b,j=Array.prototype.find.call((F=H.activeCues)!=null?F:[],({startTime:V,endTime:Y})=>V<=G&&Y>G);return wo(j)}async function Eu(b,k=Qa){return new Promise(I=>{dr(b,"loadstart",async()=>{let F=await Ao(b,[],k);dr(b,"cuechange",()=>{let H=ko(b);if(H){let G=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:H});b.dispatchEvent(G)}},{},F),I(F)})})}function Tu(b,k){if(k){let I=k.playingDate;if(I!=null)return new Date(I.getTime()-b.currentTime*1e3)}return typeof b.getStartDate=="function"?b.getStartDate():new Date(NaN)}function _u(b,k){if(k&&k.playingDate)return k.playingDate;if(typeof b.getStartDate=="function"){let I=b.getStartDate();return new Date(I.getTime()+b.currentTime*1e3)}return new Date(NaN)}var bu=async b=>fetch(b).then(k=>k.text()).then(k=>{let I=k.split(`
`).find((F,H,G)=>H&&G[H-1].startsWith("#EXT-X-STREAM-INF"));return fetch(I).then(F=>F.text()).then(F=>F.split(`
`))}),Su=b=>{var k,I;let F=(I=((k=b.find(V=>V.startsWith("#EXT-X-PLAYLIST-TYPE")))!=null?k:"").split(":")[1])==null?void 0:I.trim(),H=_o(F),G=bo(F),j;if(H===Fr.LIVE){let V=b.find(Y=>Y.startsWith("#EXT-X-PART-INF"));V?j=+V.split(":")[1].split("=")[1]*2:j=+b.find(Y=>Y.startsWith("#EXT-X-TARGETDURATION")).split(":")[1]*3}return{streamType:H,targetLiveWindow:G,liveEdgeStartOffset:j}},Au=async(b,k)=>{if(k===Nr.MP4)return{streamType:Fr.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0};if(k===Nr.M3U8){let I=await bu(b);return Su(I)}return console.error(`Media type ${k} is an unrecognized or unsupported type for src ${b}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0}},oo=async(b,k,I=zn({src:b}))=>{var F,H,G;let{streamType:j,targetLiveWindow:V,liveEdgeStartOffset:Y}=await Au(b,I);((F=At.get(k))!=null?F:{}).liveEdgeStartOffset=Y,((H=At.get(k))!=null?H:{}).targetLiveWindow=V,k.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((G=At.get(k))!=null?G:{}).streamType=j,k.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},wu=b=>{var k;let I=b.type,F=_o(I),H=bo(I),G,j=!!((k=b.partList)!=null&&k.length);return F===Fr.LIVE&&(G=j?b.partTarget*2:b.targetduration*3),{streamType:F,targetLiveWindow:H,liveEdgeStartOffset:G,lowLatency:j}},ku=(b,k,I)=>{var F,H,G,j,V,Y,oe,z;let{streamType:te,targetLiveWindow:Re,liveEdgeStartOffset:ce,lowLatency:de}=wu(b);if(te===Fr.LIVE){de?(I.config.backBufferLength=(F=I.userConfig.backBufferLength)!=null?F:4,I.config.maxFragLookUpTolerance=(H=I.userConfig.maxFragLookUpTolerance)!=null?H:.001,I.config.abrBandWidthUpFactor=(G=I.userConfig.abrBandWidthUpFactor)!=null?G:I.config.abrBandWidthFactor):I.config.backBufferLength=(j=I.userConfig.backBufferLength)!=null?j:8;let xe=Object.freeze({get length(){return k.seekable.length},start(Ae){return k.seekable.start(Ae)},end(Ae){var Qe;return Ae>this.length?k.seekable.end(Ae):(Qe=I.liveSyncPosition)!=null?Qe:k.seekable.end(Ae)}});((V=At.get(k))!=null?V:{}).seekable=xe}((Y=At.get(k))!=null?Y:{}).liveEdgeStartOffset=ce,((oe=At.get(k))!=null?oe:{}).targetLiveWindow=Re,k.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((z=At.get(k))!=null?z:{}).streamType=te,k.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},lo,uo,Lu=(uo=(lo=globalThis==null?void 0:globalThis.navigator)==null?void 0:lo.userAgent)!=null?uo:"",Ru=Lu.toLowerCase().indexOf("android")!==-1,At=new WeakMap,Lo="mux.com",co,ho,Ro=(ho=(co=Ft).isSupported)==null?void 0:ho.call(co),Du=Ru,Iu=()=>Xa.utils.now(),Cu=Xa.utils.generateUUID,Pu=(b,{domain:k=Lo,maxResolution:I=""}={})=>{if(!b)return;let[F,H=""]=hu(b),G=new URL(`https://stream.${k}/${F}.m3u8${H}`);return I&&G.searchParams.set("max_resolution",I),G.toString()},xu=b=>{if(!b)return;let[k]=b.split("?");return k||void 0},Ou=b=>{if(!b||!b.startsWith("https://stream."))return;let[k]=new URL(b).pathname.slice(1).split(".m3u8");return k||void 0},Mu=b=>{var k,I,F;return(k=b==null?void 0:b.metadata)!=null&&k.video_id?b.metadata.video_id:Oo(b)&&(F=(I=xu(b.playbackId))!=null?I:Ou(b.src))!=null?F:b.src},Fu=b=>{var k;return(k=At.get(b))==null?void 0:k.error},Nu=b=>{var k,I;return(I=(k=At.get(b))==null?void 0:k.streamType)!=null?I:Fr.UNKNOWN},Uu=b=>{var k,I;return(I=(k=At.get(b))==null?void 0:k.targetLiveWindow)!=null?I:Number.NaN},Do=b=>{var k,I;return(I=(k=At.get(b))==null?void 0:k.seekable)!=null?I:b.seekable},Bu=b=>{var k;let I=(k=At.get(b))==null?void 0:k.liveEdgeStartOffset;if(typeof I!="number")return Number.NaN;let F=Do(b);return F.length?F.end(F.length-1)-I:Number.NaN},Gu=(b,k,I=.001)=>Math.abs(b-k)<=I,Io=(b,k,I=.001)=>b>k||Gu(b,k,I),Hu=b=>b.paused&&Io(b.currentTime,b.duration),Co=(b,k)=>k?b.ended:b.ended||Hu(b),Ku=(b,k,I)=>{Po(k,I);let{metadata:F={}}=b,{view_session_id:H=Cu()}=F,G=Mu(b);F.view_session_id=H,F.video_id=G,b.metadata=F,At.set(k,{});let j=qu(b,k);Vu(b,k,j),Wu(b,k,j),Eu(k);let V=gu(b,k,j),Y=mu(b,k,j);return{engine:j,setAutoplay:V,setPreload:Y}},Po=(b,k)=>{let I=k==null?void 0:k.engine;I&&(I.detachMedia(),I.destroy()),b!=null&&b.mux&&!b.mux.deleted&&(b.mux.destroy(),delete b.mux),b&&(b.removeAttribute("src"),b.load(),b.removeEventListener("error",Fo),b.removeEventListener("error",ja),b.removeEventListener("durationchange",Mo),At.delete(b),b.dispatchEvent(new Event("teardown")))};function xo(b,k){var I;let F=zn(b);if(F!==Nr.M3U8)return!0;let H=!F||((I=k.canPlayType(F))!=null?I:!0),{preferPlayback:G}=b,j=G===Ti.MSE,V=G===Ti.NATIVE;return H&&(V||!(Ro&&(j||Du)))}var qu=(b,k)=>{let{debug:I,streamType:F,startTime:H=-1,metadata:G,preferCmcd:j}=b,V=zn(b)===Nr.M3U8,Y=xo(b,k);if(V&&!Y&&Ro){let oe={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0},z=ju(F),te=j!==qa.NONE?{useHeaders:j===qa.HEADER,sessionId:G==null?void 0:G.view_session_id,contentId:G==null?void 0:G.video_id}:void 0;return new Ft({debug:I,startPosition:H,cmcd:te,...oe,...z})}},ju=b=>b===Fr.LIVE?{backBufferLength:8}:{},Oo=({playbackId:b,src:k,customDomain:I})=>{if(b)return!0;if(typeof k!="string")return!1;let F=window==null?void 0:window.location.href,H=new URL(k,F).hostname.toLocaleLowerCase();return H.includes(Lo)||!!I&&H.includes(I.toLocaleLowerCase())},Vu=(b,k,I)=>{var F;let{envKey:H}=b,G=Oo(b);if(H||G){let{playerInitTime:j,playerSoftwareName:V,playerSoftwareVersion:Y,beaconCollectionDomain:oe,debug:z,disableCookies:te}=b,Re={...b.metadata,video_title:((F=b==null?void 0:b.metadata)==null?void 0:F.video_title)||void 0},ce=de=>typeof de.player_error_code=="string"?!1:typeof b.errorTranslator=="function"?b.errorTranslator(de):de;Xa.monitor(k,{debug:z,beaconCollectionDomain:oe,hlsjs:I,Hls:I?Ft:void 0,automaticErrorTracking:!1,errorTranslator:ce,disableCookies:te,data:{...H?{env_key:H}:{},player_software_name:V,player_software:V,player_software_version:Y,player_init_time:j,...Re}})}},Wu=(b,k,I)=>{var F;let H=xo(b,k),{src:G}=b;if(k&&H){let j=zn(b);typeof G=="string"?(k.preload==="none"?dr(k,"loadstart",()=>oo(G,k,j)):oo(G,k,j),k.setAttribute("src",G),b.startTime&&(((F=At.get(k))!=null?F:{}).startTime=b.startTime,k.addEventListener("durationchange",Mo,{once:!0}))):k.removeAttribute("src"),k.addEventListener("error",Fo),k.addEventListener("error",ja),k.addEventListener("emptied",()=>{k.querySelectorAll("track[data-removeondestroy]").forEach(V=>{V.remove()})},{once:!0}),dr(k,"pause",()=>{!Co(k)||k.ended||k.dispatchEvent(new Event("ended"))}),dr(k,"play",()=>{k.ended||!Io(k.currentTime,k.duration)||(k.currentTime=k.seekable.start(0))})}else I&&G?(I.once(Ft.Events.LEVEL_LOADED,(j,V)=>{ku(V.details,k,I)}),I.on(Ft.Events.ERROR,(j,V)=>{let Y={[Ft.ErrorTypes.NETWORK_ERROR]:qt.MEDIA_ERR_NETWORK,[Ft.ErrorTypes.MEDIA_ERROR]:qt.MEDIA_ERR_DECODE},oe=new qt("",Y[V.type]);oe.fatal=V.fatal,oe.data=V,k.dispatchEvent(new CustomEvent("error",{detail:oe}))}),k.addEventListener("error",ja),pu(k,I),I.attachMedia(k)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function Mo(b){var k;let I=b.target,F=(k=At.get(I))==null?void 0:k.startTime;if(F&&cu(I.seekable,I.duration,F)){let H=I.preload==="auto";H&&(I.preload="none"),I.currentTime=F,H&&(I.preload="auto")}}async function Fo(b){if(!b.isTrusted)return;b.stopImmediatePropagation();let k=b.target;if(!(k!=null&&k.error))return;let{message:I,code:F}=k.error,H=new qt(I,F);if(k.src&&(F!==qt.MEDIA_ERR_DECODE||F!==void 0))try{let{status:G}=await fetch(k.src);H.data={response:{code:G}}}catch{}k.dispatchEvent(new CustomEvent("error",{detail:H}))}function ja(b){var k,I;if(!(b instanceof CustomEvent)||!(b.detail instanceof qt))return;let F=b.target,H=b.detail;!H||!H.fatal||(((k=At.get(F))!=null?k:{}).error=H,(I=F.mux)==null||I.emit("error",{player_error_code:H.code,player_error_message:H.message,player_error_context:H.context}))}var Yu=Object.defineProperty,zu=(b,k,I)=>k in b?Yu(b,k,{enumerable:!0,configurable:!0,writable:!0,value:I}):b[k]=I,_i=(b,k,I)=>(zu(b,typeof k!="symbol"?k+"":k,I),I),Ja=(b,k,I)=>{if(!k.has(b))throw TypeError("Cannot "+I)},le=(b,k,I)=>(Ja(b,k,"read from private field"),I?I.call(b):k.get(b)),Ue=(b,k,I)=>{if(k.has(b))throw TypeError("Cannot add the same private member more than once");k instanceof WeakSet?k.add(b):k.set(b,I)},tt=(b,k,I,F)=>(Ja(b,k,"write to private field"),F?F.call(b,I):k.set(b,I),I),nt=(b,k,I)=>(Ja(b,k,"access private method"),I),Xn=class{addEventListener(){}removeEventListener(){}dispatchEvent(b){return!0}};if(typeof DocumentFragment>"u"){class b extends Xn{}globalThis.DocumentFragment=b}var Za=class extends Xn{},Xu=class extends Xn{},Qu={get(b){},define(b,k,I){},upgrade(b){},whenDefined(b){return Promise.resolve(Za)}},Hn,$u=class{constructor(b,k={}){Ue(this,Hn,void 0),tt(this,Hn,k==null?void 0:k.detail)}get detail(){return le(this,Hn)}initCustomEvent(){}};Hn=new WeakMap;function Ju(b,k){return new Za}var Zu={document:{createElement:Ju},DocumentFragment,customElements:Qu,CustomEvent:$u,EventTarget:Xn,HTMLElement:Za,HTMLVideoElement:Xu},ed=typeof window>"u"||typeof globalThis.customElements>"u",Kn=ed?Zu:globalThis,td=()=>{try{return"0.15.4"}catch{}return"UNKNOWN"},rd=td(),id=()=>rd,fo=b=>{var k,I,F,H,G,j,V,Y,oe,z,te,Re,ce,de,xe,Ae,Qe,ee,fe,Te,De,we,$,T,Z,N,ye,Ye,Je,Ct,Ve,x,jt,Pt,Xe,Vt,Be,Et,Ze,gt;return k=class extends b{constructor(){super(),Ue(this,ye),Ue(this,Je),Ue(this,Ve),Ue(this,jt),Ue(this,Xe),Ue(this,Be),Ue(this,Ze),_i(this,"castEnabled",!1),Ue(this,De,{paused:!1}),Ue(this,we,void 0),Ue(this,$,{}),Ue(this,T,void 0),Ue(this,Z,void 0),Ue(this,N,void 0),k.instances.add(this),nt(this,Xe,Vt).call(this)}static get castElement(){return le(k,I)}static get castEnabled(){return le(k,F)}static get castState(){var X;return(X=le(k,oe,z))==null?void 0:X.getCastState()}static async exitCast(){try{await le(k,oe,z).endCurrentSession(!0)}catch(X){console.error(X);return}}get castPlayer(){if(k.castElement===this)return le(this,we)}attributeChangedCallback(X){if(this.castPlayer)switch(X){case"cast-stream-type":case"cast-src":this.load();break}}async requestCast(X={}){var ve;nt(ve=k,fe,Te).call(ve,X),tt(k,I,this),Object.entries(le(this,$)).forEach(([je,at])=>{le(this,we).controller.addEventListener(je,at)});try{await le(k,oe,z).requestSession()}catch{tt(k,I,void 0);return}le(this,De).paused=super.paused,super.pause(),this.muted=super.muted;try{await this.load()}catch(je){console.error(je)}}async load(){var X,ve;if(!this.castPlayer)return super.load();let je=new chrome.cast.media.MediaInfo(this.castSrc,this.castContentType),at=[...this.querySelectorAll("track")].filter(({kind:Dt,src:We})=>We&&(Dt==="subtitles"||Dt==="captions")),mt=[],wt=0;at.length&&(je.tracks=at.map(Dt=>{let We=++wt;mt.length===0&&Dt.track.mode==="showing"&&mt.push(We);let xt=new chrome.cast.media.Track(We,chrome.cast.media.TrackType.TEXT);return xt.trackContentId=Dt.src,xt.trackContentType="text/vtt",xt.subtype=Dt.kind==="captions"?chrome.cast.media.TextTrackType.CAPTIONS:chrome.cast.media.TextTrackType.SUBTITLES,xt.name=Dt.label,xt.language=Dt.srclang,xt})),this.castStreamType==="live"?je.streamType=chrome.cast.media.StreamType.LIVE:je.streamType=chrome.cast.media.StreamType.BUFFERED,je.metadata=new chrome.cast.media.GenericMediaMetadata,je.metadata.title=this.title,je.metadata.images=[{url:this.poster}];let er=new chrome.cast.media.LoadRequest(je);er.currentTime=(X=super.currentTime)!=null?X:0,er.autoplay=!le(this,De).paused,er.activeTrackIds=mt,await((ve=le(k,te,Re))==null?void 0:ve.loadMedia(er)),this.dispatchEvent(new Event("volumechange"))}play(){var X;if(this.castPlayer){this.castPlayer.isPaused&&((X=this.castPlayer.controller)==null||X.playOrPause());return}return super.play()}pause(){var X;if(this.castPlayer){this.castPlayer.isPaused||(X=this.castPlayer.controller)==null||X.playOrPause();return}super.pause()}get castSrc(){var X,ve,je;return(je=(ve=this.getAttribute("cast-src"))!=null?ve:(X=this.querySelector("source"))==null?void 0:X.src)!=null?je:this.currentSrc}set castSrc(X){this.castSrc!=X&&this.setAttribute("cast-src",`${X}`)}get castContentType(){var X;return(X=this.getAttribute("cast-content-type"))!=null?X:void 0}set castContentType(X){this.setAttribute("cast-content-type",`${X}`)}get castStreamType(){var X,ve;return(ve=(X=this.getAttribute("cast-stream-type"))!=null?X:this.streamType)!=null?ve:void 0}set castStreamType(X){this.setAttribute("cast-stream-type",`${X}`)}get readyState(){if(this.castPlayer)switch(this.castPlayer.playerState){case chrome.cast.media.PlayerState.IDLE:return 0;case chrome.cast.media.PlayerState.BUFFERING:return 2;default:return 3}return super.readyState}get paused(){return this.castPlayer?this.castPlayer.isPaused:super.paused}get muted(){var X;return this.castPlayer?(X=this.castPlayer)==null?void 0:X.isMuted:super.muted}set muted(X){var ve;if(this.castPlayer){(X&&!this.castPlayer.isMuted||!X&&this.castPlayer.isMuted)&&((ve=this.castPlayer.controller)==null||ve.muteOrUnmute());return}super.muted=X}get volume(){var X,ve;return this.castPlayer?(ve=(X=this.castPlayer)==null?void 0:X.volumeLevel)!=null?ve:1:super.volume}set volume(X){var ve;if(this.castPlayer){this.castPlayer.volumeLevel=X,(ve=this.castPlayer.controller)==null||ve.setVolumeLevel();return}super.volume=X}get duration(){var X,ve;return this.castPlayer&&le(this,ye,Ye)?(ve=(X=this.castPlayer)==null?void 0:X.duration)!=null?ve:NaN:super.duration}get currentTime(){var X,ve;return this.castPlayer&&le(this,ye,Ye)?(ve=(X=this.castPlayer)==null?void 0:X.currentTime)!=null?ve:0:super.currentTime}set currentTime(X){var ve;if(this.castPlayer){this.castPlayer.currentTime=X,(ve=this.castPlayer.controller)==null||ve.seek();return}super.currentTime=X}get onentercast(){return le(this,T)}set onentercast(X){le(this,T)&&(this.removeEventListener("entercast",le(this,T)),tt(this,T,null)),typeof X=="function"&&(tt(this,T,X),this.addEventListener("entercast",X))}get onleavecast(){return le(this,Z)}set onleavecast(X){le(this,Z)&&(this.removeEventListener("leavecast",le(this,Z)),tt(this,Z,null)),typeof X=="function"&&(tt(this,Z,X),this.addEventListener("leavecast",X))}get oncastchange(){return le(this,N)}set oncastchange(X){le(this,N)&&(this.removeEventListener("castchange",le(this,N)),tt(this,N,null)),typeof X=="function"&&(tt(this,N,X),this.addEventListener("castchange",X))}},I=new WeakMap,F=new WeakMap,H=new WeakMap,G=new WeakSet,j=function(){return typeof chrome<"u"&&chrome.cast&&chrome.cast.isAvailable},V=new WeakSet,Y=function(){return typeof cast<"u"&&cast.framework},oe=new WeakSet,z=function(){if(le(k,V,Y))return cast.framework.CastContext.getInstance()},te=new WeakSet,Re=function(){var X;return(X=le(k,oe,z))==null?void 0:X.getCurrentSession()},ce=new WeakSet,de=function(){var X;return(X=le(k,te,Re))==null?void 0:X.getSessionObj().media[0]},xe=new WeakSet,Ae=function(X){return new Promise((ve,je)=>{le(k,ce,de).editTracksInfo(X,ve,je)})},Qe=new WeakSet,ee=function(X){return new Promise((ve,je)=>{le(k,ce,de).getStatus(X,ve,je)})},fe=new WeakSet,Te=function(X){return le(k,oe,z).setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,androidReceiverCompatible:!1,language:"en-US",resumeSavedSession:!0,...X})},De=new WeakMap,we=new WeakMap,$=new WeakMap,T=new WeakMap,Z=new WeakMap,N=new WeakMap,ye=new WeakSet,Ye=function(){var X;return(X=this.castPlayer)==null?void 0:X.isMediaLoaded},Je=new WeakSet,Ct=function(){le(k,I)===this&&(Object.entries(le(this,$)).forEach(([X,ve])=>{le(this,we).controller.removeEventListener(X,ve)}),tt(k,I,void 0),this.muted=le(this,we).isMuted,this.currentTime=le(this,we).savedPlayerState.currentTime,le(this,we).savedPlayerState.isPaused===!1&&this.play())},Ve=new WeakSet,x=function(){this.dispatchEvent(new CustomEvent("castchange",{detail:le(k,oe,z).getCastState()}))},jt=new WeakSet,Pt=async function(){var X,ve;let{SESSION_RESUMED:je}=cast.framework.SessionState;if(le(k,oe,z).getSessionState()===je&&this.castSrc===((X=le(k,ce,de))==null?void 0:X.media.contentId)){tt(k,I,this),Object.entries(le(this,$)).forEach(([at,mt])=>{le(this,we).controller.addEventListener(at,mt)});try{await nt(ve=k,Qe,ee).call(ve,new chrome.cast.media.GetStatusRequest)}catch(at){console.error(at)}le(this,$)[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED](),le(this,$)[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]()}},Xe=new WeakSet,Vt=function(){var X;!le(k,V,Y)||this.castEnabled||(this.castEnabled=!0,nt(X=k,fe,Te).call(X),this.textTracks.addEventListener("change",nt(this,Ze,gt).bind(this)),nt(this,Ve,x).call(this),tt(this,we,new cast.framework.RemotePlayer),new cast.framework.RemotePlayerController(le(this,we)),tt(this,$,{[cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED]:({value:ve})=>{ve===!1&&nt(this,Je,Ct).call(this),this.dispatchEvent(new Event(ve?"entercast":"leavecast"))},[cast.framework.RemotePlayerEventType.DURATION_CHANGED]:()=>{this.dispatchEvent(new Event("durationchange"))},[cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED]:()=>{this.dispatchEvent(new Event("volumechange"))},[cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED]:()=>{!le(this,ye,Ye)||this.dispatchEvent(new Event("timeupdate"))},[cast.framework.RemotePlayerEventType.VIDEO_INFO_CHANGED]:()=>{this.dispatchEvent(new Event("resize"))},[cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED]:()=>{this.dispatchEvent(new Event(this.paused?"pause":"play"))},[cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED]:()=>{var ve,je;((ve=this.castPlayer)==null?void 0:ve.playerState)!==chrome.cast.media.PlayerState.PAUSED&&this.dispatchEvent(new Event({[chrome.cast.media.PlayerState.PLAYING]:"playing",[chrome.cast.media.PlayerState.BUFFERING]:"waiting",[chrome.cast.media.PlayerState.IDLE]:"emptied"}[(je=this.castPlayer)==null?void 0:je.playerState]))},[cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED]:async()=>{!le(this,ye,Ye)||(await Promise.resolve(),nt(this,Be,Et).call(this))}}))},Be=new WeakSet,Et=function(){nt(this,Ze,gt).call(this)},Ze=new WeakSet,gt=async function(){var X,ve,je,at,mt,wt;if(!this.castPlayer)return;let er=((ve=(X=le(this,we).mediaInfo)==null?void 0:X.tracks)!=null?ve:[]).filter(({type:et})=>et===chrome.cast.media.TrackType.TEXT),Dt=[...this.textTracks].filter(({kind:et})=>et==="subtitles"||et==="captions"),We=er.map(({language:et,name:hr,trackId:fr})=>{var Ar;let{mode:wr}=(Ar=Dt.find(Wt=>Wt.language===et&&Wt.label===hr))!=null?Ar:{};return wr?{mode:wr,trackId:fr}:!1}).filter(Boolean),xt=We.filter(({mode:et})=>et!=="showing").map(({trackId:et})=>et),cr=We.find(({mode:et})=>et==="showing"),nr=(mt=(at=(je=le(k,te,Re))==null?void 0:je.getSessionObj().media[0])==null?void 0:at.activeTrackIds)!=null?mt:[],It=nr;if(nr.length&&(It=It.filter(et=>!xt.includes(et))),cr!=null&&cr.trackId&&(It=[...It,cr.trackId]),It=[...new Set(It)],!((et,hr)=>et.length===hr.length&&et.every(fr=>hr.includes(fr)))(nr,It))try{let et=new chrome.cast.media.EditTracksInfoRequest(It);await nt(wt=k,xe,Ae).call(wt,et)}catch(et){console.error(et)}},Ue(k,G),Ue(k,V),Ue(k,oe),Ue(k,te),Ue(k,ce),Ue(k,xe),Ue(k,Qe),Ue(k,fe),_i(k,"observedAttributes",["cast-src","cast-content-type","cast-stream-type"]),_i(k,"instances",new Set),Ue(k,I,void 0),Ue(k,F,!1),_i(k,"initCast",()=>{var X;le(k,G,j)?le(k,V,Y)?le(X=k,H).call(X,chrome.cast.isAvailable):customElements.whenDefined("google-cast-button").then(()=>{var ve;return le(ve=k,H).call(ve,chrome.cast.isAvailable)}):globalThis.__onGCastApiAvailable=()=>{customElements.whenDefined("google-cast-button").then(()=>{var ve;return le(ve=k,H).call(ve,chrome.cast.isAvailable)})}}),Ue(k,H,X=>{if(X){tt(k,F,!0);let{CAST_STATE_CHANGED:ve}=cast.framework.CastContextEventType;le(k,oe,z).addEventListener(ve,at=>{k.instances.forEach(mt=>{var wt;return nt(wt=mt,Ve,x).call(wt,at)})});let{SESSION_STATE_CHANGED:je}=cast.framework.CastContextEventType;le(k,oe,z).addEventListener(je,at=>{k.instances.forEach(mt=>{var wt;return nt(wt=mt,jt,Pt).call(wt,at)})}),k.instances.forEach(at=>{var mt;return nt(mt=at,Xe,Vt).call(mt)})}}),k},Va=globalThis.HTMLVideoElement?fo(HTMLVideoElement):fo(Object);globalThis.customElements&&!globalThis.customElements.get("castable-video")&&(customElements.define("castable-video",Va,{extends:"video"}),globalThis.CastableVideoElement=Va);Va.initCast();var No=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],vo,Wa=(vo=globalThis.document)==null?void 0:vo.createElement("template");Wa&&(Wa.innerHTML=`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      audio {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
      }
    </style>
    <slot></slot>
  `);var go,Ya=(go=globalThis.document)==null?void 0:go.createElement("template");Ya&&(Ya.innerHTML=`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      video {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, 50% 50%);
      }

      video::-webkit-media-text-track-container {
        transform: var(--media-webkit-text-track-transform);
        transition: var(--media-webkit-text-track-transition);
      }
    </style>
    <slot></slot>
  `);var es=(b,{tag:k,is:I})=>{var F,H,G,j,V,Y,oe,z,te,Re,ce,de,xe;let Ae=(F=globalThis.document)==null?void 0:F.createElement(k,{is:I}),Qe=Ae?nd(Ae):[];return H=class extends b{constructor(){super(),Ue(this,z),Ue(this,Re),Ue(this,de),Ue(this,Y,void 0),Ue(this,oe,void 0),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.append(this.constructor.template.content.cloneNode(!0)))}static get observedAttributes(){var ee,fe,Te;return nt(ee=H,j,V).call(ee),[...(Te=(fe=Ae==null?void 0:Ae.constructor)==null?void 0:fe.observedAttributes)!=null?Te:[],"autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"]}get nativeEl(){var ee,fe;return(fe=(ee=le(this,oe))!=null?ee:this.shadowRoot.querySelector(k))!=null?fe:this.querySelector(k)}set nativeEl(ee){tt(this,oe,ee)}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(ee){this.toggleAttribute("muted",!!ee)}get src(){return this.getAttribute("src")}set src(ee){this.setAttribute("src",`${ee}`)}get preload(){var ee,fe;return(fe=this.getAttribute("preload"))!=null?fe:(ee=this.nativeEl)==null?void 0:ee.preload}set preload(ee){this.setAttribute("preload",`${ee}`)}attributeChangedCallback(ee,fe,Te){nt(this,z,te).call(this),nt(this,de,xe).call(this,ee,fe,Te)}connectedCallback(){nt(this,z,te).call(this)}},G=new WeakMap,j=new WeakSet,V=function(){if(le(this,G))return;tt(this,G,!0);let ee=new Set(this.observedAttributes);ee.delete("muted");for(let fe of Qe)if(!(fe in this.prototype))if(typeof Ae[fe]=="function")this.prototype[fe]=function(...Te){return nt(this,z,te).call(this),(()=>this.call?this.call(fe,...Te):this.nativeEl[fe].apply(this.nativeEl,Te))()};else{let Te={get(){var De,we,$;nt(this,z,te).call(this);let T=fe.toLowerCase();if(ee.has(T)){let Z=this.getAttribute(T);return Z===null?!1:Z===""?!0:Z}return($=(De=this.get)==null?void 0:De.call(this,fe))!=null?$:(we=this.nativeEl)==null?void 0:we[fe]}};fe!==fe.toUpperCase()&&(Te.set=function(De){nt(this,z,te).call(this);let we=fe.toLowerCase();if(ee.has(we)){De===!0||De===!1||De==null?this.toggleAttribute(we,!!De):this.setAttribute(we,De);return}if(this.set){this.set(fe,De);return}this.nativeEl[fe]=De}),Object.defineProperty(this.prototype,fe,Te)}},Y=new WeakMap,oe=new WeakMap,z=new WeakSet,te=function(){var ee,fe;if(le(this,Y))return;if(tt(this,Y,!0),!this.nativeEl){let we=document.createElement(k,{is:I});we.part=k,this.shadowRoot.append(we)}this.nativeEl.muted=this.hasAttribute("muted");for(let we of Qe)nt(this,Re,ce).call(this,we);let Te=new Map,De=this.shadowRoot.querySelector("slot:not([name])");De==null||De.addEventListener("slotchange",()=>{let we=new Map(Te);De.assignedElements().filter($=>["track","source"].includes($.localName)).forEach($=>{var T,Z;we.delete($);let N=Te.get($);N||(N=$.cloneNode(),Te.set($,N)),(Z=(T=this.nativeEl).append)==null||Z.call(T,N)}),we.forEach($=>$.remove())});for(let we of this.constructor.Events)(fe=(ee=this.shadowRoot).addEventListener)==null||fe.call(ee,we,$=>{$.target===this.nativeEl&&this.dispatchEvent(new CustomEvent($.type,{detail:$.detail}))},!0)},Re=new WeakSet,ce=function(ee){if(Object.prototype.hasOwnProperty.call(this,ee)){let fe=this[ee];delete this[ee],this[ee]=fe}},de=new WeakSet,xe=function(ee,fe,Te){var De,we,$,T;["id","class"].includes(ee)||(Te===null?(we=(De=this.nativeEl).removeAttribute)==null||we.call(De,ee):(T=($=this.nativeEl).setAttribute)==null||T.call($,ee,Te))},Ue(H,j),_i(H,"Events",No),_i(H,"template",k.endsWith("audio")?Wa:Ya),Ue(H,G,void 0),H};function nd(b){let k=[];for(let I=Object.getPrototypeOf(b);I&&I!==HTMLElement.prototype;I=Object.getPrototypeOf(I))k.push(...Object.getOwnPropertyNames(I));return k}globalThis.document?es(HTMLElement,{tag:"video"}):class{};globalThis.document?es(HTMLElement,{tag:"audio"}):class{};No.push("castchange","entercast","leavecast");var Ha=es(Kn.HTMLElement,{tag:"video",is:"castable-video"}),Se={BEACON_COLLECTION_DOMAIN:"beacon-collection-domain",CUSTOM_DOMAIN:"custom-domain",DEBUG:"debug",DISABLE_COOKIES:"disable-cookies",ENV_KEY:"env-key",MAX_RESOLUTION:"max-resolution",METADATA_URL:"metadata-url",PLAYBACK_ID:"playback-id",PLAYER_SOFTWARE_NAME:"player-software-name",PLAYER_SOFTWARE_VERSION:"player-software-version",PREFER_CMCD:"prefer-cmcd",PREFER_PLAYBACK:"prefer-playback",START_TIME:"start-time",STREAM_TYPE:"stream-type",TARGET_LIVE_WINDOW:"target-live-window",LIVE_EDGE_OFFSET:"live-edge-offset",TYPE:"type"},ad=Object.values(Se),sd=id(),od="mux-video",Sr,Xi,qn,Qi,jn,Vn,Wn,Yn,za,mo=class extends Ha{constructor(){super(),Ue(this,Yn),Ue(this,Sr,void 0),Ue(this,Xi,void 0),Ue(this,qn,void 0),Ue(this,Qi,{}),Ue(this,jn,void 0),Ue(this,Vn,void 0),Ue(this,Wn,void 0),tt(this,qn,Iu())}static get observedAttributes(){var b;return[...ad,...(b=Ha.observedAttributes)!=null?b:[]]}get preferCmcd(){var b;return(b=this.getAttribute(Se.PREFER_CMCD))!=null?b:void 0}set preferCmcd(b){b!==this.preferCmcd&&(b?no.includes(b)?this.setAttribute(Se.PREFER_CMCD,b):console.warn(`Invalid value for preferCmcd. Must be one of ${no.join()}`):this.removeAttribute(Se.PREFER_CMCD))}get playerInitTime(){return le(this,qn)}get playerSoftwareName(){var b;return(b=le(this,Vn))!=null?b:od}set playerSoftwareName(b){tt(this,Vn,b)}get playerSoftwareVersion(){var b;return(b=le(this,jn))!=null?b:sd}set playerSoftwareVersion(b){tt(this,jn,b)}get _hls(){var b;return(b=le(this,Sr))==null?void 0:b.engine}get mux(){return this.nativeEl.mux}get error(){var b;return(b=Fu(this.nativeEl))!=null?b:null}get errorTranslator(){return le(this,Wn)}set errorTranslator(b){tt(this,Wn,b)}get src(){return this.getAttribute("src")}set src(b){b!==this.src&&(b==null?this.removeAttribute("src"):this.setAttribute("src",b))}get type(){var b;return(b=this.getAttribute(Se.TYPE))!=null?b:void 0}set type(b){b!==this.type&&(b?this.setAttribute(Se.TYPE,b):this.removeAttribute(Se.TYPE))}get autoplay(){let b=this.getAttribute("autoplay");return b===null?!1:b===""?!0:b}set autoplay(b){let k=this.autoplay;b!==k&&(b?this.setAttribute("autoplay",typeof b=="string"?b:""):this.removeAttribute("autoplay"))}get preload(){let b=this.getAttribute("preload");return b===""?"auto":["none","metadata","auto"].includes(b)?b:super.preload}set preload(b){b!=this.getAttribute("preload")&&(["","none","metadata","auto"].includes(b)?this.setAttribute("preload",b):this.removeAttribute("preload"))}get debug(){return this.getAttribute(Se.DEBUG)!=null}set debug(b){b!==this.debug&&(b?this.setAttribute(Se.DEBUG,""):this.removeAttribute(Se.DEBUG))}get disableCookies(){return this.hasAttribute(Se.DISABLE_COOKIES)}set disableCookies(b){b!==this.disableCookies&&(b?this.setAttribute(Se.DISABLE_COOKIES,""):this.removeAttribute(Se.DISABLE_COOKIES))}get startTime(){let b=this.getAttribute(Se.START_TIME);if(b==null)return;let k=+b;return Number.isNaN(k)?void 0:k}set startTime(b){b!==this.startTime&&(b==null?this.removeAttribute(Se.START_TIME):this.setAttribute(Se.START_TIME,`${b}`))}get playbackId(){var b;return(b=this.getAttribute(Se.PLAYBACK_ID))!=null?b:void 0}set playbackId(b){b!==this.playbackId&&(b?this.setAttribute(Se.PLAYBACK_ID,b):this.removeAttribute(Se.PLAYBACK_ID))}get maxResolution(){var b;return(b=this.getAttribute(Se.MAX_RESOLUTION))!=null?b:void 0}set maxResolution(b){b!==this.maxResolution&&(b?this.setAttribute(Se.MAX_RESOLUTION,b):this.removeAttribute(Se.MAX_RESOLUTION))}get customDomain(){var b;return(b=this.getAttribute(Se.CUSTOM_DOMAIN))!=null?b:void 0}set customDomain(b){b!==this.customDomain&&(b?this.setAttribute(Se.CUSTOM_DOMAIN,b):this.removeAttribute(Se.CUSTOM_DOMAIN))}get ended(){return Co(this.nativeEl,this._hls)}get envKey(){var b;return(b=this.getAttribute(Se.ENV_KEY))!=null?b:void 0}set envKey(b){b!==this.envKey&&(b?this.setAttribute(Se.ENV_KEY,b):this.removeAttribute(Se.ENV_KEY))}get beaconCollectionDomain(){var b;return(b=this.getAttribute(Se.BEACON_COLLECTION_DOMAIN))!=null?b:void 0}set beaconCollectionDomain(b){b!==this.beaconCollectionDomain&&(b?this.setAttribute(Se.BEACON_COLLECTION_DOMAIN,b):this.removeAttribute(Se.BEACON_COLLECTION_DOMAIN))}get streamType(){var b;return(b=this.getAttribute(Se.STREAM_TYPE))!=null?b:Nu(this.nativeEl)}set streamType(b){b!==this.streamType&&(b?this.setAttribute(Se.STREAM_TYPE,b):this.removeAttribute(Se.STREAM_TYPE))}get targetLiveWindow(){return this.hasAttribute(Se.TARGET_LIVE_WINDOW)?+this.getAttribute(Se.TARGET_LIVE_WINDOW):Uu(this.nativeEl)}set targetLiveWindow(b){b!=this.targetLiveWindow&&(b==null?this.removeAttribute(Se.TARGET_LIVE_WINDOW):this.setAttribute(Se.TARGET_LIVE_WINDOW,`${+b}`))}get liveEdgeStart(){var b,k;if(this.hasAttribute(Se.LIVE_EDGE_OFFSET)){let{liveEdgeOffset:I}=this,F=(b=this.nativeEl.seekable.end(0))!=null?b:0,H=(k=this.nativeEl.seekable.start(0))!=null?k:0;return Math.max(H,F-I)}return Bu(this.nativeEl)}get liveEdgeOffset(){if(this.hasAttribute(Se.LIVE_EDGE_OFFSET))return+this.getAttribute(Se.LIVE_EDGE_OFFSET)}set liveEdgeOffset(b){b!=this.targetLiveWindow&&(b==null?this.removeAttribute(Se.LIVE_EDGE_OFFSET):this.setAttribute(Se.LIVE_EDGE_OFFSET,`${+b}`))}get seekable(){return Do(this.nativeEl)}async addCuePoints(b){return Ao(this.nativeEl,b)}get activeCuePoint(){return ko(this.nativeEl)}get cuePoints(){return yu(this.nativeEl)}getStartDate(){return Tu(this.nativeEl,this._hls)}get currentPdt(){return _u(this.nativeEl,this._hls)}get preferPlayback(){let b=this.getAttribute(Se.PREFER_PLAYBACK);if(b===Ti.MSE||b===Ti.NATIVE)return b}set preferPlayback(b){b!==this.preferPlayback&&(b===Ti.MSE||b===Ti.NATIVE?this.setAttribute(Se.PREFER_PLAYBACK,b):this.removeAttribute(Se.PREFER_PLAYBACK))}get metadata(){return{...this.getAttributeNames().filter(b=>b.startsWith("metadata-")&&![Se.METADATA_URL].includes(b)).reduce((b,k)=>{let I=this.getAttribute(k);return I!=null&&(b[k.replace(/^metadata-/,"").replace(/-/g,"_")]=I),b},{}),...le(this,Qi)}}set metadata(b){tt(this,Qi,b??{}),this.mux&&this.mux.emit("hb",le(this,Qi))}load(){tt(this,Sr,Ku(this,this.nativeEl,le(this,Sr)))}unload(){Po(this.nativeEl,le(this,Sr)),tt(this,Sr,void 0)}attributeChangedCallback(b,k,I){var F,H;switch(Ha.observedAttributes.includes(b)&&!["src","autoplay","preload"].includes(b)&&super.attributeChangedCallback(b,k,I),b){case Se.PLAYER_SOFTWARE_NAME:this.playerSoftwareName=I??void 0;break;case Se.PLAYER_SOFTWARE_VERSION:this.playerSoftwareVersion=I??void 0;break;case"src":{let G=!!k,j=!!I;!G&&j?nt(this,Yn,za).call(this):G&&!j?this.unload():G&&j&&(this.unload(),nt(this,Yn,za).call(this));break}case"autoplay":if(I===k)break;(F=le(this,Sr))==null||F.setAutoplay(this.autoplay);break;case"preload":if(I===k)break;(H=le(this,Sr))==null||H.setPreload(I);break;case Se.PLAYBACK_ID:this.src=Pu(I??void 0,{maxResolution:this.maxResolution,domain:this.customDomain});break;case Se.DEBUG:{let G=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this._hls&&(this._hls.config.debug=G);break}case Se.METADATA_URL:I&&fetch(I).then(G=>G.json()).then(G=>this.metadata=G).catch(()=>console.error(`Unable to load or parse metadata JSON from metadata-url ${I}!`));break;case Se.STREAM_TYPE:(I==null||I!==k)&&this.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}));break;case Se.TARGET_LIVE_WINDOW:(I==null||I!==k)&&this.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0,detail:this.targetLiveWindow}));break}}disconnectedCallback(){this.unload()}};Sr=new WeakMap,Xi=new WeakMap,qn=new WeakMap,Qi=new WeakMap,jn=new WeakMap,Vn=new WeakMap,Wn=new WeakMap,Yn=new WeakSet,za=async function(){le(this,Xi)||(await tt(this,Xi,Promise.resolve()),tt(this,Xi,null),this.load())};Kn.customElements.get("mux-video")||(Kn.customElements.define("mux-video",mo),Kn.MuxVideoElement=mo);function ld(b){let k,I,F,H,G,j,V,Y,oe,z,te,Re='<iframe title="Juan Serrano Studio video reel." src="https://player.vimeo.com/video/838845033?h=4f99954369&amp;color=ffffff" style="position:absolute;top:0;left:0;width:100%;height:100%;" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen=""></iframe>',ce,de,xe="",Ae,Qe,ee,fe,Te;return document.title=k="About | "+$s,{c(){I=Vi(),F=xr("section"),H=xr("div"),G=xr("div"),j=Vi(),V=xr("h1"),Y=eo("— "),oe=eo(b[0]),z=Vi(),te=xr("div"),te.innerHTML=Re,ce=Vi(),de=xr("script"),de.innerHTML=xe,Qe=Vi(),ee=xr("div"),fe=xr("img"),this.h()},l(De){iu("svelte-1mzuqc9",document.head).forEach(Or),I=Wi(De),F=Mr(De,"SECTION",{class:!0});var $=Yi(F);H=Mr($,"DIV",{class:!0});var T=Yi(H);G=Mr(T,"DIV",{class:!0});var Z=Yi(G);Z.forEach(Or),j=Wi(T),V=Mr(T,"H1",{class:!0});var N=Yi(V);Y=to(N,"— "),oe=to(N,b[0]),N.forEach(Or),z=Wi(T),te=Mr(T,"DIV",{class:!0,style:!0,["data-svelte-h"]:!0}),ro(te)!=="svelte-1f2bh08"&&(te.innerHTML=Re),ce=Wi(T),de=Mr(T,"SCRIPT",{src:!0,["data-svelte-h"]:!0}),ro(de)!=="svelte-13fxq40"&&(de.innerHTML=xe),T.forEach(Or),Qe=Wi($),ee=Mr($,"DIV",{class:!0});var ye=Yi(ee);fe=Mr(ye,"IMG",{src:!0,alt:!0,class:!0}),ye.forEach(Or),$.forEach(Or),this.h()},h(){ur(G,"class","prose md:prose-lg"),ur(V,"class","mt-5 font-serif text-2xl font-bold md:text-4xl"),ur(te,"class","relative mt-20"),nu(te,"padding","56.25% 0 0 0"),Js(de.src,Ae="https://player.vimeo.com/api/player.js")||ur(de,"src",Ae),ur(H,"class","w-full px-2.5 md:w-1/2 md:overflow-y-scroll md:p-10"),Js(fe.src,Te=b[2])||ur(fe,"src",Te),ur(fe,"alt",b[3]),ur(fe,"class","object-cover"),ur(ee,"class","flex w-full overflow-hidden md:h-full md:max-h-screen md:w-1/2 md:flex-col"),ur(F,"class","mx-auto flex flex-col-reverse gap-y-5 pb-20 md:h-full md:flex-row md:gap-y-0 md:pb-0")},m(De,we){io(De,I,we),io(De,F,we),Kt(F,H),Kt(H,G),G.innerHTML=b[1],Kt(H,j),Kt(H,V),Kt(V,Y),Kt(V,oe),Kt(H,z),Kt(H,te),Kt(H,ce),Kt(H,de),Kt(F,Qe),Kt(F,ee),Kt(ee,fe)},p(De,[we]){we&0&&k!==(k="About | "+$s)&&(document.title=k)},i:Zs,o:Zs,d(De){De&&(Or(I),Or(F))}}}function ud(b,k,I){let{data:F}=k;console.log(JSON.stringify(F.info.about,null,2));const{ownerName:H,ownerBio:{html:G},ownerPicture:{url:j,alt:V}}=F.info.about;return b.$$set=Y=>{"data"in Y&&I(4,F=Y.data)},[H,G,j,V,F]}class gd extends tu{constructor(k){super(),ru(this,k,ud,ld,eu,{data:4})}}export{gd as component,fd as universal};
